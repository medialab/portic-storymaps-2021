{"version":3,"sources":["visualizations/PrincipalVisualizationPart3/ExtraversionObject.js","visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js","components/SigmaComponent/reducers.js","components/SigmaComponent/GraphContainer.js","contents/fr/footer.mdx","helpers/hooks.js","components/TriangleComponent/PortGroup.js","components/TriangleComponent/TriangleComponent.js","colorPalettes.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","contents/fr/partie-1.mdx","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2-intro.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/about.mdx","contents/fr/references.mdx","contents/en/references.mdx","contents/en/tests.mdx","components/SvgComponent/SvgComponent.js","components/GeoComponent/index.js","components/SigmaComponent/index.js","components/TriangleComponent/index.js","components/BezierComponent/index.js","components/BezierComponent/BezierComponent.js","components/DataProvider/index.js","components/DataProvider/DataProvider.js","components/LineChart/LineChart.js","contents/fr/tests.mdx","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","helpers/misc.js","components/Caller/Caller.js","components/Caller/index.js","components/GeoComponent/ChoroplethLayer.js","components/GeoComponent/PointsLayer.js","components/GeoComponent/FlowsLayer.js","components/GeoComponent/CustomObjectLayer.js","components/GeoComponent/Button.js","components/GeoComponent/Input.js","components/GeoComponent/Legend.js","components/GeoComponent/GeoComponent.js","../ /^/.//.*$/ groupOptions: {} namespace object","visualizations/Test.js","components/DeclineComponent/LongitudinalTradeChart.js","components/DeclineComponent/ProductsDistributionChart.js","components/DeclineComponent/index.js","components/DeclineComponent/DeclineComponent.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialComponent/CircularAlluvialComponent.js","components/CircularAlluvialComponent/utils.js","components/SliderRange/SliderRange.js","components/SliderRange/index.js","components/RadioButton/index.js","components/RadioButton/RadioButton.js","components/RadarPlot/index.js","components/RadarPlot/RadarPlot.js","visualizations/PrincipalVisualizationPart2/RadarWrapper.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/Step2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/IntroBureaux/IntroBureaux.js","visualizations/IntroBureaux/index.js","visualizations/HomeportFlows/HomeportFlows.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","components/VisualizationFocus/VisualizationFocus.js","components/VisualizationFocus/index.js","pages/ScrollyPage/ScrollyPage.js","pages/ScrollyPage/index.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","pages/StandaloneVisualization/index.js","pages/StandaloneVisualization/StandaloneVisualization.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/contexts.js","contents/fr/metadata.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/BarChart.js","components/BarChart/index.js","contents/en/metadata.js"],"names":["ExtraversionObject","navigoValues","metric1","metric2","toflitPct","transformGroup","circleRadius","width","height","name","legendMode","isActive","isMinified","onClick","useState","isInited","setIsInited","useEffect","setTimeout","ReactTooltip","rebuild","leftPath","rightPath","transform","useSpring","to","immediate","maxTriangleHeight","maxArea","area1","area2","leftTriangleHeight","Math","sqrt","rightTriangleHeight","start","end","PI","partialCircle","map","command","join","labelFontSize","parseInt","g","className","cx","undefined","d","stroke","colorsPalettes","generic","accent2","stroke-width","fill","data-for","data-tip","toFixed","ui","colorAccentBackground","max","font-size","textAnchor","x","y","x1","y1","x2","y2","marker-end","Step3Object","datum","projection","projectionTemplate","longitude","latitude","totalTonnage","parseFloat","cumulated_tonnage_out_region","cumulated_tonnage_in_region","type_of_object","navigoMetric1","navigoMetric2","inPercentage","totalValue","cumulated_exports_value_from_region","cumulated_exports_value_from_ext","noOverlapTransform","includes","isNaN","Step3Objects","data","customsOffices","ports","selectedBureau","setSelectedBureau","handleClick","visiblePorts","useMemo","filter","customs_office","portsSpaceStartY","portsSpaceHeight","portsSpaceWidth","portRowHeight","length","sort","a","b","yA","port","portIndex","initialCircleRadius","objectX","objectY","cy","r","style","dark","index","SmallMultiples","bureaux","unshift","margin","multiplesY","columnWidth","xObjectsStart","opacity","position","left","bottom","custom_office","id","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient","renderTriangles","atlasMode","TriangleComponent","totalWidth","rowHeight","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","ratio","sizes","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","field","values","attr","uniq","palette","colors","generatePalette","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","smallerNode","Color","lighten","rgb","string","createEdgeReducer","container","useRef","renderer","setRenderer","getCamera","animate","needToRefresh","settings","labelGrid","cell","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","labelFont","camera","setState","getState","disable","on","state","current","ref","minHeight","minWidth","SigmaComponent","gexfString","spatialize","inputCameraPosition","angle","title","headerRef","headerHeight","getBoundingClientRect","setCameraPosition","find","prop","gexf","parse","Graph","forceAtlas2","inferSettings","assign","iterations","flex","cam","readingTime","layoutProps","MDXContent","components","props","mdxType","parentName","isMDXComponent","tableOfContents","level","children","frontMatter","useInterval","callback","delay","savedCallback","setInterval","clearInterval","useDebounce","value","debouncedValue","setDebouncedValue","handler","clearTimeout","PortGroup","numberOfColumns","scaleX","scaleY","legendWidth","totalHeight","margins","fontSize","triangleWidth","nb_pointcalls_out","triangleHeight","mean_tonnage","xTransform","yTransform","markerRadius","staticTransform","cellCenterX","textStartY","triangleStartY","legendTextWidth","labelBgWidth","line","strokeDasharray","circle","marker-start","xmlns","transformOrigin","inputMargins","right","offset","stopColor","stop-opacity","xa","tonnageClasses","step","highlight","SvgComponent","GeoComponent","BezierComponent","dataFilename","setData","loadingData","setLoadingData","dataURL","process","then","csvString","newData","csvParse","catch","err","require","None","console","log","border","DataProvider","str","extension","split","pop","backgroundData","visData","layers","type","renderObjects","colorPalettes","provinces","admiralties","label","backgroundFilename","markerColor","markerSize","showLabels","PASS_DURATION","Hull","bottomRightX","bottomLeftX","Sail","sailSpeed","distance","randomFactor","random","minRightX","maxLeftX","maxRightX","step1","points","step2","loop","from","config","duration","polygon","Matt","secondWidth","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","BoatsIllustration","useReducer","action","Object","entries","reduce","boat","payload","genId","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","now","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","lang","currentMetadata","trimText","limit","words","output","slice","cartesian2Polar","radians","atan2","count","accent1","iwanthue","colorSpace","seed","clustering","Caller","visualizationId","useContext","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","e","GeoPart","initialD","project","layer","currentD","animationProps","path","tooltip","properties","ChoroplethLayer","reverseColors","geoPath","info","features","colorValues","generatedPalette","PointGroup","onGroupMouseEnter","onGroupMouseLeave","displayLabel","area","rawSize","labelPosition","labelSize","zIndex","onMouseEnter","onMouseMove","onMouseLeave","displayMetric","labelsColor","StackedLabelGroup","thatIndex","stackedRowHeight","transformLabel","window","innerWidth","labelY","PointsLayer","hoveredIndex","setHoveredIndex","visibleMarkers","coordsMap","mark","grouped","sizeCoef","custom","areaRange","sizeScale","labelSizeScale","stackedLabelsTop","maxLabelFontSize","innerHeight","stackLabels","items","enter","leave","displayLabels","FlowGroup","arrowSize","inputXDep","xDep","inputYDep","yDep","inputXDest","xDest","inputYDest","yDest","inputStrokeWidth","strokeWidth","cp1X","cp1Y","cp2X","cp2Y","labelDepTransform","labelDestTransform","arrowPath","fields","FlowsLayer","markerData","strokeWidthScale","flow","arrowSizeScale","copy","latitude_dep","longitude_dep","latitude_dest","longitude_dest","CustomObjectLayer","renderObject","Button","onMouseDown","isMouseDown","interval","onMouseUp","background","Input","inputValue","onBlur","setValue","onChange","target","Legend","hasSize","hasColors","colorModalities","modality","initialProjectionTemplate","inputProjectionConfig","projectionConfig","debug","withLegend","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","setProjectionTemplate","defaultProjectionConfig","rotationDegree","geoEqualEarth","center","translate","placeHolder","val","layerIndex","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","keys","module","exports","Test","datasets","datasetName","JSON","stringify","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","fillGaps","barTooltipFn","cityName","highlightYears","colorScaleMessages","annotations","year","footerRef","setHeight","newHeight","offsetHeight","yearsExtent","yearsEnumerated","xBand","scaleBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","nice","top","yShareScale","rightYAxisValues","axisPropsFromTickScale","leftYAxisValue","marginLeft","maximum","minimum","marginRight","bandwidth","aStartYear","aEndYear","annotation","annotationIndex","patternUnits","replace","data-effect","data-html","data-class","data-place","next","initialEndYear","row","markerEnd","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","sum","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","flows","her","labelScale","element","maxWidth","backgroundColor","DeclineComponent","productTradePartThreshold","rows","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","austriaWar","usIndependance","laRochelleDiaspora","totalRows","renderRow","rowFlex","rowIndex","region","comparison","rowId","PrincipalVisualizationPart1","colorSchemes","colorScheme1","colorScheme2","colorScheme3","CircularAlluvialComponent","sumBy","inputHeight","filters","centerHorizontalLabels","displaceHorizontalLabels","tooltips","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","spec","stepsSpec","_id","stepIndex","stepData","groups","groupBy","valueAbs","actualValue","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","abs","VERTICAL_BAR_SIZE","stepScales","0","orientation","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","tooltipContent","fontWeight","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","cos","sin","flow_type","partner","tContent","trim","nodeHeight","initialY","initialHeight","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","flowX","flowY","flowWidth","flowHeight","Range","createSliderWithTooltip","Slider","SliderRange","allowCross","RadioButton","checked","aria-label","htmlFor","RadarPlot","captions","initialSize","RadarWrapper","globalWidth","minified","bureau","navigoAgregation","minTonnage","maxTonnage","aggregationMethod","setAggregationMethod","dataFilteredTonnage","setDataFilteredTonnage","dataFilteredTonnageFerme","setDataFilteredTonnageFerme","fermeCaptions","setFermeCaptions","destCaptions","setDestCaptions","tonnageData","setTonnageData","travelData","setTravelData","radarData","setRadarData","valueSlider","setValueSlider","upperSlider","setUpperSlider","colorAll","prepareTravelData","datas","_","dest","rObj","prepareTonnageData","rescale","maxValue","maxBy","hasOwnProperty","dkey","filtered","ferme","item","tonnage","ferme_bureau","radioAggType","newAgMethod","destination_radar","uniqBy","obj","prepareDestCaptions","meta","displayData","isEmpty","el","PrincipalVisualizationPart2","showOnlyToflit","sumToflitBy","alluvialFilters","titles","labels","Step2","paddingLeft","BarChart","layout","metrics_type","PrincipalVisualizationPart3","currentMapTemplate","setCurrentMapTemplate","gradientTransform","colorBackgroundBlue","customs_region","BureauBackground","radius","BureauLabel","labelOnRight","thatWidth","IntroBureaux","dimensions","renderBureaux","HomeportFlows","currentProjectionTemplate","setCurrentProjectionTemplate","VisualizationContainer","inputDimensions","DatasetsContext","relevantDatasets","viz","visualizationsList","datasetsIds","order","tickSpan","tickFormat","value_rel_per_direction","entity","portion","autoSort","ascending","nb_outs","shortname","VisualizationController","setDimensions","visProps","omit","bounds","onResize","contentRect","measureRef","VisualizationFocus","howDone","howRead","visualization","onClose","copyClicked","setCopyClicked","copyLink","linkCopied","stopPropagation","url","homepage","visualizationsMap","visualizations","ScrollyPage","ContentSync","sectionRef","focusOnViz","setFocusOnViz","visualizationIsFullScreen","setVisualizationIsFullScreen","setActiveVisualization","newState","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","visualizationEntries","sectionDims","visY","Provider","behavior","params","finalParams","newVis","thatId","Helmet","summary","routes","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","ReferencesFr","ReferencesEn","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","itemIndex","route","navigator","userAgent","Home","match","introRef","inVis","setInVis","titleHTML","subtitle","newActiveVisualization","firstOneY","Infinity","dangerouslySetInnerHTML","__html","Atlas","history","useHistory","shownVisualization","visualizationIndex","pathname","src","alt","StandaloneVisualization","PlainPage","Content","contentsURL","fallback","colorText","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","tsvParse","error","newDatasets","renderRoute","ThatComponent","ln","otherLang","pathOtherLang","routeItem","React","lazy","component","Fragment","BASE_NAME","Wrapper","basename","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","createContext","HorizontalBarChart","initialWidth","headersHeight","setHeadersHeight","legendRef","Tooltip","newHeadersHeight","colorPalette","yTickFormat","yTickSpan","initialYDomain","yField","sortY","xTickFormat","xTickSpan","initialXDomain","fillXGaps","xField","sortX","sortYField","sortYAscending","sortYType","yAutoSort","sortXField","sortXAscending","sortXType","xValues","vizWidth","xDomain","bandsNb","xScale","xExtent","yDomain","bandWidth","yScale","yStackScale","xAxisValues","yAxisValues","valueIndex","axis","thatHeight","thatY1","thatY2","thatX1","thatX2","multiplier","groupIndex","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","setLegendWidth","newLegendWidth","fixedRowHeight","formatLabel","vizHeight","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX"],"mappings":"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","file":"static/js/main.c9b7cd2b.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\nimport { animated, useSpring } from 'react-spring';\nimport cx from 'classnames';\nimport colorsPalettes from '../../colorPalettes';\n\nimport partialCircle from 'svg-partial-circle';\nimport { max } from 'd3';\nimport ReactTooltip from 'react-tooltip';\n\n\nconst ExtraversionObject = ({\n  navigoValues: [metric1, metric2],\n  toflitPct,\n  transformGroup,\n  circleRadius,\n  width,\n  height,\n  name,\n  legendMode,\n  isActive,\n  isMinified,\n  onClick,\n}) => {\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  const { transform } = useSpring({\n    to: {\n      transform: transformGroup\n    },\n    immediate: !isInited\n  });\n\n\n  const maxTriangleHeight = (circleRadius) * 1.4;\n  // dimensionning triangles based on their area (and not triangle height)\n  // Area = (height * base) / 2;\n  const maxArea = maxTriangleHeight * (maxTriangleHeight) / 2;\n  const area1 = metric1 * maxArea;\n  const area2 = metric2 * maxArea;\n  const leftTriangleHeight = Math.sqrt(area1 * metric1);\n  const rightTriangleHeight = Math.sqrt(area2 * metric2);\n\n  let start = null\n  let end = null\n  let leftPath;\n  let rightPath;\n  if (toflitPct) {\n    // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement rparti en bas  droite si co sans coords\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (toflitPct - 50) / 100 * Math.PI\n    end = Math.PI * 3 / 2 - (toflitPct - 50) / 100 * Math.PI\n\n    leftPath = partialCircle(\n      0, 0,         // center X and Y\n      circleRadius,              // radius\n      start,          // start angle in radians --> Math.PI / 4\n      end             // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n    rightPath = partialCircle(\n      0, 0,             // center X and Y\n      circleRadius,                  // radius\n      start,              // start angle in radians --> Math.PI / 4\n      end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n  }\n\n  let labelFontSize = parseInt(height * 0.013);\n  labelFontSize = labelFontSize > 8 ? labelFontSize : 8;\n  return (\n    <animated.g\n      className={cx('ExtraversionObject', { 'is-active': isActive, 'is-minified': isMinified })}\n      // transform={noOverlapTransform}\n      transform={transform}\n      onClick={() => typeof onClick === 'function' ? onClick(name) : undefined}\n    // { datum.longitude === 0 ? x=1 : null }\n    >\n\n      <>\n        {\n          toflitPct && leftPath != null ?\n            <>\n\n              <path\n                d={`${leftPath}\n                  `}\n                stroke={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n                stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={`${(100 - toflitPct ).toFixed(1)}% de valeur d'exports de produits fabriqus hors de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n              />\n\n              <path\n                d={`${rightPath}\n                  `}\n                stroke={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n                stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={`${(toflitPct).toFixed(1)}% de valeur d'exports de produits fabriqus dans la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n              />\n            </>\n            :\n            null\n        }\n        <path className='left-triangle'\n          fill={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n          d={`M ${0} ${-leftTriangleHeight / 2}\n            V ${leftTriangleHeight / 2}\n            L ${-leftTriangleHeight} ${0}\n            Z\n                `}\n                data-for=\"geo-tooltip\"\n                data-tip={`${(metric1 * 100 ).toFixed(1)}% du tonnage cumul des voyages raliss vers l'extrieur de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n        />\n\n        <path\n          className='right-triangle'\n          fill={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n          d={`M ${0} ${-rightTriangleHeight / 2}\n            L ${rightTriangleHeight} ${0}\n            L ${0} ${rightTriangleHeight / 2}\n            Z\n            `}\n            data-for=\"geo-tooltip\"\n            data-tip={`${(metric2 * 100 ).toFixed(1)}% du tonnage cumul des voyages raliss vers l'intrieur de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n        />\n        <g\n          transform={`translate(${parseInt(0)}, ${toflitPct ? parseInt(circleRadius) + 15 : max([leftTriangleHeight, rightTriangleHeight]) / 2 + 10})`}\n        >\n          <text\n            className='object-label'\n            font-size={labelFontSize}\n            textAnchor=\"middle\"\n          >\n            {name}\n          </text>\n        </g>\n      </>\n      {\n        legendMode ?\n          <g className=\"legend-container\">\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={-circleRadius * 1.7}\n              className=\"top left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des exports de produits fabriqus hors de la direction\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * .95}\n              y1={-circleRadius * 1.5}\n              x2={-circleRadius * .5}\n              y2={-circleRadius * 1}\n              marker-end=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={-circleRadius * 1.7}\n              className=\"top right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des exports de produits fabriqus dans la direction\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 1.15}\n              y1={-circleRadius * 1.5}\n              x2={circleRadius * .5}\n              y2={-circleRadius * 1}\n              marker-end=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={0}\n              className=\"bottom left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des voyages hors direction (tonnage c.)\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * 1.8}\n              y1={circleRadius * .2}\n              x2={-circleRadius * .3}\n              y2={circleRadius * .1}\n              marker-end=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={0}\n              className=\"bottom right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des voyages dans la direction (tonnage c.)\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 2}\n              y1={circleRadius * .2}\n              x2={circleRadius * .3}\n              y2={circleRadius * .1}\n              marker-end=\"url(#triangle-end)\"\n            />\n\n          </g>\n          : null\n      }\n    </animated.g>);\n}\n\nexport default ExtraversionObject;","/*\nDOCUMENTATION : sommaires des fonctions\n\n- renderLabel (renderObject)\npositionner geographiquement des labels\n\n- renderStep3Object (renderObject)\ncration d'un double triangle et d'un cercle autour (deux courbes de bzier), positionn gographiquement\n(objet associ  un bureau de ferme)\n\n- fonction renderStep3SmallMultiples (renderObjects)\ncration des objets double triangle et cercles pour les small multiples de la viz 3.3, positionns en bas  droite du SVG\n+ un objet de lgende\n\n- renderTriangles (renderObjects)\ncration des triangles pour la viz 3.1, relis par une courbe pointille  des points positionns gographiquement\n+ un triangle de lgende\n\n@TODO : complter la fonction step3Object (ou crer une nouvelle fonction), pour grer l'apparition des doubles triangles pour chaque port\n-  cette fonctionnalit est dj prvue dans la fonction renderStep3Object (dans la boucle   if (datum.type_of_object === \"port\") { ...}) mais en l'tat les objets ports sont positionns gographiquement\n- il faudrait adapter pour positionner les objets ports en colonne, sur la gauche du SVG, et qu'ils aient par dfaut une opacit  0% sauf au hover de l'objet bureau des fermes correspondant => apparition\n\n*/\nimport { useMemo, useState } from 'react';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport ExtraversionObject from './ExtraversionObject';\n\nimport TriangleComponent from '../../components/TriangleComponent/TriangleComponent';\n\nexport function Label(datum, projection, { width }) { //  terme on pourrait mettre un objet \n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text size={width * 0.05}>{datum.label}</text>\n    </g>);\n}\n\nfunction Step3Object({\n  datum,\n  projection,\n  width,\n  height,\n  projectionTemplate,\n  isActive,\n  isMinified,\n  onClick\n}) { //  priori plus besoin de datum et de width qui sont dj passs au composant CustomObjectLayer\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  let circleRadius = width * 0.05;\n  const totalTonnage = parseFloat(datum.cumulated_tonnage_out_region) + parseFloat(datum.cumulated_tonnage_in_region)\n\n  if (datum.type_of_object === \"port\") {\n    // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n    // se grerait bien avec un switch\n    if (totalTonnage < 1000) { // * 1000\n      circleRadius = width * 0.025\n    }\n    else {\n      if (totalTonnage > 5000) {\n        circleRadius = width * 0.075\n      }\n    }\n  }\n\n  const navigoMetric1 = parseFloat(datum.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n  const navigoMetric2 = parseFloat(datum.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n  let inPercentage = 0;\n  if (datum.type_of_object === \"customs_office\") {\n    const totalValue = parseFloat(datum.cumulated_exports_value_from_region) + parseFloat(datum.cumulated_exports_value_from_ext)\n    inPercentage = parseFloat(datum.cumulated_exports_value_from_region) / totalValue * 100\n    inPercentage = inPercentage === 100 ? 99.99 : inPercentage;\n  }\n\n  // handle overlap \n  let noOverlapTransform = `translate(${x},${y})` // mettre entre accolades ??\n  if (projectionTemplate.includes('Poitou')) {\n    if (datum.name === 'Tonnay-Charente') {\n      noOverlapTransform = `translate(${x + width * 0.16},${y})`\n    }\n    else if ((datum.name === 'Rochefort')) {\n      noOverlapTransform = `translate(${x + width * 0.04},${y - height * 0.0})`\n    }\n    else if ((datum.name === 'Marennes')) {\n      noOverlapTransform = `translate(${x - width * 0.03},${y + height * 0.05})`\n    }\n    else if ((datum.name === 'Marans')) {\n      noOverlapTransform = `translate(${x + width * 0.03},${y - height * 0.05})`\n    }\n    else if ((datum.name === 'Saint-Martin-de-R')) {\n      noOverlapTransform = `translate(${x - width * 0.06},${y})`\n    }\n    else if ((datum.name === `Les Sables-d'Olonne`)) {\n      noOverlapTransform = `translate(${x - width * 0.1},${y - height * 0.1})`\n    }\n  }\n  \n\n  const transformGroup = projectionTemplate === 'France' ? noOverlapTransform + ' scale(0.1)' : noOverlapTransform + ` scale(${isMinified ? 0.5 : 1})`;\n  return (\n    <ExtraversionObject\n      {\n      ...{\n        transformGroup,\n        navigoValues: [navigoMetric1, navigoMetric2],\n        toflitPct: !isNaN(inPercentage) ? inPercentage : 100,\n        circleRadius,\n        width,\n        height,\n        name: datum.name,\n        isActive,\n        isMinified,\n        onClick\n      }\n      }\n    />\n  )\n}\n\nexport function Step3Objects({\n  data: { customsOffices = [], ports = [] },\n  projection,\n  width,\n  height,\n  projectionTemplate\n}) {\n  const [selectedBureau, setSelectedBureau] = useState(undefined);\n  const handleClick = (name) => {\n    if (name === selectedBureau) {\n      setSelectedBureau(undefined);\n    } else setSelectedBureau(name);\n  }\n\n  const visiblePorts = useMemo(() => {\n    if (selectedBureau) {\n      return ports.filter(d => d.customs_office === selectedBureau)\n    }\n    return [];\n  }, [selectedBureau, ports])\n\n  const partsSpaceStartX = 15;\n  const portsSpaceStartY = height * 0.18;\n  const portsSpaceHeight = height * 0.55;\n  const portsSpaceWidth = width * .35;\n\n  const portRowHeight = visiblePorts.length ?  portsSpaceHeight / visiblePorts.length : portsSpaceHeight;\n\n  return (\n    <g className=\"Step3Objects\">\n      {\n        selectedBureau ?\n          <g className=\"ports-details\">\n            <foreignObject\n              x={0}\n              y={0}\n              width={width * .4}\n              height={height / 2}\n              className=\"ports-details-title\"\n            >\n              <h5>Ports associs au bureau des fermes de {selectedBureau} ({visiblePorts.length})</h5>\n            </foreignObject>\n            <g\n              className=\"ports-space\"\n              transform={`translate(${partsSpaceStartX}, ${portsSpaceStartY})`}\n            >\n              {/* <rect\n                x={0}\n                y={0}\n                width={portsSpaceWidth}\n                height={portsSpaceHeight}\n                style={{ fill: 'red' }}\n              /> */}\n              {\n                visiblePorts\n                .sort((a, b) => {\n                  const [_xA, yA] = projection([+a.longitude, +a.latitude]);/* eslint no-unused-vars : 0 */\n                  const [_xB, yB] = projection([+b.longitude, +b.latitude]);/* eslint no-unused-vars : 0 */\n                  if (yA > yB) {\n                    return 1;\n                  }\n                  return -1;\n                })\n                .map((port, portIndex) => {\n                  const [x, y] = projection([+port.longitude, +port.latitude]);\n                  const initialCircleRadius = width * 0.05;\n                  let circleRadius = initialCircleRadius;\n                  const totalTonnage = parseFloat(port.cumulated_tonnage_out_region) + parseFloat(port.cumulated_tonnage_in_region)\n\n                  // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n                  // se grerait bien avec un switch\n                  if (totalTonnage < 1000) { // * 1000\n                    circleRadius = width * 0.025\n                  }\n                  else {\n                    if (totalTonnage > 5000) {\n                      circleRadius = width * 0.075\n                    }\n                  }\n                  const navigoMetric1 = parseFloat(port.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n                  const navigoMetric2 = parseFloat(port.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n                  const objectX = portsSpaceWidth / 2 - initialCircleRadius * 2 + (visiblePorts.length > 5 ? portIndex % 2 === 0 ? 0 : initialCircleRadius * 2 : 0);\n                  const objectY = portRowHeight * portIndex;\n                  // const transformGroup = projectionTemplate === 'France' ? `translate(${x},${y})` + ' scale(0.1)' : `translate(${x},${y})` + ` scale(1)`;\n                  const transformGroup = `translate(${objectX}, ${objectY})`;\n                  return (\n                    <g className=\"port-group\" key={port.name}>\n                      <line\n                        x1={objectX}\n                        y1={objectY}\n                        x2={x - partsSpaceStartX}\n                        y2={y - portsSpaceStartY}\n                      />\n                      <circle\n                        cx={x - partsSpaceStartX}\n                        cy={y - portsSpaceStartY}\n                        r={width * 0.002}\n                        style={{ fill: colorsPalettes.generic.dark }}\n                        className=\"marker\"\n                      />\n                      <ExtraversionObject\n                        {\n                        ...{\n                          transformGroup,\n                          navigoValues: [navigoMetric1, navigoMetric2],\n                          circleRadius,\n                          width,\n                          height,\n                          name: port.name,\n                        }\n                        }\n                      />\n                    </g>\n                  )\n                })\n              }\n            </g>\n\n          </g>\n          : null\n      }\n      {\n        customsOffices.map((datum, index) => (\n          <Step3Object\n            key={datum.name}\n            {\n            ...{\n              datum,\n              projection,\n              width,\n              height,\n              projectionTemplate,\n              onClick: handleClick,\n              isActive: datum.name === selectedBureau,\n              isMinified: selectedBureau && datum.name !== selectedBureau\n            }\n            }\n          />\n        ))\n      }\n    </g>\n  )\n}\n\nexport function SmallMultiples({ data, width, height, projection }) {\n  // could be parametered in props too\n  const bureaux = data.filter(({ name }) => name === 'Le Havre' || name === 'Nantes' || name === 'Bordeaux' || name === 'La Rochelle')\n    .sort((a, b) => {\n      if (a.cumulated_exports_value_from_region > b.cumulated_exports_value_from_region) {\n        return -1;\n      }\n      return 1;\n    })\n  const legendCustomOffice = {\n    name: 'Lgende',\n    cumulated_tonnage_in_region: 60,\n    cumulated_tonnage_out_region: 60,\n    cumulated_exports_value_from_region: 50,\n    cumulated_exports_value_from_ext: 50,\n    legendMode: true\n  }\n  bureaux.unshift(legendCustomOffice)\n\n  const margin = 15;\n  let circleRadius = width * 0.05;\n  const multiplesY = height - circleRadius - margin * 2;\n\n  const legendFactor = 1;\n\n  const columnWidth = (circleRadius * 2 + margin);\n\n  const xObjectsStart = width * .4 // circleRadius * legendFactor + circleRadius + margin;\n\n  return (\n    <g className=\"small-multiples-and-legend-and-title\">\n      {/* <foreignObject\n        x={margin * 4}\n        y={multiplesY - circleRadius * 4}\n        width={circleRadius * 7}\n        height={height}\n        className=\"interaction-cta\"\n      >\n        <div>\n          cliquer sur un bureau des fermes pour voir le dtail de ses ports\n        </div>\n      </foreignObject> */}\n      <rect\n        x={xObjectsStart + margin * 2}\n        y={multiplesY - circleRadius * 3}\n        width={width - xObjectsStart - margin * 4}\n        height={height - multiplesY + circleRadius * 3 - margin / 2}\n        style={{ fill: 'white' }}\n        opacity={0.5}\n      />\n      <foreignObject\n        x={xObjectsStart + circleRadius * 1.5}\n        y={multiplesY - circleRadius * 3}\n        width={(circleRadius * 2 + margin) * (bureaux.length - 1)}\n        height={height}\n      >\n        <div style={{ position: 'relative' }}>\n          <h5 className=\"visualization-title\" style={{ position: 'absolute', left: 0, bottom: 0 }}>\n            Comparaison avec les bureaux de fermes et ports dominants d'autres directions en 1787\n          </h5>\n        </div>\n      </foreignObject>\n      <g className=\"small-multiples\">\n        {\n          bureaux\n            .map((custom_office, index) => {\n              const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n\n              const navigoMetric1 = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n              const navigoMetric2 = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n\n              const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n              const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n\n              return custom_office.legendMode ?\n                (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${circleRadius * legendFactor * 4 + margin + index * (circleRadius * legendFactor + margin)}, ${multiplesY - (circleRadius * legendFactor - circleRadius)})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius: circleRadius * legendFactor,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n                : (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${xObjectsStart + index * columnWidth}, ${multiplesY})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n            })\n        }\n\n      </g>\n      <defs>\n        <marker id=\"triangle-end\" viewBox=\"-10 0 10 10\"\n          refX=\"1\" refY=\"5\"\n          markerUnits=\"strokeWidth\"\n          markerWidth={width * 0.01}\n          markerHeight={width * 0.01}\n          orient=\"auto\">\n          <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n        </marker>\n      </defs>\n    </g>\n  );\n\n}\n\nexport function renderTriangles({ data, width, height, projection, projectionTemplate, atlasMode }) {\n  // console.log(\"data : layder.data \", data)\n  return (\n    <TriangleComponent\n      data={data}\n      totalWidth={width} // @TODO : il faudrait rduire cette width \n      rowHeight={height * 0.3}\n      projection={projection}\n      projectionTemplate={projectionTemplate}\n      atlasMode={atlasMode}\n    />\n  );\n}","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      // console.log('color the attr', nodeColor.name, attr[nodeColor.name]);\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      // console.log('size attr', nodeSize.name, attr);\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const smallerNode = sourceNodeSize < targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (smallerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = smallerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[smallerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React, { useCallback, useRef, useState, useEffect, useMemo } from 'react';\nimport gexf from 'graphology-gexf';\nimport forceAtlas2 from 'graphology-layout-forceatlas2';\nimport Graph from 'graphology';\nimport { WebGLRenderer as Renderer } from 'sigma';\nimport { scaleLinear } from 'd3-scale';\nimport { min, max, extent } from 'd3-array';\nimport { uniq } from 'lodash';\n// import get from 'axios';\n\nimport { createNodeReducer, createEdgeReducer } from './reducers';\nimport { generatePalette, usePrevious } from '../../helpers/misc';\n\n// import GraphControls from './GraphControls';\n\nimport './GraphContainer.scss';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\n// function rescale(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedReset(renderer);\n// }\n\n// function zoomIn(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedZoom(renderer);\n// }\n\n// function zoomOut(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedUnzoom(renderer);\n// }\n\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n  width,\n  height,\n  ratio,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n\n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable && nodeColorVariable.field) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable.field])\n      })\n      values = uniq(values);\n      let palette = {};\n      if (nodeColorVariable.palette) {\n        palette = nodeColorVariable.palette;\n      } else {\n        const colors = generatePalette(nodeColorVariable.field, values.length);\n        let i = 0;\n        values.forEach(option => {\n          palette[option] = colors[i];\n          i++;\n        });\n      }\n\n      return {\n        palette,\n        name: nodeColorVariable.field\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n        m.set(edge, { sourceNode: sourceAttributes, targetNode: targetAttributes })\n      });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n\n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n\n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n      const camera = renderer.getCamera();\n      // console.log('animate camera', camera);\n      camera.animate(cameraPosition);\n    }\n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n\n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n  useEffect(() => {\n    if (renderer) {\n      renderer.refresh();\n    }\n  }, [width, height])\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, { nodeReducer, edgeReducer });\n\n        newRenderer.settings.labelFont = 'IBM Plex Sans';\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        camera.setState({ ...camera.getState(), ratio: ratio || 1 });\n        camera.disable();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{ width: '100%', height: '100%', minHeight: '10vh', minWidth: '1vw' }}></div>\n      {/*renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )*/}\n    </div>\n  );\n}\n\n\nexport default function SigmaComponent({\n  data: gexfString,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  spatialize,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 },\n  width = 0,\n  height,\n  ratio,\n  title\n}) {\n  const headerRef = useRef(null);\n  const headerHeight = useMemo(\n    () => headerRef.current ? headerRef.current.getBoundingClientRect().height : 0, [headerRef.current])\n\n  // useState renvoie un state et un seter qui permet de le modifier\n  const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n\n  useEffect(() => {\n    if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n      setCameraPosition(inputCameraPosition);\n    }\n  }, [inputCameraPosition])\n\n  const onCameraUpdate = cam => {\n    setCameraPosition(cam);\n  }\n  const graph = useMemo(() => {\n    const g = gexf.parse(Graph, gexfString);\n    if (spatialize) {\n      const settings = forceAtlas2.inferSettings(g);\n      // To directly assign the positions to the nodes:\n      forceAtlas2.assign(g, {\n        settings,\n        iterations: 50\n      });\n    }\n    return g;\n  }, [gexfString]);\n\n  if (!graph) {\n    return null;\n  }\n  return (\n    <div className=\"SigmaComponent\" style={{ \n      width: '100%', \n      height: height || '100%',\n    }}>\n      <div ref={headerRef} className=\"row visualization-title-container\">\n        {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n      </div>\n      <div style={{\n        position: 'relative',\n        flex: 1,\n        // top: headerHeight,\n        // background: 'red',\n        // height: height - headerHeight\n      }}>\n\n        <GraphContainer\n          {\n          ...{\n            graph,\n            cameraPosition,\n            nodeColor,\n            nodeSize,\n            labelDensity,\n            nodeLabel,\n            ratio,\n            onCameraUpdate,\n            width,\n            height: height - headerHeight\n          }\n          }\n        />\n      </div>\n    </div>\n  )\n}","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.54,\"time\":32400,\"words\":108}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme ANR PORTIC se propose de croiser les donnes sur la navigation et sur la valeur du commerce tranger de la France  la veille de la Rvolution franaise pour mieux saisir les dynamiques commerciales  luvre. Pour ce faire, il offre des interfaces dinterrogation et de visualisation des donnes adaptes  des publics et des intrts varis.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placs sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est plac sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import { useEffect, useRef, useState } from 'react';\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}","import React, { useEffect, useState } from 'react';\nimport cx from 'classnames';\nimport { animated, useSpring } from 'react-spring';\n\nimport colorsPalettes from '../../colorPalettes';\n\n\nconst PortGroup = ({\n  numberOfColumns,\n  port,\n  scaleX,\n  scaleY,\n  legendWidth,\n  columnWidth,\n  totalHeight,\n  totalWidth,\n  projection,\n  index,\n  margins,\n  rowHeight,\n  fontSize,\n  projectionTemplate\n}) => {\n\n\n  const triangleWidth = scaleX(+port.nb_pointcalls_out)\n  const triangleHeight = scaleY(+port.mean_tonnage)\n\n  const xIndex = index % numberOfColumns;\n  // const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n  const xTransform = xIndex * columnWidth + margins.left // + (legendWidth + margins.left) * totalWidth;\n  const yTransform = totalHeight * 2.3;\n\n  // const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform, x1, y1, x2, y2, staticTransform, markerRadius } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`,\n      x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : x,\n      y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : y,\n      // x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : totalWidth * 0.1,\n      // y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : index * (totalHeight / numberOfColumns),\n\n      markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 0,\n      // markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 1,\n      \n      // x1: xTransform + columnWidth / 2,\n      // y1: yTransform + rowHeight / 7,\n      x2: x,\n      y2: y,\n      staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${x},${y}) scale(${projectionTemplate === 'rotated Poitou' ? 1 : 0.1})`\n      // staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${totalWidth * 0.1},${index * (totalHeight / numberOfColumns)}) scale(${projectionTemplate === 'France' ? 0.2 : 1})`\n    },\n    immediate: !isInited\n  });\n\n  const cellCenterX = columnWidth / 2;\n  const cellCenterY = rowHeight / 2;\n  const textStartY = rowHeight / 7;\n  const triangleStartY = cellCenterY + textStartY / 2 - triangleHeight / 2;\n  const legendTextWidth= totalWidth * 0.08;\n\n  let labelBgWidth = fontSize * 12;\n  if (port.port.length <= 10) {\n    labelBgWidth = fontSize * 6;\n  } else if (port.port.length <= 12) {\n    labelBgWidth = fontSize * 7;\n  } else if (port.port.length <= 15) {\n    labelBgWidth = fontSize * 8;\n  } else if (port.port.length <= 18) {\n    labelBgWidth = fontSize * 10;\n  }\n\n  return (\n    <g className={cx('port-point-and-triangle', {'is-minified': projectionTemplate !== 'rotated Poitou'})}>\n\n      <animated.line\n        x1={x1}\n        y1={y1}\n        x2={x2}\n        y2={y2}\n        stroke='grey'\n        strokeDasharray='2, 8'\n      />\n\n      <animated.g className='port-point' transform={transform}>\n        <animated.circle\n          cx={0}\n          cy={0}\n          r={markerRadius}\n          style={{ fill: colorsPalettes.generic.dark }}\n          className=\"marker\"\n        />\n      </animated.g>\n\n      <animated.g className='port-triangle'\n        // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n        transform={staticTransform}\n      >\n        {/* <rect\n          x={0}\n          y={0}\n          width={columnWidth}\n          height={rowHeight}\n          style={{stroke: 'red'}}\n        /> */}\n\n        {/* <path class='vertical-line'\n          d={`M ${cellCenterX} ${(rowHeight - triangleHeight) / 1.2} \n              V ${rowHeight / 7}\n              `}\n        /> */}\n        <path className='vertical-line'\n          d={`M ${cellCenterX} ${textStartY} \n              V ${triangleStartY}\n              `}\n        />\n\n        <g transform={`translate(${cellCenterX}, ${triangleStartY})`}>\n\n          <path className='triangle'\n            d={`M ${-triangleWidth / 2} ${0} \n                L ${triangleWidth / 2} ${0}\n                L ${0} ${triangleHeight}\n                Z\n                `}\n            fill=\"url(#TriangleGradient)\"\n          />\n          {/* <circle\n            fill=\"red\"\n            r={2}\n            cx={-triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={0}\n            cy={triangleHeight}\n          /> */}\n        </g>\n        <g className=\"local-legend\">\n          {/* horizontal line */}\n          <line\n            x1={cellCenterX - triangleWidth/2}\n            x2={cellCenterX + triangleWidth/2}\n            y1={triangleStartY - 3}\n            y2={triangleStartY - 3}\n            marker-start=\"url(#triangle-left)\" \n            marker-end=\"url(#triangle-right)\"\n          />\n          {/* vertical line */}\n          <line\n            x1={cellCenterX - triangleWidth/2 - 3}\n            x2={cellCenterX - triangleWidth/2 - 3}\n            y1={triangleStartY}\n            y2={triangleStartY + triangleHeight}\n            marker-start=\"url(#triangle-left)\" \n            marker-end=\"url(#triangle-right)\"\n          />\n          {/* pointing arrows */}\n          <path\n            d={`\n            M ${-(legendTextWidth* .2) - triangleWidth / 3} ${triangleStartY * .65}\n            Q ${cellCenterX - 10} ${triangleStartY * .65} ${cellCenterX - 2} ${triangleStartY - 5}\n            `}\n            marker-end=\"url(#triangle-right)\"\n          />\n          <path\n            d={`\n            M ${-triangleHeight / 3 + 3} ${triangleStartY + triangleHeight * .6 + 7}\n            L ${cellCenterX - triangleWidth/2 - 3} ${triangleStartY + triangleHeight * .6 + 7}\n            `}\n            marker-end=\"url(#triangle-right)\"\n          />\n          <foreignObject \n            y={triangleStartY / 2}\n            x={-legendTextWidth - triangleWidth / 3}\n            width={legendTextWidth}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n             nombre de navires sortis du port en 1789 : <strong>{port.nb_pointcalls_out}</strong>\n            </span>\n          </foreignObject>\n          <foreignObject \n            x={-legendTextWidth - triangleWidth / 3}\n            y={triangleStartY + triangleHeight * .6}\n            width={totalWidth * 0.08}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n              tonnage moyen des navires : <strong>{(+port.mean_tonnage || 0).toFixed(1)}</strong>\n            </span>\n          </foreignObject>\n          \n        </g>\n        <g className='label' transformOrigin=\"bottom left\" transform={`translate(${columnWidth / 2}, ${rowHeight / 7 - totalHeight * 0.025})`}>\n          <path\n            d={`M 0 ${-fontSize} L ${labelBgWidth} ${-fontSize} ${labelBgWidth - 5} ${(-fontSize + fontSize * 0.2) / 2} ${labelBgWidth} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // d={`M 0 ${-fontSize} L ${port.port.length * fontSize * .64} ${-fontSize} ${port.port.length * fontSize * .64 - 5} ${(-fontSize + fontSize * 0.2) / 2} ${port.port.length * fontSize * .64} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // x={0}\n            // y={-fontSize}\n            // height={fontSize * 1.2}\n            // width={port.port.length * fontSize * .65}\n            style={{ fill: colorsPalettes.generic.dark }}\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n          />\n          <text\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n            font-size={fontSize}\n            style={{ fill: 'white' }}\n            x={3}\n            y={0}\n            textAnchor=\"left\"\n          > {port.port} </text>\n        </g>\n\n      </animated.g>\n    </g>\n  )\n}\n\nexport default PortGroup;","/* DOCUMENTATION : API de ce TriangleComponent\n\n  Principe :\n    Composant conu spcifiquement pour les triangles de la viz 3.1, mais pourrait tre dclin\n    -> permet de produire une srie d'objets en SVG, qui se disposent dans une grille en fonction de la longueur du dataset, et les dimensions de cette grille sont paramtrables\n\n  Paramtres : \n    data : donnes  afficher sur la carte,\n    totalWidth : largeur totale du composant (1 objet de lgende + grille d'objets) (par dfaut  1200 px)\n    legendWidth : largeur de la lgende (par dfaut  un dizime de la largeur totale)\n    margins : marges de gauche (entre l'objet de la lgende et la grille) et de froite (entr la droite de la grille et l'extrmit droite de l'cran)\n    rowHeight : hauteur d'une ligne de la grille (par dfaut  200px)\n    projection : on passe en paramtre la projection de d3 geo pour pouvoir donner accs au positionnement gographique sur une carte (permet dans le cas de la viz 3.1 de lier les triangles au point de localisation gographique du port qu'ils reprsentent => point et triangle sont nest dans un mme objet, ce qui permet d'tablir une courbe pointille entre eux et grer l'interaction avec des jeux d'opacit au hover)\n\n  Pistes d'amlioration : \n  - filtrer les objets  l'entre ? (par exemple pour la viz 3.1 on pourrait choisir d'afficher le triangle associ  un port que si les dimensions dpassent un certain seuil) => cela permettrait d'allger la carte, en affichant seulement les ports pour lesquels on a des donnes reprsentatives\n\n  @TODO : documenter ce component de maire standardise\n  */\n\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\nimport cx from 'classnames';\n\nimport './TriangleComponent.scss'\nimport colorsPalettes from '../../colorPalettes';\n\n// import TriangleLegend from './TriangleLegend';\nimport PortGroup from './PortGroup';\n\n\nconst TriangleComponent = ({\n  data,\n  totalWidth = 1200,\n  legendWidth = 0.1,\n  margins: inputMargins,\n  rowHeight = 200,\n  projection,\n  projectionTemplate,\n  atlasMode\n}) => {\n\n  const margins = inputMargins ||  {\n    left: totalWidth * .1,\n    right: totalWidth * .1\n  }\n  // {\n  //   left: 0.0,\n  //   right: 0.09\n  // }\n  const numberOfColumns = data.length;\n  const columnWidth = (totalWidth - margins.left - margins.right) / (numberOfColumns) // (totalWidth * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns; // (totalWidth) / (numberOfColumns + 4) //\n  const numberOfRows = data.length / numberOfColumns;\n  const totalHeight = numberOfRows * rowHeight;\n  const fontSize = totalHeight * 0.05;\n\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n    // ]).range([0, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n  ]).range([5, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([5, rowHeight * 0.85]); // pour l'instant j'ai mis le max de longueur  85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupe par le texte]\n\n  // const legendTriangleWidth = 35;\n  // const legendTriangleHeight = 60;\n\n  return (\n\n    <g className={cx(\"TriangleComponent\", {'is-atlas-mode': atlasMode})}>\n\n      <defs>\n        <linearGradient id=\"TriangleGradient\" x2='0%' y2='100%'>\n          <stop offset=\"10%\" stopColor={`rgb(100,100,100)`} stop-opacity={0.6} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} />\n          {/* <stop offset=\"20%\" stopColor={colorsPalettes.generic.dark} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} stop-opacity={0.3} /> */}\n        </linearGradient>\n      </defs>\n      {/* <TriangleLegend\n        {\n        ...{\n          legendWidth,\n          totalWidth,\n          totalHeight,\n          legendTriangleWidth,\n          legendTriangleHeight,\n          rowHeight,\n          fontSize,\n        }\n        }\n      /> */}\n      <g className=\"triangles\">\n        {\n          // sorting groups regarding their projected projection on the horizontal axis (to avoid lines crossings)\n          data.sort((a, b) => {\n            const [xa] = projection([+a.longitude, +a.latitude]);\n            const [xb] = projection([+b.longitude, +b.latitude]);\n\n            if (xa > xb) {\n              return 1;\n            }\n            return -1;\n          })\n            .map((port, index) => {\n\n              return (\n                <PortGroup\n                  key={index}\n                  {\n                  ...{\n                    numberOfColumns,\n                    port,\n                    scaleX,\n                    scaleY,\n                    legendWidth,\n                    columnWidth,\n                    totalHeight,\n                    totalWidth,\n                    projection,\n                    index,\n                    margins,\n                    rowHeight,\n                    fontSize,\n                    projectionTemplate\n                  }\n                  }\n                />\n              )\n            })\n\n        }\n        <defs>\n            <marker id=\"triangle-left\" viewBox=\"0 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.02}\n              orient=\"auto\">\n              <path d=\"M 10 0 L 0 5 L 10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n            <marker id=\"triangle-right\" viewBox=\"-10 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.024}\n              orient=\"auto\">\n              <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n          </defs>\n      </g>\n\n    </g>\n  )\n\n}\n\nexport default TriangleComponent;","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Poitou': '#668EDB',\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produits coloniaux': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites les': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indtermin suppos Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-R': '#277262',\n    'Tonnay-Charente': '#5AD0F4',\n    'Marans': '#67CBB6',\n    \"Les Sables-d'Olonne\": '#668EDB',\n    'Marennes': '#A7E6F9',\n  },\n  tonnageClasses: {\n    '100%': '#A07BEE',\n    '75% ou plus': '#41BEA3',\n    'moins de 75%': '#FEA43B',\n  }\n}\n\nexport default colorsPalettes;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.91,\"time\":234600,\"words\":782}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`La France du dix-huitime sicle se caractrise par le fort dynamisme des ports et des hinterlands de la faade atlantique, stimuls par le commerce avec les Antilles et une demande europenne en biens de consommation oriente  la hausse. La guerre maritime qui commence en 1793 et qui se poursuit pendant plus de vingt ans, entranant la perte dfinitive de Saint-Domingue en 1804 et de lle de France (le Maurice) en 1815, sonne le glas de cette dynamique et dplace le centre de lconomie franaise vers lintrieur. `}</p>\n    <p>{`Ltude de cas prsente ici sintresse  la navigation et au commerce maritime des ctes charentaises  la veille de la Rvolution. Cette aire possde un dense maillage portuaire, avec une quarantaine de ports en activit. Certains ne font que du cabotage micro-local, dautres intgrent petit et grand cabotage, dautres enfin sadonnent galement  une navigation de long-cours. Cette rgion se prte donc particulirement  une tude portant sur larticulation entre les diffrentes chelles du commerce maritime  laube de la Rvolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Nous nous proposons de reconstituer lhistoire maritime et commerciale de la rgion  partir de deux sources historiques. Dune part, nous disposons de traces administratives de la navigation maritime grce aux redevances qui psent sur celle-ci sous lAncien Rgime. Les registres des congs rpertorient les navires  leur dpart dun port et le montant d, qui varie le plus souvent selon leur tonnage et leur destination. Ces registres, rdigs par les greffiers de lamiraut locale, ont t numriss et structurs sous la forme dune base de donnes appele `}<a parentName=\"p\" {...{\n        \"href\": \"http://navigocorpus.org/\"\n      }}>{`Navigocorpus`}</a>{`. Dans cette dernire, on compte entre autres plus de 32 000 congs pour lanne 1787 pour lensemble des ports franais, et quelque 6900 congs pour 1789 relatifs  la rgion tudie.`}</p>\n    <p>{`Les registres des congs nous permettent de reprer les dates de dpart des btiments, ainsi que diverses informations relatives  lobjet de leur voyage, leur tonnage, leur capitaine, etc.. Ces donnes ne sont cependant pas dnues dincertitude : litinraire dclar par les capitaines de navires au moment de la sortie de port ne correspond pas ncessairement au voyage effectif qui la suivi. Les congs permettent toutefois une bonne mesure des trafics de la rgion de La Rochelle, y compris  toute petite chelle, tout en demandant une attention fine  la dimension dincertitude inhrente  la source mobilise.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`Dautre part, nous disposons de traces administratives relatives au commerce gnral de la rgion tudie. La base de donnes `}<a parentName=\"p\" {...{\n        \"href\": \"http://toflit18.medialab.sciences-po.fr/%23/home\"\n      }}>{`Toflit18`}</a>{` se fonde sur la numrisation des documents du Bureau de la balance du commerce de 1716  1821. Ces documents ont t produits grce aux services des Fermes : chaque bureau des Fermes enregistrait localement les tats de sortie et dentre des marchandises entre la France et ltranger. Plus de 550 000 flux de sortie / entre ont t documents dans la base de donnes Toflit18.`}</p>\n    <p>{`Grce aux donnes de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les diffrents bureaux de ferme de la rgion et les partenaires trangers du royaume de France. Les informations que lon peut extraire de ces flux sont, entre autres, le nom du produit chang, la quantit, la valeur, le partenaire commercial, et lentit administrative ayant enregistr le flux au niveau local. En 1789, elles prcisent en outre, sauf pour le commerce de rexportation des denres coloniales, lorigine du produit commercialis (ville ou province franaise, ou tat tranger). Elles fournissent donc des informations complmentaires  celles donnes par les sources relatives  la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congs de navigation et donnes fiscales de la Ferme rendu possible par les bases de donnes Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de prciser les flux et leur valeur pour ce qui est du commerce international, et dexplorer les relations et larticulation entre les diffrents trafics de cette rgion.`}</p>\n        <p>{`La prsente tude de cas dcrit en trois temps lhistoire de la rgion de La Rochelle  laube de la Rvolution franaise. Dabord, nous constatons la relative perte dimportance et de diversit commerciale de la rgion  la suite de la perte du Canada par le royaume de France durant la guerre de Sept Ans. Nous proposons ensuite une analyse dtaille de la restructuration de la rgion en relation avec cet vnement, selon des filires spcialises qui associent des ports particuliers avec le commerce de produits spcifiques. Nous dmontrons enfin que, bien que rest dominant dans sa rgion, le port de la Rochelle a cess de structurer la rgion de Poitou-Aunis-Saintonge au profit dun rseau dchange plus diversifi.`}</p>\n        <hr></hr>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Todo intro en`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"6 min read\",\"minutes\":5.285,\"time\":317100,\"words\":1057}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-dclin-de-la-rgion-de-la-rochelle-suite--la-perte-du-canada\"\n    }}>{`Partie 1. Le dclin de la rgion de La Rochelle suite  la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, la France a pleinement profit du dveloppement des relations conomiques entre lAfrique, lAmrique et lEurope. L Atlantique franais reposant sur la traite des Africains et leur exploitation dans les les franaises (Antilles et Mascareignes) a connu son apoge juste avant la rvolte des esclaves de Saint-Domingue en aot 1791 et le dbut de la guerre maritime avec lAngleterre en fvrier 1793. Lancienne rgion Poitou-Charente, correspondant approximativement aux gnralits de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une tradition maritime ancienne et tait bien situe pour bnficier de cette phase de prosprit. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`Lexamen du commerce avec les pays trangers et les colonies de la direction des Fermes de La Rochelle, qui tait leur faade maritime, montre toutefois un dynamisme limit. Il y a bien eu croissance du commerce, mais cette croissance a t plus lente que celle des autres grands ports du royaume. Cela sexplique en grande partie par les relations privilgies de la direction de la Rochelle avec le Canada. Dune part, celui-ci se dveloppe beaucoup moins vite que les Antilles, et la rgion souffre de ce manque de dynamisme durant la premire moiti du sicle. Dautre part, le Canada est cd aux Anglais lors du trait de Paris qui clt la guerre de Sept Ans en 1763. Qubec avait dj t pris en 1759. Cette perte est svre pour la rgion dont le commerce entame alors un recul relatif trs net. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`Aprs une anne exceptionnelle en 1747, qui sexplique par lorganisation de convois transatlantiques au dpart de La Rochelle escorts par la Marine pour chapper aux prdations britanniques, la direction de La Rochelle effectue 4,6% du total du commerce franais en 1750. En 1789 sa part ne reprsente plus que 2,2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`La trajectoire de la rgion de la Rochelle contraste avec celles de Bordeaux et de Nantes. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et sa part du commerce franais ne cesse daugmenter jusquen 1789.`}</p>\n    <p>{`Le recul de La Rochelle nest pas que quantitatif. En 1750, les donnes de la direction des Fermes de La Rochelle, charge de la collecte des droits sur le commerce extrieur et colonial, montrent que cette partie du territoire commerce 21% des types de biens changs par la France (645 sur 3055, aprs `}<a parentName=\"p\" {...{\n        \"href\": \"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source&sa=D&source=editors&ust=1631692550035000&usg=AOvVaw3OWg6kqNrXVj55P3PXr232\"\n      }}>{`uniformisation des variations orthographiques`}</a>{`). En 1789, elle nen commerce plus que 7% (248/3565). Cette forte rduction de la typologie des biens commercialiss sobserve  la fois pour les exportations et pour les importations.  un niveau plus agrg de typologie des produits, parmi les 150 secteurs de la `}<a parentName=\"p\" {...{\n        \"href\": \"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\"\n      }}>{`classification Rvolution et Empire, utilise dans le cadre du programme ANR Toflit18`}</a>{`, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diversifies en 1750 quen 1789. Lindice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Un bien pour lequel il ny a pas beaucoup de concurrence nationale (les eaux-de-vie) et deux denres coloniales rexportes (le caf et le sucre) dominent en 1789 les exportations. Les toiles de coton, souvent rexportes en direction de lAfrique, viennent en quatrime place, suivies du sel (dont la valeur est faible par rapport au tonnage quil mobilise, car cest une marchandise trs pondreuse). En 1750, la mercerie et les toffes de laine font partie des cinq principales exportations (avec lindigo, les eaux-de-vie et le sucre : le sel est en 14e position). La direction des Fermes de La Rochelle sest donc spcialise dans les produits agricoles et les rexportations au dpens des biens manufacturs de la rgion. Ce constat ngatif est toutefois nuanc par lintensit capitalistique de la production deaux-de-vie qui la rapproche des biens manufacturs.`}</p>\n    <p>{`Nous ne connaissons pas la destination des rexportations coloniales en 1789. En les excluant, on constate que la concentration des marchs de la direction des Fermes de La Rochelle est la mme en 1750 et en 1789 (entre 0,41 et 0,44), mais que lAngleterre a pris la place de lAmrique (terme qui dsigne ici essentiellement les Antilles franaises). Pour aller vite, on pourrait rsumer en disant que la direction des Fermes de La Rochelle nexporte plus des biens diffrencis vers le Canada, mais essentiellement des eaux-de-vie vers lAngleterre.`}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Les donnes de la navigation ne nous permettent pas daller beaucoup plus loin dans lanalyse du dclin de cette rgion: dune part, car navons le dtail des sorties que pour la fin de lAncien Rgime, ce qui empche une analyse diachronique. Dautre part, car les donnes collectes pour 1789 napportent que des informations limites pour ce qui est des produits transports: les congs du port de La Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports de la rgion le greffier se limite le plus souvent  noter seulement larticle principal qui constitue la cargaison. Les registres des congs indiquent, toutefois, les destinations de chaque navire sorti et cette donne permettra de constater un relatif clatement des marchs de cette rgion. `}</p>\n    <p>{`Sans que lon puisse affirmer quil sagit dune nouveaut, la marginalisation de la rgion vers la fin de lAncien Rgime est confirme par son manque de capacit  assurer ses propres trafics. La navigation avec ltranger est assure,  90%, par des pavillons trangers ou extrieurs  la rgion tudie. Il sagit, pour lessentiel, des pavillons britannique et nord-europens.`}</p>\n    <Caller id=\"partie-1-pays-port-d-attache\" mdxType=\"Caller\" />\n    <p>{`Mme si on prend en compte la part de navigation sous pavillon franais assure par des navires de la rgion tudie, elle est en effet infrieure  celle de la plupart des autres provinces franaises: en 1787, les ports de lAunis-Saintonge-Poitou assurent 51.6% du tonnage quils expdient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne.`}</p>\n    <p>{`ON SORT LE RESTE JE LE GARDE L PAR SUPERSTITION GUILLAUME`}</p>\n    <p>{`Si on regarde les dparts depuis la rgion tudie vers de ports franais, calculer la part de la navigation assure par homeport locaux en 1787 dans ports de la direction de la Rochelle vers intrieur direction / reste France / international / hors Europe et comparer avec idem pour Bordeaux et pour Nantes par ex. (en tonnage)`}</p>\n    <p>{`De toutes les manires, plutt des camemberts ?`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 1 intro`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"20 min read\",\"minutes\":19.37,\"time\":1162200,\"words\":3874}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spcialisation-portuaire--le-cas-de-la-traite-ngrire-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spcialisation portuaire : le cas de la traite ngrire, du commerce du sel et de leau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" mdxType=\"Caller\" />\n    <a name=\"t.a7dc21b9ca5c7b5fecc83bd6240f607ad9c96864\"></a><a name=\"t.0\"></a>\n    <p>{`Mode demploi pour lintgration de la visualisation principale de la partie 2 avec le texte (cet encadr de tutoriel devra tre enlev  terme) :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`comme partout ailleurs, une ligne qui commence par `}{`<`}{`Caller signale au site quil doit afficher une visualisation  ct du texte qui suit`}</li>\n      <li parentName=\"ul\">{`la partie id=viz-principale-partie-2 ne doit pas tre touche, elle indique la visualisation  afficher`}</li>\n      <li parentName=\"ul\">{`le morceaux highlight=xxx reprsente la visualisation  mettre en avant. Si elle est gale  toflit18, le graphique toflit18 sera mis en gros et le graphique navigo en plus petit et vice-versa si elle gale  navigo`}</li>\n      <li parentName=\"ul\">{`le morceau filter=xxx reprsente les donnes  filtrer sur chacun des deux graphiques. Il a pour linstant quatre valeurs possibles :`}</li>\n      <li parentName=\"ul\">{`aucun : tous les flux toflit18 et les toiles navigo sont affichs`}</li>\n      <li parentName=\"ul\">{`colonial : `}</li>\n      <li parentName=\"ul\">{`pour toflit18, naffiche que les flux qui concernent la classe de produits produits coloniaux, ou le groupe de partenaires Afrique ou Colonies`}</li>\n      <li parentName=\"ul\">{`eau-de-vie :`}</li>\n      <li parentName=\"ul\">{`pour toflit18, naffiche que les flux qui concernent la classe de produits eau-de-vie et vins divers`}</li>\n      <li parentName=\"ul\">{`sel :`}</li>\n      <li parentName=\"ul\">{`pour toflit18, dimensionne les flux par poids (au lieu de valeur en livres tournois pour les autres filtres), et naffiche que les flux qui concernent la classe de produits sel`}</li>\n      <li parentName=\"ul\">{`le morceau bureau=xxx reprsente le bureau des fermes sur lequel appliquer le filtre. Il peut avoir la valeur tous ou le nom de lun des bureaux des fermes`}</li>\n      <li parentName=\"ul\">{`le morceau navigoAgregation=xxx reprsente la mthode daggrgation  utiliser, il peut avoir deux valeurs :`}</li>\n      <li parentName=\"ul\">{`tonnage : dimensionne le radarplot avec des tonnages cumuls (valeur par dfaut)`}</li>\n      <li parentName=\"ul\">{`voyages : dimensionne le radarplot avec le nombre de voyages`}</li>\n      <li parentName=\"ul\">{`le morceau minTonnage=xxx reprsente le tonnage minimum  utiliser comme filtre pour la partie navigo`}</li>\n      <li parentName=\"ul\">{`le morceau maxTonnage=xxx reprsente le tonnage minimum  utiliser comme filtre pour la partie navigo`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La rgion tudie se caractrise par une densit importante de ports qui entretiennent des relations plus ou moins tendues et plus ou moins intenses avec le reste de la France et du monde. Limportance de leurs mouvements maritimes et des tonnages impliqus nest pas directement corrle  la valeur des marchandises transportes: alors que les deux bureaux des Fermes qui exportent le plus sont celui de La Rochelle et de Tonnay-Charente, et que les importations sont domines par les ports du bureau des fermes de La Rochelle, lactivit portuaire de Marennes est en absolu la plus importante de la rgion.`}</p>\n    <p>{`Nos analyses ont certes montr que`}<a parentName=\"p\" {...{\n        \"href\": \"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view&sa=D&source=editors&ust=1631692550045000&usg=AOvVaw13rvr4sHeieN8j5IsRnDOX\"\n      }}>{` les tonnages enregistrs  Marennes semblent `}</a><a parentName=\"p\" {...{\n        \"href\": \"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view&sa=D&source=editors&ust=1631692550045000&usg=AOvVaw13rvr4sHeieN8j5IsRnDOX\"\n      }}>{`surestims  20%`}</a>{`, et cela monte  50% dans 10% des pires cas. Mais mme en prenant en compte cette distorsion, le tonnage ncessaire aux exportations vers ltranger du port de La Rochelle nest pas le plus important dans la rgion. Comme nous le verrons `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\"\n      }}>{`dans la partie 3`}</a>{`, La Rochelle na plus un rle structurant pour les ports de cette rgion: dautres ports entretiennent des relations avec ltranger et avec les marchs franais, en commercialisant les productions locales. `}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`La carte reprsente le tonnage expdi en 1787,  partir des congs dlivrs aux navires, toute destination confondue. Les 8 ports dpassant les 10000 tonneaux entretiennent tous, sauf Marans, une navigation avec ltranger; la presque totalit des ports sous ce seuil se cantonnent en revanche  un commerce rgional ou national.`}</p>\n    <p>{`Cette section propose une tude de trois ports de la rgion  la fin de lAncien Rgime afin de montrer la diversification de leurs marchs, qui sexplique largement par la nature des produits commercialiss.`}</p>\n    <p>{`Les ports de la rgion connects aux marchs trangers prsentent des spcificits lies  la nature des produits exports: les navires expdis depuis lAunis se dirigent vers lensemble de lEurope du Nord, ceux depuis la Saintonge essentiellement vers les les britanniques et la Hollande, et ceux au dpart du Poitou, nettement moins importants en volume, privilgient lespace Baltique. `}</p>\n    <p>{`De par ses relations exclusives avec les colonies et surtout son investissement dans la traite ngrire, La Rochelle mrite une tude  part. Limportation de quantits considrables de denres coloniales, majoritairement r-exportes vers lEurope du Nord, met ce port dans une situation unique. Plusieurs autres ports de la rgion se consacrent prioritairement  lexportation du sel: Noirmoutier, Ars-en-R et surtout Marennes mobilisent de flottes dpassant en 1789 les 10000 tonneaux pour sa commercialisation. Nous dvelopperons ici en dtail le cas de Marennes, principal port exportateur de sel. Sa particularit est de miser sur le march national.`}</p>\n    <p>{`Pour le commerce des eaux-de-vie, nous tudierons le cas de Tonnay-Charente. La mention de leau-de-vie parmi les cargaisons indiques par les congs tant rare, il faudra se tourner dabord vers les sources de la Balance du commerce, pour affiner ensuite les donnes par lanalyse de la navigation. `}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" mdxType=\"Caller\" />\n    <p>{`Au XVIIIe sicle, les colonies antillaises augmentent trs considrablement leur production de sucre, caf, indigo et produits tinctoriaux, pour rpondre  une demande europenne fortement oriente  la hausse. La croissance de la production passe par un nombre de plus en plus lev de plantations, qui ont un recours massif  une main-duvre desclaves, que les Europens dportent par centaines de milliers depuis lAfrique dans le cadre de la traite ngrire. Ce commerce transatlantique dtres humains, achets sur les ctes dAfrique par les ngriers europens, a commenc au XVe sicle, mais il atteint son apoge au XVIIIe sicle, lorsque 6 millions dAfricains sont dports aux Amriques. La moiti dentre eux est vendue aux Antilles. On estime  un million le nombre dAfricains introduits dans les colonies franaises au XVIIIe sicle. La principale destination est la colonie de Saint-Domingue (aujourdhui Hati) qui compte,  la veille de la grande rvolte desclaves de 1791, un demi-million desclaves, dont plus de la moiti sont ns en Afrique.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" mdxType=\"Caller\" />\n    <p>{`Lactivit ngrire est aux mains darmateurs privs qui esprent raliser un profit lors de la revente des esclaves. Si Nantes est le principal port ngrier franais, La Rochelle a jou un rle significatif, tout particulirement dans les annes 17301740 : entre 1713 et 1744, La Rochelle arme 15% des expditions ngrires, sa part tombe  11% aprs la perte du Canada, en sorte que si La Rochelle est le deuxime port ngrier le plus important en France avant 1763, il passe au 4e rang par la suite.`}</p>\n    <p>{`Malgr un dclin relatif, lactivit ngrire rochelaise est rsolument oriente  la hausse: les armateurs rochelais passent de 4,3 armements ngriers par an pour la priode 17131744  12,5 armements par an dans la dcennie 17831793. Pendant cette dernire, la traite est vritablement de lactivit principale, voire presque exclusive, des armateurs rochelais: sur un total de 200 dparts depuis le port de La Rochelle de navires rochelais, un peu plus de la moiti des tonnages se dirigent vers lAfrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se rpartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers ltranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dpasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dpassant le 50 tx `}{`[`}{`le plus grand faisant 827 tonneaux`}{`]`}{` sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et ngrier.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Les donnes de la Balance du commerce confirment la centralit du commerce colonial et ngrier : en 1789, les exportations vers lAfrique reprsentent 23% du total des exportations du bureau des Fermes, alors que 73% est constitu par les r-exportations des denres coloniales. `}</p>\n    <p>{`Alors que dans la plupart des ports ngriers franais, la part des armements ngriers est nettement infrieure  celle des armements en droiture vers les Antilles, cela nest pas le cas  La Rochelle: au dpart de ce port, les trois quarts des expditions de 1787 destines  approvisionner les Antilles en hommes ou en produits sont des ngriers. Comme  Honfleur, il y a donc clairement, en matire de trafics transatlantiques, une spcialisation ngrire rochelaise. Par ailleurs, et contrairement aux autres ports franais qui font le commerce avec les Amriques (Marseille, Bordeaux, Nantes, Le Havre), La Rochelle a une prfrence quasi-exclusive pour Saint-Domingue o plusieurs grandes familles de la ville (Belin, Garesch, Poupet Rasteau) sont trs bien implantes.`}</p>\n    <p>{`En 1789, les 12 ngriers partis de La Rochelle sont tous arms par des ngociants rochelais. Trois autres ngriers partent depuis Rochefort.`}</p>\n    <p>{`Au total, dans les dernires annes de lAncien Rgime, une douzaine de navires reviennent chaque anne  La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour dune expdition ngrire. La valeur des produits ramens est estime, en 1789,  7.1 millions de livres tournois, dont 5.1 sont rexports  ltranger (ANOM, F 2 B 14, tableaux 3 et 5). Les ngociants rochelais semblent stre taills une position forte dans le march du caf. `}<a parentName=\"p\" {...{\n        \"href\": \"https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21\"\n      }}>{`https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21`}</a></p>\n    <p>{`Si les donnes collectes par la Balance du commerce ne permettent pas de connatre les destinations des rexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative. Les Pays-Bas autrichiens (actuelle Belgique), les Provinces-Unies, Brme, Hambourg, les ports de la Baltique reoivent chacun de navires totalisant entre 500 et 550 tonneaux. Parmi les autres destinations europennes des navires partis de La Rochelle, seule la Grande-Bretagne (1048 tonneaux) nest vraisemblablement pas destinataire des produits coloniaux, car elle sapprovisionne dans ses propres colonies.. `}</p>\n    <a name=\"t.e04ea08ffc0a1e5af3987339feba50fdcd3863fc\"></a><a name=\"t.1\"></a>\n    <p>{`Destinations des navires vers ltranger (Afrique exclue) au dpart du port de La Rochelle, 1789`}</p>\n    <p>{`pays`}</p>\n    <p>{`tx total`}</p>\n    <p>{`Pays-Bas autrichiens`}</p>\n    <p>{`512`}</p>\n    <p>{`Provinces-Unies`}</p>\n    <p>{`550`}</p>\n    <p>{`Brme`}</p>\n    <p>{`520`}</p>\n    <p>{`Hambourg`}</p>\n    <p>{`530`}</p>\n    <p>{`Norvge`}</p>\n    <p>{`150`}</p>\n    <p>{`Prusse (ports en Baltique)`}</p>\n    <p>{`370`}</p>\n    <p>{`Baltique (indtermin)`}</p>\n    <p>{`200`}</p>\n    <p>{`Grande-Bretagne`}</p>\n    <p>{`1048`}</p>\n    <p>{`Etats-Unis dAmrique`}</p>\n    <p>{`160`}</p>\n    <p>{`tranger (indtermin)`}</p>\n    <p>{`104`}</p>\n    <p>{`Ds lors, il nest pas surprenant que le ngoce rochelais porte toute son attention aux questions lies au commerce colonial et ngrier. Cela apparat clairement parmi les sujets discuts par la chambre de commerce de La Rochelle. Lindexation faite  la main,  lpoque, sur la marge des registres de dlibration la Chambre de Commerce de La Rochelle permet de constater que dans la seule anne 1789, le commerce dAfrique est discut  une trentaine de reprises, et les colonies  une 50aine des reprises, le commerce de lInde  9;  titre de comparaison, le commerce avec ltranger est abord 11 fois en tout, et la pche (avec notamment la question de la concurrence et de ladmission de la pche tats-unienne, trs dbattue cette anne l en France), 17 fois. Parmi les produits indexs au marge des registres de dlibrations, les comestibles sont mentionns 16 fois - ce qui dans la conjoncture cralire particulire de lpoque nest gure tonnant-, leau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure clairement, en dpit dun critre sans doute grossier, que le regard des membres de la Chambre de commerce est clairement riv sur les colonies et la traite. `}</p>\n    <p>{`Si la question de la traite est absente des cahiers de dolances de la rgion `}{`[`}{`prciser leur nombre et fournir un % approximatif de leur compltude par rapport  tous ceux rdigs?`}{`]`}{`, la dfense des intrts coloniaux apparat, significativement, uniquement dans le cahier de dolances du Tiers-tat de la ville de La Rochelle, dont les reprsentants envoys  Versailles demanderont la rvocation de larrt rendu au conseil du roi, le 30 aot 1784, concernant le commerce tranger dans les colonies, et le rtablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrs quont faits la navigation franoise et la culture des isles franoises de lAmrique; par ailleurs, ils demanderont la suppression de lentrept et des droits actuels de consommation sur les sucres, cafs et lindigo venant des colonies, et quil soit substitu,  lentre de la totalit de ces denres dans tous les ports du roaume, un droit uniforme `}{`[`}{``}{`]`}{` : que le terrage des sucres tant dfavorable  la navigation, sil nest pas possible de linterdire entirement dans nos colonies, comme il lest dans les colonies anglaises, il soit au moins dfendu `}{`[`}{``}{`]`}{` de ltendre davantage par de nouveaux tablissemens, et que, les sucres bruts devant tre, ainsi que le coton, considrs comme matire premire, il soit mis un droit  la sortie du roaume des sucres bruts, assez sensible pour que la plus grande quantit de cette matire soit conserve en France et serve  relever et  soutenir les raffineries et  procurer du travail, puisque cest dans ces vues que le gouvernement dAngleterre interdit rigoureusement la sortie en nature des sucres bruts imports de ses colonies. Enfin Les dputs demanderont la rvocation de larrt du 14 avril 1785 , qui a cr une nouvelle compagnie des Indes et de celui pour ladmission des trangers dans les isles de France et de Bourbon. `}</p>\n    <p>{`Il faut observer que la participation rocheloise  la navigation au-del du cap de Bonne-Esprance est modeste: ltat des exportations de 1789, nindique que 38060 livres tournois exports vers lInde, et rien vers les Mascareignes `}{`[`}{`ANOM, COl F 2B 14, tableau 28`}{`]`}{`. Ces donnes semblent toutefois incompatibles avec le dpart du Henri IV pour lle de France et  lle Bourbon, le 9 mai 1789, qui arrive  bon port en fvrier 1790, et qui nest pas un ngrier `}{`[`}{`Toussaint, p. 291`}{`]`}{`  moins que sa cargaison ne viennent entirement dautres directions de Fermes du royaume. En 1787, ce sont trois armements vers les Mascareignes qui partent de La Rochelle: une certaine diversification des armements coloniaux apparat donc, ici comme  Bordeaux, dans les annes 1780, lorsque la baisse des profits du commerce antillais incite  chercher des investissements plus rentables.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`vrifier si cahiers de dolances en parlent. `}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de leau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} mdxType=\"Caller\" />\n    <p>{`total exportations eau-de-vie depuis la France et destinations pour mesurer part direction de la Rochelle (en prcisant le bureau des Fermes concerns)`}</p>\n    <p>{`Les congs de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux deau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin dannoter les cargaisons (il le fait 12 fois sur un total de 601 dparts): nous avons donc un aperu global de la navigation, sans pouvoir distinguer la nature des produits. `}{`[`}{`extrait de louvrage sur Tonnay-Charente, paru en 2012:`}{`]`}{` Si on se base sur les seules sorties de lanne 1787, 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent  ltranger (en Angleterre pour les deux tiers, le reste vers les les anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent  Dunkerque. On identifie ici la flotte europenne de leau-de-vie, qui reprsente 22 % du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, compos dune poussire de petits caboteurs (tonnage moyen 35 tx) et qui reprsente tout de mme 30 % du tonnage sortant. Ces navires sont aligns sur une destination unique : La Rochelle. Ils sont pour partie occups  lapprovisionnement de la ville et peut-tre  un commerce regional ou national: en revanche, La Rochelle a perdu le rle dentrept pour le commerce international de leau-de-vie quelle avait dans les annes 1730. Les principales maisons de ngoce deau-de-vie, en particulier Martell, nont plus de bureaux  La Rochelle en 1789: leurs bureaux principaux ont t rapatris  Tonnay-Charente et/ou dplacs  Paris. Enfin, des units plus modestes (25 tx en moyenne) voluent au sein de la mer des Pertuis (depuis la Seudre sud jusquaux Sables dOlonne) : elles reprsentent 23 % du tonnage  la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congs dlivrs en 1787 dans ce port concernent les navires avalant et attachs  des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrire et les produits manufacturs de larrire-pays  Tonnay-Charente, leurs matres quittent ce port soit  vide, soit avec une cargaison destine  Rochefort, La Rochelle ou bien aux ports de la mer des Pertuis, qui leur fournissent du fret de retour pour leur navigation vers lamont du fleuve Charente. `}{`[`}{`Cette structure du commerce de Tonnay Charente - Rvlateur du commerce deau de vie - pourrait tre montre  laide des diagrammes de Louvain ?`}{`]`}</p>\n    <p>{`Les exportations deau-de-vie charentaise en 1789 sont trs suprieures  la moyenne sculaire. Lexplication rside en partie dans les modifications induites par le Trait dEden de 1786, qui entrane une augmentation extrmement importante des exportations deau-de-vie vers lAngleterre, notamment des eaux-de-vie de qualit produites dans la rgion de Cognac, au dtriment de celles de moindre qualit. Le total des exportations deaux-de-vie franaises vers la Grande-Bretagne passe de 10  15 millions de livres tournois dans les annes 176070,  40 millions en 178789.`}</p>\n    <p>{` -`}{`>`}{` voir valeur export eau-de-vie de la direction de La Rochelle dans le temps), `}</p>\n    <p>{`En effet, les exportations dEaux-de-vie de 1789 semblent anormalement leves :`}</p>\n    <p>{`Il faudrait avoir un graphique sur les exportations totales deau de vie sur la France entire et en particulier sur les gnralits de Bordeaux, Bayonne et Nantes. Il y aussi  partir du milieu des annes 20 une augmentation des exportations  partir des ports mridionaux, en particulier Ste. On pourrait avoir des coupes en 1750, une autre anne (?) et 1789. `}</p>\n    <p>{`Autre ide de visualisation: en 1789, regarder les origines des exports. Il est possible quune partie des exports de la rgion de Cognac passe par Bordeaux, lArmagnac a priori passe par Bayonne (selon Cullen 1998 qui est LA rfrence sur ce thme). Il y aussi des choses intressantes dans larticle de Thierry (2013) sur Tonneau-Charente et Rochefort. Il faut distinguer aussi entre eau de vie simple et eau de vie double dans TOFLIT18, la 2e catgorie correspond je pense  la meilleure qualit (elle est plus chre et on la trouve moins souvent), donc le Cognac (et Armagnac).`}</p>\n    <p>{`Par ailleurs, daprs Cullen le commerce dexportation des eaux de vie connat une croissance forte aprs la fin de guerre dindpendance amricaine, mais il na pas de stat trs dtaill pour 1789.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} mdxType=\"Caller\" />\n    <p>{``}</p>\n    <p>{`Denre pondreuse de faible valeur, le sel voyage ds que cela est possible par voie maritime. Les ctes de la rgion tudie sont, avec celles du sud de la Bretagne, de trs grands producteurs de sel. Les marchs sont aussi bien nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment  la grande pche - que ceuxes pays de lEurope du Nord, qui sapprovisionnent galement au Portugal (Setubal). `}</p>\n    <p>{`Le bureau des fermes de Marennes est en absolu le principal exportateur de sel en France (par quantits), si lon inclut aussi les quantits expdies vers les ports francs franais. Il vient en troisime position, derrire les bureaux du Croisic et de Saint-Martin-de-R, si on se limite aux marchs extrieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas leves, compares  celles des flux commerciaux dont il a t question pour La Rochelle et Tonnay-Charente: le sel export depuis Marennes, y compris  destination des ports francs franais, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers ltranger). En revanche, son commerce alimente un mouvement portuaire extrmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la rgion tudie. Son commerce maritime est donc une activit importante, tant pour la production locale quil soutient, que pour lactivit induite lie  son transport (construction navale, emploi maritime).`}</p>\n    <p>{`Tous les flux sont l : `}<a parentName=\"p\" {...{\n        \"href\": \"http://toflit18.medialab.sciences-po.fr/%23/exploration/flows?sourceType%3DBest%2520Guess%2520customs%2520region%2520product%2520x%2520partner%26productClassification%3Dproduct_revolutionempire%26product%3D%255B%2522Sel%257Eproduct_revolutionempire%2522%255D%26page%3D0%26region%3D%2524all%2524%26kind%3Dtotal%26dateMin%3D1789%26dateMax%3D1789%26columns%3D%255B%2522product%2522%252C%2522region%2522%252C%2522year%2522%252C%2522partner%2522%252C%2522import%2522%252C%2522value%2522%252C%2522unitPrice%2522%252C%2522source%2522%252C%2522rawUnit%2522%255D%26orders%3D%255B%257B%2522key%2522%253A%2522unitPrice%2522%252C%2522order%2522%253A%2522DESC%2522%257D%255D\"\n      }}>{`http://toflit18.medialab.sciences-po.fr/`}{`#`}{`/exploration/flows?sourceType=Best%20Guess%20customs%20region%20product%20x%20partner`}{`&`}{`productClassification=product`}{`_`}{`revolutionempire`}{`&`}{`product=%5B%22Sel%7Eproduct`}{`_`}{`revolutionempire%22%5D`}{`&`}{`page=0`}{`&`}{`region=%24all%24`}{`&`}{`kind=total`}{`&`}{`dateMin=1789`}{`&`}{`dateMax=1789`}{`&`}{`columns=%5B%22product%22%2C%22region%22%2C%22year%22%2C%22partner%22%2C%22import%22%2C%22value%22%2C%22unitPrice%22%2C%22source%22%2C%22rawUnit%22%5D`}{`&`}{`orders=%5B%7B%22key%22%3A%22unitPrice%22%2C%22order%22%3A%22DESC%22%7D%5D`}</a></p>\n    <p>{`(mais pas par bureau).`}</p>\n    <p>{`Grosses variations de prix. Pas mal de prix absurdes. Dun peu moins de 36 livres  10 sous le quintal (!) `}</p>\n    <p>{`Exports par bureau (y compris vers la France): `}</p>\n    <p>{`Exports par bureau hors la France : `}</p>\n    <p>{`Marchs pour les exports :`}</p>\n    <p>{`Marchs pour les exports de Marennes:`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" mdxType=\"Caller\" />\n    <p>{`Les donnes sur la navigation aident  prciser la gographie commerciale du sel export depuis Marennes, mme si elles nindiquent les quantits exportes. Dans la mesure o les navires qui le transportent sortent souvent chargs entirement de sel, on peut de manire approximative additionner le total des tonnages des navires chargs de sel pour avoir un ordre de grandeur des trafics.  compter du rgne de Louis XIV, la lgislation relative aux gabelles fait dailleurs obligation au chargeur de naviguer avec une cargaison complte. Le tonnage des navires chargs de sel est donc un assez bon indicateur des quantits exportes.`}</p>\n    <p>{`Les congs confirment que, parmi les ports exportateurs de la rgion tudie, la primaut revient incontestablement  Marennes: en 1787, le tonnage additionn de navires sortis de ports franais avec du sel y est de plus du double qu Ars-en-R, le deuxime grand exportateur de la rgion. Mme en prenant en compte la survaluation des tonnages de navires  Marennes, que nous avons constate en comparant le tonnage dun mme navire relev en plusieurs ports, Marennes demeure le principal fournisseur de sel en France, ce qui est confirm par la Balance du commerce. La carte indique le tonnage total des navires sortis chargs du sel dans les ports de la France atlantique et leurs destinations.`}</p>\n    <p>{`Lexportation de sel est en outre une activit quasi exclusive  Marennes : sur 1174 dparts en 1787, 990 ont charg du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    <p>{`Les destinations des navires chargs de sel partis de Marennes montrent que le march national est nettement plus important que les marchs trangers additionns. Marennes simpose donc comme un fournisseur privilgi pour les greniers  sel des gabelles, ainsi que le montre la gographie des destinations franaises: elles sont souvent des ports de rupture de charge sur des estuaires : Honfleur, Nantes, Bordeaux et Libourne (sur la Dordogne), ou de ports francs (Bayonne et Dunkerque). Cette situation est peut-tre  lorigine de la surestimation des tonnages constate dans ce seul port de Marennes, qui travaille vraisemblablement sous le regard serr des agents de la Ferme. Les bureaux des fermes associs aux autres grandes zones de production de sel - Le Croisic et Saint-Martin-de-R - montrent une plus grande internationalisation du trafic.`}</p>\n    <p>{`Pistes possibles:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`dvp texte sur marchs extrieurs avec valeur et quantits (Toflit) et faire calcul valeur/tx`}</li>\n      <li parentName=\"ul\">{`regarder si Chambre de commerce et cahiers de dolances parlent du commerce du sel`}</li>\n      <li parentName=\"ul\">{`Piste: vrifier qui, parmi les ports exportateurs du sel, ont de liens forts avec ltranger et mettre cela en relation, ventuellement, aux tirants deau - tonnage moyen des navires exportateurs par destination et par port de dpart. En clair: est-ce que Marennes exporte plus vers ltranger que vers le march national compar aux autres ports qui vendent du sel? ici on a besoin de lexpertise de Thierry`}</li>\n      <li parentName=\"ul\">{`Il y a un ouvrage rcent publi aux PUR (et lisible sur openedition) avec 2 articles sur le sujet. Je (Loc) nai pas eu le temps de les lire.`}</li>\n    </ul>\n    <hr></hr>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de leau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 2 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.195,\"time\":431700,\"words\":1439}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`En 1789, les navires des ports locaux exportateurs de sels (Marennes, Rochefort, Ars-en-R) ont un tonnage moyen plus important que ceux de la Rochelle. De manire plus surprenante, la quantit de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de R, voire mme Rochefort - tmoigne dun dynamisme qui chappe largement au port dominant, La Rochelle. Cette particularit sinscrit dans une histoire maritime longue de la rgion centre-ouest.`}</p>\n    <p>{`Jusqu la perte des colonies nord-amricaines, le port de La Rochelle a cultiv une certaine spcificit gographique. Quoique le port de La Rochelle pratiquait, comme la presque totalit des ports atlantiques, le commerce antillais et ngrier, une part importante et qui a progressivement augment jusqu reprsenter plus de la moiti de ses armements pour les colonies dans les annes 1750 tait constitue par le commerce nord-amricain - Canada, Louisiane et pcheries de Terre-Neuve. Cette spcificit gographique a galement influ sur sa spcialisation par produits. Le commerce des fourrures est ainsi une spcialit rochelaise jusquau dbut des annes 1760. Les fourrures taient importes non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de lOhio. Ces fourrures taient pour partie r-exportes en France et en Europe (principalement vers lespace allemand et en Suisse). Une part importante, les peaux de castors en particulier, ntaient pas r-exportes, mais alimentaient lindustrie de chamoiserie niortaise et dautres localits franaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matires premires et en produits manufacturs. LAmrique du Nord tait donc un dbouch important et facile pour les crales de la rgion, les toffes locales de basse qualit et, dans une moindre mesure, le sel ncessaire aux pcheries de Terre-Neuve. Ainsi, ce commerce quoique modeste avant les annes 1740 fournissait des volumes importants demploi dans ces trois secteurs de lconomie rgionale et contribuait  faire du port de La Rochelle, le centre de gravit du complexe portuaire rgional. Cette domination tait renforce par la domination des capitaux rochelais qui sinvestissaient de manire prioritaire dans le commerce Atlantique - nord-amricain et antillais. Cette domination se mesurait notamment au dbut du sicle par la prsence des bureaux principaux des maisons de Cognac  La Rochelle. Mais, ds la crise qui suivit la chute du systme de Law, La Rochelle commena  perdre sa place et Tonnay-Charente  saffirmer comme le principal port dexportation de leau-de-vie produite dans la rgion, et du Cognac en particulier. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Ainsi, mme si le port de la Rochelle domine les autres ports de la rgion par la diversit des produits quil importe et exporte et, surtout, par son activit dans le commerce atlantique, les changes des ports de la rgion sont largement autonomes comme le montre le rseau des voyages de la rgion PASA de 1787 compar  ceux des deux autres rgions situes au nord (la Loire-Atlantique) et au sud (lAquitaine). Les indices de centralit compares avec dautres rgions domines par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacit  structurer les trafics maritimes locaux.`}</p>\n    <p>{`Ce constat peut tre li historiquement  la perte des colonies Nord-amricaines (Canada et Louisiane) qui a bris une dynamique vertueuse qui stait tablie dans annes postrieures  la guerre de succession dAutriche. En effet, avant 1748, le commerce des Antilles en droiture et la traite ngrire continuaient  dominer le commerce de la Direction de la Rochelle en valeur, tant donn le dynamisme limit de la demande manant de lAmrique du Nord. Mais, ds la fin de la guerre de Succession dAutriche, souvre une priode de croissance exceptionnelle pour le commerce avec lAmrique du Nord. Sur la priode 17481758, La Rochelle reoit annuellement plus de 1 million 300 mille livres de peaux dAmrique du Nord, soit presque autant en valeur que de sucre des Antilles (1 million 450 mille livres). Le nombre darmements  destination du Canada est multipli par deux alors que celui pour la Louisiane augmente de moiti. Par rapport aux annes prcdant la guerre, le trafic li au commerce triangulaire baisse en moyenne dun quart pour les Antilles et de plus de moiti pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et mme Dunkerque et Marseille. A linverse, les rochelais ont un monopole de fait pour la Louisiane qui nintresse gure les ports plus importants et seul Bordeaux les concurrence pour lapprovisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilits complmentaires. Dun ct, le commerce  destination du Canada pouvait se transformer en commerce triangulaire invers - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les les  sucre en morue sale et, plus rarement, en crales. La Louisiane permettait galement de raliser des oprations de contrebande avec les colons espagnols, offrant la possibilit de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1986).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limit en volume, mais crateur demplois locaux et, au milieu du sicle, facteur dun dynamisme certain scroule avec la perte des colonies franaises nord-amricaines  la fin de la guerre de Sept Ans. Cette perte dstructure durablement le commerce rochelais qui perd ses marchs privilgis et sa position dominante au sein du rseau portuaire rgional. En 1789, le commerce du port de la Rochelle est quasi-exclusivement colonial - prs de 90% de ses exportations en valeur sont destins  la traite africaine et aux Antilles. Les graphiques que nous proposons illustrent fidlement ces remarques. Ce dclin est visible sur le graphique prcdent o linfrastructure de la province de lAunis apparat originale par le faible poids relatif de son port principal - La Rochelle - incapable de freiner le dveloppement des ports quil maintenait dans sa dpendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-R. Dans la priode pr-rvolutionnaire (17871789), les flux de navires comme de marchandises tmoignent de la recomposition de lconomie de la faade maritime. Dsormais, la valeur des flux de marchandises au dpart de Tonnay-Charente et  larrive de Rochefort, qui entretient directement les productions locales, se rapproche de ceux de La Rochelle.`}</p>\n    <p>{`Cette volution est la consquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des ngociants rochelais, consquence directe de la vague de faillites qui secouent le milieu  la fin de la guerre de Sept Ans; la fermeture des marchs nord-amricains subventionns qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite ngrire. Pour lanimer, les ngociants rochelais se procurent les marchandises ncessaires  ce commerce dans toute la France et lEurope et ne se fournissent que trs peu dans larrire-pays rochelais. Le port nest donc plus rellement connect  larrire-pays et ce, dautant plus, que la faiblesse capitalistique de la place loigne les maisons de commerce spcialises dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux  Tonnay-Charente ou  Paris. `}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`Il y a aussi lautorisation accorde en 1775  Rochefort de faire le commerce colonial, qui signale la perte de pouvoir de La Rochelle.`}</p>\n    <p>{`Argument du paragraphe final: `}</p>\n    <p>{`Spcialisations des ports, mais sans complmentarit: Marennes (Sel), La Rochelle (colonial), Rochefort (commerce dimportation), Tonnay-Charente (eau de vie dont eau de vie double) et ports de lIle de R (sel + eau-de-vie).`}</p>\n    <p>{`Tonnage au dpart des ports des diffrentes provinces en 1787, agrg suivant que la destination est au sein de la mme province (local  droite) ou en dehors (externe  gauche)`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle  destination des colonies:`}</p>\n    <p>{`1 865 652 livres tournois`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle  destination du reste du monde (y compris local): 240 500`}</p>\n    <p>{`Les exportations du bureau de La Rochelle pour les colonies et les traite reprsente 88,58% du total des exportations`}</p>\n    <p>{`Pour montrer que La Rochelle ne structure pas rgion, faire voir faible impact sur rgion:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`ce qui rentre des colonies en ressort (visu reexport/pas reexport)`}</li>\n      <li parentName=\"ul\">{`tudier et visualiser origines des produits exports pour traite et commerce colonial`}</li>\n    </ul>\n    <p>{`Guillaume D.: Remarque : Jai fait pour 1789. Plus calmement :`}</p>\n    <p>{` Monde  cest hors colonies (probablement les rexports coloniales)`}</p>\n    <p>{`Donc hors r-exports, je pense que les chiffres de Loc sont bons.`}</p>\n    <p>{`use \"/Users/guillaumedaudin/Documents/Recherche/Commerce International Franais XVIIIe.xls/Balance du commerce/Retranscriptions`}{`_`}{`Commerce`}{`_`}{`France/Donnes Stata/bdd courante.dta\", clear`}</p>\n    <p>{`keep if year==1789`}</p>\n    <p>{`keep if customs`}{`_`}{`office==\"La Rochelle\"`}</p>\n    <p>{`tab partner`}{`_`}{`simplification if partner`}{`_`}{`grouping==\"Monde `}</p>\n    <p>{`collapse (sum) value, by (partner`}{`_`}{`grouping)`}</p>\n    <p>{`egen total = total(value)`}</p>\n    <p>{`gen pcrt = value/total`}</p>\n    <p>{`br`}</p>\n    <hr></hr>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 3 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":15.085,\"time\":905100,\"words\":3017}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"-propos\"\n    }}>{` propos`}</h1>\n    <p>{`Le prsent site a t ralis dans le cadre du `}<a parentName=\"p\" {...{\n        \"href\": \"https://anr.portic.fr/\"\n      }}>{`programme de recherche ANR PORTIC`}</a>{`. Ce programme porte sur les dynamiques de navigation et du commerce extrieur au dix-huitime sicle, un commerce qui seffectue largement par voie maritime. Outre la meilleure comprhension de ces dynamiques par le croisement de deux jeux de donnes, un enjeu fondamental du programme est de chercher des mthodes de qualification et dapprhension de lincertitude des donnes historiques, en exprimentant des modes de visualisation et dcriture appropris.`}</p>\n    <p>{`Dans ce cadre, le Working Package n6 de ce programme de recherche consiste  effectuer une srie dtudes de cas tirant parti de deux corpus existants de sources historiques numrises : `}<a parentName=\"p\" {...{\n        \"href\": \"http://navigocorpus.org/&sa=D&source=editors&ust=1631692550082000&usg=AOvVaw3mcv_BXceSFuq64S-VYuiV\"\n      }}>{`Navigocorpus`}</a>{`, une base de donnes portant sur lhistoire de la navigation pilote par Silvia Marzagalli et Christine Plumejeaud ; et `}<a parentName=\"p\" {...{\n        \"href\": \"http://toflit18.medialab.sciences-po.fr/%23/home\"\n      }}>{`Toflit18`}</a>{`, une base de donnes portant sur le commerce extrieur de la France, pilote par Loc Charles et Guillaume Daudin.`}</p>\n    <p>{`Ce site web sinscrit dans un mouvement second faisant suite  de premires entreprises de numrisation pour chacune des deux bases, en tentant de valoriser le travail dj accompli via ltude approfondie de sous-ensembles signifiants dans les donnes. Ces tudes devraient ainsi permettre dclairer des questions disciplinaires existantes sous un nouveau jour grce aux nouveaux matriaux et mthodes offerts par les bases de donnes mobilises par le programme. Les questions souleves par une telle initiative sont alors multiples :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Comment mobiliser ensemble deux sources dont certaines dimensions sont incommensurables et difficiles  mettre en quivalence ? `}</li>\n      <li parentName=\"ul\">{`Comment croiser les donnes numrises des deux bases avec des connaissances plus denses et qualitatives sur les phnomnes tudis, apportes par des historiens spcialistes de la rgion tudie ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte, au moment de lenqute et du raisonnement, limportante stratification de transformations, de rductions et de dcisions interprtatives constituant la chane qui relie les sources initiales avec les donnes qui en ont t tires ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte lincertitude ou lincompltude des donnes tout en proposant un rcit scientifiquement solide sur les phnomnes tudis ? `}</li>\n      <li parentName=\"ul\">{`Comment faire dialoguer les formes classiques de lcriture historique - le rcit dploy phrase aprs phrase, largument droul paragraphe par paragraphe - avec les formes dcriture diagrammatique et computationnelle quimplique la ralisation dun site web ? `}</li>\n      <li parentName=\"ul\">{`Et enfin, comment grer linhabituelle collaboration interdisciplinaire et partition dexpertises quimplique une telle criture multimodale ?`}</li>\n    </ul>\n    <p>{`Toutes ces questions ont t travailles  loccasion de la squence de collaboration denviron six mois qui a men  llaboration de ce site, dont voici un bref rcit.`}</p>\n    <h2 {...{\n      \"id\": \"dune-srie-de-questionnements--une-semaine-denqute\"\n    }}>{`Dune srie de questionnements  une semaine denqute`}</h2>\n    <p>{`Ltude de cas dont ce site est laboutissement a t articule autour dun format de collaboration intensive que nous appelons datasprint et qui consiste  faire travailler ensemble des expert.e.s de plusieurs disciplines sur un temps court et avec des questions de recherche dtermines  lavance, sur la base dun ou plusieurs jeux de donnes prpars pour loccasion.`}</p>\n    <p>{`En amont du datasprint, nous avons conduit pendant plusieurs mois un double travail de prparation des donnes, et de prparation des questions de recherche. Sur le plan des donnes, les quipes de navigo et de toflit18 donnes ont d effectuer un important travail de nettoyage et daffinement concernant les rgions et les priodes tudies : le fait de projeter une tude de cas prcise a fait merger des problmes qui taient rests dans lombre faute de besoin dun rexamen approfondi. Un travail trs important a galement t effectu pour aligner les deux bases, cest--dire pour mettre en correspondance les lieux et les types de produits commercs ou transports tels quils sont dcrits dans chacune des bases.`}</p>\n    <p>{`Sur le plan de la prparation des questions de recherche de dpart, nous avons conduit une srie de runions prliminaires relies par des documents en ligne rdigs collaborativement, qui nous ont aid  identifier des questions  la fois pertinentes en regard de lhistoire de la rgion et de la littrature existante, mais aussi de ce que les donnes nous permettaient - ou pas - dexplorer et de visualiser. Ce travail dajustement et de mise en correspondance entre les questions et les donnes a ainsi couru doctobre 2020  avril 2021, et nous a permis  la fois didentifier les activits dexploration les plus pertinentes  proposer aux participants durant latelier, et dviter les chausse-trappes qui nous conduiraient dans des questionnements impossibles  rsoudre.`}</p>\n    <p>{`De ce travail de prparation est n un document de questionnement scientifique destin  expliciter les questions de recherche  explorer partag  tous les participant.e.s de la semaine de datasprint. Ainsi, au dbut de cette dernire, ltude de cas tait structure en deux groupes, correspondant  deux lignes denqute complmentaires mais aussi  la constitution de deux quipes quilibres pour la collaboration :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`la premire quipe devait se consacrer  tudier le dynamisme de la rgion du Poitou par rapport  la France et au monde en gnral (avec lhypothse dun dclin par rapport au reste de la France au cours du dix-huitime sicle)`}</li>\n      <li parentName=\"ul\">{`la seconde quipe devait se consacrer  tudier les relations de complmentarit et de domination entre ports de la rgion, de manire notamment  distinguer les flux et circuits commerciaux qui y sont associs`}</li>\n    </ul>\n    <p>{`Sur cette base, un kit de bienvenue a t conu pour permettre  tou.te.s les expert.e.s de rapidement saisir les multiples dimensions de latelier, et nous avons conduit quelques enqutes prliminaires permettant de rsoudre les questions les plus videntes pour tirer le meilleur parti possible de la concentration dexpertises multiples sur un temps court et trs dense permise par le format de travail datasprint.`}</p>\n    <h3 {...{\n      \"id\": \"faire-avec-les-conditions-de-recherche\"\n    }}>{`Faire avec les conditions de recherche`}</h3>\n    <p>{`La semaine du datasprint, qui a eu lieu dbut avril 2021, sest avre concider avec un moment de forte reprise de lpidmie de covid-19 en France en gnral et  Paris en particulier. Cela nous a contraint  effectuer latelier en ligne. Conduire un datasprint en ligne revenait  se priver de lincommensurable apport des changes informels et autres possibilits daffichage, de circulation et de spatialisation offerts par le travail dans un mme lieu physique.  cette contrainte sest ajoute la subite fermeture des coles maternelles et primaires ladite semaine, qui a occasionn une srieuse charge extra-professionnelle pour une part substantielle des participant.e.s.`}</p>\n    <p>{`Le datasprint a nanmoins eu lieu, et nous avons dcid de considrer les conditions particulires dans lesquelles il sest conduit non seulement comme des contraintes demandant de recalibrer drastiquement nos attentes, mais aussi comme des opportunits dinvention et dexprimentation appelant  adapter nos manires de procder par rapport aux modalits initialement planifies.`}</p>\n    <h3 {...{\n      \"id\": \"improvisations-et-adaptations\"\n    }}>{`Improvisations et adaptations`}</h3>\n    <p>{`Durant le datasprint, la diversit des comptences des participant.e.s a impliqu de remettre  plat la rpartition des tches. Ainsi, chacun a pu tre amen  suggrer des pistes de recherche, manipuler les donnes, et se pencher sur lanalyse et la mise en forme des rsultats. Cette semaine a notamment t loccasion dexprimenter avec un grand nombre de technologies utilises durant les activits denqute, notamment `}<a parentName=\"p\" {...{\n        \"href\": \"https://jupyter.org/&sa=D&source=editors&ust=1631692550086000&usg=AOvVaw0Pml2nK77Q3QvwIjEjbIN_\"\n      }}>{`jupyter notebook`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://kepler.gl/&sa=D&source=editors&ust=1631692550086000&usg=AOvVaw0WK9PRupJywU_3nT9VQyFZ\"\n      }}>{`kepler.gl`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://vega.github.io/vega/&sa=D&source=editors&ust=1631692550087000&usg=AOvVaw1muv-wu_g9dqjLqikyETGT\"\n      }}>{`vega`}</a>{`, ou encore `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://matplotlib.org/\"\n      }}>{`matplotlib`}</a>{`. Nous avons nanmoins galement parfois touch aux limites de ce principe en condition zoomifie, certaines discussions spcialises (sur le plan technique ou sur le plan historique par exemple) ncessitant parfois de reformer les corps disciplinaires et des moments dappart transversaux.`}</p>\n    <p>{`Le format datasprint implique par ailleurs une dimension exprimentale, parfois chaotique, et les difficults de communications impliques par la conduite en ligne ont amplifi cette dimension. Nous avons donc construit nos journes de travail sur un canevas allg en terme damplitude horaire, et sous une forme tentant de varier les rythmes et les chelles dinteraction : un point de plnire en matine, suivi de travail en deux groupes, eux-mmes rapidement re-diviss en binmes ou en moments de travail individuel. `}</p>\n    <p>{`Sur le plan technique, nous avons opt pour une salle zoom permanente ouverte durant toute la semaine et divise en breakout rooms (salles de travail) permettant de travailler en plus petits ensembles ; nous avons galement soutenu la semaine avec un dossier google drive trs organis dans lequel lensemble des activits ont t archives et consignes.`}</p>\n    <p>{`Pour faciliter le processus dintercomprhension, des procdures mthodologiques ont galement t proposes aux participants. Ainsi, des personnes jouant le rle de facilitateurs ont fait le lien entre les diffrents groupes en circulant continuellement entre les diffrentes salles zoom de travail. Nous avons par ailleurs insist sur limportance de la documentation en structurant les activits de chaque jour autour de lcriture de rapports remplis au fur et  mesure de la journe, dont une personne scribe tait charge de prendre soin afin de garder un maximum de traces et de permettre les changes dinformation asynchrones. Ces rapports ont finalement t progressivement abandonns, car trop lourds tant donn le poids des autres activits. Nous avons galement progressivement rduit les temps de visioconfrence pour conomiser les dpenses cognitives produites par les changes en ligne.`}</p>\n    <p>{`Les sances de travail dun datasprint provoquent parfois un effet bulle dans lequel chaque quipe peut rapidement se dconnecter du travail effectu par les autres, entranant des blocages, des tches effectues en doublon ou des angles morts. Ce problme est amplifi par la conduite en ligne. Pour faire face  ce dfi, nous avons rythm les journes de points dtapes effectues  plusieurs chelles - par petits groupes, par quipes, ou en plnire - afin de partager les avances. Par ailleurs, des visites informelles et autres zoom surfing ont permis de favoriser certaines circulations dides et de mthodes.`}</p>\n    <p>{`Lun des intrts du format datasprint est enfin de favoriser une unit de temps pour le travail interdisciplinaire. Lintensit quimplique cette unit de temps appelle cependant une valorisation  la hauteur des efforts fournis sur le temps court. Le temps du datasprint est, en temps normal,  la fois un temps dexploration et denqute, et un temps de production de rsultats. Cependant, ce principe a t confront  deux spcificits dans notre cas : les conditions de travail en ligne ont demand de revoir les attentes plus modestement, mais aussi le principe et les objectifs mmes des datasprint de PORTIC qui, parce quils visent la publication de sites web finaliss et contribuant de manire relativement prcise  des tudes de cas trs serres (et non de rapports dexploration des donnes comme cest souvent le cas pour les autres datasprints). Face  ces spcificits, il nous a fallu articuler latelier avec un travail postrieur cadr par dautres temporalits pour arriver  un rsultat publiable.`}</p>\n    <h2 {...{\n      \"id\": \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\"\n    }}>{`La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique`}</h2>\n    <p>{` partir du travail effectu lors du datasprint, nous avons engag une seconde phase dapprofondissement et de continuation des enqutes inities pendant la semaine de travail intensif. Sur le fond, les axes de recherche initialement envisags ont t progressivement remanis. Cela a t fait ds la fin de la semaine de datasprint, au moment de la rdaction dun document de synthse mettant en regard les visualisations produites durant la semaine. Ce travail a t ensuite continu par Ccile Asselin qui a effectu un travail de synthse et de nettoyage sur les productions de la semaine.`}</p>\n    <h3 {...{\n      \"id\": \"une-criture-multimodale\"\n    }}>{`Une criture multimodale`}</h3>\n    <p>{`Afin de construire progressivement,  partir des explorations du datasprint, un document propre  tre publi et  transmettre un rcit et des arguments  partir des donnes des deux bases, nous avons tent dutiliser la perspective de la fabrication dun site pour articuler trois types dcriture : la confection de nouveaux fichiers de donnes correspondant aux enqutes souleves par les activits de la semaine (criture computationnelle) ; la confection de visualisations dinformations (criture diagrammatique) ; enfin, bien sr, la mise en rcit et en argument historique de ltude de cas (criture en prose).`}</p>\n    <p>{`Pour ce faire, nous avons dcid de structurer le site en une srie de trois parties  la structure identique : une visualisation principale constituant largument principal de la partie, accompagn dun texte se fondant dabord sur elle puis suivant ses propres dveloppement, accompagn de visualisations secondaires. Cette organisation visuelle et rhtorique a induit un mode de travail itratif sur le registre du ping pong qui sest dploy en trois temps : `}</p>\n    <ul>\n      <li parentName=\"ul\">{`dans la foule du datasprint, les historien.ne.s ont dabord travaill  prciser les arguments de chacune des trois parties (avril-mai 2021)`}</li>\n      <li parentName=\"ul\">{`nous avons ensuite organis deux jours intensifs de conception avec une quipe rduite dingnieur.e.s et de designers (Ccile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, Maxime Zoffoli) durant lesquels nous avons conu des propositions de visualisations principales (fin mai 2021)`}</li>\n      <li parentName=\"ul\">{`les historien.es ont,  la suite de ces deux jours, repris la main sur lcriture, enrichie et structure par les propositions constitues par les visualisations, en prcisant leurs textes comme leurs besoins pour des visualisations complmentaires, qui ont t progressivement produites en fonction du texte (juin-septembre 2021)`}</li>\n    </ul>\n    <p>{`Dans ce cadre, nous avons progressivement ngoci une infrastructure de travail oriente vers le dveloppement progressif du prsent site web. Ce dernier a tout autant servi dobjectif que de moyen de rencontre entre les diffrentes activits qui ont suivi la semaine datelier datasprint.`}</p>\n    <p>{`La fabrication du site prsent au public a t articule autour dun protocole automatis qui a permis de mettre le site  jour quotidiennement pendant sa phase dcriture et de dveloppement, et ainsi de faire progresser conjointement sa structure, son aspect graphique et les divers contenus qui le peuplent (voir son `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/medialab/portic-storymaps-2021\"\n      }}>{`rpertoire github`}</a>{` pour plus dinformations). Plus prcisment, ce protocole automatis consistait  rcuprer les contenus crits dans un google documents crit par les historien.ne.s, les donnes des bases navigo et toflit18 sur leurs espaces numriques respectifs, et enfin  produire un ensemble de donnes optimises pour le web avant de refabriquer le site.`}</p>\n    <p>{`Cette mthode de travail sur mesure, alternative  lutilisation dun CMS (type wordpress) ou dune intgration des contenus entirement artisanale, nous a permis de multiplier les itrations sur les donnes, les visualisations et les textes, afin de dvelopper itrativement un document ajust et cohrent pour la lecture. Elle nous a galement permis dchapper  une approche qui voudrait formater la production du site de manire trop squentielle, cest--dire faisant suivre un premier temps de conception puis un deuxime temps dexcution, pour plutt faire place  la dcouverte et au dialogue avec les diffrents matriaux en train de se dvelopper. `}</p>\n    <p>{`Ainsi, la mthode de travail et de montage du site adopte ici, outre la dimension doptimisation quimplique lautomatisation de certaines tches, a t le moyen de favoriser un dialogue plus organique entre les diffrentes critures en jeu dans ce document : en ralisant simultanment le design du site, celui des visualisations, et les textes qui les accompagnent, nous avons tent de faire profiter chacune de ces activits lune de lautre, comme des sources dinvention ou de solidification mutuelle, plutt que de les considrer comme des tches spcialises et/ou articules selon un rgime de subordination (de lhistoire  la technique, ou du visuel au textuel, ou de largument  son illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\"\n    }}>{`Un site destin  tisser des liens avec dautres activits et dautres publics`}</h3>\n    <p>{`Ce site est pens  la fois comme un objet autonome droulant le rcit scientifique de lhistoire de la rgion de La Rochelle au dix-huitime sicle, et comme la premire pice dassemblages scientifiques et didactiques encore  venir. Nous lavons conu avec le projet de ladresser  un public constitu dtudiant.e.s en histoire, de professeur.e.s dhistoire du secondaire, ou damateur.ice.s avancs passionns par le Poitou. Cependant, le site est galement pens pour pouvoir sarticuler avec deux publics complmentaires :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`vulgarisateurs et autres mdiateurs pourront utiliser certaines des visualisations pour des initiatives destines  un plus grand public`}</li>\n      <li parentName=\"ul\">{`historien.ne.s spcialiss pourront citer ces visualisations dans des publications conventionnelles en revues ou monographies et ainsi sappuyer sur ces dernires pour continuer nos enqutes`}</li>\n    </ul>\n    <p>{`Pour ce faire, nous avons notamment rendu chacune des visualisations dtachable du rcit propos via la page atlas - et plus techniquement en dotant chacune des visualisations dune adresse URL propre.`}</p>\n    <p>{`Par ailleurs, le `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n      }}>{`code source du site`}</a>{`, partag sous licence libre, a t construit et document de manire  pouvoir tre ventuellement driv - en tout ou partie - pour dautres projets  venir : il pourra apporter des lments utiles pour les prochaines tudes de cas du programme PORTIC mais aussi pour dautres projets similaires. Il est enfin  noter que toutes les donnes utilises - et les scripts qui les gnrent  partir des donnes compltes de toflit18 et navigo, accessibles toutes les deux librement - sont galement inclus dans le code source du site, rendant nos visualisations et rsultats entirement reproductibles.`}</p>\n    <h2 {...{\n      \"id\": \"une-criture-collective--crdits\"\n    }}>{`Une criture collective : crdits`}</h2>\n    <p>{`Ce site est le rsultat dun processus denqute et dcriture collective qui a mobilis des personnes issues de plusieurs disciplines : histoire, conomie, informatique, gomatique, design. Plus prcisment, il est luvre de :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Lingnieure stagiaire `}<a parentName=\"li\" {...{\n          \"href\": \"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7&sa=D&source=editors&ust=1631692550094000&usg=AOvVaw0ulfynLhTfei7lcL5jYioH\"\n        }}>{`Ccile Asselin`}</a>{`, en double cursus ingnierie/sciences humaines, qui sest consacre  plein temps pendant six mois  la conduite mthodologique et technique de lensemble de ltude de cas, accompagne par `}<a parentName=\"li\" {...{\n          \"href\": \"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\"\n        }}>{`Robin de Mourat`}</a>{` (co-responsable scientifique du programme PORTIC)`}</li>\n      <li parentName=\"ul\">{`Le cur de lquipe Navigo : `}<a parentName=\"li\" {...{\n          \"href\": \"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/&sa=D&source=editors&ust=1631692550095000&usg=AOvVaw39020Wis-RNAzPm10fNJnv\"\n        }}>{`Silvia Marzagalli`}</a>{` (historienne du commerce et de la navigation - directrice et co-responsable scientifique du programme PORTIC) et `}<a parentName=\"li\" {...{\n          \"href\": \"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\"\n        }}>{`Christine Plumejeaud`}</a>{` (gomaticienne - co-responsable scientifique du programme PORTIC).`}</li>\n      <li parentName=\"ul\">{`Le cur de lquipe Toflit18 : `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc&sa=D&source=editors&ust=1631692550095000&usg=AOvVaw2OMzffv-MCpJ_cEKtwiCCS\"\n        }}>{`Loc Charles`}</a>{` et `}<a parentName=\"li\" {...{\n          \"href\": \"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\"\n        }}>{`Guillaume Daudin`}</a>{` (historiens de lconomie moderne).`}</li>\n      <li parentName=\"ul\">{`Les historiens `}<a parentName=\"li\" {...{\n          \"href\": \"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/&sa=D&source=editors&ust=1631692550096000&usg=AOvVaw1432T-7BuyvxxU3C7nVxwB\"\n        }}>{`Thierry Sauzeau`}</a>{` et `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\"\n        }}>{`Pierrick Pourchasse`}</a>{`, membres permanents du programme PORTIC ayant particip au datasprint et/ou  lcriture du site`}</li>\n      <li parentName=\"ul\">{`La data librarian `}<a parentName=\"li\" {...{\n          \"href\": \"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b&sa=D&source=editors&ust=1631692550097000&usg=AOvVaw2qEoSWxdc-dGzPOcK9vpCx\"\n        }}>{`Graldine Geoffroy`}</a>{` et le chercheur en informatique `}<a parentName=\"li\" {...{\n          \"href\": \"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\"\n        }}>{`Alain Bouju`}</a>{`.`}</li>\n      <li parentName=\"ul\">{`Les ingnieurs en mthodes numriques et designers du laboratoire mdialab de Sciences Po `}<a parentName=\"li\" {...{\n          \"href\": \"https://bmaz.github.io/&sa=D&source=editors&ust=1631692550098000&usg=AOvVaw2lfEWSkTy_2hRDdY5acTpE\"\n        }}>{`Batrice Mazoyer`}</a>{`, `}<a parentName=\"li\" {...{\n          \"href\": \"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/&sa=D&source=editors&ust=1631692550099000&usg=AOvVaw39yGtYPwY4R8jFc6uP8j48\"\n        }}>{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.google.com/url?q=https://medialab.sciencespo.fr/equipe/guillaume-plique/&sa=D&source=editors&ust=1631692550099000&usg=AOvVaw1ErPeKCTA4kCsZ_KcyacEn\"\n        }}>{`Guillaume Plique`}</a>{`, `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.google.com/url?q=https://medialab.sciencespo.fr/equipe/heloise-thero/&sa=D&source=editors&ust=1631692550099000&usg=AOvVaw2-yoO4MXCzoQ0mREbpaRyA\"\n        }}>{`Hlose Thro`}</a>{`, et `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.google.com/url?q=https://paulinegourlet.com/\"\n        }}>{`Pauline Gourlet`}</a>{`, qui ont particip au datasprint.`}</li>\n      <li parentName=\"ul\">{`Les experts en traitement et visualisation de donnes invits pour loccasion du datasprint puis pour la conception des visualisations principales de chacune des trois parties : lingnieur et ancien directeur technique du mdialab `}<a parentName=\"li\" {...{\n          \"href\": \"https://fr.linkedin.com/in/paul-girard-57822118&sa=D&source=editors&ust=1631692550100000&usg=AOvVaw1K_b44Yo9DGCZL-mkLB_dj\"\n        }}>{`Paul Girard`}</a>{` (pour lentreprise `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.ouestware.com/&sa=D&source=editors&ust=1631692550101000&usg=AOvVaw2fFQcgpEg5Zdp87NnFeU38\"\n        }}>{`Ouestware`}</a>{`) ainsi que le designer dinformation expert en visualisation de donnes `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.google.com/url?q=https://www.maximezoffoli.com/\"\n        }}>{`Maxime Zoffoli`}</a>{`.`}</li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"dune-srie-de-questionnements--une-semaine-denqute\",\n    level: 2,\n    title: \"Dune srie de questionnements  une semaine denqute\",\n    children: [\n        {\n              id: \"faire-avec-les-conditions-de-recherche\",\n              level: 3,\n              title: \"Faire avec les conditions de recherche\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisations-et-adaptations\",\n              level: 3,\n              title: \"Improvisations et adaptations\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\",\n    level: 2,\n    title: \"La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique\",\n    children: [\n        {\n              id: \"une-criture-multimodale\",\n              level: 3,\n              title: \"Une criture multimodale\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\",\n              level: 3,\n              title: \"Un site destin  tisser des liens avec dautres activits et dautres publics\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"une-criture-collective--crdits\",\n    level: 2,\n    title: \"Une criture collective : crdits\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`About TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.79,\"time\":47400,\"words\":158}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"rfrences\"\n    }}>{`Rfrences`}</h1>\n    <h3 {...{\n      \"id\": \"sources-archivistiques\"\n    }}>{`Sources archivistiques`}</h3>\n    <p>{`Les donnes sur la navigation proviennent de la base de donnes Navigocorpus. Pour cette enqute, il sagit plus particulirement des:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`congs issus de la sous-srie G5 conservs aux Archives Nationales de France`}</li>\n      <li parentName=\"ul\">{`congs de Lorient, Archives dpartementales du Morbihan, 10B-19`}</li>\n      <li parentName=\"ul\">{`congs de Saint-Tropez, Archives dpartementales du Var, 7 B 10`}</li>\n      <li parentName=\"ul\">{`Registres du Bureau de Sant de Marseille, 200 E 543 et 545`}</li>\n    </ul>\n    <p>{`Les donnes relatives aux expditions ngrires ont t compltes avec la base de donnes `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.slavevoyages.org/voyage/database\"\n      }}>{`https://www.slavevoyages.org/voyage/database`}</a></p>\n    <p>{`Les donnes relatives au commerce extrieur proviennent de `}</p>\n    <ul>\n      <li parentName=\"ul\">{`Archives dOutre-Mer, COMPLETER`}</li>\n      <li parentName=\"ul\">{`Archives Nationales de France, COMPLETER`}</li>\n    </ul>\n    <p>{`Les cahiers de dolances tudis ont t collects COMPLETER`}</p>\n    <p>{`Les registres de dlibration de la Chambre de Commerce de La Rochelle sont conservs aux Archives dpartementales de la Charente Maritime, 41 ETP 8 (accessibles en ligne: `}<a parentName=\"p\" {...{\n        \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\"\n      }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir`}{`_`}{`ead`}{`_`}{`visu`}{`_`}{`lien.html?ir=11431`}{`&`}{`id=490014227`}</a>{`) `}</p>\n    <h3 {...{\n      \"id\": \"bibliographie\"\n    }}>{`Bibliographie`}</h3>\n    <p>{`Documents prliminaires dj raliss pouvant tre utiles :`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://docs.google.com/document/d/15AylB2sk_Jrru5GzLTjexs9K3iJgefhn/edit\"\n        }}>{`https://docs.google.com/document/d/15AylB2sk`}{`_`}{`Jrru5GzLTjexs9K3iJgefhn/edit`}</a>{` `}</li>\n    </ul>\n    <hr></hr>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"sources-archivistiques\",\n    level: 3,\n    title: \"Sources archivistiques\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliographie\",\n    level: 3,\n    title: \"Bibliographie\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`References`}</p>\n    <p>{`TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\n\nfunction SvgComponent ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgComponent;","import GeoComponent from './GeoComponent';\n\nexport default GeoComponent;","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","import TriangleComponent from './TriangleComponent';\n\nexport default TriangleComponent;","import BezierComponent from './BezierComponent';\n\nexport default BezierComponent;","import React, { useState, useEffect } from 'react';\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport { None } from 'vega';\n\n\nconst BezierComponent = ({\n    dataFilename,\n    totalWidth = 1200,\n    rowHeight = 200,\n    cx,\n    cy,\n    r,\n    inPercentage\n    // start,\n    // end\n}) => {\n\n    // raw marker data\n    const [data, setData] = useState(null);\n\n    const [loadingData, setLoadingData] = useState(true);\n\n\n\n    /**\n     * Marker data loading\n     */\n    useEffect(() => {\n        if (dataFilename) {\n            const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n            get(dataURL)\n                .then(({ data: csvString }) => {\n                    const newData = csvParse(csvString);\n\n                    setData(newData);\n                    setLoadingData(false);\n                })\n                .catch((err) => {\n                    setLoadingData(false);\n                })\n        }\n\n    }, [dataFilename])\n\n    if (loadingData) {\n        return (\n            <div>Chargement des donnes ...</div>\n        )\n    } else if (!data) {\n        return (\n            <div>Erreur ...</div>\n        )\n    }\n    // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n    // ${70} ${140}, ${110} ${140}, ${110} ${110} \n    // a ${R} : aire selon x de l'ellipse, ${R} : aire selon y de l'elipse, 0 : rotation de l'ellipse selon x, 1, 0 : sweep-flag (dtermine si larc doit commencer son mouvement  un angle ngatif ou positif), -(${R} * 2) 0 : coords de l'arrive\n\n    const partialCircle = require('svg-partial-circle')\n\n    let start = None\n    let end = None\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (inPercentage - 50) / 100 * Math.PI \n    end = Math.PI * 3 / 2 - (inPercentage - 50) / 100 * Math.PI\n\n    const leftPath = partialCircle(\n        cx, cy,         // center X and Y\n        r,              // radius\n        start,          // start angle in radians --> Math.PI / 4\n        end             // end angle in radians --> Math.PI * 7 / 4\n    )\n    .map((command) => command.join(' '))\n    .join(' ')\n    console.log(`<path d=\"${leftPath}\" />`)\n\n    const rightPath = partialCircle(\n        cx, cy,             // center X and Y\n        r,                  // radius\n        start,              // start angle in radians --> Math.PI / 4\n        end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n    .map((command) => command.join(' '))\n    .join(' ')\n    console.log(`<path d=\"${rightPath}\" />`)\n\n    return (\n        <div className=\"BezierComponent\">\n            \n            <svg width={1000} height={800} style={{ border: '1px solid lightgrey' }}>\n\n                <path \n                    d={`${leftPath}\n                    `} \n                    stroke=\"blue\" \n                    stroke-width=\"10\" //  ajuster en fonction de la largeur de l'cran\n                    fill=\"transparent\"\n                />\n\n                <path \n                    d={`${rightPath}\n                    `} \n                    stroke=\"red\" \n                    stroke-width=\"10\" //  ajuster en fonction de la largeur de l'cran\n                    fill=\"transparent\"\n                />\n            </svg>\n        </div>\n    );\n\n}\n\nexport default BezierComponent;\n","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: str }) => {\n          const extension = dataFilename.split('.').pop();\n          let newData;\n          if (extension === 'csv') {\n            newData = csvParse(str);\n          } else if (extension === 'geojson' || extension === 'json') {\n            newData = str;\n          }\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"9 min read\",\"minutes\":8.095,\"time\":485700,\"words\":1619}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgComponent from '../../components/SvgComponent';\nimport VegaComponent from '../../components/VegaComponent';\nimport SigmaComponent from '../../components/SigmaComponent';\nimport GeoComponent from '../../components/GeoComponent';\nimport TriangleComponent from '../../components/TriangleComponent';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport BezierComponent from '../../components/BezierComponent';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\nimport { Step3Objects } from '../../visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <p>{`Test en prod`}</p>\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + donnes avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h3 {...{\n      \"id\": \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\"\n    }}>{`Fond de carte - test custom layer avec config coast from Nantes to Bordeaux`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step3_viz_customs_offices_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname'\n          }\n        }, {\n          type: 'custom',\n          data: visData,\n          renderObjects: Step3Objects\n        }]} projectionTemplate='coast from Nantes to Bordeaux' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider> \n    <h3 {...{\n      \"id\": \"fond-de-carte---test-flows-avec-config-world\"\n    }}>{`Fond de carte - test flows avec config World`}</h3>\n    <DataProvider data={'world_1789_23mars2021_level0.json'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'aggregated_flows.json'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'flows',\n          data: visData,\n          size: {\n            field: 'tonnages_cumuls'\n          }\n        }]} projectionTemplate='World' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-france\"\n    }}>{`Fond de carte - config France`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'ports_locations_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'admiralty',\n            palette: colorPalettes.admiralties\n          },\n          size: {\n            field: 'customs_region'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='France' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-rotated-poitou\"\n    }}>{`Fond de carte - config rotated Poitou`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step1_viz_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'customs_office',\n            palette: colorPalettes.customs_office\n          },\n          size: {\n            field: 'mean_tonnage'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='rotated Poitou' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-poitou\"\n    }}>{`Fond de carte - config Poitou`}</h3>\n    <p>{`Cartographie des destination des bateaux aillant un port dattache dans la rgion, par tonnage cumul (couleur = amiraut) :`}</p>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels projectionTemplate='Poitou' height={800} width={1200} mdxType=\"GeoComponent\" />\n    <h2 {...{\n      \"id\": \"fond-de-carte-sans-template-pour-la-config\"\n    }}>{`Fond de carte sans template pour la config`}</h2>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeoComponent\" />\n    <h2 {...{\n      \"id\": \"test-courbes-de-bzier\"\n    }}>{`Test courbes de bzier`}</h2>\n    <BezierComponent dataFilename=\"part_3_step3_viz_customs_offices_data.csv\" cx={300} cy={250} r={210} inPercentage={10} start={Math.PI / 2} end={Math.PI * 3 / 2} mdxType=\"BezierComponent\" />\n    {\n      /* # Tests composant LineChart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data.filter(d => d.region === 'France')}\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 5,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n             annotations={[\n                   {\n                     type: 'span',\n                     start: 1756,\n                     end: 1763,\n                     axis: 'x',\n                     label: 'guerre de sept ans'\n                   },\n                   {\n                     type: 'span',\n                     start: 400000000,\n                     end: 500000000,\n                     axis: 'y',\n                     label: 'priode de faste'\n                   }\n                 ]}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de titre\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de line chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`,\n               fillGaps: true\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de linechart (minimum de props)\"\n             // width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               // title: 'anne',\n             }}\n             y={{\n               field: 'Imports',\n               // title: 'imports',\n               // tickSpan: 100000000,\n               // tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               // title: 'Rgion'\n             }}\n             // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      # Tests composant BarChart\n      ## Horizontal bar chart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (sans fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             annotations={[\n               {\n                 type: 'span',\n                 start: 1756,\n                 end: 1763,\n                 axis: 'x',\n                 label: 'guerre de sept ans'\n               },\n               {\n                 type: 'span',\n                 start: 400000000,\n                 end: 500000000,\n                 axis: 'y',\n                 label: 'priode de faste'\n               }\n             ]}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (grouped, fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped, no fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      ## Vertical bar charts\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               // tickSpan: 1000000,\n               //tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             height={200}\n             y={{\n               field: 'year',\n               title: 'anne',\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               rowHeight: 30,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               rowHeight: 50\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      ## Test triangle \n      <TriangleComponent \n       dataFilename=\"part_3_step1_viz_data.csv\" \n       rowHeight={300}\n       totalWidth = {1600}\n       />\n      ## Test courbes de bzier\n      <BezierComponent\n       dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n       cx={300}\n       cy={250}\n       r={210}\n       inPercentage={10}\n       // start={Math.PI / 2}\n       // end={Math.PI * 3 / 2}\n       />\n      # Test bateaux\n      <BoatsIllustration />\n      \n      # Commerce multi-chelle dans la rgion de La Rochelle\n      \n      Voici un tour d'horizon des modules react prpars pour faciliter le dveloppement :\n      ## Image SVG (avec webpack)\n      On intgre une image  SVG depuis le local (elle sera donc packe par webpack) :\n      \n      ## Image SVG (sans webpack)\n      On intgre ici directement une image  partir de son URL en ligne (depuis le dossier `public`)\n      ##### ! cass pour le moment\n      // <SvgComponent path =\"/svg/ports-region-1789.svg\" />\n      ## Visualisation vega\n      Les visualisations vega ont besoin d'un fichier csv stock dans le dossier `public/data` et d'une spec vega.\n      <VegaComponent \n       data=\"sorties_navires_vers_colonies.csv\" \n       spec={{\n         \"mark\": \"rect\",\n         \"encoding\": {\n           \"x\": {\n             \"field\": \"port_depart\",\n             \"type\": \"nominal\"\n           },\n           \"y\": {\n             \"field\": \"port_destination\",\n             \"type\": \"nominal\"\n           },\n           \"color\": {\n             \"type\": \"quantitative\",\n             \"field\": \"tonnage\",\n             \"aggregate\": \"sum\"\n           }\n           \n         }\n       }}\n      />\n      ## Rseau avec sigma\n      Les visualisations sigma ont besoin d'un fichier gexf stock dans le dossier `public/data`.\n      Paramtres :\n      * `nodeColor` : attribut pour couleur\n      * `nodeSize` : attribut pour taille\n      * `labelDensity` : densit des labels (float dans [0, 1])\n      \n      <SigmaComponent \n       data=\"toflit_aggregate_1789_only_out.gexf\" \n       nodeColor={`admiralty`}\n       nodeSize={`inside_degree`}\n       labelDensity={0.5}\n      />\n      */\n    }\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        {\n              id: \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\",\n              level: 3,\n              title: \"Fond de carte - test custom layer avec config coast from Nantes to Bordeaux\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---test-flows-avec-config-world\",\n              level: 3,\n              title: \"Fond de carte - test flows avec config World\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-france\",\n              level: 3,\n              title: \"Fond de carte - config France\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-rotated-poitou\",\n              level: 3,\n              title: \"Fond de carte - config rotated Poitou\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-poitou\",\n              level: 3,\n              title: \"Fond de carte - config Poitou\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"fond-de-carte-sans-template-pour-la-config\",\n    level: 2,\n    title: \"Fond de carte sans template pour la config\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"test-courbes-de-bzier\",\n    level: 2,\n    title: \"Test courbes de bzier\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\nconst BoatsIllustration = ({\n  width = 1200,\n  height = 100,\n}) => {\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","import { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\nimport {useRef, useEffect} from 'react';\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\n// import Graph from 'graphology-types';\nimport palettes from '../colorPalettes';\n\nconst {generic} = palettes;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\nexport function buildPageTitle (title, lang = 'fr') {\n  const currentMetadata = metadata[lang] || metadataFr;\n  return `${title} | ${currentMetadata.title} | PORTIC`;\n}\n\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\nexport function cartesian2Polar(x, y){\n  const distance = Math.sqrt(x*x + y*y)\n  const radians = Math.atan2(y,x) //This takes y first\n  return { distance:distance, radians:radians }\n}\n\n\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajout startYear et endYear pour\n      // la rcupration de portic il s'agira de dduire ce year des donnes\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble tre indiable mais pas sur qu'on doive pas le mettre dans un format spcial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas  garder dans le rsultats (colonne donnes dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau  une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        //  partir de l, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptes par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intressent dans le rsultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'tait else { ... } et on passait jamais dedans apparemment du coup l c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // diffrencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"aprs le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // mthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // mthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // mthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : rcupre les flux toflit18\n  --- \n  Paramtres :\n  * startYear : <int> # anne de dbut\n  * endYear : <int> # anne de fin\n  * params : <arr> # proprits  renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs  filtrer dans les flux (peut tre une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // a sert  quelque chose ?? pour moi c'est pas utilis, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'tat a ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les rsultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        // console.log(\"finalData : \", finalData);\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\nexport const getToflitFlowsByApi = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest\n}) => {\n\n  return new Promise((resolve, reject) => {\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    const URL = `http://data.portic.fr/api/flows/?date=${year}`;\n    console.log({ URL })\n    // quivalent  : const URL = 'http://data.portic.fr/api/flows/?date=' + year;\n    get(URL) // get de axios\n      // mixed content issue => comme l'API ne fournit pas d'accs HTTPS je me sentais un peu bloque\n      .then(({ data: str }) => {\n        // conversion en js (avec d3-dsv)\n        // const newData = csvParse(csvString);\n        try {\n          const newData = JSON.parse(str);\n          // contraire : JSON.stringify()\n          // faire des choses avec les rsultats (filtres, ...)\n          const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest })\n          resolve(finalData);\n        } catch (e) {\n          reject(e);\n        }\n\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\n\n\n\n\nexport const getPorticPointcallsByApi = ({\n  filename,\n  spec\n}) => {\n\n}\n\n","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nconst Caller = ({id: visualizationId, ...props}) => {\n  const ref = useRef(null);\n  const [id] = useState(genId());\n  const {\n    activeVisualization,\n    onBlockClick,\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  useEffect(() => {\n    // on wrappe dans un setTimeout pour avoir une ref non-nulle vers le composant\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        'is-hidden': process.env.NODE_ENV !== 'development',\n        'is-devmode': process.env.NODE_ENV === 'development',\n      })}\n    >\n      {\n        process.env.NODE_ENV === 'development' ?\n        <>\n          {\n          visualizationId ?\n          <>caller pour la visualisation <code>{visualizationId}</code> </>\n          :\n          <>caller sans id (agit comme un clearfix)</>\n        }{\n          Object.keys(props).length ? \n            <span>avec les paramtres {JSON.stringify(props)}</span>\n          : null\n        }\n        </>\n        :\n        null\n      }\n      \n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","import { geoPath } from \"d3-geo\";\nimport { generatePalette } from '../../helpers/misc';\nimport { uniq } from 'lodash';\nimport cx from 'classnames';\nimport { useSpring, animated } from 'react-spring'\nimport { useEffect, useState } from \"react\";\nimport ReactTooltip from \"react-tooltip\";\n\nconst GeoPart = ({ d: initialD, projection, project, palette, layer, width, height}) => {\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const currentD = project(initialD);\n\n  const animationProps = useSpring({\n    to: {\n      d: currentD\n    },\n    immediate: !isInited\n  });\n\n  // @todo do this cleanly (removing out of bound objects to improve performance)\n  // const boundsAbs = geoPath().bounds(initialD);\n  // const boundsRel = [projection(boundsAbs[0]), projection(boundsAbs[1])];\n  // let outOfBounds = boundsRel[0][0] > width;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  });\n  return (\n    <animated.path\n      d={animationProps.d}\n      className=\"geopart\"\n      data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n      data-for=\"geo-tooltip\"\n      style={{\n        fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n      }}\n    />\n  )\n}\n\n\n// @TODO : mettre en place une palette de couleurs quantitative \n\nconst ChoroplethLayer = ({ layer, projection, width, height, reverseColors }) => {\n\n  let palette;\n  const project = geoPath().projection(projection);\n\n  if (!layer.data) {\n    console.info(layer);\n    return null;\n  }\n\n  if (layer.data.features && layer.color && layer.color.field) {\n    // colors palette building\n    const colorValues = uniq(layer.data.features.map(datum => datum.properties[layer.color.field]));\n    if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n      palette = layer.color.palette;\n    } else if (layer.color.generatedPalette) {\n      const colors = generatePalette('map', layer.data.features.length);\n      palette = colorValues.reduce((res, key, index) => ({\n        ...res,\n        [key]: colors[index]\n      }), {});\n    }\n  }\n\n  return (\n    <>\n      <g className={cx(\"ChoroplethLayer\", { 'reverse-colors': reverseColors })}>\n        {\n          layer.data.features.map((d, i) => {\n            return (\n              <GeoPart \n                key={d.properties.id ||d.properties.name ||i} \n                {...{projection, project, palette, layer, d, width, height}}\n              />\n            )\n          })\n        }\n      </g>  \n    </>\n  );\n\n}\n\nexport default ChoroplethLayer;","\nimport { useMemo } from 'react';\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\nimport { useSpring, animated, Transition } from 'react-spring'\nimport { useEffect, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\n\n\nconst PointGroup = ({\n  projection,\n  datum,\n  layer,\n  opacity,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  displayLabel\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, color, label, rawSize, labelPosition = 'right', labelSize, index } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <>\n      <animated.g\n        className=\"point-group\"\n        transform={transform}\n        style={{\n          zIndex: labelSize,\n          opacity: opacity\n        }}\n        onMouseEnter={() => onGroupMouseEnter(index)}\n        onMouseMove={() => onGroupMouseEnter(index)}\n        onMouseLeave={() => onGroupMouseLeave()}\n        data-for=\"geo-tooltip\"\n        data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n      >\n        <circle\n          cx={0}\n          cy={0}\n          r={size}\n          style={{ fill: color }}\n          className=\"marker\"\n        />\n        {\n          layer.size.displayMetric && labelSize > 6 ?\n            <text\n              x={0}\n              y={labelSize / 4}\n              textAnchor=\"middle\"\n              fontSize={labelSize / 2}\n              fill=\"white\"\n            >\n              {rawSize}\n            </text>\n            : null\n        }\n\n        {\n          label && displayLabel ?\n            <text\n              x={labelPosition === 'right' ? size + 5 : -size - 5}\n              y={size / 2}\n              fill={layer.color && layer.color.labelsColor}\n              textAnchor={labelPosition === 'right' ? 'start' : 'end'}\n              fontSize={labelSize}\n            >\n              {label}\n            </text>\n            : null\n        }\n      </animated.g>\n    </>\n\n  );\n}\n\nconst StackedLabelGroup = ({\n  layer,\n  datum,\n  thatIndex,\n  opacity,\n  stackedRowHeight,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  labelFontSize,\n  projection\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, label, /*labelPosition = 'right', labelSize, index*/ } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { x2, y2, transformLabel } = useSpring({\n    to: {\n      x2: x - size,\n      y2: y,\n      transformLabel: `translate(${window.innerWidth * 0.01}, ${datum.labelY})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g\n      style={{\n        // zIndex: labelSize,\n        opacity: opacity\n      }}\n      onMouseEnter={() => onGroupMouseEnter(thatIndex)}\n      onMouseMove={() => onGroupMouseEnter(thatIndex)}\n      onMouseLeave={() => onGroupMouseLeave()}\n      data-for=\"geo-tooltip\"\n      data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n    >\n      <animated.g className=\"label-container\" transform={transformLabel}>\n        <text style={{ fontSize: labelFontSize }}>\n          {\n            label\n          }\n        </text>\n      </animated.g>\n      <animated.line\n        x1={labelFontSize * label.length * .5 + window.innerWidth * 0.01}\n        y1={datum.labelY - stackedRowHeight * .2}\n        x2={x2}\n        y2={y2}\n      />\n    </animated.g>\n  )\n}\n\nconst PointsLayer = ({ layer, projection, width, height }) => {\n\n  const [hoveredIndex, setHoveredIndex] = useState(null);\n\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // regroup data by coordinates\n      const coordsMap = {};\n      layer.data.forEach(datum => {\n        // id\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: layer.label ? datum[layer.label.field] : undefined,\n            labelPosition: layer.label ? layer.label.position : undefined,\n            latitude: +datum.latitude,\n            longitude: +datum.longitude,\n            color: layer.color !== undefined ? datum[layer.color.field] : 'default',\n            size: (layer.size !== undefined && layer.size.field !== undefined) ? isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field] : 0\n          }\n        } else {\n          coordsMap[mark].size += (isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field])\n        }\n      })\n\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n      // console.log(\"grouped : \", grouped)\n\n\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g.color));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n      }\n\n      // size building\n\n      // compute size (would have been more elegand with a ternary but I did not manage to write it properly)\n      let sizeCoef = width / 300; // default size\n      if (layer.size !== undefined && layer.size.custom !== undefined) {\n        sizeCoef = parseInt(layer.size.custom * width / 100);\n      }\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      // basing the scale on area rather than radius\n      const radiusRange = [3, width / 30];\n      const areaRange = radiusRange.map(r => Math.PI * r * r);\n      const sizeScale = scaleLinear().domain(sizeExtent).range(areaRange) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      const labelSizeScale = scaleLinear().domain(sizeExtent).range([8, width / 30]) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: layer.color !== undefined ? palette[datum.color] : 'grey',\n        size: layer.size !== undefined ? layer.size.custom !== undefined ? sizeCoef : sizeScale(datum.size) : width / 100,\n        rawSize: datum.size,\n        labelSize: layer.size !== undefined ? labelSizeScale(datum.size) : width / 100\n      }))\n\n      // console.log(\"grouped (PointsLayer): \", grouped)\n      return grouped;\n    }\n  }, [projection, width, layer])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  let visibleMarkers = markerData\n    .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n    .sort((a, b) => {\n      if (a.latitude > b.latitude) {\n        return 1;\n      }\n      return -1;\n    })\n\n  const onGroupMouseEnter = index => {\n    if (hoveredIndex !== index)\n      setHoveredIndex(index);\n  }\n  const onGroupMouseLeave = () => {\n    setTimeout(() => {\n      if (hoveredIndex !== null)\n        setHoveredIndex(null);\n    })\n  }\n  const stackedLabelsTop = height * .1;\n  const stackedLabelsHeight = height * .9;\n  const stackedRowHeight = stackedLabelsHeight / visibleMarkers.length;\n  const maxLabelFontSize = window.innerHeight * 0.02;\n  const labelFontSize = stackedRowHeight < maxLabelFontSize ? stackedRowHeight : maxLabelFontSize;\n  if (layer.stackLabels) {\n    visibleMarkers = visibleMarkers\n      .sort((a, b) => {\n        if (a.latitude > b.latitude) {\n          return -1;\n        }\n        return 1;\n      })\n      .map((d, i) => ({\n        ...d,\n        labelY: stackedRowHeight * i + stackedLabelsTop\n      }))\n  }\n  visibleMarkers = visibleMarkers.map((d, index) => ({ ...d, index }));\n  return (\n    <g className=\"PointsLayer\">\n      {\n        layer.stackLabels ?\n          <g className=\"stacked-labels-container\">\n            <Transition\n              // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n              items={visibleMarkers}\n              from={{ opacity: 0 }}\n              enter={{ opacity: 1 }}\n              leave={{ opacity: 0 }}\n            >\n              {({ opacity }, datum, thatIndex) => (\n                <StackedLabelGroup\n                  key={datum.label}\n                  {...{\n                    projection,\n                    datum,\n                    layer,\n                    opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n                    thatIndex: datum.index,\n                    onGroupMouseEnter,\n                    onGroupMouseLeave,\n                    stackedRowHeight,\n                    labelFontSize,\n                  }}\n                />\n              )\n\n              }\n            </Transition>\n          </g>\n          : null\n      }\n      <Transition\n        // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n        items={visibleMarkers}\n        from={{ opacity: 0 }}\n        enter={{ opacity: 1 }}\n        leave={{ opacity: 0 }}\n      >\n        {({ opacity }, datum, index) => (\n          <PointGroup\n            key={datum.label}\n            {...{\n              projection,\n              datum,\n              layer,\n              opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n              index: datum.index,\n              onGroupMouseEnter,\n              onGroupMouseLeave,\n              displayLabels: !layer.stackLabels\n            }}\n          />\n        )\n\n        }\n      </Transition>\n      {/* {\n        visibleMarkers\n          .map((datum, index) => {\n            return (\n              <PointGroup\n                key={datum.label}\n                {...{ projection, datum, layer }}\n              />\n            )\n          })\n      } */}\n    </g>\n  );\n}\n\nexport default PointsLayer;","\nimport { useMemo, useState, useEffect } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\nimport { uniq } from 'lodash';\nimport { generatePalette } from '../../helpers/misc';\n\nimport { useSpring, animated } from 'react-spring'\n\n/*\nPrincipe : path entre deux point gographiques, dont le stroke peut varier, et on peut avoir la direction avec une fleche \n\nformat des donnes attendu (json) : \n\nExemple :\n\"flow_id\": \"45.95_-0.9_46.166667_-1.15\", \n\"port_dep\": \"Charente\", \n\"port_dest\": \"La Rochelle\", \n\"latitude_dep\": 45.95, \n\"longitude_dep\": -0.9, \n\"latitude_dest\": 46.166667, \n\"longitude_dest\": -1.15, \n\"nb_flows\": 22, \n\"tonnages_cumuls\": 730}\n\n@TODO : rgler le fait que la pointe des flches ne soit pas  l'arrive (en l'tat c'est la base du triangle qui est sur les coords d'arrive) => se rgle en reculant le triangle :   viewBox=\"-10 0 10 10\" &  <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"black\" /> ( ce moment il fut rtrcir la longueur du path qui fait la barre de la flche)\n@TODO : mettre un point au dpart de mes flows ? (pas adapt quand on a des points de dpart et d'arrive qui se recoupent)\n*/\n\nconst FlowGroup = ({\n  arrowSize,\n  xDep: inputXDep,\n  yDep: inputYDep,\n  xDest: inputXDest,\n  yDest: inputYDest,\n  strokeWidth: inputStrokeWidth,\n  width,\n  height,\n  projectionTemplate,\n  datum,\n  layer,\n  color = 'black',\n}) => {\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n  let path = `M ${inputXDep} ${inputYDep} L ${inputXDest} ${inputYDest}`;\n  let cp1X = 0, cp1Y = 0, cp2X = 0, cp2Y = 0;\n  // left to right\n  if (inputXDest > inputXDep) {\n    cp1Y = inputYDep;\n    cp2Y = inputYDest;\n    cp1X = inputXDep - Math.log(inputXDest - inputXDep) // inputXDest + (inputXDest - inputXDep) / 2;\n    cp2X = inputXDep - Math.log(inputXDest - inputXDep) // inputXDest + (inputXDest - inputXDep) / 2;\n    // @todo clean that someday\n    if (inputYDest > height / 2 && projectionTemplate === \"World\") {\n      cp1X -= width * .3;\n      cp2X -= width * .3;\n    }\n    // top to bottom\n    if (inputYDest > inputYDep) {\n      if (projectionTemplate === 'France') {\n        cp1X -= width;\n        cp2X -= width;\n      }\n      path = `M ${inputXDep} ${inputYDep} C ${cp1X}, ${cp1Y} ${cp2X}, ${cp2Y} ${inputXDest}, ${inputYDest}`;\n      // bottom to top\n    } else {\n      // cp2X = inputXDest;\n      cp1X = inputXDep - (inputXDest - inputXDep) * 2.5;\n      cp2X = inputXDep - (inputXDest - inputXDep) * 2.5;\n      cp1Y = inputYDep;\n      cp2Y = inputYDest;\n      path = `M ${inputXDep} ${inputYDep} C ${cp1X}, ${cp1Y} ${cp2X}, ${cp2Y} ${inputXDest}, ${inputYDest}`;\n    }\n    // right to left\n  } else {\n    // top to bottom\n    if (inputYDest > inputYDep) {\n      cp1X = inputXDest + (width / 4 + inputXDest > inputXDep ? 0 : width / 4);\n      cp1Y = inputYDep;\n\n      cp2X = inputXDest + (width / 4 + inputXDest > inputXDep ? 0 : width / 4);\n      cp2Y = inputYDep;\n\n      path = `M ${inputXDep} ${inputYDep} C ${cp1X}, ${cp1Y} ${cp2X}, ${cp2Y} ${inputXDest}, ${inputYDest}`;\n      // bottom to top\n    } else {\n\n\n      // path = `M ${inputXDep} ${inputYDep} C ${cp1X}, ${cp1Y} ${cp2X}, ${cp2Y} ${inputXDest}, ${inputYDest}`;\n    }\n  }\n  const { d, labelDepTransform, labelDestTransform, strokeWidth } = useSpring({\n    to: {\n      xDep: inputXDep,\n      yDep: inputYDep,\n      xDest: inputXDest,\n      yDest: inputYDest,\n      d: path,\n      strokeWidth: inputStrokeWidth,\n      labelDepTransform: `translate(${inputXDep}, ${inputYDep})`,\n      labelDestTransform: `translate(${inputXDest}, ${inputYDest})`,\n      arrowPath: `M ${inputXDep} ${inputYDep} L ${inputXDest} ${inputYDest}`\n    },\n    immediate: !isInited\n  });\n  const fontSize = width * 0.01;\n  return (\n    <g className=\"flow-group\">\n      <defs>\n        <marker id=\"triangle\" viewBox=\"0 0 10 10\"\n          refX=\"1\" refY=\"5\"\n          markerUnits=\"strokeWidth\"\n          markerWidth={arrowSize} markerHeight={arrowSize}\n          orient=\"auto\">\n          <path d=\"M 0 0 L 10 5 L 0 10 Z\" fill={color} />\n        </marker>\n      </defs>\n      {/* <animated.line\n      x1={xDep}\n      y1={yDep}\n      x2={xDest}\n      y2={yDest}\n      stroke=\"blue\"\n    /> */}\n      {/* <circle\n        r={4}\n        cx={cp1X}\n        cy={cp1Y}\n        r={2}\n        fill=\"red\"\n      />\n      <circle\n        r={4}\n        cx={cp2X}\n        cy={cp2Y}\n        r={5}\n        fill=\"green\"\n      /> */}\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth * 3}\n        fill=\"none\"\n        stroke={color}\n        opacity={0}\n      />\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth}\n        marker-end=\"url(#triangle)\"\n        fill=\"none\"\n        stroke={color}\n      />\n      {\n        layer.label && layer.label.fields ?\n          <>\n            <animated.g className=\"label\" transform={labelDepTransform}>\n              <text\n                textAnchor={inputXDest < inputXDep ? 'start' : 'end'}\n                x={inputXDest < inputXDep ? 10 + inputStrokeWidth * 2 : -10 - inputStrokeWidth}\n                y={fontSize * .3}\n                fontSize={fontSize}\n              >\n                {datum[layer.label.fields[0]]}\n              </text>\n            </animated.g>\n            <animated.g className=\"label\" transform={labelDestTransform}>\n              <text\n                textAnchor={inputXDest > inputXDep ? 'start' : 'end'}\n                x={inputXDest > inputXDep ? 10 + inputStrokeWidth * 2 : -10 - inputStrokeWidth}\n                y={fontSize * .3}\n                fontSize={fontSize}\n              >\n                {datum[layer.label.fields[1]]}\n              </text>\n            </animated.g>\n          </>\n          : null\n      }\n      {/* <animated.path \n      d={arrowPath} \n      stroke=\"black\" \n      strokeWidth={strokeWidth} \n      marker-end=\"url(#triangle)\" \n    /> */}\n      {/* <line x1={xDep} y1={yDep} x2={xDest} y2={yDest} stroke=\"black\" stroke-width={size} marker-end=\"url(#triangle)\" /> */}\n    </g>\n  )\n}\n\nconst FlowsLayer = ({\n  layer,\n  projection,\n  width,\n  height,\n  projectionTemplate\n}) => {\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // console.log(\"data : \", layer.data)\n      // size building\n      const strokeWidthScale = scaleLinear().domain([\n        0,\n        max(\n          layer.data.map((flow) => {\n            // return +flow[tonnages_cumuls];\n            // console.log(\"flow[layer.size.field] : \", flow[layer.size.field])\n            return +flow[layer.size.field];\n          })\n        )\n      ]).range([0, width * height / 50000]);\n\n      const arrowSizeScale = strokeWidthScale.copy().range([0, width * height / 100000]);\n\n      let grouped = layer.data.map(flow => ({ // je ne sais pas si grouped reste le plus adapt\n        ...flow,\n        // color: palette[datum.color],\n        strokeWidth: strokeWidthScale(+flow[layer.size.field]),\n        arrowSize: arrowSizeScale(layer.data.strokeWidth)\n      }))\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g[layer.color.field]));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n        grouped = grouped.map(datum => ({\n          ...datum,\n          color: layer.color !== undefined ? palette[datum[layer.color.field]] : 'grey',\n        }))\n      }\n      // console.log(\"grouped : \", grouped)\n      return grouped;\n    }\n  }, [projection, width, layer, height])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  // console.log(\"markerData (FlowsLayer) : \", markerData)\n\n  return (\n    <g className=\"FlowsLayer\" >\n      {\n        markerData\n          .filter(({ latitude_dep, longitude_dep, latitude_dest, longitude_dest }) => latitude_dep && longitude_dep && latitude_dest && longitude_dest && !isNaN(latitude_dep) && !isNaN(longitude_dep) && !isNaN(latitude_dest) && !isNaN(longitude_dest))\n          .map((datum, index) => {\n            const { latitude_dep, longitude_dep, latitude_dest, longitude_dest, strokeWidth, arrowSize, color } = datum;\n            const [xDep, yDep] = projection([+longitude_dep, +latitude_dep]);\n            const [xDest, yDest] = projection([+longitude_dest, +latitude_dest]);\n            // console.log(\"[xDep, yDep] / [xDest, yDest] : \", [xDep, yDep], \" / \", [xDest, yDest]);\n\n            return (\n              <FlowGroup\n                {\n                ...{\n                  arrowSize,\n                  xDep,\n                  yDep,\n                  xDest,\n                  yDest,\n                  strokeWidth,\n                  datum,\n                  layer,\n                  width,\n                  color,\n                  height,\n                  projectionTemplate,\n                }\n                }\n              />\n            );\n          })\n      }\n    </g>\n  );\n}\n\nexport default FlowsLayer;","\n\n\nconst CustomObjectLayer = ({ layer, projection, width, height, projectionTemplate }) => {\n    return (\n        <g className=\"CustomObjectsLayer\">\n          {\n            typeof layer.renderObjects === 'function' ?\n                layer.renderObjects({data: layer.data, projection, width, height, projectionTemplate})\n            :\n            layer.data\n              // .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n              .map((datum, index) => {\n                // const { latitude, longitude, size, color, label } = datum;\n                // const [x, y] = projection([+longitude, +latitude]);\n                return layer.renderObject({ datum, projection, width, height, projectionTemplate })\n              })\n          }\n        </g>\n      );\n}\n\nexport default CustomObjectLayer;","import { useEffect, useState } from \"react\"\n\nconst Button = ({\n    children,\n    onMouseDown,\n    ...props\n  }) => {\n    const [isMouseDown, setState] = useState(false)\n  \n    useEffect(() => {\n      let interval\n      if (isMouseDown) {\n        console.log(\"setInterval\")\n        interval = setInterval(onMouseDown, 100)\n      }\n      return () => {\n        console.log(\"clearInterval\")\n        clearInterval(interval)\n      }\n    }, [isMouseDown, onMouseDown])\n  \n    return <button\n      {...props}\n      onMouseDown={() => {\n        setState(true)\n      }}\n      onMouseUp={() => {\n        setState(false)\n      }}\n      style={{ background: isMouseDown ? 'red' : undefined }}\n    >\n      {children}\n    </button>\n  }\n\n  export default Button ;","import { useState, useEffect } from \"react\" ;\n\nconst Input = ({\n    value: inputValue,\n    onBlur,\n    ...props\n  }) => {\n    const [value, setValue] = useState(inputValue)\n    useEffect(() => {\n      setValue(inputValue)\n    }, [inputValue])\n  \n    return <input\n      value={value}\n      onChange={(e) => {\n        setValue(e.target.value)\n      }}\n      onBlur={(e) => {\n        onBlur(e.target.value)\n      }}\n    />\n  }\n  \nexport default Input ;  ","import { uniq } from \"lodash-es\";\nimport { generatePalette } from '../../helpers/misc';\n\n\nconst Legend = ({\n  layers,\n  position\n}) => {\n  return (\n    <div className={`Legend ${typeof position === 'string' ? position : ''}`}>\n      <h5 className=\"legend-main-title\">Lgende</h5>\n      {\n        layers.map((layer, id) => {\n          let hasSize;\n          let hasColors;\n          let colorModalities;\n          if (layer.size && layer.size.field) {\n            hasSize = true;\n          }\n          if (layer.color && layer.color.field) {\n            hasColors = true;\n            const colorValues = uniq(layer.data.map(datum => datum[layer.color.field]))\n            // @todo refactor the following with PointsLayer as an util\n            let palette;\n            // colors palette building\n            if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n              palette = layer.color.palette;\n            } else {\n              const colors = generatePalette('map', colorValues.length);\n              palette = colorValues.reduce((res, key, index) => ({\n                ...res,\n                [key]: colors[index]\n              }), {});\n            }\n            colorModalities = Object.entries(palette);\n          }\n          return (\n            <>\n              {\n                hasSize ?\n                <div key={id} className=\"size-legend-container\">\n                  {/* <h6 className=\"legend-title\">Taille des cercles</h6> */}\n                  <div className=\"size-legend-item\">\n                  <span className=\"size-icon-container\">\n                    <span />\n                    <span />\n                  </span>\n                  <span className=\"label\">\n                  {layer.size.title || layer.size.field}\n                  </span>\n                  </div>\n                </div>\n                : null\n              }\n              {\n                hasColors ?\n                <div key={id + 'b'} className=\"color-legend-container\">\n                  <h6 className=\"legend-title\">{layer.color.title || layer.color.field}</h6>\n                  <ul className=\"modalities-list\">\n                    {\n                      colorModalities.map(([modality, color]) => (\n                        <li key={modality}>\n                          <span style={{background: color}} className=\"color-marker\" />\n                          <span className=\"label\">{modality}</span>\n                        </li>\n                      ))\n                    }\n                  </ul>\n                </div>\n                : null\n              }\n            </>\n          )\n        })\n      }\n    </div>\n  )\n}\n\nexport default Legend;","/* DOCUMENTATION : API de ce GoComponent\n\n  Principe :\n    Composants rutilisable pour toutes les cartes utiliss sur les sites PORTIC\n    cartographie en SVG\n    -> permet de faire des cartes choroplthes, de reprsenter des ports, des flux de navires, ...\n\n  Paramtres : \n    * width : largeur de la carte (par dfaut  1500 px)\n    * height : hauteur de la carte (par dfaut  1500 px)\n\n    * layers : diffrentes couches de la carte ('choropleth', 'points', 'flows', 'custom'),  chaque layer il faut donner un fichier de donnes (stock dans public/data) pour construire le objets qui le constituent, les couleurs, tailles, labels de ces objets sont paramtrables \n        si layer 'custom' choisi, il faut passer au layer une fonction d'affichage des donnes :\n        - renderObject : donner un objet de donne en paramtre, la fonction s'occupe de construire sa reprsentation SVG et de la positionner individuellement sur la carte\n        - renderObjects : donner un dataset, la fonction s'occupe de construire une reprsentation SVG de l'ensemble des objets, et de grer leurs positionnement sur la carte (souvent adapt quand le positionnement n'est pas gographique, qu'on a besoin de grer les espacements entre objets ...)\n\n    * projectionTemplate : configuration de carte utilise frquemment ('France', 'coast from Nantes to Bordeaux', 'Poitou', 'rotated Poitou')\n    * projectionConfig: configuration de carte customise (ce paramtre prime sur projectionTemplate si les 2 sont donnes en mme temps)\n\n    * debug : permet d'ajuster manuellement la configuration de la carte quand true (les paramtres de zoom, les coordonnes du centre, la rotation et les translations sont ajustables)\n    \n  @TODO : documenter ce component de manire standardise\n  */\n\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport { geoEqualEarth } from \"d3-geo\";\nimport ChoroplethLayer from './ChoroplethLayer';\nimport PointsLayer from './PointsLayer';\nimport FlowsLayer from './FlowsLayer';\nimport CustomObjectLayer from './CustomObjectLayer';\n// import TriangleComponent from '../TriangleComponent/TriangleComponent';\nimport Button from './Button';\nimport Input from './Input';\nimport Legend from './Legend';\n\nimport './GeoComponent.scss'\n\n\nconst GeoComponent = ({\n  width = 1500,\n  height = 1500,\n  title,\n  layers = [],\n  projectionTemplate: initialProjectionTemplate,\n  projectionConfig: inputProjectionConfig, // customed config that will overwrite a template (optional argument) \n  debug = false, // @TODO :  rparer\n  withLegend,\n}) => {\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur rgion\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n  const [projectionTemplate, setProjectionTemplate] = useState(initialProjectionTemplate)\n\n  // trick for nice animations\n  useEffect(() => {\n    // setTimeout(() => {\n      setProjectionTemplate(initialProjectionTemplate);\n    // })\n  }, [initialProjectionTemplate])\n\n\n  // define a default map Config\n  const defaultProjectionConfig = useMemo(() => {\n    return {\n      rotationDegree: 0,\n      centerX: 2.4486203,\n      centerY: 46.8576176,\n      scale: height * 5\n    };\n  }, [height]) // repsonsive : se fait en fonction de la height de l'cran\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => { // def les bonnes valeurs pour la config de la projection // enregistrer dans le state // les appliquer dans la projection\n\n    let projectionConfig = { ...defaultProjectionConfig } // casser la rfrence  defaultProj pour respecter principe react qu'on ne modifie pas un objet reu en argument\n\n    let projection = geoEqualEarth()\n\n    switch (projectionTemplate) {\n      case 'World':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * .5,\n          centerX: -1,\n          centerY:  15,\n          // translationX: width * 0.4,\n          // translationY: height * 0.28\n        }\n        break;\n      case 'coast from Nantes to Bordeaux':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 24,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.28\n        }\n        break;\n      case 'Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 30,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'Poitou zoomed':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 23,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'rotated Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          rotationDegree: 58,\n          scale: height * 32,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.29,\n          translationY: height * 0.25\n        }\n        break;\n      case 'France':\n      default: // as France config \n        // console.log('projection config in dry version', projectionConfig);\n        // console.log(`we are taking the config as specified in config parameters ===> if not specified, the view should correspond to France`);\n        break;\n    }\n\n    if (inputProjectionConfig !== undefined) {\n      projectionConfig = {\n        ...projectionConfig,\n        ...inputProjectionConfig\n      }\n    }\n\n    // update the config\n    setScale(projectionConfig.scale)\n\n    setRotation(projectionConfig.rotationDegree)\n\n    setCenterX(projectionConfig.centerX)\n    setCenterY(projectionConfig.centerY)\n\n    if (projectionConfig.translationX !== undefined) {\n      setTranslationX(projectionConfig.translationX)\n      setTranslationY(projectionConfig.translationY)\n    }\n    else {\n      projectionConfig.translationX = width / 2;\n      projectionConfig.translationY = height / 2;\n      setTranslationX(width / 2)\n      setTranslationY(height / 2)\n    }\n\n    projection\n      .scale(projectionConfig.scale)\n\n    projection.center([projectionConfig.centerX, projectionConfig.centerY])\n\n    if (projectionConfig.rotationDegree) {\n      projection.angle(projectionConfig.rotationDegree)\n    }\n\n    projection.translate([projectionConfig.translationX, projectionConfig.translationY])\n\n    return projection;\n  }, [width, height, defaultProjectionConfig, inputProjectionConfig, projectionTemplate]) \n\n\n\n  // const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n  return (\n    <div className=\"GeoComponentWrapper\">\n\n      {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div className=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg className=\"GeoComponent\" width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n\n        {\n          layers.map((layer, layerIndex) => {\n\n            switch (layer.type) {\n              case 'choropleth':\n                return <ChoroplethLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  reverseColors={layer.reverseColors}\n                />\n\n              case 'points':\n                return <PointsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'flows': \n                return <FlowsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  projectionTemplate={projectionTemplate}\n                />\n\n              case 'custom':\n                return <CustomObjectLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  projectionTemplate={projectionTemplate}\n                  width={width}\n                  height={height}\n                />\n\n              default:\n                return <g key={layerIndex}><text>Unsupported layer type</text></g>\n            }\n          })\n        }\n        {/* <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n        <rect x=\"58%\" y=\"78%\" width={width * 0.4} height={height * 0.2} rx=\"15\" ry=\"15\" fill={'white'} opacity={0.5} /> */}\n      </svg>\n      {\n        withLegend ?\n        <Legend layers={layers} position={withLegend} />\n        : null\n      }\n      <ReactTooltip id=\"geo-tooltip\" />\n    </div>\n  )\n}\n\nexport default GeoComponent;\n\n\n// old GeoComp handling for configs\n\n\n/*\nconst projection = useMemo(() => {\n  setTranslationX(width/2)\n  setTranslationY(height/2)\n\n let projection = geoEqualEarth() // ce qui vaut dans tous les cas ...\n   .scale(scale)\n   .translate([translationX, translationY]) // put the center of the map at the center of the box in which the map takes place ?\n\n if (backgroundData) { // que si center on region\n   if (centerOnRegion) {\n     setScale(height*24); // 500000 //*24\n     setCenterX(-1.7475027);\n     setCenterY(46.573642);\n     projection\n       .scale(scale) // 50000 for a centered map\n       .center([centerX, centerY]) // -1.7475027, 46.573642 for a centered map\n       .translate([translationX * 0.8, translationY * 0.56]) // @TODO : stabiliser avec coefficients calculs (pour l'instant c'est du bricolage : j'essaie de cadrer entre Nantes et Bordeaux)\n   } else {\n     // if bg data is available fit on whole geometry\n     projection\n       .fitSize([width, height], backgroundData)\n   }\n   if (rotationDegree !== 0) { // seul cas o on veut une carte tourne pour le moment c'est dans le cas step 1 main viz part 3\n     setScale(width*28)\n     setRotation(rotationDegree);\n     projection\n       .angle(rotation)\n       .translate([translationX * 0.65, translationY * 0.65]) // dans ce cas besoin de dcaler la carte vers la droite et vers le haut :  @TODO stabiliser avec coefficients calculs (pour l'instant c'est du bricolage)\n   }\n\n }\n return projection;\n}, [backgroundData, width, height, centerOnRegion, scale, rotation, translationX, translationY, centerX, centerY, rotationDegree])\n\n*/\n","var map = {\n\t\"./en/about.mdx\": [\n\t\t225\n\t],\n\t\"./en/footer.mdx\": [\n\t\t635,\n\t\t5\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t216\n\t],\n\t\"./en/metadata\": [\n\t\t334,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t334,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t219\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t636,\n\t\t6\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t637,\n\t\t7\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t638,\n\t\t8\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t221\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t223\n\t],\n\t\"./en/references.mdx\": [\n\t\t227\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t639,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t228\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t224\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t121\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t215\n\t],\n\t\"./fr/metadata\": [\n\t\t335,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t335,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t218\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t220\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t222\n\t],\n\t\"./fr/references.mdx\": [\n\t\t226\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t640,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t229\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 628;\nmodule.exports = webpackAsyncContext;","const Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore t dveloppe</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport { extent, max } from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n\n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ',' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n\n  }, [wholeHeight])\n\n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n    .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[shareField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n\n  const { values: rightYAxisValues } = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  let { values: leftYAxisValue } = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  if (yShareScale.domain()[1] - yShareScale.domain()[0] <= 5) {\n    leftYAxisValue = axisPropsFromTickScale(yShareScale, 5).values;\n  }\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", { 'has-highlights': highlightYears !== undefined })}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n              <div className=\"color-scale-container\">\n                <div className=\"color-scale-detail\">\n                  <div\n                    className=\"bar\"\n                    style={{\n                      background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                    }}\n                  />\n                  <div className=\"labels\">\n                    <span>{colorScaleMessages.maximum}</span>\n                    {/* <span>{colorScaleMessages.title}</span> */}\n                    <span>{colorScaleMessages.minimum}</span>\n                  </div>\n                </div>\n              </div>\n              : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value / 1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n              .map((year, i) => {\n                const x = xBand(year) + xBand.bandwidth() / 2;\n                const y = height - margins.bottom;\n                return (\n                  <g\n                    key={i}\n                    className=\"axis-group\"\n                    transform={`translate(${x}, ${y})`}\n                  >\n                    <line\n                      x1={0}\n                      x2={0}\n                      y1={0}\n                      y2={margins.bottom / 6}\n                      stroke=\"grey\"\n                    />\n                    <g\n                      transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                    >\n                      <text fill=\"grey\">\n                        {year}\n                      </text>\n                    </g>\n                  </g>\n                )\n              })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    <rect\n                      x={xBand(startYear)}\n                      width={xBand(endYear) - xBand(startYear)}\n                      height={height - margins.top - margins.bottom}\n                      y={margins.top}\n                      fill=\"url(#diagonalHatch)\"\n                      opacity={.4}\n                    />\n                    <line\n                      x1={xBand(startYear)}\n                      x2={xBand(startYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <line\n                      x1={xBand(endYear)}\n                      x2={xBand(endYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={yShareScale(0) - yShareScale(d[shareField])}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ?\n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] || 0).toFixed(2))\n                      .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] || 0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', { 'is-highlighted': highlightYears && highlightYears.includes(+d.year) })}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {/* data points circles */\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .filter(datum => +datum[absoluteField])\n              .map((datum, index) => {\n                \n                const x = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const y = yAbsoluteScale(+datum[absoluteField]);\n                return (\n                  <>\n                    <circle\n                      key={index}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: width * 0.005\n                      }\n                      }\n                      fill={'transparent'}\n                      data-tip={`${datum.year} : export de <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois.`}\n                      data-for={cityName}\n                      data-class=\"bar-tooltip\"\n                      data-html={true}\n                    />\n                    <circle\n                      key={index + 'a'}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: 1.5\n                      }\n                      }\n                      fill={colorsPalettes.generic.accent1}\n                    />\n                  </>\n                )\n              })\n          }\n          {\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              // .filter((d, index) => {\n              //   const next = data[index + 1];\n              //   if (+d.year === 1787 && !barTooltipFn) {\n              //     console.log('2 next for 1787', d.year, +next.year, next)\n              //   }\n              //   return index < data.length - 1\n              //     && (fillGaps ? true : +next.year === +d.year + 1)\n              // })\n              .map((datum, index) => {\n                const next = data[index + 1];\n                if (index === data.length - 1 || fillGaps ? false : +next.year !== +datum.year + 1) {\n                  return null;\n                }\n                if (!next) {\n                  return null;\n                }\n                const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const x2 = xBand(+next.year) + xBand.bandwidth() / 2;\n                const y1 = yAbsoluteScale(+datum[absoluteField]);\n                const y2 = yAbsoluteScale(+next[absoluteField]);\n                if (!+datum[absoluteField] || !+next[absoluteField]) {\n                  return null;\n                }\n                const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n                return (\n                  <line\n                    key={datum.year}\n                    {\n                    ...{\n                      x1,\n                      x2,\n                      y1,\n                      y2\n                    }\n                    }\n                    stroke={colorsPalettes.generic.accent1}\n                    title={`${datum.year}-${next.year}`}\n                    strokeWidth={2}\n                    data-tip={`${datum.year}  <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year}  <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                  />\n                )\n              })\n          }\n\n        </g>\n\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear, label, row = 0, labelPosition = 'right' } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    {\n                      labelPosition === 'right' ?\n                        <>\n                          <line\n                            x1={xBand(endYear) + 20}\n                            x2={xBand(endYear) + 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(endYear) + 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                        :\n                        <>\n                          <line\n                            x1={xBand(startYear) - 20}\n                            x2={xBand(startYear) - 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(startYear) - 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            textAnchor={'end'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                    }\n\n                    <defs>\n                      <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\"\n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                        <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                      </marker>\n                    </defs>\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n\n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = wholeHeight;\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${thisYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3  className=\"visualization-title\" style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg ref={svgRef} className={cx(\"links-container\", {'has-highlights': hoveredProduct})} style={{top: svgOffset}} width={width} height={height}>\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      key={index}\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 15])\n\n          return (\n            <div\n            key={yearIndex}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d.product, (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d.product}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineComponent from './DeclineComponent';\n\nexport default DeclineComponent;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineComponent.scss';\n\nconst DeclineComponent = (props) => {\n  const {\n    width, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : containerHeight;\n  const messages = {\n    franceOverviewTitle: {\n      fr: (start, end) => `volution de la valeur des exports du royaume de France de ${start}  ${end}`,\n      en: (start, end) => `Evolution of the value of exports from the kingdom of France from ${start} to ${end}`\n    },\n    tradeEvolutionTitle: {\n      fr: (cityName, start, end) => `volution du commerce de la direction des fermes de ${cityName} de ${start}  ${end}`,\n      en: (cityName, start, end) => `Evolution of the direction des fermes of ${cityName} trade from ${start} to ${end}`\n    },\n    top90PctTitle: {\n      fr: (cityName, start, end) => `Comparaison des parts des produits exports par la direction des fermes de ${cityName} totalisant plus de 90% du commerce en ${start} et en ${end} (ports francs non pris en compte)`,\n      en: (cityName, start, end) => `Comparison of shares of the top 90% of exported products by the direction des fermes of ${cityName} in ${start} and in ${end} (ports francs non pris en compte)`,\n    },\n    partInPct: {\n      fr: () => 'part des exports fr.',\n      en: () => 'share of french exports'\n    },\n    absoluteValue: {\n      fr: () => 'valeur absolue des exports',\n      en: () => 'exports\\' absolute value'\n    },\n    herfindalLegendTitle: {\n      // fr: () => `Degr de diversit du commerce (inverse de lindice de Herfindahl)`,\n      // en: () => `Degree of trade diversity (inverse of the Herfindahl index)`,\n      fr: () => `degr de diversit du commerce`,\n      en: () => `degree of trade diversity`,\n    },\n    herfindal0: {\n      fr: () => `commerce peu diversifi`,\n      en: () => `fewly diversified trade`,\n    },\n    herfindal1: {\n      fr: () => `commerce trs diversifi`,\n      en: () => `very diversified trade`,\n    },\n    barTooltip: {\n      fr: (year, pct, city, herfindal) => `En <strong>${year}</strong>, ${pct}% des biens exports depuis la France le sont  partir de <strong>${city}</strong>.<br/><br/>Concentration du commerce <i>(indice de Herfindahl-Hirschmann : somme du carr des parts du march franais par classe de produits exports)</i> : <span>[colorBox] ${herfindal}</span>`,\n      en: (year, pct, city, herfindal) => `In <strong>${year}</strong>, ${pct}% of exported goods from France are exported <strong>${city}</strong>.<br/><br/>Trade concentration <i>(Herfindahl-Hirschmann index : sum of square french market' shares sorted by exported products classes)</i> : <span>[colorBox] ${herfindal}</span>`,\n    },\n    productTooltip: {\n      fr: (year, product, pct) => `En <strong>${year}</strong>, les produits de la classe \"${product}\" reprsentent <strong>${pct}%</strong> de la valeur des biens exports par la direction des fermes de La Rochelle.`,\n      en: (year, product, pct) => `In <strong>${year}</strong>, products classed as \"${product}\" represent ${pct}% of goods exported by La Rochelle's direction des fermes.`,\n    },\n    sevenYearsWar: {\n      fr: () => 'guerre de sept ans',\n      en: () => 'seven years war'\n    },\n    austriaWar: {\n      fr: () => 'guerre franco-britannique au sein de la guerre de succession dAutriche',\n      en: () => 'guerre franco-britannique au sein de la guerre de succession dAutriche',\n    },\n    usIndependance: {\n      fr: () => 'guerre dindpendance Amricaine',\n      en: () => 'guerre dindpendance Amricaine',\n    },\n    laRochelleDiaspora: {\n      fr: () => 'Organisation de convois partant de La Rochelle pour chapper aux Anglais',\n      en: () => 'Organisation de convois partant de La Rochelle pour chapper aux Anglais',\n    },\n    // absolute1789: {\n    //   fr: item => `Total des exports en 1789 : ${(item.Exports / 1000000).toFixed(1)} m. de livres tournois`,\n    //   en: item => `Total des exports en 1789 : ${(item.Exports / 1000000).toFixed(1)} m. de livres tournois`\n    // }\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle[lang](startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: .5,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance[lang]()\n              },\n\n              \n            ]}\n            // fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip[lang]}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 1,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1747,\n                endYear: 1747,\n                row: 2,\n                label: messages.laRochelleDiaspora[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance[lang]()\n              },\n              // {\n              //   type: 'span',\n              //   startYear: 1789,\n              //   endYear: 1789,\n              //   row: 4,\n              //   labelPosition: 'left',\n              //   label: messages.absolute1789[lang](datasets['decline_longitudinal_data.csv'].find((d) => d.region === \"La Rochelle\" && d.year === \"1789\"))\n              // },\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            barTooltipFn={ messages.barTooltip[lang]}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                row: 0.5,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 0,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 1,\n                label: messages.usIndependance[lang]()\n              },\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products.csv`] || !datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={height/totalRows * rowFlex}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle[lang]('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip[lang]}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineComponent\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineComponent;\n","import Decline from '../components/DeclineComponent';\n\nconst PrincipalVisualizationPart1 = ({width, height, step, ...props}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialComponent.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, trimText } from '../../helpers/misc';\nimport ReactTooltip from 'react-tooltip';\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3]\n\nconst CircularAlluvialComponent = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width = 1200,\n  height : inputHeight = 800,\n  filters = [],\n  debug = false,\n  title,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true,\n  tooltips,\n  lang,\n}) => {\n  const titleRef = useRef(null);\n  const height = titleRef.current ? inputHeight - titleRef.current.getBoundingClientRect().height : inputHeight;\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters]);\n\n  let tooltipContent;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }, [filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 70]).domain([0, 1])\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n  return (\n    <>\n      <h5 ref={titleRef} className=\"visualization-title\">{title}</h5>\n      <svg \n      data-for=\"alluvial-tooltip\"\n      data-tip={tooltipContent}\n      width={width} height={height} className={cx(\"CircularAlluvialComponent\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}>\n        <g  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <g className=\"background-marks\" transform={`translate(${width / 2 - smallestDimension / 2}, 0)`} >\n          <line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </text>\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </text>\n        </g>\n        <g \n        transform={`translate(${width / 2 - smallestDimension / 2}, 0)`}>\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <g\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <g\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleClick = () => {\n                                      if (highlightedFlow && highlightedFlow._id === flow._id) {\n                                        setHighlightedFilter(undefined);\n                                        setHighlightedFlow(undefined);\n                                      }\n                                      else {\n                                        if (highlightedFilter) {\n                                          setHighlightedFilter(undefined);\n                                        }\n                                        setHighlightedFlow({...flow, stepIndex});\n                                      }\n                                      \n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH;\n                                      y3 += BAR_WIDTH;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH;\n                                      y4 += BAR_WIDTH;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    const {flow_type, customs_office, product, partner} = flow;\n                                    const value = flow[sumBy];\n                                    const tContent = tooltips.flow[lang]({flow_type, customs_office, product, sumBy, value, partner})\n                                    return (\n                                      <g\n                                        onClick={handleClick}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                        data-for=\"alluvial-tooltip\"\n                                        data-tip={tContent}\n                                      >\n                                        {/* <path \n                                    d={`\n                                    M ${x1} ${y1} \n                                    Q ${controlPoint1AX} ${controlPoint1AY}, ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    Q ${controlPoint2AX} ${controlPoint2AY}, ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                    title={'Valeur : ' + flow.valueAbs}\n                                    style={{fill: colorScales[step.field][node.id]}}\n                                  /> */}\n                                        <path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </g>\n                                    )\n                                  })\n                              }\n                            </g>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH;\n                        }\n                        const handleClick = () => {\n                          if (highlightedFilter && highlightedFilter.value === node.id) {\n                            setHighlightedFlow(undefined);\n                            setHighlightedFilter(undefined);\n                          }\n                          else {\n                            if (highlightedFlow) {\n                              setHighlightedFlow(undefined);\n                            }\n                            setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                          }\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                          // console.groupEnd('test');\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        const tContent = tooltips.node[lang](node, stepIndex);\n                        return (\n                          <g\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onClick={handleClick}\n                            data-for=\"alluvial-tooltip\"\n                            data-tip={tContent}\n                          >\n                            <rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <g\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <text\n                                style={{\n                                  fontSize: labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </text>\n                            </g>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 ||stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </g>\n                        )\n                      })\n                    }\n\n                  </g>\n                )\n              })\n          }\n        </g>\n        </g>\n      </svg>\n      <ReactTooltip id=\"alluvial-tooltip\" />\n    </>\n  )\n}\n\nexport default CircularAlluvialComponent;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import React from 'react';\nimport Slider/*, { SliderTooltip }*/ from 'rc-slider';\nimport 'rc-slider/assets/index.css';\n\nconst { createSliderWithTooltip } = Slider;\nconst Range = createSliderWithTooltip(Slider.Range);\n\nconst SliderRange = ({ title, min, max, value, onChange }) => {\n    const style = { width: 300, margin: 50 };\n\n    return (\n        <div style={style}>\n            <p>{title}</p>\n           <Range allowCross={false} min={min} max={max} value={value} onChange={onChange} />\n        </div>\n    )\n    }\n    \nexport default SliderRange;","import SliderRange from './SliderRange';\n\nexport default SliderRange;","import RadioButton from './RadioButton';\n\nexport default RadioButton;\n","import React from \"react\";\n\nconst RadioButton = ({ type, id, name, label, checked, onChange }) => {\n  return (\n    <>\n      <input\n        type={type}\n        id={id}\n        value={id}\n        name={name}\n        aria-label={label}\n        checked={checked}\n        onChange={onChange}\n      />\n      <label htmlFor={id}>{label}</label>\n    </>\n  );\n};\n\nexport default RadioButton;\n","import RadarPlot from './RadarPlot';\n\nexport default RadarPlot;","import React from 'react';\nimport RadarChart from 'react-svg-radar-chart';\nimport 'react-svg-radar-chart/build/css/index.css'\n//import { groupBy } from 'lodash';\n \n\nconst RadarPlot= ({\n  data,\n  captions,\n  size : initialSize = 100,\n  //margins: inputMargins = {},\n}) => {\n\n  return (\n       <RadarChart\n        captions={captions}\n        data={data}\n        size={initialSize}\n  />\n  )\n}\n\nexport default RadarPlot;\n","/* eslint react-hooks/exhaustive-deps : 0 */\nimport { useEffect, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport _, {maxBy, uniqBy, sumBy, values, filter, isEmpty} from 'lodash';\n\nimport SliderRange from '../../components/SliderRange';\nimport RadioButton from '../../components/RadioButton';\nimport RadarPlot from '../../components/RadarPlot';\n\nconst RadarWrapper = ({\n  data: inputData,\n  globalWidth = 500,\n  minified,\n  bureau=\"tous\",\n  navigoAgregation=\"tonnage\",\n  minTonnage,\n  maxTonnage,\n}) => {\n  const [data, setData] = useState(undefined);\n  const [selectedBureau, setSelectedBureau] = useState('Tous les bureaux');\n  const [aggregationMethod, setAggregationMethod] = useState(2);\n  const [dataFilteredTonnage, setDataFilteredTonnage] = useState([]);\n  const [dataFilteredTonnageFerme, setDataFilteredTonnageFerme] = useState([]);\n  const [fermeCaptions, setFermeCaptions] = useState([]);\n  const [destCaptions, setDestCaptions] = useState({});\n  const [tonnageData, setTonnageData] = useState([]);\n  const [travelData, setTravelData] = useState([])\n  const [radarData, setRadarData] = useState([]);\n  const [valueSlider, setValueSlider] = useState();\n  const [upperSlider, setUpperSlider] = useState();\n  const lowerSlider = 0;\n  const colorAll = 'blue';\n  const colorFerme = 'red';\n\n  const prepareDestCaptions = datas => {\n    return uniqBy(datas, 'destination_radar').map(obj => {\n      var rObj = {};\n      rObj[obj.destination_radar] = obj.destination_radar;\n      return rObj;\n    });\n  };\n\n  const prepareFermeCaptions = datas => {\n    return uniqBy(datas, 'ferme_bureau').map(obj => {\n      return obj.ferme_bureau;\n    });\n  };\n\n  const prepareTravelData = datas => {\n    return _(datas)\n      .groupBy('destination_radar')\n      .map((dest, id) => {\n        var rObj = {};\n        rObj[id] = dest.length;\n        return rObj;\n      })\n      .value();\n  };\n\n  const prepareTonnageData = (datas) => {\n    return _(datas)\n      .groupBy(\"destination_radar\")\n      .map((dest, id) => {\n        var rObj = {};\n        rObj[id] = sumBy(dest, \"tonnage\");\n        return rObj;\n      })\n      .value();\n  };\n\n  const rescale = datas => {\n    const maxValue = maxBy(values(datas), function (o) {\n      return o;\n    });\n    var x = scaleLinear()\n      .domain([0, maxValue])\n      .range([0, 1]);\n    for (var key in datas) {\n      if (datas.hasOwnProperty(key)) {\n        datas[key] = x(datas[key]);\n      }\n    }\n    for (var dkey in destCaptions) {\n      if (!datas.hasOwnProperty(dkey)) {\n        datas[dkey] = 0\n      }\n    }\n\n    return datas;\n  };\n\n  const filtered = (range, ferme) => {\n    if (ferme === 'Tous les bureaux') {\n      return filter(data, item => {\n        return (item.tonnage >= range[0]) & (item.tonnage <= range[1]);\n      });\n    } else {\n      return filter(data, item => {\n        return (\n          (item.tonnage >= range[0]) &\n          (item.tonnage <= range[1]) &\n          (item.ferme_bureau === ferme)\n        );\n      });\n    }\n  };\n\n  const radioAggType = [{\n    id: 1,\n    label: 'Aggrgation par tonnage',\n    data: tonnageData\n  }, {\n    id: 2,\n    label: 'Aggrgation par nb de trajets',\n    data: travelData\n  }];\n\n  /**\n   * UPDATE FROM PROPS\n   */\n  useEffect(() => {\n    let newAgMethod = 1;\n    if (navigoAgregation !== 'tonnage') {\n      newAgMethod = 2;\n    }\n    setAggregationMethod(newAgMethod);\n  }, [navigoAgregation])\n\n  useEffect(() => {\n    let newBureau;\n    if (bureau === 'tous') {\n      newBureau = 'Tous les bureaux';\n    } else newBureau = bureau;\n    setSelectedBureau(newBureau);\n  }, [bureau])\n\n  useEffect(() => {\n    if (maxTonnage) {\n      if (valueSlider && valueSlider.length) {\n        setValueSlider([valueSlider[0], +maxTonnage]);\n      } else {\n        setValueSlider([0, +maxTonnage]);\n      }\n    }\n  }, [maxTonnage])\n  useEffect(() => {\n    if (minTonnage) {\n      if (valueSlider && valueSlider.length) {\n        setValueSlider([+minTonnage, valueSlider[1]]);\n      } else {\n        const max = maxBy(data, 'tonnage').tonnage;\n        setValueSlider([+minTonnage, max]);\n      }\n    }\n  }, [maxTonnage])\n\n  useEffect(() => {\n    if (inputData) {\n      const newData = inputData.map(d => {\n        //pour dgager les valeurs vides du csv\n        if ((d.destination_radar !== '') & (d.ferme_bureau !== '')) {\n          return {\n            ferme_bureau: d.ferme_bureau,\n            destination_radar: d.destination_radar.replace(/['\"]+/g, ''),\n            //tonnage: (parseInt(d.tonnage) || 0) + parseInt(d.tonnage)\n            tonnage: +d.tonnage\n          };\n        }\n        return undefined;\n      })\n        .filter(d => d)\n\n      setFermeCaptions([...prepareFermeCaptions(newData), 'Tous les bureaux']);\n      setDestCaptions(Object.assign({}, ...prepareDestCaptions(newData)))\n      let max = maxBy(newData, 'tonnage').tonnage;\n      setUpperSlider(max);\n      if (maxTonnage) {\n        max = +maxTonnage;\n      }\n      let min = lowerSlider;\n      if (minTonnage) {\n        min = +minTonnage;\n      }\n      setValueSlider([min, max]);\n      setData(newData);\n    }\n  }, [inputData])\n\n  useEffect(() => {\n    setDataFilteredTonnage(filtered(valueSlider, 'Tous les bureaux') || []);\n    setDataFilteredTonnageFerme(\n      filtered(valueSlider, selectedBureau) || []\n    );\n  }, [selectedBureau, valueSlider]);\n\n  useEffect(() => {\n    setTonnageData([\n      {\n        data: rescale\n          (Object.assign({}, ...prepareTonnageData(dataFilteredTonnageFerme))\n          ),\n        meta: { color: colorFerme }\n      },\n      {\n        data: rescale(Object.assign({}, ...prepareTonnageData(dataFilteredTonnage))),\n        meta: { color: colorAll }\n      }\n    ]);\n    setTravelData([\n      {\n        data: rescale\n          (Object.assign({}, ...prepareTravelData(dataFilteredTonnageFerme))\n          ),\n        meta: { color: colorFerme }\n      },\n      {\n        data: rescale(Object.assign({}, ...prepareTravelData(dataFilteredTonnage))),\n        meta: { color: colorAll }\n      }\n    ]);\n\n    /*setRadarData([\n      {\n        data: rescale\n         (Object.assign({}, ...prepareTravelData(dataFilteredTonnageFerme))\n        ),\n        meta: { color: colorFerme }\n      },\n      {\n        data: rescale(Object.assign({}, ...prepareTravelData(dataFilteredTonnage))),\n        meta: { color: colorAll }\n      }\n    ]);  */\n  }, [dataFilteredTonnage, dataFilteredTonnageFerme, aggregationMethod]);\n\n  useEffect(() => {\n    const displayData = filter(radioAggType, d => {\n      return d.id === aggregationMethod;\n    })[0].data\n    setRadarData([...displayData])\n  }, [travelData, tonnageData, aggregationMethod]);\n\n  // let allFermeTravelsCount\n  // if (selectedBureau === \"Toutes fermes\") {\n  //   allFermeTravelsCount = data.length\n  // }\n  // else {\n  //   allFermeTravelsCount = filter(\n  //     data,\n  //     ({ ferme_bureau }) => (ferme_bureau === selectedBureau)\n  //   ).length\n  // }\n  // const ratio1 = Math.round(dataFilteredTonnageFerme.length / dataFilteredTonnage.length * 100, 2);\n  // const ratio3 = Math.round(dataFilteredTonnageFerme.length / allFermeTravelsCount * 100, 2);\n\n  // console.log(ratio3)\n\n\n  if (!data) {\n    return null;\n  }\n  return (\n    <div className=\"RadarWrapper\">\n\n\n      {/* <p>Lgende : en <span style={{color:\"blue\"}}>bleu</span> les valeurs pour l'ensemble des bureaux de ferme, en <span style={{color:\"red\"}}>rouge</span> les valeurs pour le bureau de ferme slectionn</p> */}\n      {radarData.length > 0 &&\n        !isEmpty(radarData[0].data) &&\n        !isEmpty(destCaptions) &&\n\n        <RadarPlot\n          captions={destCaptions}\n          data={radarData}\n          size={minified ? globalWidth * .3 : globalWidth * .7}\n        />\n      }\n\n\n      <div className=\"controls-container\">\n        <div>\n          {\n            aggregationMethod && aggregationMethod === 1 &&\n            <div className=\"slider-container\">\n              <p>Filtrer les voyages par intervalles de tonnage</p>\n              <SliderRange\n                min={lowerSlider}\n                max={upperSlider}\n                value={valueSlider}\n                onChange={value => [setValueSlider(value)]}\n              />\n            </div>\n          }\n\n        </div>\n        <div>\n          <p><b>Bureau de ferme de dpart ({filtered(valueSlider, selectedBureau).length} dparts affichs)</b></p>\n          <select value={selectedBureau} onChange={(e) => [setSelectedBureau(e.target.value)]}>\n            {fermeCaptions.map(item => (\n              <option key={item} value={item}>{item}</option>\n            ))}\n          </select>\n        </div>\n\n\n        <div>\n          <fieldset>\n            <ul>\n              {radioAggType.map(el =>\n                <li key={el.id}>\n                  <RadioButton\n                    type=\"radio\"\n                    key={el.id}\n                    id={el.id}\n                    name=\"radioGroup\"\n                    label={el.label}\n                    checked={aggregationMethod === el.id}\n                    onChange={() => [setAggregationMethod(el.id)]}\n                  />\n                </li>\n              )}\n            </ul>\n          </fieldset>\n        </div>\n      </div>\n\n\n    </div >\n  )\n}\n\nexport default RadarWrapper;","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import {useMemo} from 'react';\nimport CircularAlluvialComponent from \"../../components/CircularAlluvialComponent/CircularAlluvialComponent\";\nimport RadarWrapper from './RadarWrapper';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport './PrincipalVisualizationPart2.scss';\n\nconst PrincipalVisualizationPart2 = ({\n  width, \n  height: containerHeight, \n  datasets, \n  showOnlyToflit = false, \n  atlasMode, \n  highlight = 'toflit18',\n  lang = 'fr',\n  filter = 'aucun',\n  bureau=\"tous\",\n  navigoAgregation=\"tonnage\",\n  minTonnage,\n  maxTonnage,\n  ...props\n}) => {\n  const height = atlasMode ? 1200 : containerHeight;\n  const {sumToflitBy, alluvialFilters} = useMemo(() => {\n    let sumBy = 'value';\n    let filters = [];\n    switch(filter) {\n      case \"colonial\":\n        filters = [\n          {\n            key: 'product',\n            value: `produits coloniaux`\n          },\n          {\n            key: 'partner',\n            value: `Afrique`\n          },\n          {\n            key: 'partner',\n            value: `Colonies`\n          }\n        ];\n        break;\n      case \"eau-de-vie\":\n        filters = [\n          {\n            key: 'product',\n            value: `eau-de-vie et vins divers`\n          }\n        \n        ];\n        break;\n      case \"sel\":\n        filters = [{\n          key: 'product',\n          value: `sel`\n        }];\n        sumBy = 'product_weight_kg'\n        break;\n      default:\n        break;\n    }\n\n    return {\n      sumToflitBy: sumBy,\n      alluvialFilters: filters\n    }\n  }, [filter]);\n  const titles = {\n    fr: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`,\n    en: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`\n  };\n  return (\n    <div className=\"PrincipalVisualizationPart2\">\n     <div \n      className=\"circular-alluvial-container\"\n      style={{\n        width: highlight === 'toflit18' ? width * .7 : width * .3,\n        height: highlight === 'toflit18' ? height : height * .3,\n      }}\n    >\n        <CircularAlluvialComponent\n          data={datasets['part_2_toflit_viz_data.csv']}\n          width={highlight === 'toflit18' ? width * .7 : width * .3}\n          height={highlight === 'toflit18' ? height : height * .3}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          lang={lang}\n          title={titles[lang]}\n          tooltips={{\n            node: {\n              fr: ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `En 1789, le bureau des fermes de ${id} a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} de ${id}.`;\n                } else {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} vers le partenaire ${id}.`;\n                }\n              },\n              en: () => ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `In 1789, the bureau des fermes of ${id} has ${step < 3 ? 'imported' : 'exported'} ${node[sumToflitBy]} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} of ${id}.`;\n                } else {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} to the partner ${id}.`;\n                }\n              },\n            },\n            flow: {\n              fr: ({flow_type, customs_office, product, sumBy, value, partner}) => `En 1789, le bureau des fermes de ${customs_office} a ${flow_type === 'import' ? 'import' : 'export'} ${value} ${sumBy === 'value' ? 'livres tournois' : 'kg'} de ${product} ${flow_type === 'import' ? 'depuis' : 'vers'} le partenaire ${partner}`,\n              en: ({flow_type, customs_office, product, sumBy, value, partner}) => `In 1789, the bureau des fermes of ${customs_office} has ${flow_type === 'import' ? 'imported' : 'exported'} ${value} ${sumBy === 'value' ? 'livres tournois' : 'kg'} of ${product} ${flow_type === 'import' ? 'from' : 'to'} the partner ${partner}`,\n            }\n          }}\n          steps={[\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n          ]}\n        />\n     </div>\n     <div \n      className=\"radar-container\"\n      style={{\n        width: highlight === 'navigo' ? width * .7 : width * .3\n      }}\n    >\n      <RadarWrapper \n        data={datasets['radar_plot_destinations_details_origine.csv']}\n        minified={highlight !== 'navigo'}\n        globalWidth={width}\n        bureau={bureau}\n        navigoAgregation={navigoAgregation}\n        minTonnage={minTonnage}\n        maxTonnage={maxTonnage}\n      />\n       {/* <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} /> */}\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","\nimport SigmaComponent from \"../../components/SigmaComponent/GraphContainer\";\nimport BarChart from \"../../components/BarChart\";\nimport colorPalettes from \"../../colorPalettes\";\n\nconst Step2 = ({\n  width,\n  height,\n  datasets,\n}) => {\n  return (\n    <>\n          <div className=\"graphs-container\" style={{ position: 'relative', height: height * .6 }}>\n            <div className=\"graph-container\" style={{ width: width * .6, height: height * .6, position: 'absolute' }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_La Rochelle.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                ratio={1.1}\n                title={'Rseau des voyages partant ou arrivant dans la rgion PASA en 1787 ...'}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, top: 0 }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_Bordeaux.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                title={'...compar  celui de l\\'amiraut de Bordeaux'}\n                ratio={1}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, bottom: 0 }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_Nantes.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                title={'...compar  celui de l\\'amiraut de Nantes'}\n                ratio={1}\n                spatialize\n              />\n            </div>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            left: 0,\n            width: width * .3,\n            height: height * .3,\n            paddingLeft: 0,\n          }}\n            className=\"ColorLegend\"\n          >\n            <h5>Lgende des rseaux</h5>\n            <ul className=\"color-legend\">\n              <li>\n                Taille des points reprsentant les ports : nombre de liens avec d'autres ports dans le rseau\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.dark }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port interne  la rgion\n                </span>\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.accent2 }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port externe  la rgion\n                </span>\n              </li>\n            </ul>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: width * .7,\n            height: height * .3\n          }}>\n            <BarChart\n              data={datasets['part_3_centralite_comparaison.csv']}\n              title=\"Centralit compare de La Rochelle par rapport  PASA et, pour ses rgions ctires voisines, du port principal par rapport au rseau des voyages de son amiraut (1787)\"\n              width={width * .7}\n              height={height * .3}\n              orientation={'vertical'}\n              layout={'groups'}\n              y={{\n                field: 'port',\n                title: 'Port (dans son rseau local)',\n              }}\n              x={{\n                field: 'score',\n                title: 'Score',\n                // tickSpan: .1,\n                // tickFormat: (d, i) => parseInt(d * 100) + '%'\n              }}\n              color={{\n                field: 'metrics_type',\n                title: 'Type de mtrique',\n                palette: {\n                  'PageRank': colorPalettes.generic.dark,\n                  'betweenness centrality': colorPalettes.generic.accent1,\n                }\n              }}\n              margins={{\n                bottom: 20\n              }}\n              tooltip={d => d.metrics_type === 'PageRank' ? 'Le PageRank est une mesure de centralit qui consiste  donner  chaque port un score proportionnel  la somme des pageranks des ports avec lesquels il a des voyages en commun.' : 'La centralit intermdiaire est une mesure de centralit gale au nombre de fois o un port donn est sur le chemin le plus court entre deux autres ports du rseau des voyages.'}\n            />\n          </div>\n        </>\n  )\n}\n\nexport default Step2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\nimport { useState, useEffect } from 'react';\n\nimport GeoComponent from '../../components/GeoComponent/GeoComponent';\nimport { Step3Objects, SmallMultiples, renderTriangles } from './renderObjectsFunctions'; // pas sur que a reste  terme\n\nimport './PrincipalVisualizationPart3.scss';\nimport colorsPalettes from '../../colorPalettes.js';\nimport Step2 from './Step2';\n\n\nconst PrincipalVisualizationPart3 = ({ datasets, step, width, height: inputHeight, atlasMode }) => {\n  const ANIMATION_DURATION = 100;\n  const height = atlasMode ? window.innerHeight : inputHeight;\n  const [currentMapTemplate, setCurrentMapTemplate] = useState('France');\n  useEffect(() => {\n    setTimeout(() => {\n      switch (step) {\n        case 1:\n          setCurrentMapTemplate('rotated Poitou');\n          break;\n        case 3:\n          setCurrentMapTemplate('Poitou zoomed');\n          break;\n        default:\n          break;\n      }\n    }, ANIMATION_DURATION)\n  }, [step])\n  return (\n    <div className={cx(\"PrincipalVisualizationPart3\", { 'is-atlas-mode': atlasMode })} style={{ height: atlasMode ? undefined : height }}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        <GeoComponent\n          title={'Navigation au dpart des ports de la rgion PASA en 1789'}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_france_1789.geojson']\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data.csv'],\n              renderObjects: () => (\n                <>\n                  <rect\n                    x={0}\n                    y={0}\n                    width={width}\n                    height={height / 8}\n                    fill={'url(#radial-bg)'}\n                  />\n                  <defs>\n                    <linearGradient id=\"radial-bg\" gradientTransform=\"rotate(90)\">\n                      <stop offset=\"10%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} />\n                      <stop offset=\"100%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} stop-opacity={0} />\n                    </linearGradient>\n                  </defs>\n                </>\n              )\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data.csv'],\n              renderObjects: props => renderTriangles({...props, atlasMode})\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'rotated Poitou' : currentMapTemplate}\n          height={atlasMode ? window.innerHeight * .9 : height}\n          width={width}\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })} style={{ height }}>\n        <Step2\n          {\n          ...{\n            width,\n            height,\n            datasets,\n          }\n          }\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n        <GeoComponent\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_france_1789.geojson'],\n              color: {\n                field: 'shortname'\n              }\n            },\n            {\n              type: 'custom',\n              data: {\n                customsOffices: datasets['part_3_step3_viz_customs_offices_data.csv']\n              .filter(d => \n                d.customs_region === 'La Rochelle' \n                && d.name !== 'undefined customs office'\n                && !d.name.includes('Bouin')\n                ),\n                ports: datasets['part_3_step3_viz_ports_data.csv']\n              },\n              renderObjects: Step3Objects // besoin de montrer les labels des bureaux et ports => modifier la fonction\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n              renderObjects: SmallMultiples\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'Poitou zoomed' : currentMapTemplate}\n          height={height}\n          width={width}\n          title={'Extraversion du commerce et de la navigation regroups par bureau de fermes en 1789'}\n        />\n\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","import cx from 'classnames';\nimport GeoComponent from \"../../components/GeoComponent/GeoComponent\";\nimport { useSpring, animated } from 'react-spring'\n\nimport { useEffect, useState } from 'react';\nimport './IntroBureaux.scss';\n\nimport colorPalettes from \"../../colorPalettes\";\n\nconst BureauBackground = ({\n  projection,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <animated.circle\n        r={radius * 2}\n        cx={0}\n        cy={0}\n        fill={`url(#bureau-${index})`}\n      />\n      <radialGradient id={`bureau-${index}`}>\n        <stop offset=\"20%\" stopColor={colorPalettes.customs_office[datum.name]} />\n        <stop offset=\"100%\" stopColor=\"rgba(51,109,124,0)\" />\n      </radialGradient>\n    </animated.g>\n  )\n}\n\nconst BureauLabel = ({\n  projection,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n  const labelOnRight = ['La Rochelle', 'Tonnay-Charente'].includes(datum.name);\n  const thatWidth = datum.name.length * width * height * .0005;\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <circle\n        r={2}\n        cx={0}\n        cy={0}\n        fill={'white'}\n      />\n      <foreignObject\n        x={labelOnRight ? radius / 2 : -radius / 2 - thatWidth}\n        y={-height / 70}\n        fill=\"white\"\n        width={thatWidth}\n        height={height / 20}\n        className={cx(\"bureau-label\", {\n          'is-reversed': !labelOnRight\n        })}\n      >\n        <span xmlns=\"http://www.w3.org/1999/xhtml\">\n          {datum.name}\n        </span>\n      </foreignObject>\n    </animated.g>\n  )\n}\n\nconst renderBureaux = ({ data, projection, width, height, atlasMode }) => {\n  const radius = width * height * 0.00006;\n\n  return (\n    <g className={cx(\"IntroBureaux\", {'is-atlas-mode': atlasMode})}>\n      \n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauBackground\n              key={index}\n              {\n              ...{\n                projection,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauLabel\n              key={index}\n              {\n              ...{\n                projection,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n    </g>\n  )\n}\n\nconst IntroBureaux = ({\n  datasets,\n  atlasMode,\n  dimensions\n}) => {\n  return (\n    <GeoComponent\n      title={'Carte des bureaux des fermes de la rgion PASA'}\n      layers={[\n        {\n          type: 'choropleth',\n          data: datasets['map_france_1789.geojson'],\n          reverseColors: atlasMode ? false : true,\n          // color:{\n          //   field: 'shortname',\n          //   palette: colorPalettes.provinces\n          // }\n        },\n        // {\n        //   type: 'points',\n        //   data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n        //   color: {\n        //     field: 'name',\n        //     palette: colorPalettes.customs_office,\n        //     labelsColor: atlasMode ? undefined : 'white'\n        //   },\n        //   size: {\n        //     custom : 3 // 3 fois plus gros que la taille par dfaut\n        //   },\n        //   label: {\n        //     field: 'name',\n        //     position: 'left'\n        //   }\n        // }\n        {\n          type: 'custom',\n          data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n          renderObjects: props => renderBureaux({...props, atlasMode})\n        }\n      ]}\n      projectionTemplate='Poitou'\n      width={dimensions.width}\n      height={atlasMode ? window.innerHeight * .9 : dimensions.height}\n    />\n  )\n}\n\nexport default IntroBureaux;","import IntroBureaux from './IntroBureaux';\n\nexport default IntroBureaux;","import { useState } from \"react\"\nimport GeoComponent from \"../../components/GeoComponent/GeoComponent\"\n\nconst HomeportFlows = ({\n  datasets,\n  atlasMode,\n  dimensions,\n}) => {\n  const [currentProjectionTemplate, setCurrentProjectionTemplate] = useState('World');\n  return (\n    <>\n      <GeoComponent\n        title={'Voyages des bateaux rattachs au port de La Rochelle en 1787'}\n        layers={[\n          {\n            type: 'choropleth',\n            // data: datasets['world_test.geojson'],\n            data: currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n            reverseColors: atlasMode ? undefined : true,\n            // color:{\n            //   field: 'shortname',\n            //   palette: colorPalettes.provinces\n            // }\n          },\n          {\n            type: 'flows',\n            data: datasets['voyages-bateaux-homeport-larochelle-1787.csv'],\n            size: {\n              field: 'tonnages_cumuls',\n              title: 'Flches dimensionnes par tonnage cumul'\n            },\n            label: {\n              fields: ['port_dep', 'port_dest']\n            },\n            color: {\n              field: 'category',\n              title: 'Port de dpart'\n            }\n          },\n        ]}\n        projectionTemplate={currentProjectionTemplate}\n        width={dimensions.width}\n        height={atlasMode ? window.innerHeight * .9 : dimensions.height}\n        withLegend={'bottom left'}\n\n      />\n      <div\n        style={{\n          position: 'absolute',\n          right: '1rem',\n          bottom: '1rem'\n        }}\n      >\n        <button onClick={() => setCurrentProjectionTemplate(currentProjectionTemplate === 'World' ? 'France' : 'World')}>\n          Monde/France\n        </button>\n      </div>\n    </>\n  )\n}\n\nexport default HomeportFlows","// @TODO : colorLegends et titres  mettre en place pour cartes notamment\n// @TODO : faire une passe sur visualizationList.json que j'ai rempli approximativement pour les vizs 'intro-provinces', 'intro-ports', et 'intro-bureaux'\n\nimport { useContext, useMemo } from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\nimport BarChart from '../components/BarChart';\nimport GeoComponent from '../components/GeoComponent/GeoComponent';\nimport colorPalettes from '../colorPalettes'\n\n\nimport { DatasetsContext } from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\nimport IntroBureaux from './IntroBureaux';\nimport HomeportFlows from './HomeportFlows/HomeportFlows';\n\nconst VisualizationContainer = ({ id, dimensions: inputDimensions, ...props }) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n\n  const hasData = Object.keys(relevantDatasets || {}).length && !Object.entries(relevantDatasets).find(([id, payload]) => !payload);\n  if (!hasData) {\n    // console.log('no data for ', id, 'looked for', visualizationsList.find(v => v.id === id))\n    return null;\n  }\n  switch (id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'partie-1-produits-importants-pour-la-rochelle':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              .sort((a, b) => {\n                if (+a.order > +b.order) {\n                  return 1;\n                }\n                return -1;\n              })\n              .slice(0, 20)\n          }\n          title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n          orientation={'vertical'}\n          layout={'groups'}\n          y={{\n            field: 'product',\n            title: 'produit',\n          }}\n          x={{\n            field: 'value_rel_per_direction',\n            title: 'Valeur en pourcentage',\n            tickSpan: .1,\n            tickFormat: (d, i) => parseInt(d * 100) + '%'\n          }}\n          color={{\n            field: 'entity',\n            title: 'Part des exports pour :'\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n        />\n      )\n    case 'partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"volution globale de la part des changes de La Rochelle par rapport  l'ensemble de la France\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height * .5}\n          orientation={'horizontal'}\n          layout={'stack'}\n          y={{\n            field: 'portion',\n            title: 'part du commerce fr.',\n            tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'year',\n            title: 'anne',\n            fillGaps: true,\n            tickSpan: 5,\n            // tickFormat: d => d%10 === 0 ? d : undefined\n          }}\n          color={{\n            field: 'type',\n            title: 'Type'\n          }}\n          margins={{\n            left: 140,\n            right: 0,\n          }}\n          tooltip={d => `En ${d.year}, la direction des fermes de la Rochelle a ${d.type === 'import' ? 'import' : 'export'} ${(+d.portion * 100).toFixed(2)}% des ${d.type === 'import' ? 'imports' : 'exports'} franais totaux`}\n        />\n      )\n    case 'partie-1-pays-port-d-attache':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Pays d'attache des navires trangers partant de la rgion en 1789\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: 'Pays du port d\\'attache',\n            sort: {\n              field: 'nb_outs',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'nb_outs',\n            title: 'Nombre de dparts',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${d} dparts`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => `En 1789, ${d.nb_outs} bateaux sont partis de la rgion de La Rochelle (amirauts de La Rochelle, Sables d'Olonnes ou Marennes)`}\n        />\n      )\n    // case 'partie-1-produits-importants-pour-la-rochelle':\n    //   return (\n    //     <BarChart\n    //       data={\n    //         relevantDatasets[Object.keys(relevantDatasets)[0]]\n    //           .sort((a, b) => {\n    //             if (+a.order > +b.order) {\n    //               return 1;\n    //             }\n    //             return -1;\n    //           })\n    //           .slice(0, 20)\n    //       }\n    //       title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n    //       width={dimensions.width}\n    //       height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n    //       orientation={'vertical'}\n    //       layout={'groups'}\n    //       y={{\n    //         field: 'product',\n    //         title: 'produit',\n    //       }}\n    //       x={{\n    //         field: 'value_rel_per_direction',\n    //         title: 'Valeur en pourcentage',\n    //         tickSpan: .1,\n    //         tickFormat: (d, i) => parseInt(d * 100) + '%'\n    //       }}\n    //       color={{\n    //         field: 'entity',\n    //         title: 'Part des exports pour :'\n    //       }}\n    //       margins={{\n    //         left: 140\n    //       }}\n    //       tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n    //     />\n    //   )\n    case 'partie-3-comparaison-exports-coloniaux':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Comparaison des exports de produits coloniaux, locaux et autres par bureaux des fermes (1789)\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height * .5}\n          orientation={'vertical'}\n          layout={'grouped'}\n          y={{\n            field: 'customs_office',\n            title: 'Bureau des fermes',\n            // tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'value',\n            title: 'valeur en livres tournoi',\n            tickSpan: 1000000,\n            domain: [0, 6000000]\n          }}\n          color={{\n            field: 'type',\n            title: 'Type de produit'\n          }}\n          margins={{\n            left: 140,\n            right: 50,\n          }}\n          tooltip={d => `En 1789, le bureau des fermes de ${d.customs_office} a export  l'trange ${d.value} livres tournois de produits de type ${d.type}`}\n        />\n      )\n    case 'intro-provinces':\n      return (\n        <>\n          <GeoComponent\n            title={'Carte des provinces tudies : Poitou, Aunis, Saintonge, Angoumois (PASA)'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                color: {\n                  field: 'shortname',\n                  palette: colorPalettes.provinces\n                },\n                tooltip: (d) => {\n                  return d.properties.shortname\n                }\n              }\n            ]}\n            projectionTemplate='France'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n          />\n        </>\n      )\n    case 'intro-ports':\n      return (\n        <>\n          <GeoComponent\n            title={'Carte des ports de la rgion PASA'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['ports_locations_data_intro.csv'],\n                color: {\n                  field: 'province',\n                  title: 'Province du port',\n                  palette: colorPalettes.provinces,\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'nb_pointcalls',\n                  title: 'nombre de voyages enregistrs en 1789',\n                  // custom: '20'\n                },\n                tooltip: d => `${d.rawSize} mouvements de bateaux ont t observs par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      )\n    case 'intro-bureaux':\n      // console.log(\"heyyyyyy bureaux map\");\n      return (\n        <IntroBureaux\n          {\n            ...{\n              datasets,\n              atlasMode: props.atlasMode,\n              dimensions\n            }\n          }\n        />\n      )\n    case 'partie-2-part-navigation-francaise':\n      return (\n        <>\n          <GeoComponent\n            title={'Part de la navigation franaise dans la rgion'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['part_navigation_fr.csv'],\n                color: {\n                  field: 'tonnage_part_of_french',\n                  title: 'Part de la navigation franaise (par tonnage cumul)',\n                  palette: colorPalettes.tonnageClasses,\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'tonnage',\n                  title: 'Tonnage sorti des ports (en miliers)',\n                  displayMetric: true,\n                  // custom: '20'\n                },\n                // tooltip: d => `${d.rawSize} mouvements de bateaux ont t enregistrs par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      );\n    case 'partie-2-carte-direction-bateaux-de-la-rochelle':\n      // voyages-bateaux-homeport-larochelle-1787.csv\n      return (\n        <HomeportFlows\n        {\n          ...{\n            datasets,\n            atlasMode: props.atlasMode,\n            dimensions,\n          }\n        }\n        />\n      );\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\nconst VisualizationController = ({\n  lang,\n  activeVisualization,\n  atlasMode\n}) => {\n  const [dimensions, setDimensions] = useState({});\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer lang={lang} atlasMode={atlasMode} id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} {...visProps} dimensions={dimensions} />\n            </>\n            : null // <div>Pas de visualisation  afficher</div>\n          }\n  \n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import { useState } from 'react';\nimport { homepage } from '../../../package.json';\nimport copy from 'copy-to-clipboard';\nimport VisualizationController from '../VisualizationController/VisualizationController.js';\n\n\nconst VisualizationFocus = ({ visualization, lang, onClose }) => {\n\n  const [copyClicked, setCopyClicked] = useState(false);\n  let howDone, howRead;\n  if (visualization) {\n    howDone = visualization[`comment_cest_fait_${lang}`];\n    howRead = visualization[`comment_lire_${lang}`];\n  }\n\n  const messages = {\n    howDone: {\n      fr: 'Comment les donnes et la visualisations ont-elles t produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    },\n    copyLink: {\n      fr: 'copier le lien de cette visualisation',\n      en: 'copy this visualization link'\n    },\n    linkCopied: {\n      fr: 'lien copi dans le presse-papier !',\n      en: 'link copied in the clipboard !'\n    }\n  }\n\n  const handleCopyClick = (e) => {\n    e.stopPropagation();\n    const url = `${homepage}/${lang}/atlas/${visualization.id}`;\n    setCopyClicked(true);\n    copy(url);\n    setTimeout(() => setCopyClicked(false), 5000);\n  }\n  return (\n    <div className={`VisualizationFocus ${visualization ? 'is-visible' : 'is-hidden'}`}>\n      <div onClick={onClose} className=\"lightbox-background\" />\n      {\n        visualization ?\n          <div className=\"lightbox-contents\">\n\n            <div className=\"visualization-details\">\n              <div className=\"details-header\">\n                <h2>{visualization[`titre_${lang}`]}</h2>\n                <button className=\"close-btn\" onClick={onClose}>\n                  \n                </button>\n              </div>\n              <div className=\"copy-link-container\">\n                <button onClick={handleCopyClick}>{copyClicked ? messages.linkCopied[lang] : messages.copyLink[lang]}</button>\n              </div>\n              <div className=\"details-contents\">\n                {\n                  howDone && howDone.length ?\n                    <section className=\"details-contents-section\">\n                      <h3>{messages.howDone[lang]}</h3>\n                      <p>\n                        {howDone}\n                      </p>\n                    </section>\n                    : null\n                }\n                {\n                  howRead && howRead.length ?\n                    <section className=\"details-contents-section\">\n                      <h3>{messages.howRead[lang]}</h3>\n                      <p>\n                        {howRead}\n                      </p>\n                    </section>\n                    : null\n                }\n              </div>\n            </div>\n            <div className=\"visualization-wrapper\">\n              <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n            </div>\n          </div>\n          : null\n      }\n\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import VisualizationFocus from './VisualizationFocus';\n\nexport default VisualizationFocus;","import { useState, useReducer, useEffect, useRef } from 'react';\nimport { Helmet } from \"react-helmet\";\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport VisualizationFocus from '../../components/VisualizationFocus';\nimport { VisualizationControlContext } from '../../helpers/contexts';\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport visualizations from '../../visualizationsList';\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  // mobile mode: focus on text or on viz\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  // whether to open the active viz in \"atlas mode\"\n  const [visualizationIsFullScreen, setVisualizationIsFullScreen] = useState(false);\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const updateCurrentVisualization = () => {\n    if (visualizationIsFullScreen) {\n      return;\n    } \n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const y = scrollY + DISPLACE_Y;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n    const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n    if (y > sectionEnd) {\n      if (activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n      return;\n    }\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      }\n    }\n    if (scrollY === 0 && visualizationEntries.length) {\n      setActiveVisualization(visualizationEntries[0][1])\n    }\n    else if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n        <section ref={sectionRef} className={cx({ 'is-focused': !focusOnViz })}>\n          <ContentSync />\n        </section>\n        <aside className={cx({ 'is-focused': focusOnViz })}>\n          <VisualizationController activeVisualization={activeVisualization} />\n          {\n            activeVisualization ?\n              <div className=\"fullscreen-viz-toggle-container\">\n                <button\n                  data-for=\"contents-tooltip\"\n                  data-tip=\"plus d'informations sur cette visualisation\"\n                  onClick={() => setVisualizationIsFullScreen(true)}\n                >\n                  <span>+</span>\n                </button>\n              </div>\n              : null\n          }\n        </aside>\n        <VisualizationFocus\n          visualization={visualizationIsFullScreen && activeVisualization ? visualizationsMap[activeVisualization.visualizationId] : undefined}\n          lang={lang}\n          onClose={() => {\n            setVisualizationIsFullScreen(false);\n          }}\n        />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n        })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n        <ReactTooltip id=\"contents-tooltip\" />\n      </div>\n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\n// import TestScrollyFr from '!babel-loader!mdx-loader!./contents/fr/test-scrolly.mdx';\n// import testScrollyEn from '!babel-loader!mdx-loader!./contents/en/test-scrolly.mdx';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\n// import Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2-intro.mdx';\n// import Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\n// import Part21Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-1.mdx';\n// import Part21En from '!babel-loader!mdx-loader!./contents/en/part-2-1.mdx';\n\n// import Part22Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-2.mdx';\n// import Part22En from '!babel-loader!mdx-loader!./contents/en/part-2-2.mdx';\n\n// import Part23Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-3.mdx';\n// import Part23En from '!babel-loader!mdx-loader!./contents/en/part-2-3.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/about.mdx';\n\nimport ReferencesFr from '!babel-loader!mdx-loader!./contents/fr/references.mdx';\nimport ReferencesEn from '!babel-loader!mdx-loader!./contents/en/references.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le dclin de la rgion de La Rochelle suite  la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le dclin de la rgion de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spcialisation portuaire: le cas de la traite ngrire, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spcialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'references',\n      en: 'references'\n    },\n    titles: {\n      fr: 'Rfrences',\n      en: 'References'\n    },\n    shortTitles: {\n      fr: 'rfrences',\n      en: 'references'\n    },\n    contents: {\n      fr: 'fr/references.mdx',\n      en: 'en/references.mdx'\n    },\n    contentsProcessed: {\n      fr: ReferencesFr,\n      en: ReferencesEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: ' propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: ' propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang = 'fr', summary }) {\n  const messages = {\n    intro: {\n      fr: 'dcouvrir les 3 chapitres de ltude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accder  l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .filter(item => item.routes[lang])\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        {/* @todo this is a react-snap trick that should be cleaned some day, removing it somehow breaks the pages building process */}\n        <Link to={navigator.userAgent === \"ReactSnap\" ? '/fr/atlas' : `/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang = 'fr' }\n} }) {\n  const introRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const [inVis, setInVis] = useState(false);\n  const currentMetadata = metadata[lang] || metadataFr;\n  const title = currentMetadata.title;\n  const titleHTML = currentMetadata.titleHTML;\n  const subtitle = currentMetadata.subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    let newActiveVisualization;\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    let firstOneY = Infinity;\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (visY < firstOneY) {\n          firstOneY = visY;\n        }\n        if (index === 0 && y < visY) {\n          found = true;\n          newActiveVisualization = visualization;\n        } /*else if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          newActiveVisualization = undefined;\n          break;\n        }*/ else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            newActiveVisualization = visualization;\n          } else {\n            newActiveVisualization = undefined;\n          }\n          break;\n        }\n      } else {\n        // console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n\n    if (scrollY > window.innerHeight * .9 && !inVis) {\n      setInVis(true);\n    } else if (scrollY < window.innerHeight * .9 && inVis) {\n      setInVis(false);\n    }\n\n    if (!found && scrollY < firstOneY && visualizationEntries.length) {\n      newActiveVisualization = visualizationEntries[0][1]\n    }\n    if (!found && activeVisualization) {\n      newActiveVisualization = undefined;\n    }\n    if (activeVisualization !== !newActiveVisualization) {\n      setActiveVisualization(newActiveVisualization)\n    } else if ((!activeVisualization && newActiveVisualization) || activeVisualization.id !== newActiveVisualization.id) {\n      setActiveVisualization(newActiveVisualization)\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n          <span></span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            \n            <section className={cx({'is-focused': !focusOnViz})}>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside className={cx({'is-focused': focusOnViz, 'is-fixed': inVis})}>\n              <VisualizationController activeVisualization={activeVisualization} />\n            </aside>\n            \n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n      </main>\n      <ReactTooltip id=\"contents-tooltip\" />\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la rgion Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import React, { useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from '../../components/VisualizationFocus/VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang = 'fr'\n    }\n  }\n}) {\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className=\"Atlas secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>{lang === 'fr' ? 'Atlas des visualisations' : 'Visualizations atlas'}</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations.map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                history.push({\n                  pathname: `/${lang}/atlas/${visualization.id}`\n                })\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                      <img\n                        src={`${process.env.PUBLIC_URL}/thumbnails/${lang}/${visualization.id}.png`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n        <VisualizationFocus \n          visualization={shownVisualization} \n          lang={lang}\n          onClose={() => {\n            history.push({\n              pathname: `/${lang}/atlas/`\n            })\n          }}\n        />\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import StandaloneVisualization from './StandaloneVisualization';\n\nexport default StandaloneVisualization;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\nimport visualizationsList from '../../visualizationsList.json';\nconst StandaloneVisualization = ({\n  id,\n  lang\n}) => {\n  const visualization = visualizationsList.find(({id: thatId}) => thatId === id)\n  return (\n    <div className=\"StandaloneVisualization\">\n      <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n    </div>\n  )\n}\n\nexport default StandaloneVisualization;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import {Suspense} from 'react';\nimport {Helmet} from \"react-helmet\";\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst PlainPage = ({\n  Content,\n  contentsURL,\n  title,\n  lang = 'fr'\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <Suspense fallback={<div>Chargement</div>}>\n          <Content />\n        </Suspense>\n      </div>\n  </div>\n  )\n}\n\nexport default PlainPage;","import React, { useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { NavLink as Link } from 'react-router-dom';\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport { scaleLinear } from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/part')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n  const liveScrollY = useScrollYPosition();\n\n  const scrollY = useDebounce(liveScrollY, 50)\n\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const { fontColor, backgroundColor } = useMemo(() => {\n    // const wrapper = document.getElementById('wrapper');\n    // if (!wrapper) {\n    //   return {fontColor: undefined, backgroundColor: undefined}\n    // }\n    // const scrollHeight = wrapper.offsetHeight;\n    const screenHeight = window.innerHeight;\n    switch (pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n\n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: colorBackground\n        }\n\n    }\n\n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                  :\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link to={`/${lang}/atlas`}>\n              {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n\n          {\n            // @todo delete this ternary when english contents are ready\n            process.env.NODE_ENV === 'development' ?\n              <>\n                <li className=\"navitem-container lang-toggle\">\n                  <button\n                    className={lang === 'fr' ? 'is-active' : ''}\n                    onClick={() => onLangChange('fr')}\n                  >fr</button>\n                </li>\n                <li className=\"navitem-container lang-toggle\">\n                  <button\n                    className={lang === 'en' ? 'is-active' : ''}\n                    onClick={() => onLangChange('en')}\n                  >en</button>\n                </li>\n              </>\n              : null\n          }\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", { 'is-open': drawerIsOpen })}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n          <ul className=\"primary-nav-container\">\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link exact to={`/${lang}/`}>\n                {lang === 'fr' ? 'accueil' : 'home'}\n              </Link>\n            </li>\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n          </ul>\n          <ul className=\"secondary-nav-container\">\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n                <li className=\"navitem-container lang-toggle\">\n                  <ul className=\"lang-toggle-container\">\n                    <li>\n                      <button\n                        className={lang === 'fr' ? 'is-active' : ''}\n                        onClick={() => onLangChange('fr')}\n                      >fr</button>\n                    </li>\n                    <li>\n                      <button\n                        className={lang === 'en' ? 'is-active' : ''}\n                        onClick={() => onLangChange('en')}\n                      >en</button>\n                    </li>\n                  </ul>\n\n                </li>\n                :\n                null\n            }\n\n\n          </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n            }} dangerouslySetInnerHTML={{ __html: title }} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","const Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className=\"loader-container\">\n      <div className=\"loader\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\n\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  // HashRouter as Router,\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n  Link,\n} from \"react-router-dom\";\nimport uniq from 'lodash/uniq';\nimport { csvParse, tsvParse } from 'd3-dsv';\nimport axios from 'axios';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\nimport StandaloneVisualization from \"./pages/StandaloneVisualization\";\nimport PlainPage from './pages/PlainPage';\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\nimport Footer from \"./components/Footer\";\n\n/* import utils */\nimport { DatasetsContext } from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport visualizationsList from './visualizationsList';\nimport {homepage} from '../package.json';\nimport routes from './summary';\n\nconst LANGUAGES = ['fr', 'en'];\n\nfunction App() {\n\n  const history = useHistory();\n  const location = useLocation();\n\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n  useEffect(() => {\n    // loading all datasets from the atlas\n    // @todo do this on a page-to-page basis if datasets happens to be too big/numerous\n    const datasetsNames = uniq(visualizationsList.filter(d => d.datasets).reduce((res, d) => [...res, ...d.datasets.split(',').map(d => d.trim())], []));\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              let status = progressEvent.loaded / progressEvent.total;\n              status = status > 1 ? 1 : status;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              setLoadingFraction(globalFraction + status / datasetsNames.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({ ...res, [datasetName]: loadedData })\n              })\n            })\n            // make get errors non-blocking to get all available datasets in the app even if some are broken\n            .catch(err => {\n              console.error(err);\n              return resolve(res);\n            })\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n      .then(newDatasets => {\n        setLoadingFraction(1);\n        setDatasets(newDatasets)\n      })\n      .catch(console.error)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    // @todo refactor this to be handled based on the routes config JSON ?\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n    lang,\n  }) => (\n    <>\n      <ThatComponent\n        {\n        ...{\n          Content,\n          ContentSync,\n          title,\n          lang\n        }\n        }\n      />\n    </>\n\n  );\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        <header>\n          <HeaderNav {...{ onLangChange, routes }} />\n        </header>\n        <main>\n          <Switch>\n            {// looping through the page\n              LANGUAGES.map(lang => {\n                return routes\n                .map(({\n                  titles,\n                  routes: inputRoute,\n                  contents,\n                  Component: ThatComponent,\n                  contentsProcessed\n                }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  const title = titles[lang];\n                  // @todo remove Content as it is not used anymore ? (importing md content with React.lazy did not play nice with scrollytelling-related features)\n                  const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                  const ContentSync = contentsProcessed[lang];\n                  return (\n                    <Route key={index} path={route} exact>\n                      {renderRoute({ Content, ThatComponent, title, ContentSync, lang })}\n                    </Route>\n                  )\n                })\n              })\n            }\n            {\n              LANGUAGES.map(lang => {\n                return visualizationsList\n                .map(({\n                  id\n                }, index) => {\n                  const route = `/${lang}/visualization/${id}`;\n                  return (\n                    <Route key={index} path={route} exact component={() => <StandaloneVisualization {...{id, lang}} />} />\n                  )\n                })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/fr/`} />\n          </Switch>\n          {\n            loadingFraction < 1 ?\n              <Loader percentsLoaded={loadingFraction * 100} />\n              : null\n          }\n        </main>\n        <Footer\n          lang={'fr'}\n        />\n\n\n      </div>\n      {/* following react fragment is aimed at allowing react-snap to parse all the pages that have a dynamic URL */}\n      <React.Fragment>\n        {// looping through the pages to add a blank link to all of them\n          LANGUAGES.map(lang => {\n            return routes\n            // @todo this is dirty and should be removed at some point (test page is not exported in prod, so no need for react-snap)\n            .filter(({routes}) => routes[lang] && !routes[lang].includes('test'))\n            .map(({\n              titles,\n              routes: inputRoute,\n              contents,\n              Component: ThatComponent,\n              contentsProcessed\n            }, index) => {\n              const route = `/${lang}/page/${inputRoute[lang]}`;\n              return (\n                <Link to={route} exact />\n              )\n            })\n          })\n        }\n      </React.Fragment>\n    </DatasetsContext.Provider>\n  );\n}\n\n/**\n * the following variable is aimed at allowing browser-router to function\n * for deployments on gh-pages (prefixing all routes with the repo name to match ghp URL pattern e.g. https://username.github.io/projectname/)\n */\nconst BASE_NAME =\n  process.env.NODE_ENV === 'development'\n    ? undefined\n    : `/${homepage.split('/').pop()}`;\n\n\nexport default function Wrapper() {\n  return (\n    <Router basename={BASE_NAME}>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","\nimport React from 'react';\n\nexport const VisualizationControlContext = React.createContext({\n\n})\n\nexport const DatasetsContext = React.createContext({\n\n})\n","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  // const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      // const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      // setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number',\n    autoSort: yAutoSort = false\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + xExtent[1] % xTickSpan;\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  \n\n  // let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  const xAxisValues = xTickSpan ? range(xDomain[0], xDomain[xDomain.length - 1], xTickSpan) : xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 15} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          if (!yAutoSort) {\n                            return 0;\n                          }\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={bandWidth}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={thatHeight}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width: initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n\n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ? headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ? legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort: sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    autoSort = false,\n    ascending: sortYAscending = true,\n    type: sortYType,\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixedRowHeight || vizHeight / bandsNb;\n\n  const groups = Object.entries(groupBy(data, d => d[y.field]));\n\n  const xDomain = initialXDomain || layout === 'stack' ?\n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) =>\n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n    )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n\n  let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n  const xScale = scaleLinear().domain(xDomain).range([0, width - margins.left - margins.right]).nice();\n  const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + xDomain[1] % xTickSpan;\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n  return (\n    <>\n      <figure style={{ width: initialWidth, height: finalHeight }} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${margins.left + xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    {/* <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    /> */}\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                  .sort((a, b) => {\n                    if (!autoSort) {\n                      return 0;\n                    }\n                    const multiplier = sortYAscending ? 1 : -1;\n                    if (sortYField === y.field) {\n                      const aVal = sortYType === 'number' ? +a[0] : a[0];\n                      const bVal = sortYType === 'number' ? +b[0] : b[0];\n                      if (aVal < bVal) {\n                        return -1 * multiplier;\n                      }\n                      return 1 * multiplier;\n                    }\n                    const aVal = sortYType === 'number' ?\n                      +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : a[1][sortYField];\n                    const bVal = sortYType === 'number' ?\n                      +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : b[1][sortYField];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n\n                  })\n                  .map(([yModality, items], groupIndex) => {\n                    let stackDisplaceX = margins.left;\n                    return (\n                      <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                        <foreignObject x={0} y={layout === 'stack' ? bandHeight / 4 : bandHeight/2 /* + bandHeight * (items.length / 2)*/} width={margins.left} height={rowHeight}>\n                          <div className=\"vertical-bar-label\">\n                          <div>{typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}</div>\n                          </div>\n                        </foreignObject>\n                        {/* <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                          {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                        </text> */}\n                        {\n                          items\n                            .sort((a, b) => {\n                              if (!autoSort) {\n                                return 0;\n                              }\n                              const multiplier = sortXAscending ? 1 : -1;\n                              const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n                              const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n                              if (aVal > +bVal) {\n                                return -1 * multiplier;\n                              }\n                              return 1 * multiplier;\n                            })\n                            .map((item, itemIndex) => {\n\n                              const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                              const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) : xScale(item[x.field]);\n                              const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                              if (layout === 'stack') {\n                                stackDisplaceX += thatWidth;\n                              }\n                              const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                              return (\n                                <>\n                                  {\n                                    +item[x.field] > 0 ?\n                                      <rect key={itemIndex}\n                                        fill={thatColor}\n                                        width={thatWidth}\n                                        x={thatX}\n                                        y={thatY}\n                                        height={bandHeight - 1}\n                                        data-for=\"bar-tooltip\"\n                                        data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                      />\n                                      : null\n                                  }\n                                </>\n                              )\n                            })\n                        }\n                      </g>\n                    );\n                  })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au XVIII<sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}"],"sourceRoot":""}