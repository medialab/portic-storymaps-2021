{"version":3,"sources":["visualizations/PrincipalVisualizationPart3/ExtraversionObject.js","visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js","components/NetworkGraphChart/reducers.js","components/NetworkGraphChart/GraphContainer.js","contents/fr/footer.mdx","helpers/misc.js","helpers/hooks.js","components/TriangleChart/PortGroup.js","components/TriangleChart/TriangleChart.js","colorPalettes.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","contents/fr/partie-1.mdx","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2-intro.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/about.mdx","contents/fr/references.mdx","contents/en/references.mdx","contents/en/tests.mdx","components/SvgChart/SvgChart.js","components/GeographicMapChart/index.js","components/NetworkGraphChart/index.js","components/DataProvider/index.js","components/TriangleChart/index.js","components/DataProvider/DataProvider.js","contents/fr/tests.mdx","components/LineChart/LineChart.js","components/LineChart/index.js","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","components/Caller/Caller.js","components/Caller/index.js","components/GeographicMapChart/ChoroplethLayer.js","components/GeographicMapChart/PointsLayer.js","components/GeographicMapChart/FlowsLayer.js","components/GeographicMapChart/CustomObjectLayer.js","components/GeographicMapChart/Button.js","components/GeographicMapChart/Input.js","components/GeographicMapChart/Legend.js","components/GeographicMapChart/GeographicMapChart.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/BarChart.js","components/BarChart/index.js","../ /^/.//.*$/ groupOptions: {} namespace object","visualizations/Test.js","components/DeclineChart/LongitudinalTradeChart.js","components/DeclineChart/ProductsDistributionChart.js","components/DeclineChart/index.js","components/DeclineChart/DeclineChart.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialChart/CircularAlluvialChart.js","components/CircularAlluvialChart/utils.js","components/SliderRange/SliderRange.js","components/SliderRange/index.js","components/RadarPlot/AxisObject.js","components/RadarPlot/VisObject.js","components/RadarPlot/index.js","components/RadarPlot/RadarPlot.js","visualizations/PrincipalVisualizationPart2/RadarWrapper.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/Step2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/IntroBureaux/IntroBureaux.js","visualizations/IntroBureaux/index.js","visualizations/HomeportFlows/HomeportFlows.js","components/TreemapChart/TreemapChart.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","components/VisualizationFocus/VisualizationFocus.js","components/VisualizationFocus/index.js","pages/ScrollyPage/ScrollyPage.js","pages/ScrollyPage/index.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","pages/StandaloneVisualization/index.js","pages/StandaloneVisualization/StandaloneVisualization.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/contexts.js","contents/fr/metadata.js","contents/en/metadata.js"],"names":["ExtraversionObject","navigoValues","metric1","metric2","toflitPct","transformGroup","inputCircleRadius","circleRadius","inputWidth","width","inputHeight","height","name","legendMode","isActive","isMinified","onClick","fixSvgDimension","useState","isInited","setIsInited","useEffect","setTimeout","ReactTooltip","rebuild","leftPath","rightPath","transform","useSpring","to","immediate","maxTriangleHeight","maxArea","area1","area2","leftTriangleHeight","Math","sqrt","rightTriangleHeight","start","end","PI","partialCircle","map","command","join","labelFontSize","parseInt","g","className","cx","undefined","d","stroke","colorsPalettes","generic","accent2","strokeWidth","fill","data-for","data-tip","toFixed","ui","colorAccentBackground","max","font-size","textAnchor","x","y","x1","y1","x2","y2","markerEnd","Step3Object","datum","projection","projectionTemplate","longitude","latitude","totalTonnage","parseFloat","cumulated_tonnage_out_region","cumulated_tonnage_in_region","type_of_object","navigoMetric1","navigoMetric2","inPercentage","totalValue","cumulated_exports_value_from_region","cumulated_exports_value_from_ext","noOverlapTransform","includes","isNaN","Step3Objects","data","customsOffices","ports","selectedBureau","setSelectedBureau","handleClick","visiblePorts","useMemo","filter","customs_office","portsSpaceStartY","portsSpaceHeight","portsSpaceWidth","portRowHeight","length","sort","a","b","yA","port","portIndex","initialCircleRadius","objectX","objectY","cy","r","style","dark","index","SmallMultiples","bureaux","unshift","margin","multiplesY","columnWidth","xObjectsStart","opacity","position","left","bottom","custom_office","id","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient","renderTriangles","atlasMode","TriangleChart","totalWidth","rowHeight","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","ratio","sizes","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","field","values","attr","uniq","palette","colors","generatePalette","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","smallerNode","Color","lighten","rgb","string","createEdgeReducer","container","useRef","renderer","setRenderer","getCamera","animate","needToRefresh","settings","labelGrid","cell","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","labelFont","camera","setState","getState","disable","on","state","current","ref","minHeight","minWidth","NetworkGraphChart","gexfString","spatialize","inputCameraPosition","angle","title","headerRef","headerHeight","getBoundingClientRect","setCameraPosition","find","prop","gexf","parse","Graph","forceAtlas2","inferSettings","assign","iterations","flex","cam","readingTime","layoutProps","MDXContent","components","props","mdxType","parentName","isMDXComponent","tableOfContents","level","children","frontMatter","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","lang","currentMetadata","trimText","str","limit","words","split","output","slice","cartesian2Polar","distance","radians","atan2","polarToCartesian","theta","cos","sin","value","count","accent1","iwanthue","colorSpace","seed","clustering","num","abs","formatNumber","n","reverse","reduce","digit","result","useInterval","callback","delay","savedCallback","setInterval","clearInterval","useDebounce","debouncedValue","setDebouncedValue","handler","clearTimeout","PortGroup","numberOfColumns","scaleX","scaleY","legendWidth","totalHeight","margins","fontSize","triangleWidth","nb_pointcalls_out","triangleHeight","mean_tonnage","xTransform","yTransform","markerRadius","staticTransform","cellCenterX","textStartY","triangleStartY","legendTextWidth","labelBgWidth","line","strokeDasharray","circle","marker-start","xmlns","transformOrigin","inputMargins","right","offset","stopColor","stop-opacity","xa","tonnageClasses","franceAlone","portsTreemaps","href","target","rel","step","highlight","minTonnage","SvgChart","GeographicMapChart","DataProvider","dataFilename","setData","loadingData","setLoadingData","dataURL","process","then","newData","extension","pop","csvParse","catch","err","backgroundData","visData","layers","type","renderObjects","colorPalettes","provinces","admiralties","label","backgroundFilename","markerColor","markerSize","showLabels","LineChart","initialWidth","initialHeight","tooltip","annotations","headersHeight","setHeadersHeight","setLegendWidth","legendRef","newHeadersHeight","newLegendWidth","colorPalette","top","yTickFormat","tickFormat","yTickSpan","tickSpan","initialYDomain","fillGaps","xTickFormat","xTickSpan","initialXDomain","colorModalities","colorValues","modality","xDomain","yDomain","xScale","nice","yScale","groups","Object","entries","groupBy","xAxisValues","axisPropsFromTickScale","yAxisValues","marginLeft","valueIndex","axis","annotation","annotationIndex","labelPosition","thatHeight","thatY1","thatY2","points","patternUnits","thatX1","thatX2","groupIndex","groupName","items","item","itemIndex","next","consecutive","hasNext","genreIndex","genre","background","PASS_DURATION","Hull","bottomRightX","bottomLeftX","Sail","sailSpeed","randomFactor","random","minRightX","maxLeftX","maxRightX","step1","step2","loop","from","config","duration","polygon","Matt","secondWidth","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","BoatsIllustration","useReducer","action","boat","payload","genId","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","now","Caller","visualizationId","useContext","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","e","GeoPart","initialD","project","layer","currentD","animationProps","boundsAbs","geoPath","bounds","xMin","xMax","yMin","yMax","outOfBounds","path","properties","shortname","ChoroplethLayer","reverseColors","console","info","features","generatedPalette","geometry","PointGroup","onGroupMouseEnter","onGroupMouseLeave","displayLabel","area","rawSize","labelSize","zIndex","onMouseEnter","onMouseMove","onMouseLeave","displayMetric","labelsColor","StackedLabelGroup","thatIndex","stackedRowHeight","transformLabel","window","innerWidth","labelY","PointsLayer","hoveredIndex","setHoveredIndex","visibleMarkers","coordsMap","mark","grouped","sizeCoef","custom","areaRange","sizeScale","labelSizeScale","stackedLabelsTop","maxLabelFontSize","innerHeight","stackLabels","enter","leave","FlowGroup","hovered","inputXDep","xDep","inputYDep","yDep","inputXDest","xDest","inputYDest","yDest","inputStrokeWidth","actualXDep","actualYDep","actualXDest","actualYDest","arrowLength","depLabelTextAnchor","depLabelX","depLabelY","destLabelTextAnchor","destLabelX","destLabelY","arrowPath","FlowsLayer","markerData","strokeWidthScale","flow","arrowSizeScale","copy","arrowSize","latitude_dep","longitude_dep","latitude_dest","longitude_dest","hideOverflowingFlows","depLabelPosition","destLabelPosition","labels","newLabels","depId","fields","largerStrokeWidth","flows","destId","actualX","j","label1","label2","minAx","minAy","maxAx","maxAy","minBx","minBy","maxBx","aAboveB","aBelowB","distanceY","hoverIds","setHoverIds","thatLabel","isVisible","hoveredId","CustomObjectLayer","renderObject","Button","onMouseDown","isMouseDown","interval","log","onMouseUp","Input","inputValue","onBlur","setValue","onChange","Legend","layerFilter","l","hasSize","hasColors","modalityIndex","initialProjectionTemplate","inputProjectionConfig","projectionConfig","debug","withLegend","legendLayerFilter","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","setProjectionTemplate","defaultProjectionConfig","rotationDegree","geoEqualEarth","center","translate","placeHolder","val","layerIndex","HorizontalBarChart","orientation","layout","Tooltip","yField","sortY","fillXGaps","xField","sortX","sortYField","ascending","sortYAscending","sortYType","autoSort","yAutoSort","sortXField","sortXAscending","sortXType","xValues","vizWidth","bandsNb","scaleBand","xExtent","sum","bandWidth","yStackScale","multiplier","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","fixedRowHeight","formatLabel","vizHeight","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX","thatWidth","BarChart","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","keys","module","exports","Test","datasets","datasetName","JSON","stringify","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","barTooltipFn","cityName","highlightYears","colorScaleMessages","year","footerRef","setHeight","newHeight","offsetHeight","yearsExtent","yearsEnumerated","xBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","yShareScale","rightYAxisValues","leftYAxisValue","maximum","minimum","marginRight","bandwidth","aStartYear","aEndYear","replace","data-effect","data-html","data-class","data-place","initialEndYear","row","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","her","labelScale","element","maxWidth","backgroundColor","DeclineChart","productTradePartThreshold","rows","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","austriaWar","usIndependance","laRochelleDiaspora","totalRows","renderRow","rowFlex","rowIndex","region","comparison","rowId","PrincipalVisualizationPart1","colorSchemes","colorScheme1","colorScheme2","colorScheme3","G","inputProps","Text","text","Line","Circle","Rect","rect","Path","CircularAlluvialChart","sumBy","filters","centerHorizontalLabels","displaceHorizontalLabels","tooltips","align","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","spec","stepsSpec","_id","stepIndex","stepData","valueAbs","actualValue","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","VERTICAL_BAR_SIZE","stepScales","0","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","tooltipContent","fontWeight","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","flow_type","partner","tContent","trim","nodeHeight","initialY","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","flowX","flowY","flowWidth","flowHeight","Range","createSliderWithTooltip","Slider","SliderRange","allowCross","AxisObject","MARGIN","axisIndex","axisRankScale","rawX1","rawY1","rawX2","rawY2","labelXDisplace","labelYDisplace","foreignObject","inputX","inputY","inputR","VisObject","axisIndexMap","radiusScale","xRaw","yRaw","joinedPoints","tooltipValues","sumOfParts","portionA","portion","fillOpacity","RadarPlot","wholeSize","aIndex","visCenter","visSize","meta","normalizeRadarValues","datas","destCaptions","maxValue","maxBy","hasOwnProperty","dkey","RadarWrapper","globalWidth","minified","navigoAgregation","maxTonnage","selectedBureaux","setSelectedBureaux","aggregationMethod","setAggregationMethod","tonnageFilterValues","setTonnageFilterValues","datasetMaximumTonnage","setDatasetMaximumTonnage","destination_radar","ferme_bureau","tonnage","bureauxList","uniqBy","filteredData","bureauxToKeep","cleanBureaux","radarData","bureauName","relevantData","preparedData","_","dest","rObj","prepareTravelData","bureau","newSelectedBureaux","has","delete","add","PrincipalVisualizationPart2","showOnlyToflit","screenshotMode","sumToflitBy","alluvialFilters","toflit18titles","Step2","paddingLeft","metrics_type","PrincipalVisualizationPart3","currentMapTemplate","setCurrentMapTemplate","gradientTransform","colorBackgroundBlue","customs_region","BureauBackground","radius","BureauLabel","labelOnRight","IntroBureaux","dimensions","renderBureaux","HomeportFlows","hotFixedData","port_dest","port_dest_category","formatNestResults","input","isArray","TreemapChart","fieldsHierarchy","leaf","labelField","countField","root","nest","hierarchy","treemap","tile","treemapBinary","leaves","x0","y0","rectWidth","rectHeight","labelText","VisualizationContainer","inputDimensions","DatasetsContext","relevantDatasets","viz","visualizationsList","datasetsIds","order","value_rel_per_direction","entity","nb_pointcalls","country","borderBottom","omit","homeport","category_2","thatPalette","origin","VisualizationController","setDimensions","visProps","onResize","contentRect","measureRef","VisualizationFocus","howDone","howRead","visualization","onClose","copyClicked","setCopyClicked","copyLink","linkCopied","stopPropagation","url","homepage","visualizationsMap","visualizations","ScrollyPage","ContentSync","sectionRef","focusOnViz","setFocusOnViz","visualizationIsFullScreen","setVisualizationIsFullScreen","setActiveVisualization","newState","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","visualizationEntries","sectionDims","visY","Provider","behavior","params","finalParams","newVis","thatId","Helmet","summary","routes","titles","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","ReferencesFr","ReferencesEn","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","route","navigator","userAgent","Home","match","introRef","inVis","setInVis","titleHTML","subtitle","newActiveVisualization","firstOneY","Infinity","dangerouslySetInnerHTML","__html","Atlas","isLoading","setIsLoading","history","useHistory","shownVisualization","visualizationIndex","pathname","src","alt","StandaloneVisualization","PlainPage","Content","contentsURL","fallback","colorText","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","tsvParse","error","newDatasets","renderRoute","ThatComponent","ln","otherLang","pathOtherLang","routeItem","React","lazy","component","Fragment","BASE_NAME","Wrapper","basename","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","createContext"],"mappings":"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","file":"static/js/main.be893946.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\nimport { animated, useSpring } from 'react-spring';\nimport cx from 'classnames';\nimport colorsPalettes from '../../colorPalettes';\n\nimport partialCircle from 'svg-partial-circle';\nimport { max } from 'd3';\nimport ReactTooltip from 'react-tooltip';\nimport { fixSvgDimension } from '../../helpers/misc';\n\n\nconst ExtraversionObject = ({\n  navigoValues: [metric1, metric2],\n  toflitPct,\n  transformGroup,\n  circleRadius: inputCircleRadius,\n  width: inputWidth,\n  height: inputHeight,\n  name,\n  legendMode,\n  isActive,\n  isMinified,\n  onClick,\n}) => {\n  const circleRadius = fixSvgDimension(inputCircleRadius);\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  const { transform } = useSpring({\n    to: {\n      transform: transformGroup\n    },\n    immediate: !isInited\n  });\n\n\n  const maxTriangleHeight = (circleRadius) * 1.4;\n  // dimensionning triangles based on their area (and not triangle height)\n  // Area = (height * base) / 2;\n  const maxArea = maxTriangleHeight * (maxTriangleHeight) / 2;\n  const area1 = metric1 * maxArea;\n  const area2 = metric2 * maxArea;\n  const leftTriangleHeight = Math.sqrt(area1 * metric1);\n  const rightTriangleHeight = Math.sqrt(area2 * metric2);\n\n  let start = null\n  let end = null\n  let leftPath;\n  let rightPath;\n  if (toflitPct) {\n    // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement rparti en bas  droite si co sans coords\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (toflitPct - 50) / 100 * Math.PI\n    end = Math.PI * 3 / 2 - (toflitPct - 50) / 100 * Math.PI\n\n    leftPath = partialCircle(\n      0, 0,         // center X and Y\n      circleRadius,              // radius\n      start,          // start angle in radians --> Math.PI / 4\n      end             // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n    rightPath = partialCircle(\n      0, 0,             // center X and Y\n      circleRadius,                  // radius\n      start,              // start angle in radians --> Math.PI / 4\n      end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n  }\n\n  let labelFontSize = parseInt(height * 0.013);\n  labelFontSize = labelFontSize > 8 ? labelFontSize : 8;\n  return (\n    <animated.g\n      className={cx('ExtraversionObject', { 'is-active': isActive, 'is-minified': isMinified })}\n      // transform={noOverlapTransform}\n      transform={transform}\n      onClick={() => typeof onClick === 'function' ? onClick(name) : undefined}\n    // { datum.longitude === 0 ? x=1 : null }\n    >\n\n      <>\n        {\n          toflitPct && leftPath != null ?\n            <>\n\n              <path\n                d={`${leftPath}\n                  `}\n                stroke={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n                strokeWidth={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={`${(100 - toflitPct ).toFixed(1)}% de valeur d'exports de produits fabriqus hors de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n              />\n\n              <path\n                d={`${rightPath}\n                  `}\n                stroke={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n                strokeWidth={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={`${(toflitPct).toFixed(1)}% de valeur d'exports de produits fabriqus dans la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n              />\n            </>\n            :\n            null\n        }\n        <path className='left-triangle'\n          fill={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n          d={`M ${0} ${-leftTriangleHeight / 2}\n            V ${leftTriangleHeight / 2}\n            L ${-leftTriangleHeight} ${0}\n            Z\n                `}\n                data-for=\"geo-tooltip\"\n                data-tip={`${(metric1 * 100 ).toFixed(1)}% du tonnage cumul des voyages raliss vers l'extrieur de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n        />\n\n        <path\n          className='right-triangle'\n          fill={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n          d={`M ${0} ${-rightTriangleHeight / 2}\n            L ${rightTriangleHeight} ${0}\n            L ${0} ${rightTriangleHeight / 2}\n            Z\n            `}\n            data-for=\"geo-tooltip\"\n            data-tip={`${(metric2 * 100 ).toFixed(1)}% du tonnage cumul des voyages raliss vers l'intrieur de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n        />\n        <g\n          transform={`translate(${parseInt(0)}, ${toflitPct ? parseInt(circleRadius) + 15 : max([leftTriangleHeight, rightTriangleHeight]) / 2 + 10})`}\n        >\n          <text\n            className='object-label'\n            font-size={labelFontSize}\n            textAnchor=\"middle\"\n          >\n            {name}\n          </text>\n        </g>\n      </>\n      {\n        legendMode ?\n          <g className=\"legend-container\">\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={-circleRadius * 1.7}\n              className=\"top left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des exports de produits fabriqus hors de la direction\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * .95}\n              y1={-circleRadius * 1.5}\n              x2={-circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={-circleRadius * 1.7}\n              className=\"top right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des exports de produits fabriqus dans la direction\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 1.15}\n              y1={-circleRadius * 1.5}\n              x2={circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={0}\n              className=\"bottom left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des voyages hors direction (tonnage c.)\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * 1.8}\n              y1={circleRadius * .2}\n              x2={-circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={0}\n              className=\"bottom right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  Part des voyages dans la direction (tonnage c.)\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 2}\n              y1={circleRadius * .2}\n              x2={circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n\n          </g>\n          : null\n      }\n    </animated.g>);\n}\n\nexport default ExtraversionObject;","/*\nDOCUMENTATION : sommaires des fonctions\n\n- renderLabel (renderObject)\npositionner geographiquement des labels\n\n- renderStep3Object (renderObject)\ncration d'un double triangle et d'un cercle autour (deux courbes de bzier), positionn gographiquement\n(objet associ  un bureau de ferme)\n\n- fonction renderStep3SmallMultiples (renderObjects)\ncration des objets double triangle et cercles pour les small multiples de la viz 3.3, positionns en bas  droite du SVG\n+ un objet de lgende\n\n- renderTriangles (renderObjects)\ncration des triangles pour la viz 3.1, relis par une courbe pointille  des points positionns gographiquement\n+ un triangle de lgende\n\n@TODO : complter la fonction step3Object (ou crer une nouvelle fonction), pour grer l'apparition des doubles triangles pour chaque port\n-  cette fonctionnalit est dj prvue dans la fonction renderStep3Object (dans la boucle   if (datum.type_of_object === \"port\") { ...}) mais en l'tat les objets ports sont positionns gographiquement\n- il faudrait adapter pour positionner les objets ports en colonne, sur la gauche du SVG, et qu'ils aient par dfaut une opacit  0% sauf au hover de l'objet bureau des fermes correspondant => apparition\n\n*/\nimport { useMemo, useState } from 'react';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport ExtraversionObject from './ExtraversionObject';\n\nimport TriangleChart from '../../components/TriangleChart/TriangleChart';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nexport function Label(datum, projection, { width }) { //  terme on pourrait mettre un objet \n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text size={width * 0.05}>{datum.label}</text>\n    </g>);\n}\n\nfunction Step3Object({\n  datum,\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate,\n  isActive,\n  isMinified,\n  onClick\n}) { //  priori plus besoin de datum et de width qui sont dj passs au composant CustomObjectLayer\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  let circleRadius = width * 0.05;\n  const totalTonnage = parseFloat(datum.cumulated_tonnage_out_region) + parseFloat(datum.cumulated_tonnage_in_region)\n\n  if (datum.type_of_object === \"port\") {\n    // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n    // se grerait bien avec un switch\n    if (totalTonnage < 1000) { // * 1000\n      circleRadius = width * 0.025\n    }\n    else {\n      if (totalTonnage > 5000) {\n        circleRadius = width * 0.075\n      }\n    }\n  }\n\n  const navigoMetric1 = parseFloat(datum.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n  const navigoMetric2 = parseFloat(datum.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n  let inPercentage = 0;\n  if (datum.type_of_object === \"customs_office\") {\n    const totalValue = parseFloat(datum.cumulated_exports_value_from_region) + parseFloat(datum.cumulated_exports_value_from_ext)\n    inPercentage = parseFloat(datum.cumulated_exports_value_from_region) / totalValue * 100\n    inPercentage = inPercentage === 100 ? 99.99 : inPercentage;\n  }\n\n  // handle overlap \n  let noOverlapTransform = `translate(${x},${y})` // mettre entre accolades ??\n  if (projectionTemplate.includes('Poitou')) {\n    if (datum.name === 'Tonnay-Charente') {\n      noOverlapTransform = `translate(${x + width * 0.15},${y})`\n    }\n    else if ((datum.name === 'Rochefort')) {\n      noOverlapTransform = `translate(${x + width * 0.04},${y - height * 0.0})`\n    }\n    else if ((datum.name === 'Marennes')) {\n      noOverlapTransform = `translate(${x - width * 0.03},${y + height * 0.05})`\n    }\n    else if ((datum.name === 'Marans')) {\n      noOverlapTransform = `translate(${x + width * 0.03},${y - height * 0.05})`\n    }\n    else if ((datum.name === 'Saint-Martin-de-R')) {\n      noOverlapTransform = `translate(${x - width * 0.06},${y})`\n    }\n    // else if ((datum.name === `Les Sables-d'Olonne`)) {\n    //   noOverlapTransform = `translate(${x + width * 0.1},${y + height * 0.15})`\n    // }\n  }\n  \n\n  const transformGroup = projectionTemplate === 'France' ? noOverlapTransform + ' scale(0.1)' : noOverlapTransform + ` scale(${isMinified ? 0.5 : 1})`;\n  return (\n    <ExtraversionObject\n      {\n      ...{\n        transformGroup,\n        navigoValues: [navigoMetric1, navigoMetric2],\n        toflitPct: !isNaN(inPercentage) ? inPercentage : 100,\n        circleRadius,\n        width,\n        height,\n        name: datum.name,\n        isActive,\n        isMinified,\n        onClick\n      }\n      }\n    />\n  )\n}\n\nexport function Step3Objects({\n  data: { customsOffices = [], ports = [] },\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [selectedBureau, setSelectedBureau] = useState(undefined);\n  const handleClick = (name) => {\n    if (name === selectedBureau) {\n      setSelectedBureau(undefined);\n    } else setSelectedBureau(name);\n  }\n\n  const visiblePorts = useMemo(() => {\n    if (selectedBureau) {\n      return ports.filter(d => d.customs_office === selectedBureau)\n    }\n    return [];\n  }, [selectedBureau, ports])\n\n  const partsSpaceStartX = 15;\n  const portsSpaceStartY = height * 0.18;\n  const portsSpaceHeight = height * 0.55;\n  const portsSpaceWidth = width * .35;\n\n  const portRowHeight = visiblePorts.length ?  portsSpaceHeight / visiblePorts.length : portsSpaceHeight;\n\n  return (\n    <g className=\"Step3Objects\">\n      {\n        selectedBureau ?\n          <g className=\"ports-details\">\n            <foreignObject\n              x={0}\n              y={0}\n              width={width * .4}\n              height={height / 2}\n              className=\"ports-details-title\"\n            >\n              <h5>Ports associs au bureau des fermes de {selectedBureau} ({visiblePorts.length})</h5>\n            </foreignObject>\n            <g\n              className=\"ports-space\"\n              transform={`translate(${partsSpaceStartX}, ${portsSpaceStartY})`}\n            >\n              {/* <rect\n                x={0}\n                y={0}\n                width={portsSpaceWidth}\n                height={portsSpaceHeight}\n                style={{ fill: 'red' }}\n              /> */}\n              {\n                visiblePorts\n                .sort((a, b) => {\n                  const [_xA, yA] = projection([+a.longitude, +a.latitude]);/* eslint no-unused-vars : 0 */\n                  const [_xB, yB] = projection([+b.longitude, +b.latitude]);/* eslint no-unused-vars : 0 */\n                  if (yA > yB) {\n                    return 1;\n                  }\n                  return -1;\n                })\n                .map((port, portIndex) => {\n                  const [x, y] = projection([+port.longitude, +port.latitude]);\n                  const initialCircleRadius = width * 0.05;\n                  let circleRadius = initialCircleRadius;\n                  const totalTonnage = parseFloat(port.cumulated_tonnage_out_region) + parseFloat(port.cumulated_tonnage_in_region)\n\n                  // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n                  // se grerait bien avec un switch\n                  if (totalTonnage < 1000) { // * 1000\n                    circleRadius = width * 0.025\n                  }\n                  else {\n                    if (totalTonnage > 5000) {\n                      circleRadius = width * 0.075\n                    }\n                  }\n                  const navigoMetric1 = parseFloat(port.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n                  const navigoMetric2 = parseFloat(port.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n                  const objectX = portsSpaceWidth / 2 - initialCircleRadius * 2 + (visiblePorts.length > 5 ? portIndex % 2 === 0 ? 0 : initialCircleRadius * 2 : 0);\n                  const objectY = portRowHeight * portIndex;\n                  // const transformGroup = projectionTemplate === 'France' ? `translate(${x},${y})` + ' scale(0.1)' : `translate(${x},${y})` + ` scale(1)`;\n                  const transformGroup = `translate(${objectX}, ${objectY})`;\n                  return (\n                    <g className=\"port-group\" key={port.name}>\n                      <line\n                        x1={objectX}\n                        y1={objectY}\n                        x2={x - partsSpaceStartX}\n                        y2={y - portsSpaceStartY}\n                      />\n                      <circle\n                        cx={x - partsSpaceStartX}\n                        cy={y - portsSpaceStartY}\n                        r={width * 0.002}\n                        style={{ fill: colorsPalettes.generic.dark }}\n                        className=\"marker\"\n                      />\n                      <ExtraversionObject\n                        {\n                        ...{\n                          transformGroup,\n                          navigoValues: [navigoMetric1, navigoMetric2],\n                          circleRadius,\n                          width,\n                          height,\n                          name: port.name,\n                        }\n                        }\n                      />\n                    </g>\n                  )\n                })\n              }\n            </g>\n\n          </g>\n          : null\n      }\n      {\n        customsOffices.map((datum, index) => (\n          <Step3Object\n            key={datum.name}\n            {\n            ...{\n              datum,\n              projection,\n              width,\n              height,\n              projectionTemplate,\n              onClick: handleClick,\n              isActive: datum.name === selectedBureau,\n              isMinified: selectedBureau && datum.name !== selectedBureau\n            }\n            }\n          />\n        ))\n      }\n    </g>\n  )\n}\n\nexport function SmallMultiples({ \n  data, \n  width: inputWidth, \n  height: inputHeight, \n  projection \n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // could be parametered in props too\n  const bureaux = data.filter(({ name }) => name === 'Le Havre' || name === 'Nantes' || name === 'Bordeaux' || name === 'La Rochelle')\n    .sort((a, b) => {\n      if (a.cumulated_exports_value_from_region > b.cumulated_exports_value_from_region) {\n        return -1;\n      }\n      return 1;\n    })\n  const legendCustomOffice = {\n    name: 'Lgende',\n    cumulated_tonnage_in_region: 60,\n    cumulated_tonnage_out_region: 60,\n    cumulated_exports_value_from_region: 50,\n    cumulated_exports_value_from_ext: 50,\n    legendMode: true\n  }\n  bureaux.unshift(legendCustomOffice)\n\n  const margin = 15;\n  let circleRadius = width * 0.05;\n  const multiplesY = height - circleRadius - margin * 2;\n\n  const legendFactor = 1;\n\n  const columnWidth = (circleRadius * 2 + margin);\n\n  const xObjectsStart = width * .4 // circleRadius * legendFactor + circleRadius + margin;\n\n  return (\n    <g className=\"small-multiples-and-legend-and-title\">\n      {/* <foreignObject\n        x={margin * 4}\n        y={multiplesY - circleRadius * 4}\n        width={circleRadius * 7}\n        height={height}\n        className=\"interaction-cta\"\n      >\n        <div>\n          cliquer sur un bureau des fermes pour voir le dtail de ses ports\n        </div>\n      </foreignObject> */}\n      <rect\n        x={xObjectsStart + margin * 2}\n        y={multiplesY - circleRadius * 3}\n        width={width - xObjectsStart - margin * 4}\n        height={height - multiplesY + circleRadius * 3 - margin / 2}\n        style={{ fill: 'white' }}\n        opacity={0.5}\n      />\n      <foreignObject\n        x={xObjectsStart + circleRadius * 1.5}\n        y={multiplesY - circleRadius * 3}\n        width={(circleRadius * 2 + margin) * (bureaux.length - 1)}\n        height={height}\n      >\n        <div style={{ position: 'relative' }}>\n          <h5 className=\"visualization-title\" style={{ position: 'absolute', left: 0, bottom: 0 }}>\n            Comparaison avec les bureaux de fermes et ports dominants d'autres directions en 1787\n          </h5>\n        </div>\n      </foreignObject>\n      <g className=\"small-multiples\">\n        {\n          bureaux\n            .map((custom_office, index) => {\n              const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n\n              const navigoMetric1 = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n              const navigoMetric2 = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n\n              const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n              const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n\n              return custom_office.legendMode ?\n                (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${circleRadius * legendFactor * 4 + margin + index * (circleRadius * legendFactor + margin)}, ${multiplesY - (circleRadius * legendFactor - circleRadius)})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius: circleRadius * legendFactor,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n                : (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${xObjectsStart + index * columnWidth}, ${multiplesY})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n            })\n        }\n\n      </g>\n      <defs>\n        <marker id=\"triangle-end\" viewBox=\"-10 0 10 10\"\n          refX=\"1\" refY=\"5\"\n          markerUnits=\"strokeWidth\"\n          markerWidth={width * 0.01}\n          markerHeight={width * 0.01}\n          orient=\"auto\">\n          <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n        </marker>\n      </defs>\n    </g>\n  );\n\n}\n\nexport function renderTriangles({ \n  data, \n  width: inputWidth, \n  height: inputHeight, \n  projection, \n  projectionTemplate, atlasMode \n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // console.log(\"data : layder.data \", data)\n  return (\n    <TriangleChart\n      data={data}\n      totalWidth={width} // @TODO : il faudrait rduire cette width \n      rowHeight={height * 0.3}\n      projection={projection}\n      projectionTemplate={projectionTemplate}\n      atlasMode={atlasMode}\n    />\n  );\n}","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      // console.log('color the attr', nodeColor.name, attr[nodeColor.name]);\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      // console.log('size attr', nodeSize.name, attr);\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const smallerNode = sourceNodeSize < targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (smallerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = smallerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[smallerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React, { useCallback, useRef, useState, useEffect, useMemo } from 'react';\nimport gexf from 'graphology-gexf';\nimport forceAtlas2 from 'graphology-layout-forceatlas2';\nimport Graph from 'graphology';\nimport { WebGLRenderer as Renderer } from 'sigma';\nimport { scaleLinear } from 'd3-scale';\nimport { min, max, extent } from 'd3-array';\nimport { uniq } from 'lodash';\n// import get from 'axios';\n\nimport { createNodeReducer, createEdgeReducer } from './reducers';\nimport { generatePalette, usePrevious } from '../../helpers/misc';\n\n// import GraphControls from './GraphControls';\n\nimport './GraphContainer.scss';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\n// function rescale(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedReset(renderer);\n// }\n\n// function zoomIn(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedZoom(renderer);\n// }\n\n// function zoomOut(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedUnzoom(renderer);\n// }\n\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n  width,\n  height,\n  ratio,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n\n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable && nodeColorVariable.field) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable.field])\n      })\n      values = uniq(values);\n      let palette = {};\n      if (nodeColorVariable.palette) {\n        palette = nodeColorVariable.palette;\n      } else {\n        const colors = generatePalette(nodeColorVariable.field, values.length);\n        let i = 0;\n        values.forEach(option => {\n          palette[option] = colors[i];\n          i++;\n        });\n      }\n\n      return {\n        palette,\n        name: nodeColorVariable.field\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n        m.set(edge, { sourceNode: sourceAttributes, targetNode: targetAttributes })\n      });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n\n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n\n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n      const camera = renderer.getCamera();\n      // console.log('animate camera', camera);\n      camera.animate(cameraPosition);\n    }\n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n\n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n  useEffect(() => {\n    if (renderer) {\n      renderer.refresh();\n    }\n  }, [width, height])\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, { nodeReducer, edgeReducer });\n\n        newRenderer.settings.labelFont = 'IBM Plex Sans';\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        camera.setState({ ...camera.getState(), ratio: ratio || 1 });\n        camera.disable();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{ width: '100%', height: '100%', minHeight: '10vh', minWidth: '1vw' }}></div>\n      {/*renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )*/}\n    </div>\n  );\n}\n\n\nexport default function NetworkGraphChart({\n  data: gexfString,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  spatialize,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 },\n  width = 0,\n  height,\n  ratio,\n  title\n}) {\n  const headerRef = useRef(null);\n  const headerHeight = useMemo(\n    () => headerRef.current ? headerRef.current.getBoundingClientRect().height : 0, [headerRef.current])\n\n  // useState renvoie un state et un seter qui permet de le modifier\n  const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n\n  useEffect(() => {\n    if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n      setCameraPosition(inputCameraPosition);\n    }\n  }, [inputCameraPosition])\n\n  const onCameraUpdate = cam => {\n    setCameraPosition(cam);\n  }\n  const graph = useMemo(() => {\n    const g = gexf.parse(Graph, gexfString);\n    if (spatialize) {\n      const settings = forceAtlas2.inferSettings(g);\n      // To directly assign the positions to the nodes:\n      forceAtlas2.assign(g, {\n        settings,\n        iterations: 50\n      });\n    }\n    return g;\n  }, [gexfString]);\n\n  if (!graph) {\n    return null;\n  }\n  return (\n    <div className=\"NetworkGraphChart\" style={{ \n      width: '100%', \n      height: height || '100%',\n    }}>\n      <div ref={headerRef} className=\"row visualization-title-container\">\n        {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n      </div>\n      <div style={{\n        position: 'relative',\n        flex: 1,\n        // top: headerHeight,\n        // background: 'red',\n        // height: height - headerHeight\n      }}>\n\n        <GraphContainer\n          {\n          ...{\n            graph,\n            cameraPosition,\n            nodeColor,\n            nodeSize,\n            labelDensity,\n            nodeLabel,\n            ratio,\n            onCameraUpdate,\n            width,\n            height: height - headerHeight\n          }\n          }\n        />\n      </div>\n    </div>\n  )\n}","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.54,\"time\":32400,\"words\":108}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme ANR PORTIC se propose de croiser les donnes sur la navigation et sur la valeur du commerce tranger de la France  la veille de la Rvolution franaise pour mieux saisir les dynamiques commerciales  luvre. Pour ce faire, il offre des interfaces dinterrogation et de visualisation des donnes adaptes  des publics et des intrts varis.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placs sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est plac sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\nimport {useRef, useEffect} from 'react';\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\n// import Graph from 'graphology-types';\nimport palettes from '../colorPalettes';\n\nconst {generic} = palettes;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\nexport function buildPageTitle (title, lang = 'fr') {\n  const currentMetadata = metadata[lang] || metadataFr;\n  return `${title} | ${currentMetadata.title} | PORTIC`;\n}\n\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\nexport function cartesian2Polar(x, y){\n  const distance = Math.sqrt(x*x + y*y)\n  const radians = Math.atan2(y,x) //This takes y first\n  return { distance:distance, radians:radians }\n}\n\nexport const polarToCartesian = (r, theta) => [\n  r * Math.cos(theta),\n  r * Math.sin(theta)\n]\n\n\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajout startYear et endYear pour\n      // la rcupration de portic il s'agira de dduire ce year des donnes\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble tre indiable mais pas sur qu'on doive pas le mettre dans un format spcial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas  garder dans le rsultats (colonne donnes dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau  une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        //  partir de l, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptes par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intressent dans le rsultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'tait else { ... } et on passait jamais dedans apparemment du coup l c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // diffrencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"aprs le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // mthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // mthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // mthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : rcupre les flux toflit18\n  --- \n  Paramtres :\n  * startYear : <int> # anne de dbut\n  * endYear : <int> # anne de fin\n  * params : <arr> # proprits  renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs  filtrer dans les flux (peut tre une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // a sert  quelque chose ?? pour moi c'est pas utilis, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'tat a ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les rsultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        // console.log(\"finalData : \", finalData);\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\nexport const getToflitFlowsByApi = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest\n}) => {\n\n  return new Promise((resolve, reject) => {\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    const URL = `http://data.portic.fr/api/flows/?date=${year}`;\n    console.log({ URL })\n    // quivalent  : const URL = 'http://data.portic.fr/api/flows/?date=' + year;\n    get(URL) // get de axios\n      // mixed content issue => comme l'API ne fournit pas d'accs HTTPS je me sentais un peu bloque\n      .then(({ data: str }) => {\n        // conversion en js (avec d3-dsv)\n        // const newData = csvParse(csvString);\n        try {\n          const newData = JSON.parse(str);\n          // contraire : JSON.stringify()\n          // faire des choses avec les rsultats (filtres, ...)\n          const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest })\n          resolve(finalData);\n        } catch (e) {\n          reject(e);\n        }\n\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\nexport const fixSvgDimension = num => isNaN(num) ? 0 : Math.abs(+num)\n\nexport const formatNumber = (n, style = 'fr') => {\n  return ('' + n)\n  .split('')\n  .reverse()\n  .reduce(({count, result}, digit, index) => {\n    const endOfLine = count === 3 ||(count === 0 && index === ('' + n).length - 1);\n    if (endOfLine) {\n      return {\n        count: 1,\n        result: [...result, style === 'fr' ? ' ' : ',',  digit]\n      }\n    } else return {\n      count: count + 1,\n      result: [...result, digit]\n    }\n\n  }, {\n    count: 0,\n    result: []\n  })\n  .result\n  .reverse()\n  .join('')\n}","import { useEffect, useRef, useState } from 'react';\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}","import React, { useEffect, useState } from 'react';\nimport cx from 'classnames';\nimport { animated, useSpring } from 'react-spring';\n\nimport colorsPalettes from '../../colorPalettes';\n\n\nconst PortGroup = ({\n  numberOfColumns,\n  port,\n  scaleX,\n  scaleY,\n  legendWidth,\n  columnWidth,\n  totalHeight,\n  totalWidth,\n  projection,\n  index,\n  margins,\n  rowHeight,\n  fontSize,\n  projectionTemplate\n}) => {\n\n\n  const triangleWidth = scaleX(+port.nb_pointcalls_out)\n  const triangleHeight = scaleY(+port.mean_tonnage)\n\n  const xIndex = index % numberOfColumns;\n  // const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n  const xTransform = xIndex * columnWidth + margins.left // + (legendWidth + margins.left) * totalWidth;\n  const yTransform = totalHeight * 2.3;\n\n  // const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform, x1, y1, x2, y2, staticTransform, markerRadius } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`,\n      x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : x,\n      y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : y,\n      // x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : totalWidth * 0.1,\n      // y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : index * (totalHeight / numberOfColumns),\n\n      markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 0,\n      // markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 1,\n      \n      // x1: xTransform + columnWidth / 2,\n      // y1: yTransform + rowHeight / 7,\n      x2: x,\n      y2: y,\n      staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${x},${y}) scale(${projectionTemplate === 'rotated Poitou' ? 1 : 0.1})`\n      // staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${totalWidth * 0.1},${index * (totalHeight / numberOfColumns)}) scale(${projectionTemplate === 'France' ? 0.2 : 1})`\n    },\n    immediate: !isInited\n  });\n\n  const cellCenterX = columnWidth / 2;\n  const cellCenterY = rowHeight / 2;\n  const textStartY = rowHeight / 7;\n  const triangleStartY = cellCenterY + textStartY / 2 - triangleHeight / 2;\n  const legendTextWidth= totalWidth * 0.08;\n\n  let labelBgWidth = fontSize * 12;\n  if (port.port.length <= 10) {\n    labelBgWidth = fontSize * 6;\n  } else if (port.port.length <= 12) {\n    labelBgWidth = fontSize * 7;\n  } else if (port.port.length <= 15) {\n    labelBgWidth = fontSize * 8;\n  } else if (port.port.length <= 18) {\n    labelBgWidth = fontSize * 10;\n  }\n\n  return (\n    <g className={cx('port-point-and-triangle', {'is-minified': projectionTemplate !== 'rotated Poitou'})}>\n\n      <animated.line\n        x1={x1}\n        y1={y1}\n        x2={x2}\n        y2={y2}\n        stroke='grey'\n        strokeDasharray='2, 8'\n      />\n\n      <animated.g className='port-point' transform={transform}>\n        <animated.circle\n          cx={0}\n          cy={0}\n          r={markerRadius}\n          style={{ fill: colorsPalettes.generic.dark }}\n          className=\"marker\"\n        />\n      </animated.g>\n\n      <animated.g className='port-triangle'\n        // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n        transform={staticTransform}\n      >\n        {/* <rect\n          x={0}\n          y={0}\n          width={columnWidth}\n          height={rowHeight}\n          style={{stroke: 'red'}}\n        /> */}\n\n        {/* <path class='vertical-line'\n          d={`M ${cellCenterX} ${(rowHeight - triangleHeight) / 1.2} \n              V ${rowHeight / 7}\n              `}\n        /> */}\n        <path className='vertical-line'\n          d={`M ${cellCenterX} ${textStartY} \n              V ${triangleStartY}\n              `}\n        />\n\n        <g transform={`translate(${cellCenterX}, ${triangleStartY})`}>\n\n          <path className='triangle'\n            d={`M ${-triangleWidth / 2} ${0} \n                L ${triangleWidth / 2} ${0}\n                L ${0} ${triangleHeight}\n                Z\n                `}\n            fill=\"url(#TriangleGradient)\"\n          />\n          {/* <circle\n            fill=\"red\"\n            r={2}\n            cx={-triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={0}\n            cy={triangleHeight}\n          /> */}\n        </g>\n        <g className=\"local-legend\">\n          {/* horizontal line */}\n          <line\n            x1={cellCenterX - triangleWidth/2}\n            x2={cellCenterX + triangleWidth/2}\n            y1={triangleStartY - 3}\n            y2={triangleStartY - 3}\n            marker-start=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* vertical line */}\n          <line\n            x1={cellCenterX - triangleWidth/2 - 3}\n            x2={cellCenterX - triangleWidth/2 - 3}\n            y1={triangleStartY}\n            y2={triangleStartY + triangleHeight}\n            marker-start=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* pointing arrows */}\n          <path\n            d={`\n            M ${-(legendTextWidth* .2) - triangleWidth / 3} ${triangleStartY * .65}\n            Q ${cellCenterX - 10} ${triangleStartY * .65} ${cellCenterX - 2} ${triangleStartY - 5}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <path\n            d={`\n            M ${-triangleHeight / 3 + 3} ${triangleStartY + triangleHeight * .6 + 7}\n            L ${cellCenterX - triangleWidth/2 - 3} ${triangleStartY + triangleHeight * .6 + 7}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <foreignObject \n            y={triangleStartY / 2}\n            x={-legendTextWidth - triangleWidth / 3}\n            width={legendTextWidth}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n             nombre de navires sortis du port en 1789 : <strong>{port.nb_pointcalls_out}</strong>\n            </span>\n          </foreignObject>\n          <foreignObject \n            x={-legendTextWidth - triangleWidth / 3}\n            y={triangleStartY + triangleHeight * .6}\n            width={totalWidth * 0.08}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n              tonnage moyen des navires : <strong>{(+port.mean_tonnage || 0).toFixed(1)}</strong>\n            </span>\n          </foreignObject>\n          \n        </g>\n        <g className='label' transformOrigin=\"bottom left\" transform={`translate(${columnWidth / 2}, ${rowHeight / 7 - totalHeight * 0.025})`}>\n          <path\n            d={`M 0 ${-fontSize} L ${labelBgWidth} ${-fontSize} ${labelBgWidth - 5} ${(-fontSize + fontSize * 0.2) / 2} ${labelBgWidth} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // d={`M 0 ${-fontSize} L ${port.port.length * fontSize * .64} ${-fontSize} ${port.port.length * fontSize * .64 - 5} ${(-fontSize + fontSize * 0.2) / 2} ${port.port.length * fontSize * .64} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // x={0}\n            // y={-fontSize}\n            // height={fontSize * 1.2}\n            // width={port.port.length * fontSize * .65}\n            style={{ fill: colorsPalettes.generic.dark }}\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n          />\n          <text\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n            font-size={fontSize}\n            style={{ fill: 'white' }}\n            x={3}\n            y={0}\n            textAnchor=\"left\"\n          > {port.port} </text>\n        </g>\n\n      </animated.g>\n    </g>\n  )\n}\n\nexport default PortGroup;","/* DOCUMENTATION : API de ce TriangleChart\n\n  Principe :\n    Composant conu spcifiquement pour les triangles de la viz 3.1, mais pourrait tre dclin\n    -> permet de produire une srie d'objets en SVG, qui se disposent dans une grille en fonction de la longueur du dataset, et les dimensions de cette grille sont paramtrables\n\n  Paramtres : \n    data : donnes  afficher sur la carte,\n    totalWidth : largeur totale du composant (1 objet de lgende + grille d'objets) (par dfaut  1200 px)\n    legendWidth : largeur de la lgende (par dfaut  un dizime de la largeur totale)\n    margins : marges de gauche (entre l'objet de la lgende et la grille) et de froite (entr la droite de la grille et l'extrmit droite de l'cran)\n    rowHeight : hauteur d'une ligne de la grille (par dfaut  200px)\n    projection : on passe en paramtre la projection de d3 geo pour pouvoir donner accs au positionnement gographique sur une carte (permet dans le cas de la viz 3.1 de lier les triangles au point de localisation gographique du port qu'ils reprsentent => point et triangle sont nest dans un mme objet, ce qui permet d'tablir une courbe pointille entre eux et grer l'interaction avec des jeux d'opacit au hover)\n\n  Pistes d'amlioration : \n  - filtrer les objets  l'entre ? (par exemple pour la viz 3.1 on pourrait choisir d'afficher le triangle associ  un port que si les dimensions dpassent un certain seuil) => cela permettrait d'allger la carte, en affichant seulement les ports pour lesquels on a des donnes reprsentatives\n\n  @TODO : documenter ce component de maire standardise\n  */\n\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\nimport cx from 'classnames';\n\nimport './TriangleChart.scss'\nimport colorsPalettes from '../../colorPalettes';\n\n// import TriangleLegend from './TriangleLegend';\nimport PortGroup from './PortGroup';\n\n\nconst TriangleChart = ({\n  data,\n  totalWidth = 1200,\n  legendWidth = 0.1,\n  margins: inputMargins,\n  rowHeight = 200,\n  projection,\n  projectionTemplate,\n  atlasMode\n}) => {\n\n  const margins = inputMargins ||  {\n    left: totalWidth * .1,\n    right: totalWidth * .1\n  }\n  // {\n  //   left: 0.0,\n  //   right: 0.09\n  // }\n  const numberOfColumns = data.length;\n  const columnWidth = (totalWidth - margins.left - margins.right) / (numberOfColumns) // (totalWidth * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns; // (totalWidth) / (numberOfColumns + 4) //\n  const numberOfRows = data.length / numberOfColumns;\n  const totalHeight = numberOfRows * rowHeight;\n  const fontSize = totalHeight * 0.05;\n\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n    // ]).range([0, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n  ]).range([5, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([5, rowHeight * 0.85]); // pour l'instant j'ai mis le max de longueur  85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupe par le texte]\n\n  // const legendTriangleWidth = 35;\n  // const legendTriangleHeight = 60;\n\n  return (\n\n    <g className={cx(\"TriangleChart\", {'is-atlas-mode': atlasMode})}>\n\n      <defs>\n        <linearGradient id=\"TriangleGradient\" x2='0%' y2='100%'>\n          <stop offset=\"10%\" stopColor={`rgb(100,100,100)`} stop-opacity={0.6} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} />\n          {/* <stop offset=\"20%\" stopColor={colorsPalettes.generic.dark} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} stop-opacity={0.3} /> */}\n        </linearGradient>\n      </defs>\n      {/* <TriangleLegend\n        {\n        ...{\n          legendWidth,\n          totalWidth,\n          totalHeight,\n          legendTriangleWidth,\n          legendTriangleHeight,\n          rowHeight,\n          fontSize,\n        }\n        }\n      /> */}\n      <g className=\"triangles\">\n        {\n          // sorting groups regarding their projected projection on the horizontal axis (to avoid lines crossings)\n          data.sort((a, b) => {\n            const [xa] = projection([+a.longitude, +a.latitude]);\n            const [xb] = projection([+b.longitude, +b.latitude]);\n\n            if (xa > xb) {\n              return 1;\n            }\n            return -1;\n          })\n            .map((port, index) => {\n\n              return (\n                <PortGroup\n                  key={index}\n                  {\n                  ...{\n                    numberOfColumns,\n                    port,\n                    scaleX,\n                    scaleY,\n                    legendWidth,\n                    columnWidth,\n                    totalHeight,\n                    totalWidth,\n                    projection,\n                    index,\n                    margins,\n                    rowHeight,\n                    fontSize,\n                    projectionTemplate\n                  }\n                  }\n                />\n              )\n            })\n\n        }\n        <defs>\n            <marker id=\"triangle-left\" viewBox=\"0 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.02}\n              orient=\"auto\">\n              <path d=\"M 10 0 L 0 5 L 10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n            <marker id=\"triangle-right\" viewBox=\"-10 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.024}\n              orient=\"auto\">\n              <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n          </defs>\n      </g>\n\n    </g>\n  )\n\n}\n\nexport default TriangleChart;","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Poitou': '#668EDB',\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produits coloniaux': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites les': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indtermin suppos Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-R': '#277262',\n    'Saint-Martin le de R': '#277262',\n    'Tonnay-Charente': '#5AD0F4',\n    'Marans': '#67CBB6',\n    \"Les Sables-d'Olonne\": '#668EDB',\n    \"Sables d'Olonne\": '#668EDB',\n    'Marennes': '#A7E6F9',\n    'Charente': '#A7E6F9',\n    'Alligre': '#349883',\n    \"Tous les bureaux\": \"grey\"\n  },\n  tonnageClasses: {\n    '100%': '#A07BEE',\n    '75% ou plus': '#41BEA3',\n    'moins de 75%': '#FEA43B',\n  },\n  franceAlone: {\n    'France': '#41BEA3',\n  },\n  portsTreemaps: {\n    'France (rgion PASA)': '#41BEA3',\n    'Indtermin': 'rgb(240,240,240)',\n    'zone maritime': '#98a9d9',\n    'multi-Etat': '#a42e0d',\n    'France (hors rgion PASA)': '#FED63B',\n\n    'Hambourg': '#F7E0DE',\n    'Duch d\\'Oldenbourg': '#F3D1CE',\n    'Prusse': '#EFC1BD',\n    'Lubeck': '#E7A39C',\n    'Brme': '#EBB2AD',\n    'Mecklenbourg': '#E3938C',\n    'Autriche': '#bd6a62',\n\n    'Grande-Bretagne': '#A07BEE',\n    'Provinces-Unies': '#2759e3',\n    'Danemark': '#8e7bee',\n\n    'Etats-Unis d\\'Amrique': '#EBB2AD',\n    'Pologne': '#804a45',\n    'Russie': '#804a45',\n    'Espagne': '#e35027',\n    'Portugal': '#e35027',\n  }\n}\n\nexport default colorsPalettes;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.29,\"time\":257400,\"words\":858}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`La France du dix-huitime sicle se caractrise par le fort dynamisme des ports et des hinterlands de la faade atlantique, stimuls par le commerce avec les Antilles et une demande europenne en biens de consommation en hausse. La guerre maritime qui commence en 1793 et qui se poursuit pendant plus de vingt ans, entranant la perte dfinitive de Saint-Domingue en 1804 et de lle de France (le Maurice) en 1815, sonne le glas de cette dynamique et dplace le centre de lconomie franaise vers lintrieur. `}</p>\n    <p>{`Ltude de cas prsente ici sintresse  la navigation et au commerce maritime des ctes poitevines et charentaises  la veille de la Rvolution. Cela correspond  la direction des fermes de la Rochelle et  la faade maritime des provinces du Poitou, de lAunis, de la Saintonge et de lAngoumois (rgion PASA). Cette aire possde un dense maillage portuaire, avec une quarantaine de ports en activit. Certains ne font que du cabotage micro-local, dautres intgrent petit et grand cabotage, dautres enfin sadonnent galement  une navigation de long-cours. Cette rgion se prte donc particulirement  une tude portant sur larticulation entre les diffrentes chelles du commerce maritime  laube de la Rvolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Nous reconstituons lhistoire maritime et commerciale de la rgion PASA  partir de deux sources historiques. Dune part, nous disposons de traces administratives de la navigation maritime grce aux redevances qui psent sur celle-ci sous lAncien Rgime. Les registres des congs rpertorient les navires  leur dpart dun port et le montant d, qui varie le plus souvent selon leur tonnage et leur destination. Ces registres, rdigs par les greffiers de lamiraut locale, ont t numriss et structurs dans une base de donnes appele `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`. Elle compte entre autres plus de 32 000 congs pour lanne 1787 pour lensemble des ports franais, et quelque 6 900 congs pour 1789 relatifs  les ctes poitevines et charentaises.`}</p>\n    <p>{`Les registres des congs nous permettent de reprer les dates de dpart des btiments, ainsi que diverses informations relatives  lobjet de leur voyage, leur tonnage, leur capitaine, etc.. Ces donnes ne sont cependant pas dnues dincertitude : comme nous le verrons, le tonnage des navires est parfois surestim dans certains ports. Aussi, dans le cadre de la prsente tude, nous avons pris en compte litinraire dclar par les capitaines de navires au moment du dpart, tout en tant conscient que la dclaration ne correspond pas ncessairement au voyage effectif. Les congs permettent toutefois une bonne mesure des trafics de la rgion de La Rochelle, y compris  toute petite chelle, tout en demandant une attention fine  la dimension dincertitude inhrente  la source mobilise.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`Dautre part, nous disposons de traces administratives relatives au commerce de la rgion PASA. La base de donnes `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{` se fonde sur la numrisation des documents du Bureau de la balance du commerce de 1716  1821. Ces documents ont t produits grce aux services des Fermes : chaque bureau des Fermes enregistrait localement les tats de sortie et dentre des marchandises entre la France et ltranger. Plus de 550 000 flux de sortie / entre ont t documents dans la base de donnes Toflit18. La direction des fermes de La Rochelle correspondait  la faade maritime de la rgion PASA.`}</p>\n    <p>{`Grce aux donnes de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les sept diffrents bureaux de ferme de la rgion PASA et les partenaires trangers du royaume de France. Les informations que lon peut extraire de ces flux sont, entre autres, le nom du produit chang, la quantit, la valeur, le partenaire commercial, et lentit administrative ayant enregistr le flux au niveau local. En 1789, elles prcisent en outre, sauf pour le commerce de rexportation des denres coloniales, lorigine du produit commercialis (ville ou province franaise, ou tat tranger). Elles fournissent donc des informations complmentaires  celles donnes par les sources relatives  la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congs de navigation et donnes du Bureau de la balance du commerce rendu possible par les bases de donnes Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de prciser les flux et leur valeur pour ce qui est du commerce international, et dexplorer les relations et larticulation entre les diffrents trafics de cette rgion.`}</p>\n        <p>{`La prsente tude de cas dcrit en trois temps lhistoire de la rgion PASA  laube de la Rvolution franaise. Dabord, nous constatons la relative perte dimportance et de diversit commerciale de la rgion  la suite de la perte du Canada par le royaume de France durant la guerre de Sept Ans. Nous proposons ensuite une analyse dtaille de la restructuration de la rgion en relation avec cet vnement, selon des filires spcialises qui associent des ports particuliers avec le commerce de produits spcifiques. Nous dmontrons enfin que, bien que dominant dans sa rgion, le port de la Rochelle ne structure pas en 1789 la rgion au profit dun rseau dchange plus diversifi.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Todo intro en`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"7 min read\",\"minutes\":6.045,\"time\":362700,\"words\":1209}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-dclin-de-la-rgion-de-la-rochelle-suite--la-perte-du-canada\"\n    }}>{`Partie 1. Le dclin de la rgion de La Rochelle suite  la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, la France a pleinement profit du dveloppement des relations conomiques entre lAfrique, lAmrique et lEurope. L Atlantique franais reposant sur la traite des Africains et leur exploitation dans les les franaises (Antilles et Mascareignes) a connu son apoge juste avant la rvolte des esclaves de Saint-Domingue en aot 1791 et le dbut de la guerre maritime avec lAngleterre en fvrier 1793. Lancienne rgion Poitou-Charente, correspondant approximativement aux gnralits de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une longue tradition maritime  son actif et tait bien situe pour bnficier de cette phase de prosprit. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`Lexamen du commerce avec les pays trangers et les colonies de la direction des Fermes de La Rochelle, qui tait leur faade maritime, montre toutefois un dynamisme limit. Il y a bien eu croissance du commerce, mais cette croissance a t plus lente que celle des autres grands ports du royaume. Cela sexplique en grande partie par les relations privilgies de la direction de la Rochelle avec le Canada. Dune part, celui-ci se dveloppe beaucoup moins vite que les Antilles, et la rgion souffre de ce manque de dynamisme durant la premire moiti du sicle. Dautre part, le Canada est cd aux Anglais lors du trait de Paris qui clt la guerre de Sept Ans en 1763. Qubec avait dj t pris en 1759. Cette perte est svre pour la rgion dont le commerce entame alors un recul relatif trs net. La trajectoire de la rgion de la Rochelle contraste ainsi avec celles de Bordeaux et de Nantes dans la seconde moiti du sicle. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et sa part du commerce franais ne cesse daugmenter jusquen 1789. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`Aprs une anne exceptionnelle en 1747, qui sexplique par lorganisation de convois transatlantiques au dpart de La Rochelle escorts par la Marine pour chapper aux prdations britanniques, la direction de La Rochelle effectue 4,6% du total du commerce franais en 1750. En 1789 sa part ne reprsente plus que 2,2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`Le recul de La Rochelle nest pas que quantitatif. En 1750, les donnes de la direction des Fermes de La Rochelle, charge de la collecte des droits sur le commerce extrieur et colonial, montrent que cette partie du territoire commerce 21% des types de biens changs par la France (645 sur 3055, aprs `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source\" target=\"blank\" rel=\"noopener noreferrer\">{`uniformisation des variations orthographiques`}</a>{`). En 1789, elle nen commerce plus que 7% (248/3565). Cette forte rduction de la typologie des biens commercialiss sobserve  la fois pour les exportations et pour les importations.  un niveau plus agrg de typologie des produits, parmi les 150 secteurs de la `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\" target=\"blank\" rel=\"noopener noreferrer\">{`classification Rvolution et Empire, utilise dans le cadre du programme ANR Toflit18`}</a>{`, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diversifies en 1750 quen 1789. Lindice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Un bien pour lequel il ny a pas beaucoup de concurrence nationale (les eaux-de-vie) et deux denres coloniales rexportes (le caf et le sucre) dominent en 1789 les exportations. Les toiles de coton, souvent rexportes en direction de lAfrique, viennent en quatrime place, suivies du sel (dont la valeur est faible par rapport au tonnage quil mobilise, car cest une marchandise trs pondreuse). En 1750, la mercerie et les toffes de laine font partie des cinq principales exportations (avec lindigo, les eaux-de-vie et le sucre : le sel est en 14e position). `}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`La direction des Fermes de La Rochelle sest donc spcialise dans les produits agricoles et les rexportations de denres coloniales, au dpens des biens manufacturs de la rgion. Ce constat ngatif est toutefois nuanc par lintensit capitalistique de la production deaux-de-vie qui la rapproche des biens manufacturs. La spcialisation et limportance de ce produit dexportation ressort avec vidence en comparant la part de la direction des Fermes de La Rochelle  la moyenne nationale.`}</p>\n    <p>{`Nous ne connaissons pas la destination des rexportations coloniales en 1789. En les excluant, on constate que la concentration des marchs de la direction des Fermes de La Rochelle est la mme en 1750 et en 1789 (entre 0,41 et 0,44), mais que lAngleterre a pris la place de lAmrique (terme qui dsigne en 1789 essentiellement les Antilles franaises). Cela est confirm par la distribution des tonnages des navires partant depuis la rgion PASA vers ltranger en 1789 : lAngleterre y a une part trs importante.`}</p>\n    <p>{`Pour aller vite, on pourrait rsumer en disant que la direction des Fermes de La Rochelle nexporte plus des biens diffrencis vers le Canada, mais essentiellement des eaux-de-vie vers lAngleterre. Du point de vue de la navigation, le fort tonnage destin  ce type de commerce est infrieur  celui engag pour lexportation du sel vers les mers du Nord et Baltique.`}</p>\n    <p>{`Les donnes de la navigation collectes ne nous permettent pas de contribuer  lanalyse du dclin de cette rgion: dune part, car navons le dtail des sorties que pour la fin de lAncien Rgime, ce qui empche une analyse diachronique. Dautre part, car les donnes collectes pour 1789 napportent que des informations limites pour ce qui est des produits transports: les congs du port de La `}</p>\n    <p>{`Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports de la rgion le greffier se limite le plus souvent  noter seulement larticle principal qui compose la cargaison. Les registres des congs indiquent, toutefois, les destinations de chaque navire sorti et cette donne permet de constater un relatif clatement des marchs de cette rgion. `}</p>\n    <Caller id=\"partie-1-ports-destinations\" mdxType=\"Caller\" />\n    <p>{`Sans que lon puisse affirmer quil sagit dune nouveaut, la marginalisation de la rgion vers la fin de lAncien Rgime est confirme par son manque de capacit  assurer ses propres trafics. La navigation avec ltranger est assure,  90%, par des pavillons trangers ou extrieurs  la rgion tudie. Il sagit, pour lessentiel, des pavillons britannique et nord-europens. Parmi les ports de la rgion, seul La Rochelle joue un rle, mais comme nous le verrons (partie 2.1), cette navigation est lie aux activits de traite et au commerce colonial. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`Cette incapacit de la rgion  assurer les exportations vers ltranger nest pas lie  une absence dactivit maritime: au contraire, si on additionne le total des sorties de navires depuis les ports de la rgion tudie en 1789, toute destination confondue, on mesure que les btiments rgionaux assurent une partie considrable des trafics, suprieure  celle assure par les navires des autres ports franais, alors que la part de la navigation trangre est trs minoritaire. Toutefois, la part de navigation sous pavillon franais assure par les navires de la rgion tudie, est infrieure  celle de la plupart des autres provinces franaises: en 1787, les ports de lAunis-Saintonge-Poitou assurent 51.6% du tonnage quils expdient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne. La rgion nest donc pas trs dynamique,  la fin de lAncien Rgime, en matire darmement.`}</p>\n    <Caller id=\"partie-1-ports-dattache\" mdxType=\"Caller\" />\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 1 intro`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":16.005,\"time\":960300,\"words\":3201}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spcialisation-portuaire--le-cas-de-la-traite-ngrire-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spcialisation portuaire : le cas de la traite ngrire, du commerce du sel et de leau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" bureaux=\"tous,La Rochelle,Rochefort,Saint-Martin-de-R,Les Sables-d'Olonne,Marennes,Charente,Marans,Tonnay-Charente\" mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La rgion PASA se caractrise par une densit importante de ports qui entretiennent des relations plus ou moins tendues et plus ou moins intenses avec le reste de la France et du monde. Limportance de leurs mouvements maritimes et des tonnages nest pas directement corrle  la valeur des marchandises transportes. Ainsi, les deux bureaux des Fermes qui dominent en valeur des exportations sont ceux de La Rochelle, trs li au commerce colonial et ngrier, et de Tonnay-Charente, exportateur deau-de-vie essentiellement vers la Grande-Bretagne. Par contre, lactivit portuaire de Marennes (exportateur du sel vers les ports de la mer du Nord et de la Baltique) est en tonnage la plus importante de la rgion mais ses exportations sont de faible valeur. Les importations sont domines par les ports du bureau des fermes de La Rochelle (cest  dire, essentiellement, La Rochelle), en raison de la forte valeur des produits coloniaux. La balance du commerce de Rochefort, qui importe des matires premires navales, est trs dficitaire.`}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Nos analyses ont certes montr que`}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{` les tonnages enregistrs  Marennes semblent `}</a><a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{`surestims  20%`}</a>{`, et mme  50% dans 10% des pires cas, mais cela ne remet pas en cause la primaut de ce port. La carte, qui reprsente le tonnage expdi en 1789,  partir des congs dlivrs aux navires, toutes destinations confondues, met en outre en vidence le caractre trs internationalis des transporteurs dans les ports exportateurs de sel vers ltranger (Noirmoutier et lle de R) et deau-de-vie (Tonnay-Charente), ainsi que  Rochefort, largement approvisionn par les marines du Nord qui y apportent les matriels ncessaires  larsenal. Ce sont ces transporteurs qui assurent la presque totalit du commerce avec ltranger (hors traite) de la rgion PASA. Comme nous le verrons `}<a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{`dans la partie 3`}</a>{`, La Rochelle na plus un rle structurant pour les ports de cette rgion: dautres ports entretiennent des relations avec ltranger et avec les marchs franais, en commercialisant les productions locales, sans que la chane logistique ne passe par La Rochelle.`}</p>\n    <p>{`Cette section propose une tude de trois ports de la rgion  la fin de lAncien Rgime afin de montrer la diversit des produits quils commercialisent et de leurs marchs. De par ses relations exclusives avec les colonies et surtout son investissement dans la traite ngrire, La Rochelle mrite une tude  part. Limportation de quantits considrables de denres coloniales, majoritairement r-exportes vers lEurope du Nord, met ce port dans une situation unique. Pour le commerce des eaux-de-vie, nous tudierons le cas de Tonnay-Charente. La mention de leau-de-vie parmi les cargaisons indiques par les congs tant rare, il faudra se tourner dabord vers les sources de la Balance du commerce, pour affiner ensuite les donnes par lanalyse de la navigation. `}</p>\n    <Caller id=\"sorties-de-sel\" mdxType=\"Caller\" />\n    <p>{`Plusieurs autres ports de la rgion, enfin, se consacrent prioritairement  lexportation du sel, comme on peut le constater sur le diagramme: Ars-en-R, Noirmoutier et surtout Marennes mobilisent de flottes dpassant en 1789 les 10000 tonneaux pour sa commercialisation. Nous dvelopperons ici en dtail le cas de Marennes, principal port exportateur de sel, dont la particularit est de miser largement sur lapprovisionnement du march national.`}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" bureaux=\"tous,La Rochelle\" mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, les colonies antillaises augmentent trs considrablement leur production de sucre, caf, indigo et produits tinctoriaux, pour rpondre  la hausse de la demande europenne. La croissance de la production passe par un nombre de plus en plus lev de plantations, qui ont un recours massif  une main-duvre desclaves, que les Europens dportent par centaines de milliers depuis lAfrique dans le cadre de la traite ngrire. Ce commerce transatlantique dtres humains, achets sur les ctes dAfrique par les ngriers europens, a commenc au XVe sicle, mais il atteint son apoge au dix-huitime sicle, lorsque 6 millions dAfricains sont dports aux Amriques. La moiti dentre eux est vendue aux Antilles. On estime  un million le nombre dAfricains introduits dans les colonies franaises au dix-huitime sicle. La principale destination est la colonie de Saint-Domingue (aujourdhui Hati) qui compte,  la veille de la grande rvolte de 1791, un demi-million desclaves, dont plus de la moiti sont ns en Afrique. Alors que dans la plupart des ports ngriers franais, la part des armements ngriers est nettement infrieure  celle des armements en droiture vers les Antilles, cela nest pas le cas  La Rochelle: sur les 15 dparts de 1789 depuis ce port destins  approvisionner les Antilles en hommes ou en produits, 12 sont des ngriers qui font voile tout dabord vers les ctes africaines dans le cadre dun circuit triangulaire.. Comme  Honfleur, il y a donc clairement, en matire de trafics transatlantiques, une spcialisation ngrire rochelaise. En 1789, les 12 ngriers partis de La Rochelle sont tous arms par des ngociants rochelais. Trois autres ngriers partent depuis Rochefort. `}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" bureaux=\"tous,La Rochelle\" minTonnage=\"100\" mdxType=\"Caller\" />\n    <p>{`Lactivit ngrire est aux mains darmateurs privs qui esprent raliser un profit lors de la revente des captifs aux Antilles. Si Nantes est le principal port ngrier franais, La Rochelle a jou un rle significatif, tout particulirement dans les annes 17301740 : entre 1713 et 1744, La Rochelle arme 15% des expditions ngrires franaises; sa part tombe  11% aprs la perte du Canada, en sorte que si La Rochelle est le deuxime port ngrier le plus important en France avant 1763, il passe au 4e rang par la suite.`}</p>\n    <p>{`Malgr un dclin relatif, lactivit ngrire rochelaise augmente en termes absolus : les armateurs rochelais passent de 4,3 armements ngriers par an pour la priode 17131744  12,5 armements par an dans la dcennie 17831793. Pendant cette dernire dcennie, la traite est vritablement lactivit principale, voire presque exclusive, des armateurs rochelais : en 1789, sur un total de 200 dparts depuis le port de La Rochelle de navires arms par des Rochelais, un peu plus de la moiti des tonnages se dirigent vers lAfrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se rpartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers ltranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dpasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dpassant le 50 tonneaux (le plus grand faisant 827 tonneaux) sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et ngrier. `}</p>\n    <p>{`Ds lors quon carte la poussire des caboteurs, limportance des destinations africaines et des colonies est lisible sur ce schma, qui reprsente les destinations des navires sortis du port de La Rochelle en 1789, tout port dattache confondu. Tous les navires qui se dirigent vers les Amriques, les Antilles ou locan Indien sauf un sont par ailleurs arms par des armateurs de La Rochelle. `}</p>\n    <p>{`Au total, dans les dernires annes de lAncien Rgime, une douzaine de navires reviennent chaque anne  La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour dune expdition ngrire aprs une tape aux Antilles. Les donnes de la Balance du commerce confirment la centralit du commerce colonial et ngrier : en 1789, les exportations vers lAfrique reprsentent 23% du total des exportations du bureau des Fermes de La Rochelle, alors que 73% est constitu par les r-exportations des denres coloniales. La valeur des produits ramens est estime, en 1789,  7,1 millions de livres tournois, dont 5,1 sont rexports  ltranger. Les ngociants rochelais semblent stre taills une position forte dans le march du caf, ce qui peut sexpliquer par la leurs liens quasi-exclusifs avec Saint-Domingue o plusieurs grandes familles de la ville (Belin, Garesch, Poupet Rasteau) sont trs bien implantes. Saint-Domingue fournit en effet la presque totalit du caf import en France depuis les Antilles.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Si les donnes collectes par la Balance du commerce ne permettent pas de connatre les destinations des rexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative. Les Pays-Bas autrichiens (actuelle Belgique), les Provinces-Unies, Brme, Hambourg, les ports de la Baltique reoivent chacun de navires totalisant entre 500 et 550 tonneaux. Parmi les autres destinations europennes des navires partis de La Rochelle, seule la Grande-Bretagne (1 048 tonneaux) nest vraisemblablement pas destinataire des produits coloniaux, car elle sapprovisionne dans ses propres colonies. `}</p>\n    <p>{`Ds lors, il nest pas surprenant que le ngoce rochelais porte toute son attention aux questions lies au commerce colonial et ngrier. Cela apparat clairement parmi les sujets discuts par la chambre de commerce de La Rochelle. Lindexation faite  la main,  lpoque, sur la marge des registres de dlibrations de la Chambre de Commerce de La Rochelle permet de constater que dans la seule anne 1789, le commerce dAfrique est discut  une trentaine de reprises, et les colonies  une cinquantaine des reprises, le commerce de lInde  9 reprises;  titre de comparaison, le commerce avec ltranger est abord 11 fois en tout, et la pche (avec notamment la question de la concurrence et de ladmission de la pche tats-unienne, trs dbattue cette anne l en France), 17 fois. Parmi les produits indexs au marge des registres de dlibrations, les comestibles sont mentionns 16 fois - ce qui dans la conjoncture cralire particulire de lpoque nest gure tonnant-, leau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure, en dpit dun critre sans doute grossier, que le regard des membres de la Chambre de commerce est clairement riv sur les colonies et la traite. `}</p>\n    <p>{`Si la question de la traite semble absente des cahiers de dolances de la rgion (lanalyse porte sur un chantillon de 163 cahiers sur les 522 rdigs dans lensemble de la rgion PASA), la dfense des intrts coloniaux apparat, significativement, uniquement dans le cahier de dolances du Tiers-tat de la ville de La Rochelle, dont les reprsentants envoys  Versailles demanderont la rvocation de larrt rendu au conseil du roi, le 30 aot 1784, concernant le commerce tranger dans les colonies, et le rtablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrs quont faits la navigation franoise et la culture des isles franoises de lAmrique. Larrt en question est celui qui a largi lexclusif mitig, introduit en 1767, en facilitant lapprovisionnement des colonies par les navires trangers dans des conditions restrictives prcises. Ladmission de navires trangers aux colonies a provoqu les protestations de toutes les chambres du commerce de France concernes par le commerce colonial, car le ngoce franais refuse toute concurrence. Ce qui est intressant cest toutefois que nous ne sommes pas ici dans le cadre dun document qui mane de la Chambre de commerce ou dun groupe darmateurs: le cahier de dolances du Tiers de La Rochelle se fait donc le porte-parole des intrts du ngoce colonial franais, et demande galement des lois interdisant la rexportation des sucres bruts afin dencourager les raffineries locales. Enfin les dputs demanderont la rvocation de larrt du 14 avril 1785 , qui a cr une nouvelle compagnie des Indes et de celui pour ladmission des trangers dans les isles de France et de Bourbon (cest --dire  lle Maurice et  la Runion), mme si pendant lpoque du commerce libre (17691785), les armements vers locan Indien ou la Chine depuis La Rochelle (26) ont t infrieurs  ceux de Nantes (44), Bordeaux (41), Marseille (42) ou Saint-Malo (32) et bien sr de Lorient (120). `}</p>\n    <p>{`La participation rocheloise  la navigation au-del du cap de Bonne-Esprance  la fin de lAncien Rgime est en effet modeste: ltat des exportations de 1789, nindique que 38 060 livres tournois exports vers lInde, et rien vers les Mascareignes. Ces donnes semblent toutefois incompatibles avec le dpart du navire Henri IV pour lle de France et lle Bourbon, le 9 mai 1789, qui arrive  bon port en fvrier 1790, et qui nest pas un ngrier `}{`[`}{`Toussaint, 1967, p. 291`}{`]`}{`  moins que sa cargaison ne vienne entirement dautres directions de Fermes du royaume. En 1787, ce sont trois navires qui partent de La Rochelle vers les Mascareignes : une certaine diversification des armements coloniaux apparat donc, ici comme  Bordeaux, dans les annes 1780, lorsque la baisse des profits du commerce antillais incite  chercher des investissements plus rentables.`}</p>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de leau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} bureaux=\"Charente, Saint-Martin-de-R, Rochefort,Tonnay-Charente\" mdxType=\"Caller\" />\n    <p>{`Les congs de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux deau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin dannoter les cargaisons (il le fait 12 fois sur un total de 601 dparts): nous avons donc un aperu global de la navigation, sans pouvoir distinguer la nature des produits. Lanalyse mene sur les sorties de lanne 1787 permet toutefois didentifier les rseaux commerciaux. 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent  ltranger (en Angleterre pour les deux tiers, le reste vers les les anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent  Dunkerque. On identifie ici la flotte europenne de leau-de-vie, qui reprsente 22% du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, compos dune poussire de petits caboteurs (tonnage moyen 35 tx) et qui reprsente tout de mme 30% du tonnage sortant. Ces navires sont aligns sur une destination unique: La Rochelle. Ils sont pour partie occups  lapprovisionnement de la ville et peut-tre  un commerce rgional ou national: en revanche, La Rochelle a perdu le rle dentrept pour le commerce international de leau-de-vie quelle avait dans les annes 1730. Les principales maisons de ngoce deau-de-vie, en particulier Martell, nont plus de bureaux  La Rochelle en 1789: leurs bureaux principaux ont t rapatris  Tonnay-Charente et/ou dplacs  Paris. Enfin, des units plus modestes (25 tx en moyenne) voluent au sein de la mer des Pertuis (depuis la Seudre sud jusquaux Sables dOlonne) : elles reprsentent 23% du tonnage  la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congs dlivrs en 1787 dans ce port concernent les navires avalant et attachs  des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrire et les produits manufacturs de larrire-pays  Tonnay-Charente, leurs matres quittent ce port soit  vide, soit avec une cargaison destine  Rochefort, La Rochelle ou bien aux ports de la mer des Pertuis, qui leur fournissent un fret de retour pour leur navigation vers lamont du fleuve Charente. `}{`]`}</p>\n    <Caller id=\"exports-eau-de-vie-la-rochelle-longitudinal\" mdxType=\"Caller\" />\n    <p>{`Les exportations deau-de-vie charentaise en 1789 sont trs suprieures  la moyenne sculaire. Lexplication rside en partie dans les modifications induites par le Trait dEden de 1786, qui entrane une augmentation extrmement importante des exportations deau-de-vie vers lAngleterre, notamment des eaux-de-vie de qualit produites dans la rgion de Cognac, au dtriment de celles de moindre qualit. Le total des exportations deaux-de-vie franaises vers la Grande-Bretagne passe de 10  15 millions de livres tournois dans les annes 176070,  40 millions en 178789.`}</p>\n    <Caller id=\"exports-eau-de-vie-comparaison-directions-des-fermes\" mdxType=\"Caller\" />\n    <p>{`La Rochelle domine les exportations deaux-de-vie franaises en 1750, mais est dpasse par Bordeaux en 1770, qui exporte, en concurrence avec la Direction des fermes de la Rochelle, des eaux-de-vie de lAngoumois. Par contre, lexplosion des exportations vers lAngleterre permise par le trait Eden-Reynald de 1787 bnficie beaucoup plus  La Rochelle qu Bordeaux. Nantes stagne alors que les exportations depuis Bayonne et Montpellier croissent.`}</p>\n    <Caller id=\"origines-exports-eau-de-vie-1789-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Parmis les zones de production, lAngoumois domine, suivi par lAunis. Les valeurs exportes en eaux-de-vie double (ie  teneur dalcool plus lev) sont comparables  celles de eaux-de-vie simples. La dnomination eaux-de-vie double nexiste que dans les chiffres de 1788 et 1789 et que dans les donnes issues de la rgion PASA, indiquant peut-tre les progrs des techniques de distillation dans la rgion.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} bureaux=\"Saint-Martin-de-R, Marennes\" mdxType=\"Caller\" />\n    <p>{`Denre pondreuse de faible valeur, le sel voyage ds que cela est possible par voie maritime. Les ctes de la rgion PASA sont, comme celles du sud de la Bretagne, de trs grands producteurs de sel. Marennes est un port dsign comme fournisseur par ladministration des gabelle il approvisionne entre autres les greniers  sel de Libourne, de Honfleur, et de Saint-Valry-sur-Somme. Ses marchs sont donc avant tout nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment  la grande pche. Ltranger (pays de la mer du Nord et du pourtour de la Baltique) y est un partenaire moins important que pour Saint-Martin-de-R ou Noirmoutier. `}</p>\n    <Caller id=\"sorties-de-marennes\" mdxType=\"Caller\" />\n    <p>{`Cest pourquoi, en quantit, le bureau des fermes de Marennes est le principal exportateur de sel en France, si lon inclut aussi les livraisons vers les ports francs franais. Il vient en troisime position, derrire les bureaux du Croisic et de Saint-Martin-de-R, si on se limite aux marchs extrieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas leves compares  celles des flux commerciaux dont il a t question pour La Rochelle et Tonnay-Charente: le sel export depuis Marennes, y compris  destination des ports francs franais, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers ltranger). En revanche, son commerce alimente un mouvement portuaire extrmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la rgion tudie. Son commerce maritime est donc une activit importante, tant pour la production locale quil soutient, que pour lactivit induite lie  son transport (construction navale, emploi maritime). Comme on la vu plus haut (partie 1), les transporteurs ne sont pas de Marennes mme, et les retombes concernent donc aussi bien les ports de cabotage de la rgion que ceux du littoral atlantique franais.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" mdxType=\"Caller\" />\n    <p>{`Les donnes sur la navigation aident  prciser la gographie commerciale du sel export, mme si elles nindiquent pas les quantits exportes.  compter du rgne de Louis XIV, la lgislation relative aux gabelles fait obligation au chargeur de naviguer avec une cargaison complte. Le tonnage des navires chargs de sel est donc un assez bon indicateur des quantits exportes. Les congs confirment que, parmi les ports exportateurs de la rgion tudie, la primaut revient incontestablement  Marennes: en 1787, le tonnage additionn de navires sortis de ports franais avec du sel y est de plus du double qu Ars-en-R, le deuxime grand exportateur de la rgion. Mme en prenant en compte la survaluation des tonnages de navires  Marennes, que nous avons constate en comparant le tonnage dun mme navire relev en plusieurs ports, Marennes demeure le principal fournisseur de sel en France. `}</p>\n    <p>{`Lexportation de sel est en outre une activit quasi exclusive  Marennes : sur 1174 dparts en 1787, 990 ont charg du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de leau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 2 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"9 min read\",\"minutes\":8.245,\"time\":494700,\"words\":1649}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`En 1789, les navires qui sortent des ports exportateurs de sels (Marennes, Rochefort, Ars-en-R) ont un tonnage moyen plus important que ceux sortant de La Rochelle. De manire plus surprenante, la quantit de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de R, voire mme Rochefort - tmoigne dun dynamisme qui chappe largement au port dominant, La Rochelle. Cette particularit sinscrit dans une histoire maritime longue de la rgion PASA.`}</p>\n    <p>{`Jusqu la perte des colonies nord-amricaines, le port de La Rochelle a cultiv une certaine spcificit gographique. Quoique le port de La Rochelle pratiquait, comme la presque totalit des ports atlantiques, le commerce antillais et ngrier, une part importante et qui a progressivement augment jusqu reprsenter plus de la moiti de ses armements pour les colonies dans les annes 1750 tait constitue par le commerce nord-amricain - Canada, Louisiane et pcheries de Terre-Neuve. Cette spcificit gographique a galement influ sur sa spcialisation par produits. Le commerce des fourrures est ainsi une spcialit rochelaise jusquau dbut des annes 1760. Les fourrures taient importes non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de lOhio. Ces fourrures taient pour partie r-exportes en France et en Europe (principalement vers lespace allemand et en Suisse). Une part importante, les peaux de castors en particulier, ntait pas rexporte, mais alimentait lindustrie de chamoiserie niortaise et dautres localits franaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matires premires et en produits manufacturs. LAmrique du Nord tait donc un dbouch important et facile pour les crales de la rgion, les toffes locales de basse qualit et, dans une moindre mesure, le sel ncessaire aux pcheries de Terre-Neuve. Ce commerce quoique modeste avant les annes 1740 fournissait des volumes importants demploi dans ces trois secteurs de lconomie rgionale et contribuait  faire du port de La Rochelle, le centre de gravit du complexe portuaire rgional. Cette domination tait renforce par la prpondrance des capitaux rochelais, investis de manire prioritaire dans le commerce Atlantique - nord-amricain et antillais. La domination rochelaise se mesurait notamment au dbut du sicle par la prsence des bureaux principaux des maisons de Cognac  La Rochelle. Mais, ds la crise qui suivit la chute du systme de Law, La Rochelle commena  perdre sa place et Tonnay-Charente  saffirmer comme le principal port dexportation de leau-de-vie produite dans la rgion, et du Cognac en particulier. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Ainsi, mme si le port de la Rochelle a lascendant sur les autres ports de la rgion par la diversit des produits quil importe et exporte et, surtout, par son activit dans le commerce atlantique, les changes des ports de la rgion sont largement autonomes comme le montre le rseau des voyages de la rgion PASA de 1787 compar  ceux des deux autres rgions situes au nord (la Loire-Atlantique) et au sud (lAquitaine). Les indices de centralit (la betweeness centrality ou centralit dintermdiarit compte le nombre de plus courts chemins entre deux ports passant par le port donn ; le pagerank mesure la connexion relative  des ports eux-mmes bien connects. Voir `}<a href=\"https://fr.wikipedia.org/wiki/Centralit%25C3%25A9\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://fr.wikipedia.org/wiki/Centralit%C3%A9\"\n        }}>{`https://fr.wikipedia.org/wiki/Centralit%C3%A9`}</a></a>{`) ; compares avec dautres rgions domines par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacit  structurer les trafics maritimes locaux comme nous lavons illustr dans la partie 2 avec les exemples de la traite, du commerce des eaux-de-vie et du commerce du sel.`}</p>\n    <p>{`Ce constat peut tre li historiquement  la perte des colonies nord-amricaines (Canada et Louisiane) qui a bris une dynamique vertueuse qui stait tablie dans les annes suivant la guerre de succession dAutriche. En effet, avant 1748, le commerce des Antilles en droiture et la traite ngrire continuaient  dominer le commerce de la Direction de la Rochelle en valeur, tant donn le dynamisme limit de la demande manant de lAmrique du Nord. Mais, ds la fin de la guerre de Succession dAutriche, souvre une priode de croissance exceptionnelle pour le commerce avec lAmrique du Nord. Sur la priode 17481758, La Rochelle reoit annuellement plus de 1 million 300 mille livres de peaux dAmrique du Nord, soit presque autant en valeur que de sucre des Antilles (1 million 450 mille livres). Le nombre darmements  destination du Canada est multipli par deux alors que celui pour la Louisiane augmente de moiti. Par rapport aux annes prcdant la guerre, le trafic li au commerce triangulaire baisse en moyenne dun quart pour les Antilles et de plus de moiti pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et mme Dunkerque et Marseille. A linverse, les Rochelais ont un monopole de fait pour la Louisiane qui nintresse gure les ports plus importants et seul Bordeaux les concurrence pour lapprovisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilits complmentaires. Dun ct, le commerce  destination du Canada pouvait se transformer en commerce triangulaire invers - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les les  sucre en morue sale et, plus rarement, en crales. La Louisiane permettait galement de raliser des oprations de contrebande avec les colons espagnols, offrant la possibilit de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1991).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limit en volume, mais crateur demplois locaux et, au milieu du sicle, facteur dun dynamisme certain, scroule avec la perte des colonies franaises nord-amricaines  la fin de la guerre de Sept Ans. Cette perte dstructure durablement le commerce rochelais qui perd ses marchs privilgis et sa position dominante au sein du rseau portuaire rgional. En 1789, le commerce du port de la Rochelle est quasi exclusivement colonial : prs de 90% de ses exportations en valeur sont destins  la traite africaine et aux Antilles. Son impact dans la structuration de la rgion tudie apparat faible, alors que les autres bureaux de Fermes de la rgion exportent essentiellement des produits rgionaux, cela nest pas le cas dans le bureau de La Rochelle. Dautres ports, par ailleurs, sont nettement plus extravertis en termes de navigation. Le profil de La Rochelle devrait sapparenter  celui des autres grands ports coloniaux,  cela prs que Bordeaux exporte une partie consistante de produits rgionaux de son arrire-pays, quil contribue  structurer. Le Havre et Nantes, comme La Rochelle, nexportent pas, eux, essentiellement des produits de leur rgion. La part des voyages internes  la rgion est en revanche importante pour La Rochelle, mais cela reflte plus les ncessits de lapprovisionnement de la ville et de la rgion quun rle dentrept pour lexportation. Ainsi,  titre dexemple, le total du tonnage expdi du seul port de Ribrou-Saujon en 1789 vers La Rochelle avec de la chaux est de 1640 tonneaux. Quant  la quarantaine de navires qui sy rendent depuis Marennes, ils ont  bord du vin, des eaux-de-vie, du bois, des fves, des hutres, des meubles, des passagers, ou naviguent  vide.`}</p>\n    <p>{`Les graphiques que nous proposons illustrent fidlement nos propos. Ce dclin se donne  voir,  la veille de la Rvolution, sur le graphique en dbut de section, o linfrastructure de la rgion PASA apparat originale par le faible poids relatif de son port principal - La Rochelle - incapable de freiner le dveloppement des ports quil maintenait dans sa dpendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-R. Dans la priode pr-rvolutionnaire (17871789), les flux de navires comme de marchandises tmoignent ainsi de la recomposition de lconomie de la faade maritime. Dsormais, la valeur des flux de marchandises au dpart de Tonnay-Charente et  larrive de Rochefort, qui entretient directement les productions locales, se rapproche de ceux de La Rochelle.`}</p>\n    <p>{`Cette volution est la consquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des ngociants rochelais, consquence directe de la vague de faillites qui secouent le milieu  la fin de la guerre de Sept Ans; la fermeture des marchs nord-amricains subventionns qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite ngrire. Pour lanimer, les ngociants rochelais se procurent les marchandises ncessaires  ce commerce dans toute la France et lEurope et ne se fournissent que trs peu dans larrire-pays rochelais. Le port nest donc pas le point de passage oblig de son arrire-pays dans les relations avec le grand large, et ce, dautant plus, que la faiblesse capitalistique de la place loigne les maisons de commerce spcialises dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux  Tonnay-Charente ou  Paris. Mme dans le commerce colonial, La Rochelle doit faire une place aux autres ports de la rgion puisque Rochefort se voit accorder lautorisation de faire le commerce colonial, tmoignant du dclin conomique et politique du port.`}</p>\n    <p>{`Pour conclure, La Rochelle reste en 1789 un port relativement dominant dans la rgion, notamment en ce qui concerne le commerce atlantique, mais cette domination a largement diminu au cours du sicle. De plus, la spcialisation des ports de la rgion dans le sel pour les uns (Marennes, Rochefort, Ars-en-R), dans leau-de-vie pour les autres (Tonnay-Charente et, dans une moindre mesure, les ports de lle de R), nest plus articule par la place de La Rochelle. Le commerce colonial ne sappuie plus sur le rseau des ports et des places manufacturires locales, mais survit grce aux capitaux et aux marchandises venus dailleurs. Les guerres de la Rvolution et napoloniennes ont par la suite dmontr la fragilit et lartificialit dun tel dispositif. Le blocus anglais et linterdiction de la traite transatlantique sonnent pour le port de la Rochelle le glas de son destin de grand port commercial. `}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 3 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":15.55,\"time\":933000,\"words\":3110}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"-propos\"\n    }}>{` propos`}</h1>\n    <p>{`Le prsent site a t ralis dans le cadre du `}<a href=\"https://anr.portic.fr/\" target=\"blank\" rel=\"noopener noreferrer\">{`programme de recherche ANR PORTIC`}</a>{`. Ce programme porte sur les dynamiques de navigation et du commerce extrieur au dix-huitime sicle, un commerce qui seffectue largement par voie maritime. Outre la meilleure comprhension de ces dynamiques par le croisement de deux jeux de donnes, un enjeu fondamental du programme est de chercher des mthodes de qualification et dapprhension de lincertitude des donnes historiques, en exprimentant des modes de visualisation et dcriture appropris.`}</p>\n    <p>{`Dans ce cadre, le Working Package n5 de ce programme de recherche consiste  effectuer une srie dtudes de cas tirant parti de deux corpus existants de sources historiques numrises : `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`, une base de donnes portant sur lhistoire de la navigation pilote par Silvia Marzagalli et Christine Plumejeaud ; et `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{`, une base de donnes portant sur le commerce extrieur de la France, pilote par Loc Charles et Guillaume Daudin.`}</p>\n    <p>{`Ce site web sinscrit dans un mouvement second faisant suite aux premires entreprises de numrisation pour chacune des deux bases, en tentant de valoriser le travail dj accompli via ltude approfondie de sous-ensembles signifiants dans les donnes. Ces tudes clairent des questions disciplinaires existantes sous un nouveau jour grce aux nouveaux matriaux et mthodes offerts par les bases de donnes mobilises par le programme. Les questions souleves par une telle initiative sont multiples :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Comment mobiliser ensemble deux sources dont certaines dimensions sont incommensurables ou difficiles  mettre en quivalence ? `}</li>\n      <li parentName=\"ul\">{`Comment croiser les donnes numrises des deux bases avec des connaissances plus denses et qualitatives sur les phnomnes tudis, apportes par des historiens spcialistes de la rgion tudie ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte, au moment de lenqute et du raisonnement, limportante stratification de transformations, de rductions et de dcisions interprtatives constituant la chane qui relie les sources initiales avec les donnes qui en ont t tires ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte lincertitude ou lincompltude des donnes tout en proposant une analyse scientifiquement solide des phnomnes tudis ? `}</li>\n      <li parentName=\"ul\">{`Comment faire dialoguer les formes classiques de lcriture historique - le rcit dploy phrase aprs phrase, largument droul paragraphe par paragraphe - avec les formes dcriture diagrammatique et computationnelle quimplique la ralisation dun site web ? `}</li>\n      <li parentName=\"ul\">{`Et enfin, comment grer linhabituelle collaboration interdisciplinaire et partition dexpertises quimplique une telle criture multimodale ?`}</li>\n    </ul>\n    <p>{`Toutes ces questions ont t travailles lors de six mois de collaboration qui ont men  llaboration de ce site, dont voici un bref rcit.`}</p>\n    <h2 {...{\n      \"id\": \"dune-srie-de-questionnements--une-semaine-denqute\"\n    }}>{`Dune srie de questionnements  une semaine denqute`}</h2>\n    <p>{`Ltude de cas dont ce site est laboutissement a t articule autour dun format de collaboration intensive que nous appelons datasprint et qui consiste  faire travailler ensemble des expert.e.s de plusieurs disciplines sur un temps court et avec des questions de recherche dtermines  lavance, sur la base dun ou plusieurs jeux de donnes prpars pour loccasion.`}</p>\n    <p>{`En amont du datasprint, nous avons conduit pendant plusieurs mois un double travail de prparation des donnes, et de prparation des questions de recherche. Sur le plan des donnes, les quipes de navigo et de toflit18 donnes ont d effectuer un important travail de nettoyage et daffinement concernant les rgions et les priodes tudies : le fait de projeter une tude de cas prcise a fait merger des problmes qui taient rests dans lombre faute de besoin dun rexamen approfondi. Un travail trs important a galement t effectu pour aligner les deux bases, cest--dire pour mettre en correspondance les lieux et les types de produits commercs ou transports tels quils sont dcrits dans chacune des bases.`}</p>\n    <p>{`Sur le plan de la prparation des questions de recherche de dpart, nous avons conduit une srie de runions prliminaires relies par des documents en ligne rdigs collaborativement, qui nous ont aid  identifier des questions  la fois pertinentes en regard de lhistoire de la rgion et de la littrature existante, mais aussi de ce que les donnes nous permettaient - ou pas - dexplorer et de visualiser. Ce travail dajustement et de mise en correspondance entre les questions et les donnes a ainsi couru doctobre 2020  avril 2021, et nous a permis  la fois didentifier les activits dexploration les plus pertinentes  proposer aux participants durant latelier, et dviter les chausses-trappes qui nous auraient conduit dans des questionnements impossibles  rsoudre.`}</p>\n    <p>{`De ce travail de prparation est n un document de questionnement scientifique destin  expliciter les questions de recherche  explorer partag  tous les participant.e.s de la semaine de datasprint. Ainsi, au dbut du datasprint, ltude de cas tait structure en deux groupes, correspondant  deux lignes denqute complmentaires mais aussi  la constitution de deux quipes quilibres pour la collaboration :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`la premire quipe devait se consacrer  tudier le dynamisme de la rgion du Poitou par rapport  la France et au monde en gnral (avec lhypothse dun dclin par rapport au reste de la France au cours du dix-huitime sicle)`}</li>\n      <li parentName=\"ul\">{`la seconde quipe devait se consacrer  tudier les relations de complmentarit et de domination entre ports de la rgion, de manire notamment  distinguer les flux et circuits commerciaux qui y sont associs`}</li>\n    </ul>\n    <p>{`Sur cette base, un kit de bienvenue a t conu pour permettre  tou.te.s les expert.e.s de rapidement saisir les multiples dimensions de latelier, et nous avons conduit quelques enqutes prliminaires permettant de rsoudre les questions les plus videntes pour tirer le meilleur parti possible de la concentration dexpertises multiples sur le temps court et trs dense du datasprint.`}</p>\n    <h3 {...{\n      \"id\": \"faire-avec-les-conditions-de-recherche\"\n    }}>{`Faire avec les conditions de recherche`}</h3>\n    <p>{`La semaine du datasprint, qui a eu lieu dbut avril 2021, sest avre concider avec un moment de forte reprise de lpidmie de covid-19 en France en gnral et  Paris en particulier. Cela nous a contraint  effectuer latelier en ligne. Conduire un datasprint en ligne revenait  se priver de lincommensurable apport des changes informels et autres possibilits daffichage, de circulation et de spatialisation offerts par le travail dans un mme lieu physique.  cette contrainte sest ajoute la subite fermeture des coles maternelles et primaires ladite semaine, qui a occasionn une srieuse charge extra-professionnelle pour une part substantielle des participant.e.s.`}</p>\n    <p>{`Le datasprint a nanmoins eu lieu, et nous avons dcid de considrer les conditions particulires dans lesquelles il sest conduit non seulement comme des contraintes demandant de recalibrer drastiquement nos attentes, mais aussi comme des occasions dinvention et dexprimentation appelant  adapter nos manires de procder par rapport aux modalits initialement planifies.`}</p>\n    <h3 {...{\n      \"id\": \"improvisations-et-adaptations\"\n    }}>{`Improvisations et adaptations`}</h3>\n    <p>{`Durant le datasprint, la diversit des comptences des participant.e.s a impliqu de remettre  plat la rpartition des tches. Ainsi, chacun a pu tre amen  suggrer des pistes de recherche, manipuler les donnes, et se pencher sur lanalyse et la mise en forme des rsultats. Cette semaine a notamment t loccasion dexprimenter avec un grand nombre de technologies utilises durant les activits denqute, notamment `}<a href=\"https://jupyter.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`jupyter notebook`}</a>{`, `}<a href=\"https://kepler.gl/\" target=\"blank\" rel=\"noopener noreferrer\">{`kepler.gl`}</a>{`, `}<a href=\"https://vega.github.io/vega/\" target=\"blank\" rel=\"noopener noreferrer\">{`vega`}</a>{`, ou encore `}<a href=\"https://matplotlib.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`matplotlib`}</a>{`. Nous avons nanmoins galement parfois touch aux limites de ce principe en condition zoomifie, certaines discussions spcialises (sur le plan technique ou sur le plan historique par exemple) ncessitant parfois de rformer les corps disciplinaires et de prvoir des moments dapart transversaux.`}</p>\n    <p>{`Le format datasprint implique par ailleurs une dimension exprimentale, parfois chaotique, et les difficults de communications impliques par la conduite en ligne ont amplifi cette dimension. Nous avons donc construit nos journes de travail sur un canevas allg en terme damplitude horaire, et sous une forme tentant de varier les rythmes et les chelles dinteraction : un point de plnire en matine, suivi de travail en deux groupes, eux-mmes rapidement re-diviss en binmes ou en moments de travail individuel. `}</p>\n    <p>{`Sur le plan technique, nous avons opt pour une salle zoom permanente ouverte durant toute la semaine et divise en breakout rooms (salles de travail) permettant de travailler en plus petits ensembles ; nous avons galement soutenu la semaine avec un dossier google drive trs organis dans lequel lensemble des activits ont t archives et consignes.`}</p>\n    <p>{`Pour faciliter le processus dintercomprhension, des procdures mthodologiques ont galement t proposes aux participants. Ainsi, des personnes jouant le rle de facilitateurs ont fait le lien entre les diffrents groupes en circulant continuellement entre les diffrentes salles zoom de travail. Nous avons par ailleurs insist sur limportance de la documentation en structurant les activits de chaque jour autour de lcriture de rapports remplis au fur et  mesure de la journe, dont une personne scribe tait charge de prendre soin afin de garder un maximum de traces et de permettre les changes dinformation asynchrones. Ces rapports ont finalement t progressivement abandonns, car trop lourds tant donn le poids des autres activits. Nous avons galement progressivement rduit les temps de visioconfrence pour minimiser la fatigue lie aux changes en ligne.`}</p>\n    <p>{`Les sances de travail dun datasprint provoquent parfois un effet bulle dans lequel chaque quipe peut rapidement se dconnecter du travail effectu par les autres, entranant des blocages, des tches effectues en doublon ou des angles morts. Ce problme est amplifi par la conduite en ligne. Pour faire face  ce dfi, nous avons rythm les journes de points dtapes effectues  plusieurs chelles - par petits groupes, par quipes, ou en plnire - afin de partager les avances. Par ailleurs, des visites informelles et autres zoom surfing ont permis de favoriser certaines circulations dides et de mthodes.`}</p>\n    <p>{`Lun des intrts du format datasprint est enfin de favoriser une unit de temps pour le travail interdisciplinaire. Lintensit quimplique cette unit de temps appelle cependant une valorisation  la hauteur des efforts fournis sur le temps court. Le temps du datasprint est, en temps normal,  la fois un temps dexploration et denqute, et un temps de production de rsultats. Cependant, ce principe a t confront  deux spcificits dans notre cas : les conditions de travail en ligne ont demand de revoir les attentes plus modestement, mais aussi le principe et les objectifs mmes des datasprint de PORTIC qui, parce quils visent la publication de sites web finaliss et contribuant de manire relativement prcise  des tudes de cas trs serres (et non de rapports dexploration des donnes comme cest souvent le cas pour les autres datasprints). Face  ces spcificits, il nous a fallu articuler latelier avec un travail postrieur cadr par dautres temporalits pour arriver  un rsultat publiable.`}</p>\n    <h2 {...{\n      \"id\": \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\"\n    }}>{`La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique`}</h2>\n    <p>{` partir du travail effectu lors du datasprint, nous avons engag une seconde phase dapprofondissement. Sur le fond, les axes de recherche initialement envisags ont t progressivement remanis. Cela a t fait ds la fin de la semaine de datasprint, au moment de la rdaction dun document de synthse mettant en regard les visualisations produites durant la semaine. Ce travail a t ensuite continu par Ccile Asselin qui a effectu un travail de synthse et de nettoyage sur les productions de la semaine.`}</p>\n    <h3 {...{\n      \"id\": \"une-criture-multimodale\"\n    }}>{`Une criture multimodale`}</h3>\n    <p>{`Afin de construire progressivement,  partir des explorations du datasprint, un document propre  tre publi et  transmettre un rcit et des arguments  partir des donnes des deux bases, nous avons tent dutiliser la perspective de la fabrication dun site pour articuler trois types dcriture : la confection de nouveaux fichiers de donnes correspondant aux enqutes souleves par les activits de la semaine (criture computationnelle) ; la confection de visualisations dinformations (criture diagrammatique) ; enfin, bien sr, la mise en rcit et en argument historique de ltude de cas (criture en prose).`}</p>\n    <p>{`Pour ce faire, nous avons dcid de structurer le site en une srie de trois parties  la structure identique : une visualisation principale constituant largument principal de la partie, accompagn dun texte se fondant dabord sur elle puis suivant ses propres dveloppement, accompagn de visualisations secondaires. Cette organisation visuelle et rhtorique a induit un mode de travail itratif sur le registre du ping pong qui sest dploy en trois temps : `}</p>\n    <ul>\n      <li parentName=\"ul\">{`dans la foule du datasprint, les historien.ne.s ont dabord travaill  prciser les arguments de chacune des trois parties (avril-mai 2021)`}</li>\n      <li parentName=\"ul\">{`nous avons ensuite organis deux jours intensifs de conception avec une quipe rduite dingnieur.e.s et de designers (Ccile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, Maxime Zoffoli) durant lesquels nous avons conu des propositions de visualisations principales (fin mai 2021)`}</li>\n      <li parentName=\"ul\">{`les historien.es ont,  la suite de ces deux jours, repris la main sur lcriture, enrichie et structure par les propositions constitues par les visualisations, en prcisant leurs textes comme leurs besoins pour des visualisations complmentaires, qui ont t progressivement produites en fonction du texte (juin-septembre 2021)`}</li>\n    </ul>\n    <p>{`Dans ce cadre, nous avons progressivement ngoci une infrastructure de travail oriente vers le dveloppement progressif du prsent site web. Ce dernier a tout autant servi dobjectif que de moyen de rencontre entre les diffrentes activits qui ont suivi la semaine datelier datasprint.`}</p>\n    <p>{`La fabrication du site prsent au public a t articule autour dun protocole automatis qui a permis de mettre le site  jour quotidiennement pendant sa phase dcriture et de dveloppement, et ainsi de faire progresser conjointement sa structure, son aspect graphique et les divers contenus qui le peuplent (voir son `}<a href=\"https://github.com/medialab/portic-storymaps-2021\" target=\"blank\" rel=\"noopener noreferrer\">{`rpertoire github`}</a>{` pour plus dinformations). Plus prcisment, ce protocole automatis consistait  rcuprer les contenus crits dans un google documents crit par les historien.ne.s, les donnes des bases navigo et toflit18 sur leurs espaces numriques respectifs, et enfin  produire un ensemble de donnes optimises pour le web avant de refabriquer le site.`}</p>\n    <p>{`Cette mthode de travail sur mesure, alternative  lutilisation dun CMS (type wordpress) ou dune intgration des contenus entirement artisanale, nous a permis de multiplier les itrations sur les donnes, les visualisations et les textes, afin de dvelopper itrativement un document ajust et cohrent pour la lecture. Elle nous a galement permis dchapper  une approche qui voudrait formater la production du site de manire trop squentielle, cest--dire faisant suivre un premier temps de conception puis un deuxime temps dexcution, pour plutt faire place  la dcouverte et au dialogue avec les diffrents matriaux en train de se dvelopper. `}</p>\n    <p>{`Ainsi, la mthode de travail et de montage du site adopte ici, outre la dimension doptimisation quimplique lautomatisation de certaines tches, a t le moyen de favoriser un dialogue plus organique entre les diffrentes critures en jeu dans ce document : en ralisant simultanment le design du site, celui des visualisations, et les textes qui les accompagnent, nous avons tent de faire profiter chacune de ces activits lune de lautre, comme des sources dinvention ou de solidification mutuelle, plutt que de les considrer comme des tches spcialises et/ou articules selon un rgime de subordination (de lhistoire  la technique, ou du visuel au textuel, ou de largument  son illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\"\n    }}>{`Un site destin  tisser des liens avec dautres activits et dautres publics`}</h3>\n    <p>{`Ce site est pens  la fois comme un objet autonome droulant le rcit scientifique de lhistoire de la rgion de La Rochelle au dix-huitime sicle, et comme la premire pice dassemblages scientifiques et didactiques encore  venir. Nous lavons conu avec le projet de ladresser  un public constitu dtudiant.e.s en histoire, de professeur.e.s dhistoire du secondaire, ou damateur.ice.s avancs passionns par le Poitou et les Charentes. Cependant, le site est galement pens pour pouvoir sarticuler avec deux publics complmentaires :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`les personnes spcialises dans la mdiation et/ou la vulgarisation pourront utiliser certaines des visualisations pour des initiatives destines  un plus grand public`}</li>\n      <li parentName=\"ul\">{`les historien.ne.s spcialiss pourront citer ces visualisations dans des publications conventionnelles en revues ou monographies et ainsi sappuyer sur ces dernires pour continuer nos enqutes`}</li>\n    </ul>\n    <p>{`Pour ce faire, nous avons notamment rendu chacune des visualisations dtachable du rcit propos via la page atlas - et plus techniquement en dotant chacune des visualisations dune adresse URL propre.`}</p>\n    <p>{`Par ailleurs, le `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`code source du site`}</a>{`, partag sous licence libre, a t construit et document de manire  pouvoir tre driv - en tout ou partie - pour dautres projets  venir : il pourra apporter des lments utiles pour les prochaines tudes de cas du programme PORTIC mais aussi pour dautres projets similaires. Il est enfin  noter que toutes les donnes utilises - et les scripts qui les gnrent  partir des donnes compltes de toflit18 et navigo, accessibles toutes les deux librement - sont galement inclus dans le code source du site, rendant nos visualisations et rsultats entirement reproductibles.`}</p>\n    <h2 {...{\n      \"id\": \"une-criture-collective--crdits\"\n    }}>{`Une criture collective : crdits`}</h2>\n    <p>{`Ce site est le rsultat dun processus denqute et dcriture collective qui a mobilis des personnes issues de plusieurs disciplines : histoire, conomie, informatique, gomatique, design. Plus prcisment, il est luvre de :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Lingnieure stagiaire `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, en double cursus ingnierie/sciences humaines, qui sest consacre  plein temps pendant six mois  la conduite mthodologique et technique de lensemble de ltude de cas, accompagne par `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{` (designer de recherche - co-responsable scientifique du programme PORTIC)`}</li>\n      <li parentName=\"ul\">{`Le cur de lquipe Navigo : `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{` (historienne du commerce et de la navigation - directrice et co-responsable scientifique du programme PORTIC) et `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{` (gomaticienne - co-responsable scientifique du programme PORTIC).`}</li>\n      <li parentName=\"ul\">{`Le cur de lquipe Toflit18 : `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loc Charles`}</a>{` et `}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{` (historiens de lconomie moderne).`}</li>\n      <li parentName=\"ul\">{`Les historiens `}<a href=\"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/\" target=\"blank\" rel=\"noopener noreferrer\">{`Thierry Sauzeau`}</a>{` et `}<a href=\"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\" target=\"blank\" rel=\"noopener noreferrer\">{`Pierrick Pourchasse`}</a>{`, membres permanents du programme PORTIC ayant particip au datasprint et/ou  lcriture du site`}</li>\n      <li parentName=\"ul\">{`La data librarian `}<a href=\"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b\" target=\"blank\" rel=\"noopener noreferrer\">{`Graldine Geoffroy`}</a>{` et le chercheur en informatique `}<a href=\"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\" target=\"blank\" rel=\"noopener noreferrer\">{`Alain Bouju`}</a>{`.`}</li>\n      <li parentName=\"ul\">{`Les ingnieurs en mthodes numriques et designers du laboratoire mdialab de Sciences Po `}<a href=\"https://bmaz.github.io/\" target=\"blank\" rel=\"noopener noreferrer\">{`Batrice Mazoyer`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/\" target=\"blank\" rel=\"noopener noreferrer\">{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/guillaume-plique/\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Plique`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/heloise-thero/\" target=\"blank\" rel=\"noopener noreferrer\">{`Hlose Thro`}</a>{`, et `}<a href=\"https://paulinegourlet.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Pauline Gourlet`}</a>{`, qui ont particip au datasprint.`}</li>\n      <li parentName=\"ul\">{`Les experts en traitement et visualisation de donnes invits pour loccasion du datasprint puis pour la conception des visualisations principales de chacune des trois parties : lingnieur et ancien directeur technique du mdialab `}<a href=\"https://fr.linkedin.com/in/paul-girard-57822118\" target=\"blank\" rel=\"noopener noreferrer\">{`Paul Girard`}</a>{` (pour lentreprise `}<a href=\"https://www.ouestware.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Ouestware`}</a>{`) ainsi que le designer dinformation expert en visualisation de donnes `}<a href=\"https://www.maximezoffoli.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Maxime Zoffoli`}</a>{`.`}</li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"dune-srie-de-questionnements--une-semaine-denqute\",\n    level: 2,\n    title: \"Dune srie de questionnements  une semaine denqute\",\n    children: [\n        {\n              id: \"faire-avec-les-conditions-de-recherche\",\n              level: 3,\n              title: \"Faire avec les conditions de recherche\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisations-et-adaptations\",\n              level: 3,\n              title: \"Improvisations et adaptations\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\",\n    level: 2,\n    title: \"La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique\",\n    children: [\n        {\n              id: \"une-criture-multimodale\",\n              level: 3,\n              title: \"Une criture multimodale\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\",\n              level: 3,\n              title: \"Un site destin  tisser des liens avec dautres activits et dautres publics\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"une-criture-collective--crdits\",\n    level: 2,\n    title: \"Une criture collective : crdits\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`About TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.11,\"time\":186600,\"words\":622}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"rfrences\"\n    }}>{`Rfrences`}</h1>\n    <h3 {...{\n      \"id\": \"sources-archivistiques\"\n    }}>{`Sources archivistiques`}</h3>\n    <p>{`Les donnes sur la navigation proviennent de la base de donnes Navigocorpus. Pour cette enqute, il sagit plus particulirement des:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`congs issus de la sous-srie G5 conservs aux Archives Nationales de France`}</li>\n      <li parentName=\"ul\">{`congs de Lorient, Archives dpartementales du Morbihan, 10B-19`}</li>\n      <li parentName=\"ul\">{`congs de Saint-Tropez, Archives dpartementales du Var, 7 B 10`}</li>\n      <li parentName=\"ul\">{`Registres du Bureau de Sant de Marseille, 200 E 543 et 545`}</li>\n    </ul>\n    <p>{`Les donnes relatives aux expditions ngrires ont t compltes avec la base de donnes `}<a href=\"https://www.slavevoyages.org/voyage/database\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://www.slavevoyages.org/voyage/database\"\n        }}>{`https://www.slavevoyages.org/voyage/database`}</a></a></p>\n    <p>{`Les donnes relatives au commerce extrieur proviennent de la base de donnes Toflit18 (voir `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/exploration/sources\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"http://toflit18.medialab.sciences-po.fr/#/exploration/sources\"\n        }}>{`http://toflit18.medialab.sciences-po.fr/#/exploration/sources`}</a></a>{`).`}</p>\n    <p>{`Pour cette enqute, il sagit plus particulirement des : `}</p>\n    <p>{`Archives Nationales dOutre-Mer (pour 1789) `}</p>\n    <p>{` Col. F2 B 14 (prsent aussi en AN Marine B 7 514)`}</p>\n    <p>{`Archives Nationales de France (pour 1789) : AN F12 1665 et 1666 AN Marine B 7 514 (prsent aussi en ANOM Col F2 B 14)`}</p>\n    <p>{`Archives dpartementales de la Charente-Maritime `}</p>\n    <p>{`41 ETP 270 (pour lhistorique des exportations de La Rochelle) `}</p>\n    <p>{`Bibliothque municipale de Saint-Brieuc `}</p>\n    <p>{` Fonds Gournay, M8487 (pour 1750)`}</p>\n    <p>{`La majeure partie des cahiers de dolances tudis sont tirs des Archives Dpartementales de Charente-Maritime (AD17). En effet, les Archives Dpartementales de la Vende (AD85) ne conservent que de rares cahiers pour littoral du Poitou (Bouin, Noirmoutier, lIle dElle dans le marais poitevin). La collecte et/ou la transcription ont t ralises selon deux modalits. Nous avons tout dabord rcupr un ensemble de cahiers charentais transcrits sur le site `}<a href=\"http://www.histoirepassion.eu/?-1789-Cahiers-de-doleances-et-Etats-generaux-\" target=\"blank\" rel=\"noopener noreferrer\">{`Histoire Passion - Saintonge Aunis Angoumois`}</a>{`. Nous avons ensuite complt ce corpus grce  la collaboration des AD17 et des AD85. Ainsi, de nouveaux cahiers ont t rcuprs et transcrits par Thierry Sauzeau, le tout permettant dvaluer lexhaustivit et la teneur de lchantillon utilis. Le corpus de 163 cahiers recle 14 cahiers de paroisses que compltent 5 cahiers de districts (groupes de paroisses) du littoral. Lensemble de ce travail de consolidation et de mise en donnes est disponible et rutilisable `}<a href=\"https://docs.google.com/spreadsheets/d/1A8-OiTSYv7opCcWvF8tsJ0dmEXkHZMgN-7lhj-4hqFw/edit?usp%3Dsharing\" target=\"blank\" rel=\"noopener noreferrer\">{` cette adresse`}</a>{`.`}</p>\n    <p>{`Les registres de dlibration de la Chambre de Commerce de La Rochelle sont conservs aux Archives dpartementales de la Charente Maritime, 41 ETP 8 (accessibles en ligne: `}<a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir%5C_ead%5C_visu%5C_lien.html?ir=11431&id=490014227\"\n        }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir\\\\_ead\\\\_visu\\\\_lien.html?ir=11431`}{`&`}{`id=490014227`}</a></a>{`) `}</p>\n    <h3 {...{\n      \"id\": \"bibliographie\"\n    }}>{`Bibliographie`}</h3>\n    <p>{`Augeron, Mickal et Guillemet, Dominique (dir.), Champlain ou les portes du Nouveau Monde. Cinq sicles dchanges entre le Centre-Ouest franais et lAmrique du Nord, La Crche, Geste Editions, 2004.`}</p>\n    <p>{`Clark, John G., La Rochelle and the Atlantic Economy during the Eighteenth Century, Baltimore, Johns Hopkins University Press, 1981.`}</p>\n    <p>{`Delafosse, Marcel, ed. Histoire de La Rochelle, Toulouse, Privat, 2002.`}</p>\n    <p>{`Deveau, Jean-Michel, La Traite rochelaise, Paris, Karthala, 1990.`}</p>\n    <p>{`Hocquet, Jean-Claude, Navigation et transport du sel atlantique, dans Mnanteau, Loc (dir.), Sel et salines de lEurope atlantique, Rennes, PUR, 2018, p. 223234.`}</p>\n    <a href=\"https://www.pur-editions.fr/search?search%3D%257B%2522bounce%2522%253A%257B%2522Item1%2522%253A%2522Author%2522,%2522Item2%2522%253A%252221245%2522%257D,%2522query%2522%253A%2522Martinetti%2520Brice%2522%257D\" target=\"blank\" rel=\"noopener noreferrer\">Martinetti, Brice</a>, Les ngociants de La Rochelle au XVIIIe sicle, Rennes, PUR, 2013.\n    <p>{`Mathieu, Jacques, La Nouvelle-France. Les Franais en Amrique du Nord, XVIe-XVIIIe sicles, Paris, Belin, 1991.`}</p>\n    <p>{`Robert, Henri, Les trafics coloniaux du port de la Rochelle au XVIIIe sicle, Poitiers, Mmoire de la Socit des Antiquaires de lOuest, 4e srie, tome IV, 1960.`}</p>\n    <p>{`Sauzeau, Thierry et Normand, Eric (dir.), De Tonnay  Charente : histoire dune porte maritime des pays charentais, La Crche, Geste ditions, 2013, 203 p.`}</p>\n    <p>{`Sauzeau, Thierry,  Rochefort/Tonnay-Charente (XVIIe-XIXe sicles) entre concurrence et complmentarit , dans Fernandez, Alexandre et Marnot, Bruno (dir.), Les ports du golfe de Gascogne. De Concarneau  La Corogne (xve-xxie sicles), Paris, PUPS, 2013, p.109122.`}</p>\n    <p>{`Sauzeau, Thierry, Les marins de la Seudre (XVIIIe-XIXe sicle), Pays dhistoire, La Crche, Geste Editions, 2005, 342 p.`}</p>\n    <p>{`Toussaint, Auguste, La route des Iles. Contribution  lhistoire maritime des Mascareignes, Paris, SEVPEN, 1967`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"sources-archivistiques\",\n    level: 3,\n    title: \"Sources archivistiques\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliographie\",\n    level: 3,\n    title: \"Bibliographie\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`References`}</p>\n    <p>{`TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\n\nfunction SvgChart ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgChart;","import GeographicMapChart from './GeographicMapChart';\n\nexport default GeographicMapChart;","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import TriangleChart from './TriangleChart';\n\nexport default TriangleChart;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: str }) => {\n          const extension = dataFilename.split('.').pop();\n          let newData;\n          if (extension === 'csv') {\n            newData = csvParse(str);\n          } else if (extension === 'geojson' || extension === 'json') {\n            newData = str;\n          }\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.975,\"time\":478500,\"words\":1595}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgChart from '../../components/SvgChart';\nimport VegaChart from '../../components/VegaChart';\nimport NetworkGraphChart from '../../components/NetworkGraphChart';\nimport GeographicMapChart from '../../components/GeographicMapChart';\nimport TriangleChart from '../../components/TriangleChart';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\nimport { Step3Objects } from '../../visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <p>{`Test en prod`}</p>\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + donnes avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h3 {...{\n      \"id\": \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\"\n    }}>{`Fond de carte - test custom layer avec config coast from Nantes to Bordeaux`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step3_viz_customs_offices_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname'\n          }\n        }, {\n          type: 'custom',\n          data: visData,\n          renderObjects: Step3Objects\n        }]} projectionTemplate='coast from Nantes to Bordeaux' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider> \n    <h3 {...{\n      \"id\": \"fond-de-carte---test-flows-avec-config-world\"\n    }}>{`Fond de carte - test flows avec config World`}</h3>\n    <DataProvider data={'world_1789_23mars2021_level0.json'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'aggregated_flows.json'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'flows',\n          data: visData,\n          size: {\n            field: 'tonnages_cumuls'\n          }\n        }]} projectionTemplate='World' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-france\"\n    }}>{`Fond de carte - config France`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'ports_locations_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'admiralty',\n            palette: colorPalettes.admiralties\n          },\n          size: {\n            field: 'customs_region'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='France' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-rotated-poitou\"\n    }}>{`Fond de carte - config rotated Poitou`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step1_viz_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'customs_office',\n            palette: colorPalettes.customs_office\n          },\n          size: {\n            field: 'mean_tonnage'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='rotated Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-poitou\"\n    }}>{`Fond de carte - config Poitou`}</h3>\n    <p>{`Cartographie des destination des bateaux aillant un port dattache dans la rgion, par tonnage cumul (couleur = amiraut) :`}</p>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels projectionTemplate='Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />\n    <h2 {...{\n      \"id\": \"fond-de-carte-sans-template-pour-la-config\"\n    }}>{`Fond de carte sans template pour la config`}</h2>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeographicMapChart\" />\n    {\n      /* # Tests composant LineChart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data.filter(d => d.region === 'France')}\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 5,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n             annotations={[\n                   {\n                     type: 'span',\n                     start: 1756,\n                     end: 1763,\n                     axis: 'x',\n                     label: 'guerre de sept ans'\n                   },\n                   {\n                     type: 'span',\n                     start: 400000000,\n                     end: 500000000,\n                     axis: 'y',\n                     label: 'priode de faste'\n                   }\n                 ]}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de titre\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de line chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`,\n               fillGaps: true\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de linechart (minimum de props)\"\n             // width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               // title: 'anne',\n             }}\n             y={{\n               field: 'Imports',\n               // title: 'imports',\n               // tickSpan: 100000000,\n               // tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               // title: 'Rgion'\n             }}\n             // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      # Tests composant BarChart\n      ## Horizontal bar chart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (sans fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             annotations={[\n               {\n                 type: 'span',\n                 start: 1756,\n                 end: 1763,\n                 axis: 'x',\n                 label: 'guerre de sept ans'\n               },\n               {\n                 type: 'span',\n                 start: 400000000,\n                 end: 500000000,\n                 axis: 'y',\n                 label: 'priode de faste'\n               }\n             ]}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (grouped, fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped, no fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      ## Vertical bar charts\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               // tickSpan: 1000000,\n               //tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             height={200}\n             y={{\n               field: 'year',\n               title: 'anne',\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               rowHeight: 30,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               rowHeight: 50\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      ## Test triangle \n      <TriangleChart \n       dataFilename=\"part_3_step1_viz_data.csv\" \n       rowHeight={300}\n       totalWidth = {1600}\n       />\n      ## Test courbes de bzier\n      <BezierComponent\n       dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n       cx={300}\n       cy={250}\n       r={210}\n       inPercentage={10}\n       // start={Math.PI / 2}\n       // end={Math.PI * 3 / 2}\n       />\n      # Test bateaux\n      <BoatsIllustration />\n      \n      # Commerce multi-chelle dans la rgion de La Rochelle\n      \n      Voici un tour d'horizon des modules react prpars pour faciliter le dveloppement :\n      ## Image SVG (avec webpack)\n      On intgre une image  SVG depuis le local (elle sera donc packe par webpack) :\n      \n      ## Image SVG (sans webpack)\n      On intgre ici directement une image  partir de son URL en ligne (depuis le dossier `public`)\n      ##### ! cass pour le moment\n      // <SvgChart path =\"/svg/ports-region-1789.svg\" />\n      ## Visualisation vega\n      Les visualisations vega ont besoin d'un fichier csv stock dans le dossier `public/data` et d'une spec vega.\n      <VegaChart \n       data=\"sorties_navires_vers_colonies.csv\" \n       spec={{\n         \"mark\": \"rect\",\n         \"encoding\": {\n           \"x\": {\n             \"field\": \"port_depart\",\n             \"type\": \"nominal\"\n           },\n           \"y\": {\n             \"field\": \"port_destination\",\n             \"type\": \"nominal\"\n           },\n           \"color\": {\n             \"type\": \"quantitative\",\n             \"field\": \"tonnage\",\n             \"aggregate\": \"sum\"\n           }\n           \n         }\n       }}\n      />\n      ## Rseau avec sigma\n      Les visualisations sigma ont besoin d'un fichier gexf stock dans le dossier `public/data`.\n      Paramtres :\n      * `nodeColor` : attribut pour couleur\n      * `nodeSize` : attribut pour taille\n      * `labelDensity` : densit des labels (float dans [0, 1])\n      \n      <NetworkGraphChart \n       data=\"toflit_aggregate_1789_only_out.gexf\" \n       nodeColor={`admiralty`}\n       nodeSize={`inside_degree`}\n       labelDensity={0.5}\n      />\n      */\n    }\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        {\n              id: \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\",\n              level: 3,\n              title: \"Fond de carte - test custom layer avec config coast from Nantes to Bordeaux\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---test-flows-avec-config-world\",\n              level: 3,\n              title: \"Fond de carte - test flows avec config World\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-france\",\n              level: 3,\n              title: \"Fond de carte - config France\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-rotated-poitou\",\n              level: 3,\n              title: \"Fond de carte - config rotated Poitou\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-poitou\",\n              level: 3,\n              title: \"Fond de carte - config Poitou\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"fond-de-carte-sans-template-pour-la-config\",\n    level: 2,\n    title: \"Fond de carte sans template pour la config\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","import LineChart from './LineChart';\n\nexport default LineChart;","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\nconst BoatsIllustration = ({\n  width: inputWidth = 1200,\n  height: inputHeight = 100,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nconst Caller = ({id: visualizationId, ...props}) => {\n  const ref = useRef(null);\n  const [id] = useState(genId());\n  const {\n    activeVisualization,\n    onBlockClick,\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  useEffect(() => {\n    // on wrappe dans un setTimeout pour avoir une ref non-nulle vers le composant\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        'is-hidden': process.env.NODE_ENV !== 'development',\n        'is-devmode': process.env.NODE_ENV === 'development',\n      })}\n    >\n      {\n        process.env.NODE_ENV === 'development' ?\n        <>\n          {\n          visualizationId ?\n          <>caller pour la visualisation <code>{visualizationId}</code> </>\n          :\n          <>caller sans id (agit comme un clearfix)</>\n        }{\n          Object.keys(props).length ? \n            <span>avec les paramtres {JSON.stringify(props)}</span>\n          : null\n        }\n        </>\n        :\n        null\n      }\n      \n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","import { geoPath } from \"d3-geo\";\nimport { generatePalette } from '../../helpers/misc';\nimport { uniq } from 'lodash';\nimport cx from 'classnames';\nimport { useSpring, animated } from 'react-spring'\nimport { useEffect, useState } from \"react\";\nimport ReactTooltip from \"react-tooltip\";\n\nconst GeoPart = ({ d: initialD, projection, project, palette, layer, width, height}) => {\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const currentD = project(initialD);\n\n  const animationProps = useSpring({\n    to: {\n      d: currentD\n    },\n    immediate: !isInited\n  });\n\n  // @todo do this cleanly (removing out of bound objects to improve performance)\n  const boundsAbs = geoPath().bounds(initialD);\n  const [[x1, y1], [x2, y2]] = [projection(boundsAbs[0]), projection(boundsAbs[1])];\n  const [xMin, xMax] = [x1, x2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const [yMin, yMax] = [y1, y2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const outOfBounds = (isNaN(xMin) || isNaN(xMax) || isNaN(yMin) || isNaN(yMax)) ? false : xMin > width || yMin > height || xMax < 0 || yMax < 0;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  });\n  return outOfBounds ? null : (\n    <animated.path\n      title={initialD.properties.shortname}\n      d={animationProps.d}\n      className=\"geopart\"\n      data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n      data-for=\"geo-tooltip\"\n      style={{\n        fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n      }}\n    />\n  )\n}\n\n\n// @TODO : mettre en place une palette de couleurs quantitative \n\nconst ChoroplethLayer = ({ layer, projection, width, height, reverseColors }) => {\n\n  let palette;\n  const project = geoPath().projection(projection);\n\n  if (!layer.data) {\n    console.info(layer);\n    return null;\n  }\n\n  if (layer.data.features && layer.color && layer.color.field) {\n    // colors palette building\n    const colorValues = uniq(layer.data.features.map(datum => datum.properties[layer.color.field]));\n    if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n      palette = layer.color.palette;\n    } else if (layer.color.generatedPalette) {\n      const colors = generatePalette('map', layer.data.features.length);\n      palette = colorValues.reduce((res, key, index) => ({\n        ...res,\n        [key]: colors[index]\n      }), {});\n    }\n  }\n\n  return (\n    <>\n      <g className={cx(\"ChoroplethLayer\", { 'reverse-colors': reverseColors })}>\n        {\n          layer.data.features\n          .filter(d => d.geometry)\n          .map((d, i) => {\n            return (\n              <GeoPart \n                key={d.properties.id ||d.properties.name ||i} \n                {...{projection, project, palette, layer, d, width, height}}\n              />\n            )\n          })\n        }\n      </g>  \n    </>\n  );\n\n}\n\nexport default ChoroplethLayer;","\nimport { useMemo } from 'react';\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\nimport { useSpring, animated, Transition } from 'react-spring'\nimport { useEffect, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\n\n\nconst PointGroup = ({\n  projection,\n  datum,\n  layer,\n  opacity,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  displayLabel\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, color, label, rawSize, labelPosition = 'right', labelSize, index } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <>\n      <animated.g\n        className=\"point-group\"\n        transform={transform}\n        style={{\n          zIndex: labelSize,\n          opacity: opacity\n        }}\n        onMouseEnter={() => onGroupMouseEnter(index)}\n        onMouseMove={() => onGroupMouseEnter(index)}\n        onMouseLeave={() => onGroupMouseLeave()}\n        data-for=\"geo-tooltip\"\n        data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n      >\n        <circle\n          cx={0}\n          cy={0}\n          r={size}\n          style={{ fill: color }}\n          className=\"marker\"\n        />\n        {\n          layer.size && layer.size.displayMetric && labelSize > 6 ?\n            <text\n              x={0}\n              y={labelSize / 4}\n              textAnchor=\"middle\"\n              fontSize={labelSize / 2}\n              fill=\"white\"\n            >\n              {rawSize}\n            </text>\n            : null\n        }\n\n        {\n          label && displayLabel ?\n            <text\n              x={labelPosition === 'right' ? size + 5 : -size - 5}\n              y={size / 2}\n              fill={layer.color && layer.color.labelsColor}\n              textAnchor={labelPosition === 'right' ? 'start' : 'end'}\n              fontSize={labelSize}\n            >\n              {label}\n            </text>\n            : null\n        }\n      </animated.g>\n    </>\n\n  );\n}\n\nconst StackedLabelGroup = ({\n  layer,\n  datum,\n  thatIndex,\n  opacity,\n  stackedRowHeight,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  labelFontSize,\n  projection\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, label, /*labelPosition = 'right', labelSize, index*/ } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { x2, y2, transformLabel } = useSpring({\n    to: {\n      x2: x - size,\n      y2: y,\n      transformLabel: `translate(${window.innerWidth * 0.01}, ${datum.labelY})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g\n      style={{\n        // zIndex: labelSize,\n        opacity: opacity\n      }}\n      onMouseEnter={() => onGroupMouseEnter(thatIndex)}\n      onMouseMove={() => onGroupMouseEnter(thatIndex)}\n      onMouseLeave={() => onGroupMouseLeave()}\n      data-for=\"geo-tooltip\"\n      data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n    >\n      <animated.g className=\"label-container\" transform={transformLabel}>\n        <text style={{ fontSize: labelFontSize }}>\n          {\n            label\n          }\n        </text>\n      </animated.g>\n      <animated.line\n        x1={labelFontSize * label.length * .5 + window.innerWidth * 0.01}\n        y1={datum.labelY - stackedRowHeight * .2}\n        x2={x2}\n        y2={y2}\n      />\n    </animated.g>\n  )\n}\n\nconst PointsLayer = ({ layer, projection, width, height }) => {\n\n  const [hoveredIndex, setHoveredIndex] = useState(null);\n\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // regroup data by coordinates\n      const coordsMap = {};\n      layer.data.forEach(datum => {\n        // id\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: layer.label ? datum[layer.label.field] : undefined,\n            labelPosition: layer.label ? layer.label.position : undefined,\n            latitude: +datum.latitude,\n            longitude: +datum.longitude,\n            color: layer.color !== undefined ? datum[layer.color.field] : 'default',\n            size: (layer.size !== undefined && layer.size.field !== undefined) ? isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field] : 0\n          }\n        } else if (layer.size !== undefined) {\n          coordsMap[mark].size += (isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field])\n        }\n      })\n\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n      // console.log(\"grouped : \", grouped)\n\n\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g.color));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n      }\n\n      // size building\n\n      // compute size (would have been more elegand with a ternary but I did not manage to write it properly)\n      let sizeCoef = width / 300; // default size\n      if (layer.size !== undefined && layer.size.custom !== undefined) {\n        sizeCoef = parseInt(layer.size.custom * width / 100);\n      }\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      // basing the scale on area rather than radius\n      const radiusRange = [3, width * height / 20000];\n      const areaRange = radiusRange.map(r => Math.PI * r * r);\n      const sizeScale = scaleLinear().domain(sizeExtent).range(areaRange) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      const labelSizeScale = scaleLinear().domain(sizeExtent).range([8, width / 30]) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: layer.color !== undefined ? palette[datum.color] : 'grey',\n        size: layer.size !== undefined ? layer.size.custom !== undefined ? sizeCoef : sizeScale(datum.size) : width / 100,\n        rawSize: datum.size,\n        labelSize: layer.size !== undefined ? labelSizeScale(datum.size) : width * height / 30000\n      }))\n\n      // console.log(\"grouped (PointsLayer): \", grouped)\n      return grouped;\n    }\n  }, [projection, width, layer])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  let visibleMarkers = markerData\n    .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n    .sort((a, b) => {\n      if (a.latitude > b.latitude) {\n        return 1;\n      }\n      return -1;\n    })\n\n  const onGroupMouseEnter = index => {\n    if (hoveredIndex !== index)\n      setHoveredIndex(index);\n  }\n  const onGroupMouseLeave = () => {\n    setTimeout(() => {\n      if (hoveredIndex !== null)\n        setHoveredIndex(null);\n    })\n  }\n  const stackedLabelsTop = height * .1;\n  const stackedLabelsHeight = height * .9;\n  const stackedRowHeight = stackedLabelsHeight / visibleMarkers.length;\n  const maxLabelFontSize = window.innerHeight * 0.02;\n  const labelFontSize = stackedRowHeight < maxLabelFontSize ? stackedRowHeight : maxLabelFontSize;\n  if (layer.stackLabels) {\n    visibleMarkers = visibleMarkers\n      .sort((a, b) => {\n        if (a.latitude > b.latitude) {\n          return -1;\n        }\n        return 1;\n      })\n      .map((d, i) => ({\n        ...d,\n        labelY: stackedRowHeight * i + stackedLabelsTop\n      }))\n  }\n  visibleMarkers = visibleMarkers.map((d, index) => ({ ...d, index }));\n  return (\n    <g className=\"PointsLayer\">\n      {\n        layer.stackLabels ?\n          <g className=\"stacked-labels-container\">\n            <Transition\n              // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n              items={visibleMarkers}\n              from={{ opacity: 0 }}\n              enter={{ opacity: 1 }}\n              leave={{ opacity: 0 }}\n            >\n              {({ opacity }, datum, thatIndex) => (\n                <StackedLabelGroup\n                  key={datum.label}\n                  {...{\n                    projection,\n                    datum,\n                    layer,\n                    opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n                    thatIndex: datum.index,\n                    onGroupMouseEnter,\n                    onGroupMouseLeave,\n                    stackedRowHeight,\n                    labelFontSize,\n                  }}\n                />\n              )\n\n              }\n            </Transition>\n          </g>\n          : null\n      }\n      <Transition\n        // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n        items={visibleMarkers}\n        from={{ opacity: 0 }}\n        enter={{ opacity: 1 }}\n        leave={{ opacity: 0 }}\n      >\n        {({ opacity }, datum, index) => (\n          <PointGroup\n            key={datum.label}\n            {...{\n              projection,\n              datum,\n              layer,\n              opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n              index: datum.index,\n              onGroupMouseEnter,\n              onGroupMouseLeave,\n              displayLabel: !layer.stackLabels\n            }}\n          />\n        )\n\n        }\n      </Transition>\n      {/* {\n        visibleMarkers\n          .map((datum, index) => {\n            return (\n              <PointGroup\n                key={datum.label}\n                {...{ projection, datum, layer }}\n              />\n            )\n          })\n      } */}\n    </g>\n  );\n}\n\nexport default PointsLayer;","\nimport { useMemo, useState, useEffect } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport cx from 'classnames';\nimport { max } from 'd3-array';\nimport { uniq } from 'lodash';\nimport { cartesian2Polar, fixSvgDimension, generatePalette, polarToCartesian } from '../../helpers/misc';\n\nimport { useSpring, animated } from 'react-spring'\n\n/*\nPrincipe : path entre deux point gographiques, dont le stroke peut varier, et on peut avoir la direction avec une fleche \n\nformat des donnes attendu (json) : \n\nExemple :\n\"flow_id\": \"45.95_-0.9_46.166667_-1.15\", \n\"port_dep\": \"Charente\", \n\"port_dest\": \"La Rochelle\", \n\"latitude_dep\": 45.95, \n\"longitude_dep\": -0.9, \n\"latitude_dest\": 46.166667, \n\"longitude_dest\": -1.15, \n\"nb_flows\": 22, \n\"tonnages_cumuls\": 730}\n\n@TODO : rgler le fait que la pointe des flches ne soit pas  l'arrive (en l'tat c'est la base du triangle qui est sur les coords d'arrive) => se rgle en reculant le triangle :   viewBox=\"-10 0 10 10\" &  <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"black\" /> ( ce moment il fut rtrcir la longueur du path qui fait la barre de la flche)\n@TODO : mettre un point au dpart de mes flows ? (pas adapt quand on a des points de dpart et d'arrive qui se recoupent)\n*/\n\nconst FlowGroup = ({\n  id,\n  hovered,\n  xDep: inputXDep,\n  yDep: inputYDep,\n  xDest: inputXDest,\n  yDest: inputYDest,\n  strokeWidth: inputStrokeWidth,\n  datum,\n  layer,\n  color = 'black',\n\n  path,\n  actualXDep,\n  actualYDep,\n  actualXDest,\n  actualYDest,\n  arrowLength,\n  depLabelTextAnchor,\n  depLabelX,\n  depLabelY,\n  destLabelTextAnchor,\n  destLabelX,\n  destLabelY,\n  fontSize,\n  onMouseEnter,\n  onMouseLeave,\n}) => {\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  const { d, strokeWidth } = useSpring({\n    to: {\n      xDep: inputXDep,\n      yDep: inputYDep,\n      xDest: inputXDest,\n      yDest: inputYDest,\n      d: path,\n      strokeWidth: fixSvgDimension(inputStrokeWidth),\n      arrowPath: `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`\n    },\n    immediate: !isInited\n  });\n\n  return (\n    <g onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} className={cx(\"flow-group\", { hovered })}>\n      <defs>\n        <marker\n          id={`triangle-${id}`}\n          viewBox={`0 0 ${arrowLength} ${arrowLength}`}\n          refY={arrowLength / 2}\n          orient=\"auto\">\n          <path d={`M 0 0 L ${arrowLength} ${arrowLength / 2} L 0 ${arrowLength} Z`} fill={color} />\n        </marker>\n      </defs>\n      {/* hover placeholder */}\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth * 3}\n        fill=\"none\"\n        stroke={color}\n        opacity={0}\n      />\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth}\n        markerEnd={`url(#triangle-${id})`}\n        fill=\"none\"\n        stroke={color}\n      />\n    </g>\n  )\n}\n\nconst FlowsLayer = ({\n  layer,\n  projection,\n  width,\n  height,\n  projectionTemplate,\n}) => {\n\n  /**\n    * Data aggregation for viz\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // size building\n      const strokeWidthScale = scaleLinear().domain([\n        0,\n        max(\n          layer.data.map((flow) => {\n            return +flow[layer.size.field];\n          })\n        )\n      ]).range([1, width * height / 20000]);\n\n      const arrowSizeScale = strokeWidthScale.copy().range([0, width * height / 100000]);\n\n      let grouped = layer.data.map(flow => ({ // je ne sais pas si grouped reste le plus adapt\n        ...flow,\n        // color: palette[datum.color],\n        strokeWidth: strokeWidthScale(+flow[layer.size.field]),\n        arrowSize: arrowSizeScale(layer.data.strokeWidth)\n      }))\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g[layer.color.field]));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n        grouped = grouped.map(datum => ({\n          ...datum,\n          color: layer.color !== undefined ? palette[datum[layer.color.field]] : 'grey',\n        }))\n      }\n      // console.log(\"grouped : \", grouped)\n      return grouped\n        .filter(({ latitude_dep, longitude_dep, latitude_dest, longitude_dest }) => latitude_dep && longitude_dep && latitude_dest && longitude_dest && !isNaN(latitude_dep) && !isNaN(longitude_dep) && !isNaN(latitude_dest) && !isNaN(longitude_dest))\n        .map((datum, index) => {\n          const { latitude_dep, longitude_dep, latitude_dest, longitude_dest, strokeWidth, arrowSize, color } = datum;\n          const [xDep, yDep] = projection([+longitude_dep, +latitude_dep]);\n          const [xDest, yDest] = projection([+longitude_dest, +latitude_dest]);\n          // console.log(\"[xDep, yDep] / [xDest, yDest] : \", [xDep, yDep], \" / \", [xDest, yDest]);\n          if (layer.hideOverflowingFlows) {\n            if (xDep < 0 || xDep > width || xDest < 0 || xDest > width\n              || yDep < 0 || yDep > height || yDest < 0 || yDest > height\n            ) {\n              return null;\n            }\n          }\n          const id = `${xDep}-${yDep}-${xDest}-${yDest}`;\n\n          const arrowLength = fixSvgDimension(strokeWidth) * 3;\n\n          const { distance, radians } = cartesian2Polar(xDest - xDep, yDest - yDep);\n          const [relativeXDest, relativeYDest] = polarToCartesian(distance - arrowLength, radians);\n          let actualXDest = xDep + relativeXDest;\n          let actualYDest = yDep + relativeYDest;\n          let actualXDep = xDep;\n          let actualYDep = yDep;\n          let path = `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`;\n\n          let depLabelPosition = actualXDest < actualXDep ? 'right' : 'left';\n          let destLabelPosition = actualXDest > actualXDep ? 'right' : 'left';\n          if (actualXDest < width * .26) {\n            destLabelPosition = 'right';\n          }\n          if (actualXDest > width * .75) {\n            destLabelPosition = 'left';\n          }\n\n          const fontSize = width * 0.02;\n\n          const depLabelTextAnchor = depLabelPosition === 'right' ? 'start' : 'end';\n          const depLabelX = depLabelPosition === 'right' ? 10 : -10\n          const depLabelY = fontSize * .3\n\n          const destLabelTextAnchor = destLabelPosition === 'right' ? 'start' : 'end'\n          const destLabelX = destLabelPosition === 'right' ? 10 : -10\n          const destLabelY = fontSize * .3;\n\n          return {\n            id,\n            arrowSize,\n            xDep,\n            yDep,\n            xDest,\n            yDest,\n            strokeWidth,\n            datum,\n            layer,\n            width,\n            color,\n            height,\n            projectionTemplate,\n\n            fontSize,\n            path,\n            actualXDep,\n            actualYDep,\n            actualXDest,\n            actualYDest,\n            arrowLength,\n\n            depLabelTextAnchor,\n            depLabelX,\n            depLabelY,\n\n            destLabelTextAnchor,\n            destLabelX,\n            destLabelY,\n          }\n        })\n        .filter(d => d)\n    }\n    return []\n  }, [projection, width, layer, height])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const labels = useMemo(() => {\n    let newLabels = markerData.reduce((res, flow) => {\n      const {\n        id,\n        xDep,\n        yDep,\n        xDest,\n        yDest,\n        strokeWidth,\n  \n        depLabelX,\n        depLabelY,\n        depLabelTextAnchor,\n  \n        destLabelX,\n        destLabelY,\n        destLabelTextAnchor,\n        fontSize,\n        datum\n      } = flow;\n      const depId = datum[layer.label.fields[0]] // `${actualXDep}-${actualYDep}`;\n      if (res[depId]) {\n        // update position if we find a larger flow for this label\n        if (res[depId].largerStrokeWidth > strokeWidth) {\n          res[depId] = {\n            ...res[depId],\n            largerStrokeWidth: strokeWidth,\n            x: xDep + depLabelX,\n            y: yDep + depLabelY,\n            textAnchor: depLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[depId].flows = [...res[depId].flows, id]\n        // create a new entry for label\n      } else {\n        res[depId] = {\n          label: datum[layer.label.fields[0]],\n          largerStrokeWidth: strokeWidth,\n          x: xDep + depLabelX,\n          y: yDep + depLabelY,\n          textAnchor: depLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n  \n      const destId = datum[layer.label.fields[1]] // `${actualXDest}-${actualYDest}`;\n      if (res[destId]) {\n        // update position if we find a larger flow for this label\n        if (res[destId].largerStrokeWidth > strokeWidth) {\n          res[destId] = {\n            ...res[destId],\n            largerStrokeWidth: strokeWidth,\n            x: xDest + destLabelX,\n            y: yDest + destLabelY,\n            textAnchor: destLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[destId].flows = [...res[destId].flows, id]\n        // create a new entry for label\n      } else {\n        res[destId] = {\n          label: datum[layer.label.fields[1]],\n          largerStrokeWidth: strokeWidth,\n          x: xDest + destLabelX,\n          y: yDest + destLabelY,\n          textAnchor: destLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n      return res;\n    }, {})\n    newLabels = Object.entries(newLabels).map(([id, label]) => ({\n      id,\n      ...label,\n      width: label.label.length * label.fontSize * 0.5,\n      actualX: label.textAnchor === 'start' ? label.x : label.x - (label.label.length * label.fontSize * 0.5),\n      height: label.fontSize,\n    }))\n    newLabels = newLabels.sort((a, b) => {\n      if (a.y > b.y) {\n        return 1;\n      }\n      return -1;\n    })\n    // resolve labels collisions\n    for (let i = 0 ; i < newLabels.length ; i++) {\n      for (let j = i + 1 ; j < newLabels.length ; j++) {\n        const label1 = newLabels[i];\n        const label2 = newLabels[j];\n\n        const minAx = label1.x;\n        const minAy = label1.y - label1.height;\n        const maxAx = label1.x + label1.width;\n        const maxAy = label1.y;\n\n        const minBx = label2.x;\n        const minBy = label2.y - label2.height;\n        const maxBx = label2.x + label2.width;\n        const maxBy = label2.y;\n\n        const aLeftOfB = maxAx < minBx;\n        const aRightOfB = minAx > maxBx;\n        const aAboveB = minAy > maxBy;\n        const aBelowB = maxAy < minBy;\n\n        if (!( aLeftOfB || aRightOfB || aAboveB || aBelowB )) {\n          if (!aAboveB || aBelowB) {\n            const distanceY = Math.abs(label1.y - (label2.y - label2.height));\n            label1.y -= distanceY / 2 ;\n            label2.y += distanceY / 2 ;\n          }\n          // if (!aLeftOfB || aRightOfB) {\n          //   const distanceX = Math.abs(label1.x - (label2.x + label2.width));\n          //   label1.x -= distanceX / 2 ;\n          //   label2.x += distanceX / 2 ;\n          // }\n        }\n      }\n    }\n    newLabels = newLabels.sort((a, b) => {\n      if (a.largerStrokeWidth > b.largerStrokeWidth) {\n        return -1;\n      }\n      return 1;\n    })\n    return newLabels;\n  }, [markerData])\n  \n\n  const [hoverIds, setHoverIds] = useState(undefined);\n  return (\n    <g className=\"FlowsLayer\" >\n      {\n        markerData\n          .map((data, index) => {\n\n            const {\n              id,\n              arrowSize,\n              xDep,\n              yDep,\n              xDest,\n              yDest,\n              strokeWidth,\n              datum,\n              layer,\n              width,\n              color,\n              height,\n              projectionTemplate,\n\n              fontSize,\n              path,\n              actualXDep,\n              actualYDep,\n              actualXDest,\n              actualYDest,\n              arrowLength,\n              depLabelTextAnchor,\n              depLabelX,\n              depLabelY,\n              destLabelTextAnchor,\n              destLabelX,\n              destLabelY,\n            } = data;\n\n            const onMouseEnter = () => {\n              setHoverIds([id]);\n            }\n            const onMouseLeave = () => {\n              setHoverIds(undefined);\n            }\n            const hovered = hoverIds && hoverIds.includes(id);\n            return (\n              <FlowGroup\n                key={index}\n                {\n                ...{\n                  hovered,\n                  id,\n                  arrowSize,\n                  xDep,\n                  yDep,\n                  xDest,\n                  yDest,\n                  strokeWidth,\n                  datum,\n                  layer,\n                  width,\n                  color,\n                  height,\n                  projectionTemplate,\n\n                  fontSize,\n                  path,\n                  actualXDep,\n                  actualYDep,\n                  actualXDest,\n                  actualYDest,\n                  arrowLength,\n                  depLabelTextAnchor,\n                  depLabelX,\n                  depLabelY,\n                  destLabelTextAnchor,\n                  destLabelX,\n                  destLabelY,\n\n                  onMouseEnter,\n                  onMouseLeave,\n                }\n                }\n              />\n            );\n          })\n      }\n      {\n        labels.map((thatLabel, index) => {\n          const {\n            id,\n            label,\n            textAnchor,\n            x,\n            // actualX,\n            y,\n            fontSize,\n            flows,\n          } = thatLabel;\n          const isVisible = hoverIds ? hoverIds.find(hoveredId => flows.includes(hoveredId)) : true;\n          const onMouseEnter = () => {\n            setHoverIds(flows);\n          }\n          const onMouseLeave = () => {\n            setHoverIds(undefined);\n          }\n          return (\n            <g\n              id={id}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            >\n              {/* <rect\n                x={actualX}\n                y={y - height}\n                width={width}\n                height={height}\n                fill=\"pink\"\n              /> */}\n              <text\n                id={id}\n                className={cx(\"label\", {'is-visible': isVisible})}\n                textAnchor={textAnchor}\n                x={x}\n                y={y}\n                fontSize={fontSize}\n              >\n                {label}\n              </text>\n            </g>\n          )\n        })\n      }\n    </g>\n  );\n}\n\nexport default FlowsLayer;","\n\n\nconst CustomObjectLayer = ({ layer, projection, width, height, projectionTemplate }) => {\n    return (\n        <g className=\"CustomObjectsLayer\">\n          {\n            typeof layer.renderObjects === 'function' ?\n                layer.renderObjects({data: layer.data, projection, width, height, projectionTemplate})\n            :\n            layer.data\n              // .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n              .map((datum, index) => {\n                // const { latitude, longitude, size, color, label } = datum;\n                // const [x, y] = projection([+longitude, +latitude]);\n                return layer.renderObject({ datum, projection, width, height, projectionTemplate })\n              })\n          }\n        </g>\n      );\n}\n\nexport default CustomObjectLayer;","import { useEffect, useState } from \"react\"\n\nconst Button = ({\n    children,\n    onMouseDown,\n    ...props\n  }) => {\n    const [isMouseDown, setState] = useState(false)\n  \n    useEffect(() => {\n      let interval\n      if (isMouseDown) {\n        console.log(\"setInterval\")\n        interval = setInterval(onMouseDown, 100)\n      }\n      return () => {\n        console.log(\"clearInterval\")\n        clearInterval(interval)\n      }\n    }, [isMouseDown, onMouseDown])\n  \n    return <button\n      {...props}\n      onMouseDown={() => {\n        setState(true)\n      }}\n      onMouseUp={() => {\n        setState(false)\n      }}\n      style={{ background: isMouseDown ? 'red' : undefined }}\n    >\n      {children}\n    </button>\n  }\n\n  export default Button ;","import { useState, useEffect } from \"react\" ;\n\nconst Input = ({\n    value: inputValue,\n    onBlur,\n    ...props\n  }) => {\n    const [value, setValue] = useState(inputValue)\n    useEffect(() => {\n      setValue(inputValue)\n    }, [inputValue])\n  \n    return <input\n      value={value}\n      onChange={(e) => {\n        setValue(e.target.value)\n      }}\n      onBlur={(e) => {\n        onBlur(e.target.value)\n      }}\n    />\n  }\n  \nexport default Input ;  ","import { uniq } from \"lodash-es\";\nimport { generatePalette } from '../../helpers/misc';\n\n\nconst Legend = ({\n  layers,\n  position,\n  layerFilter\n}) => {\n  return (\n    <div className={`Legend ${typeof position === 'string' ? position : ''}`}>\n      <h5 className=\"legend-main-title\">Lgende</h5>\n      {\n        layers\n        .filter(l => {\n          if (typeof layerFilter === 'function') {\n            return layerFilter(l);\n          }\n          return true;\n        })\n        .map((layer, id) => {\n          let hasSize;\n          let hasColors;\n          let colorModalities;\n          if (layer.size && layer.size.field) {\n            hasSize = true;\n          }\n          if (layer.color && layer.color.field) {\n            hasColors = true;\n            const colorValues = uniq(layer.data.map(datum => datum[layer.color.field]))\n            // @todo refactor the following with PointsLayer as an util\n            let palette;\n            // colors palette building\n            if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n              palette = layer.color.palette;\n            } else {\n              const colors = generatePalette('map', colorValues.length);\n              palette = colorValues.reduce((res, key, index) => ({\n                ...res,\n                [key]: colors[index]\n              }), {});\n            }\n            colorModalities = Object.entries(palette);\n          }\n          return (\n            <>\n              {\n                hasSize ?\n                <div key={id} className=\"size-legend-container\">\n                  {/* <h6 className=\"legend-title\">Taille des cercles</h6> */}\n                  <div className=\"size-legend-item\">\n                  <span className=\"size-icon-container\">\n                    <span />\n                    <span />\n                  </span>\n                  <span className=\"label\">\n                  {layer.size.title || layer.size.field}\n                  </span>\n                  </div>\n                </div>\n                : null\n              }\n              {\n                hasColors ?\n                <div key={id + 'b'} className=\"color-legend-container\">\n                  <h6 className=\"legend-title\">{layer.color.title || layer.color.field}</h6>\n                  <ul className=\"modalities-list\">\n                    {\n                      colorModalities.map(([modality, color], modalityIndex) => (\n                        <li key={modalityIndex}>\n                          <span style={{background: color}} className=\"color-marker\" />\n                          <span className=\"label\">{modality}</span>\n                        </li>\n                      ))\n                    }\n                  </ul>\n                </div>\n                : null\n              }\n            </>\n          )\n        })\n      }\n    </div>\n  )\n}\n\nexport default Legend;","/* DOCUMENTATION : API de ce GoComponent\n\n  Principe :\n    Composants rutilisable pour toutes les cartes utiliss sur les sites PORTIC\n    cartographie en SVG\n    -> permet de faire des cartes choroplthes, de reprsenter des ports, des flux de navires, ...\n\n  Paramtres : \n    * width : largeur de la carte (par dfaut  1500 px)\n    * height : hauteur de la carte (par dfaut  1500 px)\n\n    * layers : diffrentes couches de la carte ('choropleth', 'points', 'flows', 'custom'),  chaque layer il faut donner un fichier de donnes (stock dans public/data) pour construire le objets qui le constituent, les couleurs, tailles, labels de ces objets sont paramtrables \n        si layer 'custom' choisi, il faut passer au layer une fonction d'affichage des donnes :\n        - renderObject : donner un objet de donne en paramtre, la fonction s'occupe de construire sa reprsentation SVG et de la positionner individuellement sur la carte\n        - renderObjects : donner un dataset, la fonction s'occupe de construire une reprsentation SVG de l'ensemble des objets, et de grer leurs positionnement sur la carte (souvent adapt quand le positionnement n'est pas gographique, qu'on a besoin de grer les espacements entre objets ...)\n\n    * projectionTemplate : configuration de carte utilise frquemment ('France', 'coast from Nantes to Bordeaux', 'Poitou', 'rotated Poitou')\n    * projectionConfig: configuration de carte customise (ce paramtre prime sur projectionTemplate si les 2 sont donnes en mme temps)\n\n    * debug : permet d'ajuster manuellement la configuration de la carte quand true (les paramtres de zoom, les coordonnes du centre, la rotation et les translations sont ajustables)\n    \n  @TODO : documenter ce component de manire standardise\n  */\n\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport { geoEqualEarth } from \"d3-geo\";\nimport ChoroplethLayer from './ChoroplethLayer';\nimport PointsLayer from './PointsLayer';\nimport FlowsLayer from './FlowsLayer';\nimport CustomObjectLayer from './CustomObjectLayer';\n// import TriangleChart from '../TriangleChart/TriangleChart';\nimport Button from './Button';\nimport Input from './Input';\nimport Legend from './Legend';\n\nimport './GeographicMapChart.scss'\nimport { fixSvgDimension } from '../../helpers/misc';\n\n\nconst GeographicMapChart = ({\n  width: inputWidth = 1500,\n  height: inputHeight = 1500,\n  title,\n  layers = [],\n  projectionTemplate: initialProjectionTemplate,\n  projectionConfig: inputProjectionConfig, // customed config that will overwrite a template (optional argument) \n  debug = false, // @TODO :  rparer\n  withLegend,\n  legendLayerFilter\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur rgion\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n  const [projectionTemplate, setProjectionTemplate] = useState(initialProjectionTemplate)\n\n  // trick for nice animations\n  useEffect(() => {\n    // setTimeout(() => {\n      setProjectionTemplate(initialProjectionTemplate);\n    // })\n  }, [initialProjectionTemplate])\n\n\n  // define a default map Config\n  const defaultProjectionConfig = useMemo(() => {\n    return {\n      rotationDegree: 0,\n      centerX: 2.4486203,\n      centerY: 46.8576176,\n      scale: height * 5\n    };\n  }, [height]) // repsonsive : se fait en fonction de la height de l'cran\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => { // def les bonnes valeurs pour la config de la projection // enregistrer dans le state // les appliquer dans la projection\n\n    let projectionConfig = { ...defaultProjectionConfig } // casser la rfrence  defaultProj pour respecter principe react qu'on ne modifie pas un objet reu en argument\n\n    let projection = geoEqualEarth()\n\n    switch (projectionTemplate) {\n      case 'World':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * .5,\n          centerX: -1,\n          centerY:  15,\n          // translationX: width * 0.4,\n          // translationY: height * 0.28\n        }\n        break;\n      case 'coast from Nantes to Bordeaux':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 24,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.28\n        }\n        break;\n      case 'Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 30,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'Poitou zoomed':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 23,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'rotated Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          rotationDegree: 58,\n          scale: height * 32,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.29,\n          translationY: height * 0.25\n        }\n        break;\n      case 'France':\n      default: // as France config \n        // console.log('projection config in dry version', projectionConfig);\n        // console.log(`we are taking the config as specified in config parameters ===> if not specified, the view should correspond to France`);\n        break;\n    }\n\n    if (inputProjectionConfig !== undefined) {\n      projectionConfig = {\n        ...projectionConfig,\n        ...inputProjectionConfig\n      }\n    }\n\n    // update the config\n    setScale(projectionConfig.scale)\n\n    setRotation(projectionConfig.rotationDegree)\n\n    setCenterX(projectionConfig.centerX)\n    setCenterY(projectionConfig.centerY)\n\n    if (projectionConfig.translationX !== undefined) {\n      setTranslationX(projectionConfig.translationX)\n      setTranslationY(projectionConfig.translationY)\n    }\n    else {\n      projectionConfig.translationX = width / 2;\n      projectionConfig.translationY = height / 2;\n      setTranslationX(width / 2)\n      setTranslationY(height / 2)\n    }\n\n    projection\n      .scale(projectionConfig.scale)\n\n    projection.center([projectionConfig.centerX, projectionConfig.centerY])\n\n    if (projectionConfig.rotationDegree) {\n      projection.angle(projectionConfig.rotationDegree)\n    }\n\n    projection.translate([projectionConfig.translationX, projectionConfig.translationY])\n\n    return projection;\n  }, [width, height, defaultProjectionConfig, inputProjectionConfig, projectionTemplate]) \n\n\n\n  // const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n  return (\n    <div className=\"GeographicMapChartWrapper\">\n\n      {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div className=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg className=\"GeographicMapChart\" width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n\n        {\n          layers.map((layer, layerIndex) => {\n\n            switch (layer.type) {\n              case 'choropleth':\n                return <ChoroplethLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  reverseColors={layer.reverseColors}\n                />\n\n              case 'points':\n                return <PointsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'flows': \n                return <FlowsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  projectionTemplate={projectionTemplate}\n                />\n\n              case 'custom':\n                return <CustomObjectLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  projectionTemplate={projectionTemplate}\n                  width={width}\n                  height={height}\n                />\n\n              default:\n                return <g key={layerIndex}><text>Unsupported layer type</text></g>\n            }\n          })\n        }\n        {/* <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n        <rect x=\"58%\" y=\"78%\" width={width * 0.4} height={height * 0.2} rx=\"15\" ry=\"15\" fill={'white'} opacity={0.5} /> */}\n      </svg>\n      {\n        withLegend ?\n        <Legend layerFilter={legendLayerFilter} layers={layers} position={withLegend} />\n        : null\n      }\n      <ReactTooltip id=\"geo-tooltip\" />\n    </div>\n  )\n}\n\nexport default GeographicMapChart;","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  // const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      // const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      // setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number',\n    autoSort: yAutoSort = false\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + xExtent[1] % xTickSpan;\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  \n\n  // let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  const xAxisValues = xTickSpan ? range(xDomain[0], xDomain[xDomain.length - 1], xTickSpan) : xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 15} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = fixSvgDimension(height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom);\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={fixSvgDimension(xScale(end) - xScale(start))}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={fixSvgDimension(thatX2 - thatX1)}\n                        y={yScale(start)}\n                        height={fixSvgDimension(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          if (!yAutoSort) {\n                            return 0;\n                          }\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={fixSvgDimension(bandWidth)}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={fixSvgDimension(thatHeight)}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width: initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n\n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ? headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ? legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort: sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    autoSort = false,\n    ascending: sortYAscending = true,\n    type: sortYType,\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixSvgDimension(fixedRowHeight || vizHeight / bandsNb);\n\n  const groups = Object.entries(groupBy(data, d => d[y.field]));\n\n  const xDomain = initialXDomain || layout === 'stack' ?\n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) =>\n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n    )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n  let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n  const xScale = scaleLinear().domain(xDomain).range([0, width - margins.left - margins.right]).nice();\n  const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + xDomain[1] % xTickSpan;\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n  return (\n    <>\n      <figure style={{ width: initialWidth, height: finalHeight }} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={valueIndex}\n                    transform={`translate(${margins.left + xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    {/* <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    /> */}\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                  .sort((a, b) => {\n                    if (!autoSort) {\n                      return 0;\n                    }\n                    const multiplier = sortYAscending ? 1 : -1;\n                    if (sortYField === y.field) {\n                      const aVal = sortYType === 'number' ? +a[0] : a[0];\n                      const bVal = sortYType === 'number' ? +b[0] : b[0];\n                      if (aVal < bVal) {\n                        return -1 * multiplier;\n                      }\n                      return 1 * multiplier;\n                    }\n                    const aVal = sortYType === 'number' ?\n                      +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : a[1][sortYField];\n                    const bVal = sortYType === 'number' ?\n                      +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : b[1][sortYField];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n\n                  })\n                  .map(([yModality, items], groupIndex) => {\n                    let stackDisplaceX = margins.left;\n                    return (\n                      <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                        <foreignObject \n                          x={0} \n                          y={layout === 'stack' ? bandHeight / 4 : (bandHeight * items.length) / 2 /* + bandHeight * (items.length / 2)*/} \n                          width={margins.left} \n                          height={rowHeight * 2}\n                        >\n                          <div className=\"vertical-bar-label\">\n                          <div>{typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}</div>\n                          </div>\n                        </foreignObject>\n                        {/* <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                          {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                        </text> */}\n                        {\n                          items\n                            .sort((a, b) => {\n                              if (!autoSort) {\n                                return 0;\n                              }\n                              const multiplier = sortXAscending ? 1 : -1;\n                              const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n                              const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n                              if (aVal > +bVal) {\n                                return -1 * multiplier;\n                              }\n                              return 1 * multiplier;\n                            })\n                            .map((item, itemIndex) => {\n\n                              const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                              const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) : xScale(item[x.field]);\n                              const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                              if (layout === 'stack') {\n                                stackDisplaceX += thatWidth;\n                              }\n                              const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                              return (\n                                <>\n                                  {\n                                    +item[x.field] > 0 ?\n                                      <rect key={itemIndex}\n                                        fill={thatColor}\n                                        width={fixSvgDimension(thatWidth)}\n                                        x={thatX}\n                                        y={thatY}\n                                        height={fixSvgDimension(bandHeight - 1)}\n                                        data-for=\"bar-tooltip\"\n                                        data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                      />\n                                      : null\n                                  }\n                                </>\n                              )\n                            })\n                        }\n                      </g>\n                    );\n                  })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color], modalityIndex) => (\n                        <li\n                          key={modalityIndex}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","var map = {\n\t\"./en/about.mdx\": [\n\t\t225\n\t],\n\t\"./en/footer.mdx\": [\n\t\t642,\n\t\t5\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t216\n\t],\n\t\"./en/metadata\": [\n\t\t338,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t338,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t219\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t643,\n\t\t6\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t644,\n\t\t7\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t645,\n\t\t8\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t221\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t223\n\t],\n\t\"./en/references.mdx\": [\n\t\t227\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t646,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t228\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t224\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t121\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t215\n\t],\n\t\"./fr/metadata\": [\n\t\t339,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t339,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t218\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t220\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t222\n\t],\n\t\"./fr/references.mdx\": [\n\t\t226\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t647,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t229\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 635;\nmodule.exports = webpackAsyncContext;","const Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore t dveloppe</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport { extent, max } from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\n\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n\n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ',' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n\n  }, [wholeHeight])\n\n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n    .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[shareField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n\n  const { values: rightYAxisValues } = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  let { values: leftYAxisValue } = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  if (yShareScale.domain()[1] - yShareScale.domain()[0] <= 5) {\n    leftYAxisValue = axisPropsFromTickScale(yShareScale, 5).values;\n  }\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", { 'has-highlights': highlightYears !== undefined })}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n              <div className=\"color-scale-container\">\n                <div className=\"color-scale-detail\">\n                  <div\n                    className=\"bar\"\n                    style={{\n                      background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                    }}\n                  />\n                  <div className=\"labels\">\n                    <span>{colorScaleMessages.maximum}</span>\n                    {/* <span>{colorScaleMessages.title}</span> */}\n                    <span>{colorScaleMessages.minimum}</span>\n                  </div>\n                </div>\n              </div>\n              : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value / 1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n              .map((year, i) => {\n                const x = xBand(year) + xBand.bandwidth() / 2;\n                const y = height - margins.bottom;\n                return (\n                  <g\n                    key={i}\n                    className=\"axis-group\"\n                    transform={`translate(${x}, ${y})`}\n                  >\n                    <line\n                      x1={0}\n                      x2={0}\n                      y1={0}\n                      y2={margins.bottom / 6}\n                      stroke=\"grey\"\n                    />\n                    <g\n                      transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                    >\n                      <text fill=\"grey\">\n                        {year}\n                      </text>\n                    </g>\n                  </g>\n                )\n              })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    <rect\n                      x={xBand(startYear)}\n                      width={xBand(endYear) - xBand(startYear)}\n                      height={fixSvgDimension(height - margins.top - margins.bottom)}\n                      y={margins.top}\n                      fill=\"url(#diagonalHatch)\"\n                      opacity={.4}\n                    />\n                    <line\n                      x1={xBand(startYear)}\n                      x2={xBand(startYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <line\n                      x1={xBand(endYear)}\n                      x2={xBand(endYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={fixSvgDimension(yShareScale(0) - yShareScale(d[shareField]))}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ?\n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] || 0).toFixed(2))\n                      .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] || 0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', { 'is-highlighted': highlightYears && highlightYears.includes(+d.year) })}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {/* data points circles */\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .filter(datum => +datum[absoluteField])\n              .map((datum, index) => {\n                \n                const x = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const y = yAbsoluteScale(+datum[absoluteField]);\n                return (\n                  <>\n                    <circle\n                      key={index}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: width * 0.005\n                      }\n                      }\n                      fill={'transparent'}\n                      data-tip={`${datum.year} : export de <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois.`}\n                      data-for={cityName}\n                      data-class=\"bar-tooltip\"\n                      data-html={true}\n                    />\n                    <circle\n                      key={index + 'a'}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: 1.5\n                      }\n                      }\n                      fill={colorsPalettes.generic.accent1}\n                    />\n                  </>\n                )\n              })\n          }\n          {\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              // .filter((d, index) => {\n              //   const next = data[index + 1];\n              //   if (+d.year === 1787 && !barTooltipFn) {\n              //     console.log('2 next for 1787', d.year, +next.year, next)\n              //   }\n              //   return index < data.length - 1\n              //     && (fillGaps ? true : +next.year === +d.year + 1)\n              // })\n              .map((datum, index) => {\n                const next = data[index + 1];\n                if (index === data.length - 1 || fillGaps ? false : +next.year !== +datum.year + 1) {\n                  return null;\n                }\n                if (!next) {\n                  return null;\n                }\n                const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const x2 = xBand(+next.year) + xBand.bandwidth() / 2;\n                const y1 = yAbsoluteScale(+datum[absoluteField]);\n                const y2 = yAbsoluteScale(+next[absoluteField]);\n                if (!+datum[absoluteField] || !+next[absoluteField]) {\n                  return null;\n                }\n                const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n                return (\n                  <line\n                    key={datum.year}\n                    {\n                    ...{\n                      x1,\n                      x2,\n                      y1,\n                      y2\n                    }\n                    }\n                    stroke={colorsPalettes.generic.accent1}\n                    title={`${datum.year}-${next.year}`}\n                    strokeWidth={2}\n                    data-tip={`${datum.year}  <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year}  <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                  />\n                )\n              })\n          }\n\n        </g>\n\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear, label, row = 0, labelPosition = 'right' } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    {\n                      labelPosition === 'right' ?\n                        <>\n                          <line\n                            x1={xBand(endYear) + 20}\n                            x2={xBand(endYear) + 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(endYear) + 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                        :\n                        <>\n                          <line\n                            x1={xBand(startYear) - 20}\n                            x2={xBand(startYear) - 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(startYear) - 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            textAnchor={'end'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                    }\n\n                    <defs>\n                      <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\"\n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                        <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                      </marker>\n                    </defs>\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n\n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = fixSvgDimension(wholeHeight);\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${thisYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3  className=\"visualization-title\" style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg \n        ref={svgRef} \n        className={cx(\"links-container\", {'has-highlights': hoveredProduct})} \n        style={{top: svgOffset}} \n        width={width} \n        height={height}\n      >\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      key={index}\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 15])\n\n          return (\n            <div\n            key={yearIndex}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d.product, (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d.product}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineChart from './DeclineChart';\n\nexport default DeclineChart;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineChart.scss';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nconst DeclineChart = (props) => {\n  const {\n    width: inputWidth, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const width = fixSvgDimension(inputWidth);\n  const messages = {\n    franceOverviewTitle: {\n      fr: (start, end) => `volution de la valeur des exports du royaume de France de ${start}  ${end}`,\n      en: (start, end) => `Evolution of the value of exports from the kingdom of France from ${start} to ${end}`\n    },\n    tradeEvolutionTitle: {\n      fr: (cityName, start, end) => `volution du commerce de la direction des fermes de ${cityName} de ${start}  ${end}`,\n      en: (cityName, start, end) => `Evolution of the direction des fermes of ${cityName} trade from ${start} to ${end}`\n    },\n    top90PctTitle: {\n      fr: (cityName, start, end) => `Comparaison des parts des produits exports par la direction des fermes de ${cityName} totalisant plus de 90% du commerce en ${start} et en ${end} (ports francs non pris en compte)`,\n      en: (cityName, start, end) => `Comparison of shares of the top 90% of exported products by the direction des fermes of ${cityName} in ${start} and in ${end} (ports francs non pris en compte)`,\n    },\n    partInPct: {\n      fr: () => 'part des exports fr.',\n      en: () => 'share of french exports'\n    },\n    absoluteValue: {\n      fr: () => 'valeur absolue des exports',\n      en: () => 'exports\\' absolute value'\n    },\n    herfindalLegendTitle: {\n      // fr: () => `Degr de diversit du commerce (inverse de lindice de Herfindahl)`,\n      // en: () => `Degree of trade diversity (inverse of the Herfindahl index)`,\n      fr: () => `degr de diversit du commerce`,\n      en: () => `degree of trade diversity`,\n    },\n    herfindal0: {\n      fr: () => `commerce peu diversifi`,\n      en: () => `fewly diversified trade`,\n    },\n    herfindal1: {\n      fr: () => `commerce trs diversifi`,\n      en: () => `very diversified trade`,\n    },\n    barTooltip: {\n      fr: (year, pct, city, herfindal) => `En <strong>${year}</strong>, ${pct}% des biens exports depuis la France le sont  partir de <strong>${city}</strong>.<br/><br/>Concentration du commerce <i>(indice de Herfindahl-Hirschmann : somme du carr des parts du march franais par classe de produits exports)</i> : <span>[colorBox] ${herfindal}</span>`,\n      en: (year, pct, city, herfindal) => `In <strong>${year}</strong>, ${pct}% of exported goods from France are exported <strong>${city}</strong>.<br/><br/>Trade concentration <i>(Herfindahl-Hirschmann index : sum of square french market' shares sorted by exported products classes)</i> : <span>[colorBox] ${herfindal}</span>`,\n    },\n    productTooltip: {\n      fr: (year, product, pct) => `En <strong>${year}</strong>, les produits de la classe \"${product}\" reprsentent <strong>${pct}%</strong> de la valeur des biens exports par la direction des fermes de La Rochelle.`,\n      en: (year, product, pct) => `In <strong>${year}</strong>, products classed as \"${product}\" represent ${pct}% of goods exported by La Rochelle's direction des fermes.`,\n    },\n    sevenYearsWar: {\n      fr: () => 'guerre de sept ans',\n      en: () => 'seven years war'\n    },\n    austriaWar: {\n      fr: () => 'guerre franco-britannique au sein de la guerre de succession dAutriche',\n      en: () => 'guerre franco-britannique au sein de la guerre de succession dAutriche',\n    },\n    usIndependance: {\n      fr: () => 'guerre dindpendance Amricaine',\n      en: () => 'guerre dindpendance Amricaine',\n    },\n    laRochelleDiaspora: {\n      fr: () => 'Organisation de convois partant de La Rochelle pour chapper aux Anglais',\n      en: () => 'Organisation de convois partant de La Rochelle pour chapper aux Anglais',\n    },\n    // absolute1789: {\n    //   fr: item => `Total des exports en 1789 : ${(item.Exports / 1000000).toFixed(1)} m. de livres tournois`,\n    //   en: item => `Total des exports en 1789 : ${(item.Exports / 1000000).toFixed(1)} m. de livres tournois`\n    // }\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle[lang](startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: .5,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance[lang]()\n              },\n\n              \n            ]}\n            // fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip[lang]}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 1,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1747,\n                endYear: 1747,\n                row: 2,\n                label: messages.laRochelleDiaspora[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance[lang]()\n              },\n              // {\n              //   type: 'span',\n              //   startYear: 1789,\n              //   endYear: 1789,\n              //   row: 4,\n              //   labelPosition: 'left',\n              //   label: messages.absolute1789[lang](datasets['decline_longitudinal_data.csv'].find((d) => d.region === \"La Rochelle\" && d.year === \"1789\"))\n              // },\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            barTooltipFn={ messages.barTooltip[lang]}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                row: 0.5,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 0,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 1,\n                label: messages.usIndependance[lang]()\n              },\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products/decline_LR_products.csv`] || !datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products/decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data/decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle[lang]('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip[lang]}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineChart\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineChart;\n","import Decline from '../components/DeclineChart';\n\nconst PrincipalVisualizationPart1 = ({width, height, step, ...props}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialChart.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, fixSvgDimension, trimText } from '../../helpers/misc';\nimport ReactTooltip from 'react-tooltip';\nimport { useSpring, animated } from 'react-spring'\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3];\n\nconst G =({children, className, onClick, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.g className={className} onClick={onClick} {...props}>\n      {children}\n    </animated.g>\n  )\n}\nconst Text =({children, onClick, className, style, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.text className={className} onClick={onClick} style={style} {...props}>\n      {children}\n    </animated.text>\n  )\n}\nconst Line = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.line className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nconst Circle = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.circle className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nconst Rect = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.rect className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nconst Path = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.path className={className} onClick={onClick} style={style} {...props} />\n  )\n}\n\nconst CircularAlluvialChart = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width: inputWidth = 1200,\n  height : inputHeight = 800,\n  filters = [],\n  debug = false,\n  title,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true,\n  tooltips,\n  lang,\n  align = 'left'\n}) => {\n  const titleRef = useRef(null);\n  let height = titleRef.current ? inputHeight - titleRef.current.getBoundingClientRect().height : inputHeight;\n  height = fixSvgDimension(height);\n  const width = fixSvgDimension(inputWidth);\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters]);\n\n  let tooltipContent;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }, [filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 50]).domain([0, 1])\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n  return (\n    <>\n      <h5 ref={titleRef} className=\"visualization-title\">{title}</h5>\n      <svg \n        data-for=\"alluvial-tooltip\"\n        data-tip={tooltipContent}\n        width={width} \n        height={height} \n        className={cx(\"CircularAlluvialChart\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}\n      >\n        <G  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <G className=\"background-marks\" transform={`translate(${align === 'left' ?  0 : width / 2 - smallestDimension / 2}, 0)`} >\n          <Line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </Text>\n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </Text>\n        </G>\n        <G \n          transform={`translate(${align === 'left' ? 0 : width / 2 - smallestDimension / 2}, 0)`}\n        >\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <G\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <Rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <G\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleClick = () => {\n                                      if (highlightedFlow && highlightedFlow._id === flow._id) {\n                                        setHighlightedFilter(undefined);\n                                        setHighlightedFlow(undefined);\n                                      }\n                                      else {\n                                        if (highlightedFilter) {\n                                          setHighlightedFilter(undefined);\n                                        }\n                                        setHighlightedFlow({...flow, stepIndex});\n                                      }\n                                      \n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH;\n                                      y3 += BAR_WIDTH;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH;\n                                      y4 += BAR_WIDTH;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    const {flow_type, customs_office, product, partner} = flow;\n                                    const value = flow[sumBy];\n                                    const tContent = tooltips.flow[lang]({flow_type, customs_office, product, sumBy, value, partner})\n                                    return (\n                                      <G\n                                        onClick={handleClick}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                        data-for=\"alluvial-tooltip\"\n                                        data-tip={tContent}\n                                      >\n                                        {/* <Path \n                                    d={`\n                                    M ${x1} ${y1} \n                                    Q ${controlPoint1AX} ${controlPoint1AY}, ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    Q ${controlPoint2AX} ${controlPoint2AY}, ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                    title={'Valeur : ' + flow.valueAbs}\n                                    style={{fill: colorScales[step.field][node.id]}}\n                                  /> */}\n                                        <Path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <Line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <Line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <Line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <Line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </G>\n                                    )\n                                  })\n                              }\n                            </G>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH;\n                        }\n                        const handleClick = () => {\n                          if (highlightedFilter && highlightedFilter.value === node.id) {\n                            setHighlightedFlow(undefined);\n                            setHighlightedFilter(undefined);\n                          }\n                          else {\n                            if (highlightedFlow) {\n                              setHighlightedFlow(undefined);\n                            }\n                            setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                          }\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                          // console.groupEnd('test');\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        const tContent = tooltips.node[lang](node, stepIndex);\n                        return (\n                          <G\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onClick={handleClick}\n                            data-for=\"alluvial-tooltip\"\n                            data-tip={tContent}\n                          >\n                            <Rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <G\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <Text\n                                style={{\n                                  fontSize: stepIndex === 0 || [2, 3, 5].find(index => index === stepIndex) ? labelFontSize * .75 : labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </Text>\n                            </G>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <Line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 ||stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <Rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </G>\n                        )\n                      })\n                    }\n\n                  </G>\n                )\n              })\n          }\n        </G>\n        </G>\n      </svg>\n      <ReactTooltip id=\"alluvial-tooltip\" />\n    </>\n  )\n}\n\nexport default CircularAlluvialChart;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import React from 'react';\nimport Slider/*, { SliderTooltip }*/ from 'rc-slider';\nimport 'rc-slider/assets/index.css';\n\nconst { createSliderWithTooltip } = Slider;\nconst Range = createSliderWithTooltip(Slider.Range);\n\nconst SliderRange = ({ title, min, max, value, onChange }) => {\n    const style = { width: 300, margin: 50 };\n\n    return (\n        <div style={style}>\n            <p>{title}</p>\n           <Range \n            allowCross={false} \n            min={min} \n            max={max} \n            value={value} \n            onChange={onChange} \n          />\n        </div>\n    )\n    }\n    \nexport default SliderRange;","import SliderRange from './SliderRange';\n\nexport default SliderRange;","import React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { polarToCartesian } from '../../helpers/misc';\n\n\nconst AxisObject = ({\n  size,\n  MARGIN,\n  axisIndex,\n  axisRankScale,\n  axis,\n  label\n}) => {\n    const [rawX1, rawY1] = [size/2 + MARGIN / 2, size/2 + MARGIN / 2];\n    const [x2Rel, y2Rel] = polarToCartesian(size/2, axisRankScale(axisIndex))\n    const rawX2 = rawX1 + x2Rel;\n    const rawY2 = rawY1 + y2Rel;\n    let labelXDisplace = -MARGIN / 8;\n    let labelYDisplace = 15;\n    if (axisIndex > 0) {\n      labelYDisplace = -10;\n      if (axisIndex === axis.length / 2) {\n        labelYDisplace = -20;\n        labelXDisplace = -MARGIN / 6;\n      } else if (axisIndex < axis.length / 2) {\n        labelXDisplace = -MARGIN / 2;\n      } else {\n        labelXDisplace = 5;\n      }\n      // special cases\n      if (axisIndex === 3 || axisIndex === 5) {\n        labelYDisplace = -30;\n      }\n      if (axisIndex === 7) {\n        labelYDisplace = 5;\n      }\n      if (axisIndex === 1) {\n        labelYDisplace = 5;\n        labelXDisplace = -MARGIN/3;\n      }\n    }\n    const {\n      x1,\n      y1,\n      x2,\n      y2,\n      labelX,\n      labelY\n    } = useSpring({\n      x1: rawX1,\n      y1: rawY1,\n      x2: rawX2,\n      y2: rawY2,\n      labelX: rawX2 + labelXDisplace,\n      labelY: rawY2 + labelYDisplace\n    })\n    return (\n      <g key={axisIndex} className=\"AxisObject\">\n        <animated.line\n          {\n            ...{\n              x1,\n              y1,\n              x2,\n              y2,\n            }\n          }\n        />\n        <animated.foreignObject \n          x={labelX} \n          y={labelY} \n          width={MARGIN * .7} \n          height={MARGIN}\n        >\n          <div className=\"label\">\n            {label}\n          </div>\n        </animated.foreignObject>\n      </g>\n    )\n}\n\nexport default AxisObject;","import { sum } from 'lodash';\nimport React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { fixSvgDimension, polarToCartesian } from '../../helpers/misc';\n\nconst Circle = ({\n  cx: inputX,\n  cy: inputY,\n  r: inputR,\n  ...props\n}) => {\n  const {\n    cx,\n    cy,\n    r,\n  } = useSpring({\n    cx: fixSvgDimension(inputX),\n    cy: fixSvgDimension(inputY),\n    r: inputR\n  })\n  return (\n    <animated.circle\n      cx={cx}\n      cy={cy}\n      r={r}\n      {...props}\n    />\n  )\n}\n\nconst VisObject = ({\n  color,\n  data,\n  axisIndexMap,\n  axisRankScale,\n  center,\n  name,\n  radiusScale\n}) => {\n  const points = Object.entries(axisIndexMap)\n  .map(([key, index]) => {\n    const val = data[key] || 0;\n    const r = radiusScale(val);\n    const theta = axisRankScale(+index);\n    const [xRaw, yRaw] = polarToCartesian(r, theta);\n    const x = fixSvgDimension(xRaw + center[0]);\n    const y = fixSvgDimension(yRaw + center[1]);\n    return [x, y]\n  })\n  const {joinedPoints} = useSpring({\n    joinedPoints: points.map(([x, y]) => `${x},${y}`).join(' ')\n  });\n\n  let tooltipValues = Object.entries(data);\n  const sumOfParts = sum(tooltipValues.map(v => v[1]));\n  tooltipValues = tooltipValues.map(([key, val]) => [key, val / sumOfParts])\n  return (\n    <g \n      className=\"VisObject\"\n      data-for=\"radar-tooltip\"\n      data-html={true}\n      data-place=\"left\"\n      data-tip={`\n      <p>\n      ${name === 'Tous les bureaux' ? 'Parts des destinations des voyages de 1789 initis depuis tous les ports de la rgion' : 'Part des destinations pour les voyages de 1789 initis depuis des ports rattachs au bureau des fermes de <strong>' + name + '</strong>'} :\n      </p>\n      <ol>\n        ${\n          tooltipValues\n          .sort(([_key, portionA], [_key2, portionB]) => {\n            if (portionA > portionB) {\n              return -1;\n            }\n            return 1;\n          })\n          .map(([key, portion]) => `\n            <li>\n              <strong>${key}</strong> : <strong>${(portion * 100).toFixed(2)}%</strong>\n            </li>\n          `).join('\\n')\n        }\n      </ol>\n  `}\n    >\n      <animated.polygon\n        points={joinedPoints}\n        fill={color}\n        fillOpacity={.5}\n      />\n      {\n        points\n        .map(([x, y], index) => {\n          return (\n            <Circle\n              key={index}\n              cx={x}\n              cy={y}\n              r={1}\n              fill={color}\n            />\n          )\n        })\n      }\n    </g>\n  )\n}\n\nexport default VisObject;","import RadarPlot from './RadarPlot';\n\nexport default RadarPlot;","import { scaleLinear } from 'd3-scale';\nimport React, { useEffect, useMemo } from 'react';\nimport { useSpring, animated } from 'react-spring'\nimport Tooltip from 'react-tooltip';\n\nimport AxisObject from './AxisObject';\nimport VisObject from './VisObject';\n\nconst RadarPlot= ({\n  data,\n  size : wholeSize = 100,\n  axis,\n}) => {\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  const axisIndexMap = useMemo(() =>\n    axis.reduce((res, a, aIndex) => ({\n      ...res,\n      [a]: aIndex\n    }), {})\n  , [axis])\n  const MARGIN = 100;\n  const size = wholeSize - MARGIN;\n  const { visCenter, visSize } = useSpring({\n    visCenter: size/2 + MARGIN / 2,\n    visSize: size/2,\n  })\n  const axisRankScale = scaleLinear().domain([0, axis.length]).range([Math.PI / 2, Math.PI * 2.5])\n  const radiusScale = scaleLinear().domain([0, 1]).range([0, size / 2])\n  return (\n    <>\n    <svg className=\"RadarPlot\" width={wholeSize} height={wholeSize}>\n      <animated.circle\n        cx={visCenter}\n        cy={visCenter}\n        r={visSize}\n        strokeWidth={.5}\n        stroke=\"grey\"\n        fill=\"none\"\n      />\n      <g className=\"background-container\">\n        {\n          axis.map((label, axisIndex) => (\n            <AxisObject\n              key={axisIndex}\n              {\n                ...{\n                  size,\n                  MARGIN,\n                  axisIndex,\n                  axisRankScale,\n                  axis,\n                  label\n                }\n              }\n            />\n          ))\n        }\n      </g>\n      <g className=\"objects-container\">\n        {\n          data.map((datum, datumIndex) => (\n            <VisObject\n              key={datum.meta.name}\n              color={datum.meta.color}\n              name={datum.meta.name}\n              data={datum.data}\n              axisIndexMap={axisIndexMap}\n              axisRankScale={axisRankScale}\n              center={[size/2 + MARGIN / 2, size/2 + MARGIN / 2]}\n              radiusScale={radiusScale}\n            />\n          ))\n        }\n      </g>\n    </svg>\n    <Tooltip id=\"radar-tooltip\" />\n    </>\n  )\n}\n\nexport default RadarPlot;\n","/* eslint react-hooks/exhaustive-deps : 0 */\nimport { useEffect, useMemo, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport _, { maxBy, uniqBy, sumBy, values } from 'lodash';\nimport cx from 'classnames';\n\nimport SliderRange from '../../components/SliderRange';\nimport RadarPlot from '../../components/RadarPlot';\n\n\nconst prepareTravelData = datas => {\n  return _(datas)\n    .groupBy('destination_radar')\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = dest.length;\n      return rObj;\n    })\n    .value();\n};\n\nconst prepareTonnageData = (datas) => {\n  return _(datas)\n    .groupBy(\"destination_radar\")\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = sumBy(dest, \"tonnage\");\n      return rObj;\n    })\n    .value();\n};\n\n\nconst normalizeRadarValues = (datas, destCaptions) => {\n  // mapping on max value\n  const maxValue = maxBy(values(datas), function (o) {\n    return o;\n  });\n  // mapping on sum\n  // const maxValue = sum(values(datas))\n  var x = scaleLinear()\n    .domain([0, maxValue])\n    .range([0, 1]);\n  for (var key in datas) {\n    if (datas.hasOwnProperty(key)) {\n      datas[key] = x(datas[key]);\n    }\n  }\n  for (var dkey in destCaptions) {\n    if (!datas.hasOwnProperty(dkey)) {\n      datas[dkey] = 0\n    }\n  }\n\n  return datas;\n};\n\nconst RadarWrapper = ({\n  data: inputData,\n  globalWidth = 500,\n  minified,\n  title,\n  bureaux = \"tous\",\n  navigoAgregation = \"tonnage\",\n  minTonnage,\n  maxTonnage,\n  axis = [],\n  colorPalette\n}) => {\n  const [selectedBureaux, setSelectedBureaux] = useState(new Set(['Tous les bureaux']));\n  const [aggregationMethod, setAggregationMethod] = useState('tonnage');\n  const [tonnageFilterValues, setTonnageFilterValues] = useState([]);\n  const [datasetMaximumTonnage, setDatasetMaximumTonnage] = useState();\n  const datasetMinimumTonnage = 0;\n\n  /**\n   * DATA UPDATE\n   */\n  const data = useMemo(() => {\n    if (inputData) {\n      const newData = inputData.map(d => {\n        // remove csv empty values\n        if ((d.destination_radar !== '') & (d.ferme_bureau !== '')) {\n          return {\n            ferme_bureau: d.ferme_bureau,\n            destination_radar: d.destination_radar.replace(/['\"]+/g, ''),\n            tonnage: +d.tonnage\n          };\n        }\n        return undefined;\n      })\n        .filter(d => d)\n      // setDestCaptions(Object.assign({}, ...prepareDestCaptions(newData)))\n      let max = maxBy(newData, 'tonnage').tonnage;\n      setDatasetMaximumTonnage(max);\n      if (maxTonnage) {\n        max = +maxTonnage;\n      }\n      let min = datasetMinimumTonnage;\n      if (minTonnage) {\n        min = +minTonnage;\n      }\n      setTonnageFilterValues([min, max]);\n      return newData;\n    }\n    return inputData;\n  }, [inputData])\n\n  const bureauxList = useMemo(() => {\n    return [\n      'Tous les bureaux',\n      ...uniqBy(data, 'ferme_bureau').map(({ ferme_bureau }) => ferme_bureau)\n    ]\n  }, [data])\n\n  const filteredData = useMemo(() => {\n    const bureauxToKeep = Array.from(selectedBureaux);\n    return data\n      .filter(datum => {\n        if (bureauxToKeep.includes('Tous les bureaux')) {\n          return true;\n        }\n        return bureauxToKeep.includes(datum.ferme_bureau)\n      })\n      .filter(datum => {\n        if (aggregationMethod === 'tonnage' && tonnageFilterValues && tonnageFilterValues.length) {\n          return datum.tonnage >= tonnageFilterValues[0]\n            && datum.tonnage <= tonnageFilterValues[1]\n        }\n        return true;\n      })\n  }, [data, selectedBureaux, tonnageFilterValues])\n\n  /**\n   * UPDATE FROM PROPS\n   */\n  /** update from navigoAgregation prop */\n  useEffect(() => {\n    setAggregationMethod(navigoAgregation);\n  }, [navigoAgregation])\n\n  /** update from bureaux prop */\n  useEffect(() => {\n    if (bureaux) {\n      const cleanBureaux = (bureaux).split(',')\n      .map(b => b.trim())\n      .map(b => b === 'tous' ? 'Tous les bureaux' : b)\n    setSelectedBureaux(new Set(cleanBureaux));\n    }\n    \n  }, [bureaux])\n\n  /** update from maxTonnage prop */\n  useEffect(() => {\n    if (maxTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([tonnageFilterValues[0], +maxTonnage]);\n      } else {\n        setTonnageFilterValues([0, +maxTonnage]);\n      }\n    }\n  }, [maxTonnage])\n\n  /** update from minTonnage prop */\n  useEffect(() => {\n    if (minTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([+minTonnage, tonnageFilterValues[1]]);\n      } else {\n        const max = maxBy(data, 'tonnage').tonnage;\n        setTonnageFilterValues([+minTonnage, max]);\n      }\n    }\n  }, [minTonnage])\n\n\n  const radarData = useMemo(() => {\n    const bureauxObjects = Array.from(selectedBureaux);\n\n    return bureauxObjects.map((bureauName) => {\n      const relevantData = bureauName === 'Tous les bureaux' ? filteredData :\n        filteredData.filter(datum => datum.ferme_bureau === bureauName);\n      const preparedData = aggregationMethod === 'tonnage' ? prepareTonnageData(relevantData) : prepareTravelData(relevantData);\n      return {\n        data: normalizeRadarValues\n          (Object.assign({}, ...preparedData)\n          ),\n        meta: {\n          color: colorPalette[bureauName],\n          name: bureauName\n        }\n      }\n    })\n  }, [selectedBureaux, tonnageFilterValues, aggregationMethod]);\n\n  if (!data || !radarData) {\n    return null;\n  }\n  return (\n    <div className={cx(\"RadarWrapper\", { 'is-minified': minified })}>\n\n      <h5 className=\"visualization-title\">{title}</h5>\n      <RadarPlot\n        data={radarData.reverse()}\n        size={minified ? globalWidth * .4 : globalWidth * .7}\n        axis={axis}\n      />\n      <div\n        className={cx(\"controls-container\", { 'is-minified': minified })}\n      >\n        <div className=\"controls-contents\">\n          <strong>{filteredData.length}</strong> voyages agrgs par <span className=\"aggregation-controls-container\">\n\n            <select value={aggregationMethod} onChange={e => setAggregationMethod(e.target.value)}>\n              <option\n                key={'tonnage'}\n                id={'tonnage'}\n                value={'tonnage'}\n              >tonnage{aggregationMethod === 'tonnage' ? ` (navires de ${tonnageFilterValues[0]}  ${tonnageFilterValues[1]} tonneaux)` : ''}</option>\n              <option\n                key={'voyages'}\n                id={'voyages'}\n                value={'voyages'}\n              >nombre de voyages</option>\n            </select>\n            {\n              aggregationMethod && aggregationMethod === 'tonnage' &&\n              <span className=\"slider-container\">\n                <SliderRange\n                  min={datasetMinimumTonnage}\n                  max={datasetMaximumTonnage}\n                  value={tonnageFilterValues}\n                  onChange={value => [setTonnageFilterValues(value)]}\n                />\n              </span>\n            }\n          </span>\n          <ul className=\"bureaux-list\">\n            {\n              bureauxList.map((bureau, index) => {\n                const handleClick = () => {\n                  const newSelectedBureaux = new Set(selectedBureaux);\n                  if (selectedBureaux.has(bureau) && Array.from(selectedBureaux).length > 1) {\n                    newSelectedBureaux.delete(bureau);\n                  } else {\n                    newSelectedBureaux.add(bureau);\n                  }\n                  setSelectedBureaux(newSelectedBureaux);\n                }\n                return (\n                  <li\n                    key={index}\n                    onClick={handleClick}\n                    className={cx(\"bureau-item\", { 'is-active': selectedBureaux.has(bureau) })}\n                  >\n                    <span\n                      className=\"color-marker\"\n                      style={{ background: colorPalette[bureau] }}\n                    />\n                    <span className=\"bureau-label\">\n                      {bureau === 'Tous les bureaux' ? 'Ensemble des ports' : bureau}\n                    </span>\n                  </li>\n                )\n              })\n            }\n          </ul>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default RadarWrapper;","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import {useMemo} from 'react';\nimport cx from 'classnames';\nimport CircularAlluvialChart from \"../../components/CircularAlluvialChart/CircularAlluvialChart\";\nimport RadarWrapper from './RadarWrapper';\n\nimport colorsPalettes from '../../colorPalettes';\nimport {fixSvgDimension} from '../../helpers/misc';\n\nimport './PrincipalVisualizationPart2.scss';\n\nconst PrincipalVisualizationPart2 = ({\n  width: inputWidth, \n  height: containerHeight, \n  datasets, \n  showOnlyToflit = false, \n  atlasMode, \n  screenshotMode,\n  highlight = 'toflit18',\n  lang = 'fr',\n  filter = 'aucun',\n  bureaux=\"tous\",\n  navigoAgregation=\"tonnage\",\n  minTonnage,\n  maxTonnage,\n  ...props\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const {sumToflitBy, alluvialFilters} = useMemo(() => {\n    let sumBy = 'value';\n    let filters = [];\n    switch(filter) {\n      case \"colonial\":\n        filters = [\n          {\n            key: 'product',\n            value: `produits coloniaux`\n          },\n          {\n            key: 'partner',\n            value: `Afrique`\n          },\n          {\n            key: 'partner',\n            value: `Colonies`\n          }\n        ];\n        break;\n      case \"eau-de-vie\":\n        filters = [\n          {\n            key: 'product',\n            value: `eau-de-vie et vins divers`\n          }\n        \n        ];\n        break;\n      case \"sel\":\n        filters = [{\n          key: 'product',\n          value: `sel`\n        }];\n        sumBy = 'product_weight_kg'\n        break;\n      default:\n        break;\n    }\n\n    return {\n      sumToflitBy: sumBy,\n      alluvialFilters: filters\n    }\n  }, [filter]);\n  const toflit18titles = {\n    fr: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`,\n    en: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`\n  };\n  const navigoTitles = {\n    fr: `Parts de diffrents groupes de directions pour les navires partis de la rgion PASA en 1789`,\n    en: `Parts de diffrents groupes de direction pour les navires partis de la rgion PASA en 1789`\n  };\n  return (\n    <div \n      className={cx(\"PrincipalVisualizationPart2\", {'is-atlas-mode': atlasMode, 'is-screenshot-mode': screenshotMode})}\n    >\n     <div \n      className=\"circular-alluvial-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .5,\n        height: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .5,\n      }}\n    >\n        <CircularAlluvialChart\n          data={datasets['part_2_toflit_viz_data/part_2_toflit_viz_data.csv']}\n          width={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .45}\n          height={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .45}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          lang={lang}\n          title={toflit18titles[lang]}\n          displaceHorizontalLabels={highlight === 'toflit18'}\n          centerHorizontalLabels={highlight === 'toflit18'}\n          tooltips={{\n            node: {\n              fr: ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `En 1789, le bureau des fermes de ${id} a ${step < 3 ? 'export' : 'import'} ${parseInt(node.valueAbs)} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${parseInt(node.valueAbs)} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} de ${id}.`;\n                } else {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${parseInt(node.valueAbs)} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} vers le partenaire ${id}.`;\n                }\n              },\n              en: () => ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `In 1789, the bureau des fermes of ${id} has ${step < 3 ? 'imported' : 'exported'} ${node[sumToflitBy]} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${parseInt(node.valueAbs)} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} of ${id}.`;\n                } else {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${parseInt(node.valueAbs)} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} to the partner ${id}.`;\n                }\n              },\n            },\n            flow: {\n              fr: ({flow_type, customs_office, product, sumBy, value, partner}) => `En 1789, le bureau des fermes de ${customs_office} a ${flow_type === 'import' ? 'import' : 'export'} ${parseInt(value)} ${sumBy === 'value' ? 'livres tournois' : 'kg'} de ${product} ${flow_type === 'import' ? 'depuis' : 'vers'} le partenaire ${partner}`,\n              en: ({flow_type, customs_office, product, sumBy, value, partner}) => `In 1789, the bureau des fermes of ${customs_office} has ${flow_type === 'import' ? 'imported' : 'exported'} ${parseInt(value)} ${sumBy === 'value' ? 'livres tournois' : 'kg'} of ${product} ${flow_type === 'import' ? 'from' : 'to'} the partner ${partner}`,\n            }\n          }}\n          steps={[\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n          ]}\n        />\n     </div>\n     <div \n      className=\"radar-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'navigo' ? width * .7 : width * .4\n      }}\n    >\n      <RadarWrapper \n        data={datasets['part_2_navigo_viz_data/part_2_navigo_viz_data.csv']}\n        minified={!atlasMode && highlight !== 'navigo'}\n        globalWidth={atlasMode ? window.innerWidth * .5 : width}\n        bureaux={bureaux}\n        navigoAgregation={navigoAgregation}\n        minTonnage={minTonnage}\n        maxTonnage={maxTonnage}\n        title={navigoTitles[lang]}\n        axis={[\n          'Local',\n          'Afrique',\n          'Colonies',\n          'Grande-Bretagne',\n          'Europe',\n          'Ports francs et petites les',\n          'France',\n          'Reste du monde',\n        ]}\n        colorPalette={colorsPalettes.customs_office}\n      />\n       {/* <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} /> */}\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","\nimport NetworkGraphChart from \"../../components/NetworkGraphChart/GraphContainer\";\nimport BarChart from \"../../components/BarChart\";\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nconst Step2 = ({\n  width: inputWidth,\n  height: inputHeight,\n  datasets,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  return (\n    <>\n          <div className=\"graphs-container\" style={{ position: 'relative', height: height * .6 }}>\n            <div className=\"graph-container\" style={{ width: width * .6, height: height * .6, position: 'absolute' }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_La Rochelle/flows_1787_around_La Rochelle.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                ratio={1.1}\n                title={'Rseau des voyages partant ou arrivant dans la rgion PASA en 1787 ...'}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, top: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Bordeaux/flows_1787_around_Bordeaux.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                title={'...compar  celui de l\\'amiraut de Bordeaux'}\n                ratio={1}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, bottom: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Nantes/flows_1787_around_Nantes.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                title={'...compar  celui de l\\'amiraut de Nantes'}\n                ratio={0.7}\n                spatialize\n              />\n            </div>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            left: 0,\n            width: width * .3,\n            height: height * .3,\n            paddingLeft: 0,\n          }}\n            className=\"ColorLegend\"\n          >\n            <h5>Lgende des rseaux</h5>\n            <ul className=\"color-legend\">\n              <li>\n                Taille des points reprsentant les ports : nombre de liens avec d'autres ports dans le rseau\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.dark }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port interne  la rgion\n                </span>\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.accent2 }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port externe  la rgion\n                </span>\n              </li>\n            </ul>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: width * .7,\n            height: height * .3\n          }}>\n            <BarChart\n              data={datasets['part_3_centralite_comparaison/part_3_centralite_comparaison.csv']}\n              title=\"Centralit compare de La Rochelle par rapport  PASA et, pour ses rgions ctires voisines, du port principal par rapport au rseau des voyages de son amiraut (1787)\"\n              width={width * .7}\n              height={height * .3}\n              orientation={'vertical'}\n              layout={'groups'}\n              y={{\n                field: 'port',\n                title: 'Port (dans son rseau local)',\n              }}\n              x={{\n                field: 'score',\n                title: 'Score',\n                // tickSpan: .1,\n                // tickFormat: (d, i) => parseInt(d * 100) + '%'\n              }}\n              color={{\n                field: 'metrics_type',\n                title: 'Type de mtrique',\n                palette: {\n                  'PageRank': colorPalettes.generic.dark,\n                  'betweenness centrality': colorPalettes.generic.accent1,\n                }\n              }}\n              margins={{\n                bottom: 40\n              }}\n              tooltip={d => d.metrics_type === 'PageRank' ? 'Le PageRank est une mesure de centralit qui consiste  donner  chaque port un score proportionnel  la somme des pageranks des ports avec lesquels il a des voyages en commun.' : 'La centralit intermdiaire est une mesure de centralit gale au nombre de fois o un port donn est sur le chemin le plus court entre deux autres ports du rseau des voyages.'}\n            />\n          </div>\n        </>\n  )\n}\n\nexport default Step2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\nimport { useState, useEffect } from 'react';\n\nimport GeographicMapChart from '../../components/GeographicMapChart/GeographicMapChart';\nimport { Step3Objects, SmallMultiples, renderTriangles } from './renderObjectsFunctions'; // pas sur que a reste  terme\n\nimport './PrincipalVisualizationPart3.scss';\nimport colorsPalettes from '../../colorPalettes.js';\nimport Step2 from './Step2';\nimport { fixSvgDimension } from '../../helpers/misc';\n\n\nconst PrincipalVisualizationPart3 = ({ \n  datasets, \n  step, \n  width: inputWidth, \n  height: inputHeight, \n  atlasMode \n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? window.innerHeight : fixSvgDimension(inputHeight);\n  const [currentMapTemplate, setCurrentMapTemplate] = useState('France');\n  useEffect(() => {\n    setTimeout(() => {\n      switch (step) {\n        case 1:\n          setCurrentMapTemplate('rotated Poitou');\n          break;\n        case 3:\n          setCurrentMapTemplate('Poitou zoomed');\n          break;\n        default:\n          break;\n      }\n    })\n  }, [step])\n  return (\n    <div className={cx(\"PrincipalVisualizationPart3\", { 'is-atlas-mode': atlasMode })} style={{ height: atlasMode ? undefined : height }}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        <GeographicMapChart\n          title={'Navigation au dpart des ports de la rgion PASA en 1789'}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson']\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: () => (\n                <>\n                  <rect\n                    x={0}\n                    y={0}\n                    width={width}\n                    height={height / 8}\n                    fill={'url(#radial-bg)'}\n                  />\n                  <defs>\n                    <linearGradient id=\"radial-bg\" gradientTransform=\"rotate(90)\">\n                      <stop offset=\"10%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} />\n                      <stop offset=\"100%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} stop-opacity={0} />\n                    </linearGradient>\n                  </defs>\n                </>\n              )\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: props => renderTriangles({...props, atlasMode})\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'rotated Poitou' : currentMapTemplate}\n          height={atlasMode ? window.innerHeight * .9 : height}\n          width={width}\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })} style={{ height }}>\n        <Step2\n          {\n          ...{\n            width,\n            height,\n            datasets,\n          }\n          }\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],\n              color: {\n                field: 'shortname'\n              }\n            },\n            {\n              type: 'custom',\n              data: {\n                customsOffices: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv']\n              .filter(d => \n                d.customs_region === 'La Rochelle' \n                && d.name !== 'undefined customs office'\n                && !d.name.includes('Bouin')\n                ),\n                ports: datasets['part_3_step3_viz_ports_data/part_3_step3_viz_ports_data.csv']\n              },\n              renderObjects: Step3Objects // besoin de montrer les labels des bureaux et ports => modifier la fonction\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n              renderObjects: SmallMultiples\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'Poitou zoomed' : currentMapTemplate}\n          height={height}\n          width={width}\n          title={'Extraversion du commerce et de la navigation regroups par bureau de fermes en 1789'}\n        />\n\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","import cx from 'classnames';\nimport GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\";\nimport { useSpring, animated } from 'react-spring'\n\nimport { useEffect, useState } from 'react';\nimport './IntroBureaux.scss';\n\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\nconst BureauBackground = ({\n  projection,\n  atlasMode,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <animated.circle\n        r={radius * 2}\n        cx={0}\n        cy={0}\n        fill={`url(#bureau-${index})`}\n      />\n      <radialGradient id={`bureau-${index}`}>\n        <stop offset={atlasMode ? '0%' : \"20%\"} stopColor={colorPalettes.customs_office[datum.name]} />\n        <stop offset=\"100%\" stopColor={atlasMode ? \"rgba(255,255,255,0)\" : \"rgba(51,109,124,0)\"} />\n      </radialGradient>\n    </animated.g>\n  )\n}\n\nconst BureauLabel = ({\n  projection,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n  const labelOnRight = ['La Rochelle', 'Tonnay-Charente'].includes(datum.name);\n  const thatWidth = fixSvgDimension(datum.name.length * width * height * .0005);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <circle\n        r={2}\n        cx={0}\n        cy={0}\n        fill={'white'}\n      />\n      <foreignObject\n        x={labelOnRight ? radius / 2 : -radius / 2 - thatWidth}\n        y={-height / 70}\n        fill=\"white\"\n        width={thatWidth}\n        height={height / 20}\n        className={cx(\"bureau-label\", {\n          'is-reversed': !labelOnRight\n        })}\n      >\n        <span xmlns=\"http://www.w3.org/1999/xhtml\">\n          {datum.name}\n        </span>\n      </foreignObject>\n    </animated.g>\n  )\n}\n\nconst renderBureaux = ({ data, projection, width, height, atlasMode }) => {\n  const radius = width * height * 0.00006;\n\n  return (\n    <g className={cx(\"IntroBureaux\", {'is-atlas-mode': atlasMode})}>\n      \n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauBackground\n              key={index}\n              {\n              ...{\n                projection,\n                atlasMode,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauLabel\n              key={index}\n              {\n              ...{\n                projection,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n    </g>\n  )\n}\n\nconst IntroBureaux = ({\n  datasets,\n  atlasMode,\n  dimensions\n}) => {\n  return (\n    <GeographicMapChart\n      title={'Carte des bureaux des fermes de la rgion PASA'}\n      layers={[\n        {\n          type: 'choropleth',\n          data: datasets['map_backgrounds/map_france_1789.geojson'],\n          reverseColors: atlasMode ? false : true,\n          // color:{\n          //   field: 'shortname',\n          //   palette: colorPalettes.provinces\n          // }\n        },\n        // {\n        //   type: 'points',\n        //   data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n        //   color: {\n        //     field: 'name',\n        //     palette: colorPalettes.customs_office,\n        //     labelsColor: atlasMode ? undefined : 'white'\n        //   },\n        //   size: {\n        //     custom : 3 // 3 fois plus gros que la taille par dfaut\n        //   },\n        //   label: {\n        //     field: 'name',\n        //     position: 'left'\n        //   }\n        // }\n        {\n          type: 'custom',\n          data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n          renderObjects: props => renderBureaux({...props, atlasMode})\n        }\n      ]}\n      projectionTemplate='Poitou'\n      width={fixSvgDimension(dimensions.width)}\n      height={atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height)}\n    />\n  )\n}\n\nexport default IntroBureaux;","import IntroBureaux from './IntroBureaux';\n\nexport default IntroBureaux;","import GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\"\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nconst HomeportFlows = ({\n  datasets,\n  atlasMode,\n  dimensions,\n}) => {\n  const totalHeight = atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height);\n  const hotFixedData = datasets['voyages-bateaux-homeport-larochelle-1787/voyages-bateaux-homeport-larochelle-1787.csv']\n  .map(datum => {\n    if (datum.port_dest.includes(`Cte d'Or`)) {\n      return {\n        ...datum,\n        latitude_dest: 5,\n        longitude_dest: -0.6107851\n      }\n    }\n    return datum;\n  })\n  return (\n    <div className=\"HomeportFlows\">\n      <div className=\"column\">\n        <GeographicMapChart\n          title={'Voyages des navires rattachs au port de La Rochelle en 1787'}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData,\n              size: {\n                field: 'tonnages_cumuls',\n                title: 'Flches dimensionnes par tonnage cumul'\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: 'Port de dpart'\n              },\n              hideOverflowingFlows: true\n            }\n          ]}\n          projectionTemplate={'coast from Nantes to Bordeaux'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          withLegend={'bottom left'}\n          legendLayerFilter={l => l.type === 'flows'}\n          height={totalHeight}\n        />\n      </div>\n      <div className=\"column\">\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'], // currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category !== 'pasa'),\n              hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumuls',\n                title: 'Flches dimensionnes par tonnage cumul'\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: 'Port de dpart'\n              }\n            },\n          ]}\n          projectionTemplate={'France'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_world_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category === 'tranger'),\n              // hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumuls',\n                title: 'Flches dimensionnes par tonnage cumul'\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: 'Port de dpart'\n              }\n            },\n          ]}\n          projectionTemplate={'World'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default HomeportFlows","\nimport { useRef, useState, useEffect, useMemo } from 'react';\nimport {nest} from 'd3-collection';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\nimport {\n  treemap, \n  hierarchy, \n  // treemapResquarify,\n  treemapBinary,\n} from 'd3-hierarchy';\n\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nconst formatNestResults = (input) => {\n  if (Array.isArray(input)) {\n    return {\n      name: 'root',\n      children: input.map(formatNestResults)\n    }\n  } else if (input.key && input.values) {\n    return {\n      name: input.key,\n      children: input.values.map(formatNestResults)\n    }\n  } else return input;\n}\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {array} fieldsHierarchy\n * @param {object} leaf\n * @param {string} leaf.labelField\n * @param {number} leaf.countField\n\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst TreemapChart = ({\n  data,\n  fieldsHierarchy = [],\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  leaf: {\n    labelField,\n    countField,\n  },\n  color,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth - 10);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const root = useMemo(() => {\n    const res = nest()\n    fieldsHierarchy.forEach((field) => {\n      res.key((d) => d[field])\n    })\n    \n    const visData = formatNestResults(res.entries(data))\n    const result = hierarchy(visData).sum(d => +d[countField]);\n    treemap()\n    .size([width, height])\n    .tile(treemapBinary)\n    .round(true)\n    (result);\n    return result;\n  }, [data, fieldsHierarchy, width, height, countField])\n\n\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n    // return () => {\n    //   setHeadersHeight(0);\n    //   setLegendWidth(0);\n    // };\n  }, [width, height, color, data])\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  \n\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"TreemapChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" >{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            {\n              root.leaves().map((datum, datumIndex) => {\n                const {x0, y0, x1, y1} = datum;\n                const rectWidth = x1 - x0;\n                const rectHeight = y1 - y0;\n                const labelText = `${datum.data[labelField]} (${datum.data[countField]})`;\n                const fontSize = rectWidth / labelText.length * 1.5\n                // const labelWidth = window.innerWidth * 0.003 * labelText.length;\n                return (\n                  <g \n                    key={`${x0}-${y0}`} \n                    transform={`translate(${x0},${y0})`}\n                    data-for=\"treemap-tooltip\"\n                    data-tip={tooltip ? tooltip(datum.data) : undefined}\n                  >\n                    <rect\n                      stroke=\"white\"\n                      x={0}\n                      y={0}\n                      width={rectWidth}\n                      height={rectHeight}\n                      fill={colorPalette[datum.data[color.field]]}\n                    />\n                    {\n                      rectHeight > fontSize ?\n                        <text\n                          x={rectWidth/2}\n                          y={rectHeight / 2 + 5}\n                          style={{\n                            fontSize\n                          }}\n                          textAnchor=\"middle\"\n                        >\n                          {labelText}\n                        </text>\n                      : null\n                    }\n                  </g>\n                )\n              })\n            }\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"treemap-tooltip\" />\n    </>\n  )\n}\nexport default TreemapChart;","// @TODO : colorLegends et titres  mettre en place pour cartes notamment\n// @TODO : faire une passe sur visualizationList.json que j'ai rempli approximativement pour les vizs 'intro-provinces', 'intro-ports', et 'intro-bureaux'\n\nimport { useContext, useMemo } from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\nimport BarChart from '../components/BarChart';\nimport LineChart from '../components/LineChart';\nimport GeographicMapChart from '../components/GeographicMapChart/GeographicMapChart';\nimport colorPalettes from '../colorPalettes'\n\nimport {formatNumber} from '../helpers/misc'\nimport { DatasetsContext } from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\nimport IntroBureaux from './IntroBureaux';\nimport HomeportFlows from './HomeportFlows/HomeportFlows';\nimport TreemapChart from '../components/TreemapChart/TreemapChart';\nimport { omit } from 'lodash';\n\nconst VisualizationContainer = ({ id, dimensions: inputDimensions, ...props }) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n\n  const hasData = Object.keys(relevantDatasets || {}).length && !Object.entries(relevantDatasets).find(([id, payload]) => !payload);\n  if (!hasData) {\n    // console.log('no data for ', id, 'looked for', visualizationsList.find(v => v.id === id))\n    return null;\n  }\n  switch (id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'partie-1-produits-importants-pour-la-rochelle':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              .sort((a, b) => {\n                if (+a.order > +b.order) {\n                  return 1;\n                }\n                return -1;\n              })\n              .slice(0, 20)\n          }\n          title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n          orientation={'vertical'}\n          layout={'groups'}\n          y={{\n            field: 'product',\n            title: 'produit',\n          }}\n          x={{\n            field: 'value_rel_per_direction',\n            title: 'Valeur en pourcentage',\n            tickSpan: .1,\n            tickFormat: (d, i) => parseInt(d * 100) + '%'\n          }}\n          color={{\n            field: 'entity',\n            title: 'Part des exports pour :'\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n        />\n      )\n    case 'partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"volution globale de la part des changes de La Rochelle par rapport  l'ensemble de la France\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height * .5}\n          orientation={'horizontal'}\n          layout={'stack'}\n          y={{\n            field: 'portion',\n            title: 'part du commerce fr.',\n            tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'year',\n            title: 'anne',\n            fillGaps: true,\n            tickSpan: 5,\n            // tickFormat: d => d%10 === 0 ? d : undefined\n          }}\n          color={{\n            field: 'type',\n            title: 'Type'\n          }}\n          margins={{\n            left: 140,\n            right: 0,\n          }}\n          tooltip={d => `En ${d.year}, la direction des fermes de la Rochelle a ${d.type === 'import' ? 'import' : 'export'} ${(+d.portion * 100).toFixed(2)}% des ${d.type === 'import' ? 'imports' : 'exports'} franais totaux`}\n        />\n      )\n    case 'sorties-de-sel':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Ports de dpart des navires transportant du sel en 1789, agrgs par tonnage cumul\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'port',\n            title: 'Port',\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: 'Tonnage cumul',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => `En 1789, ${d.tonnage} tonneaux (et ${d.nb_pointcalls} navires) sont partis de la rgion PASA avec du sel comme cargaison.`}\n        />\n      )\n    case 'sorties-de-marennes':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Destination des navires partant de Marennnes en 1789, agrges par pays et par tonnage cumul\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height / 2}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: 'Pays',\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: 'Tonnage cumul',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => `En 1789, ${d.tonnage} tonneaux (et ${d.nb_pointcalls} navires) sont partis du port de Marennes en direction d'un port de ${d.country}.`}\n        />\n      )\n    case 'partie-1-pays-port-d-attache':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Pays du port d'attache des navires trangers partant de la rgion en 1789\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: 'Pays du port d\\'attache',\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: 'Tonnage cumul',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => `En 1789, ${d.nb_pointcalls} navires soit ${d.tonnage} tonnaux sont partis de la rgion de La Rochelle (amirauts de La Rochelle, Sables d'Olonnes ou Marennes)`}\n        />\n      )\n    // case 'partie-1-produits-importants-pour-la-rochelle':\n    //   return (\n    //     <BarChart\n    //       data={\n    //         relevantDatasets[Object.keys(relevantDatasets)[0]]\n    //           .sort((a, b) => {\n    //             if (+a.order > +b.order) {\n    //               return 1;\n    //             }\n    //             return -1;\n    //           })\n    //           .slice(0, 20)\n    //       }\n    //       title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n    //       width={dimensions.width}\n    //       height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n    //       orientation={'vertical'}\n    //       layout={'groups'}\n    //       y={{\n    //         field: 'product',\n    //         title: 'produit',\n    //       }}\n    //       x={{\n    //         field: 'value_rel_per_direction',\n    //         title: 'Valeur en pourcentage',\n    //         tickSpan: .1,\n    //         tickFormat: (d, i) => parseInt(d * 100) + '%'\n    //       }}\n    //       color={{\n    //         field: 'entity',\n    //         title: 'Part des exports pour :'\n    //       }}\n    //       margins={{\n    //         left: 140\n    //       }}\n    //       tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n    //     />\n    //   )\n    case 'partie-3-comparaison-exports-coloniaux':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Comparaison des exports de produits coloniaux, locaux et autres par bureaux des fermes (1789)\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height * .5}\n          orientation={'vertical'}\n          layout={'grouped'}\n          y={{\n            field: 'customs_office',\n            title: 'Bureau des fermes',\n            // tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'value',\n            title: 'valeur en livres tournoi',\n            tickSpan: 1000000,\n            domain: [0, 6000000]\n          }}\n          color={{\n            field: 'type',\n            title: 'Type de produit'\n          }}\n          margins={{\n            left: 140,\n            right: 50,\n          }}\n          tooltip={d => `En 1789, le bureau des fermes de ${d.customs_office} a export  l'trange ${d.value} livres tournois de produits de type ${d.type}`}\n        />\n      )\n    case 'intro-provinces':\n      return (\n        <>\n          <GeographicMapChart\n            title={'Carte des provinces tudies : Poitou, Aunis, Saintonge, Angoumois (PASA)'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                color: {\n                  field: 'shortname',\n                  palette: colorPalettes.provinces\n                },\n                tooltip: (d) => {\n                  return d.properties.shortname\n                }\n              }\n            ]}\n            projectionTemplate='France'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n          />\n        </>\n      )\n    case 'sorties-de-marennes-avec-sel-destinations':\n      return (\n        <div>\n          <div style={{borderBottom: '2px solid #333'}}>\n            <GeographicMapChart\n              title={'Carte des navires sortis de Marennes avec du sel en 1789, dimensionns par tonnage cumul'}\n              layers={[\n                {\n                  type: 'choropleth',\n                  data: datasets['map_backgrounds/map_france_1789.geojson']\n                },\n                {\n                  type: 'points',\n                  data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country === 'France'),\n                  // color: {\n                  //   field: 'country',\n                  //   title: 'Pays',\n                  //   palette: colorPalettes.franceAlone\n                  // },\n                  size: {\n                    field: 'tonnage',\n                    title: 'tonnage cumul',\n                    // custom: '20'\n                  },\n                  tooltip: d => `En 1789, des navires pour un total d'approximativement ${d.rawSize} tonneaux sont partis de Marennes avec du sel pour se rendre au port de ${d.label}`,\n                  label: {\n                    field: 'port',\n                    position: 'left'\n                  },\n                  stackLabels: true\n                }\n              ]}\n              projectionTemplate='France'\n              width={dimensions.width}\n              height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n            />\n          </div>\n          <GeographicMapChart\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_world_1789.geojson']\n              },\n              {\n                type: 'points',\n                data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country !== 'France'),\n                // color: {\n                //   field: 'country',\n                //   title: 'Pays',\n                //   // labelsColor: props.atlasMode ? undefined : 'white'\n                // },\n                size: {\n                  field: 'tonnage',\n                  title: 'tonnage cumul',\n                  // custom: '20'\n                },\n                tooltip: d =>`En 1789, des navires pour un total d'approximativement ${d.rawSize} tonneaux sont partis de Marennes avec du sel pour se rendre au port de ${d.label}`,\n                label: {\n                  field: 'port',\n                },\n                stackLabels: true\n              }\n            ]}\n            projectionTemplate='World'\n            projectionConfig={{\n              scale: (props.atlasMode ? window.innerHeight : dimensions.height) * .8,\n              centerY:  45,\n              centerX: -30\n            }}\n            width={dimensions.width}\n            withLegend={'bottom right'}\n            height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n          />\n        </div>\n      )\n    case 'intro-ports':\n      return (\n        <>\n          <GeographicMapChart\n            title={'Carte des ports de la rgion PASA'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['ports_locations_data_intro/ports_locations_data_intro.csv'],\n                color: {\n                  field: 'province',\n                  title: 'Province du port',\n                  palette: omit(colorPalettes.provinces, ['Angoumois']),\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'nb_pointcalls',\n                  title: 'nombre de congs enregistrs en 1789',\n                  // custom: '20'\n                },\n                tooltip: d => `${d.rawSize} dparts de navires ont t observs par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      )\n    case 'intro-bureaux':\n      // console.log(\"heyyyyyy bureaux map\");\n      return (\n        <IntroBureaux\n          {\n            ...{\n              datasets,\n              atlasMode: props.atlasMode,\n              dimensions\n            }\n          }\n        />\n      )\n    case 'partie-2-part-navigation-francaise':\n      return (\n        <>\n          <GeographicMapChart\n            title={'Part de la navigation franaise dans la rgion'}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['part_navigation_fr/part_navigation_fr.csv'],\n                color: {\n                  field: 'tonnage_part_of_french',\n                  title: 'Part de la navigation franaise (par tonnage cumul)',\n                  palette: colorPalettes.tonnageClasses,\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'tonnage',\n                  title: 'Tonnage sorti des ports (en miliers)',\n                  displayMetric: true,\n                  // custom: '20'\n                },\n                // tooltip: d => `${d.rawSize} mouvements de bateaux ont t enregistrs par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      );\n    case 'partie-2-carte-direction-bateaux-de-la-rochelle':\n      // voyages-bateaux-homeport-larochelle-1787.csv\n      return (\n        <HomeportFlows\n        {\n          ...{\n            datasets,\n            atlasMode: props.atlasMode,\n            dimensions,\n          }\n        }\n        />\n      );\n    case 'partie-1-ports-dattache':\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_ports_dattache_des_navires_partant_de_la_region/hierarchie_ports_dattache_des_navires_partant_de_la_region.csv'],\n            title: 'Ports d\\'attache des navires partant de la rgion PASA en 1789 (dimensionns par tonnage cumul)',\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => `En 1789, ${d.tonnage} tonneaux cumuls sortis de la rgion PASA provenaient de navires rattachs au port de ${d.homeport} - ${d.category_2}.`,\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'ports'],\n            color: {\n              field: 'category_2',\n              palette: colorPalettes.portsTreemaps\n            },\n            leaf: {\n              labelField: 'homeport',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      )\n    case 'partie-1-ports-destinations':\n      const thatPalette = {\n        ...colorPalettes.portsTreemaps\n      }\n      delete thatPalette['France (rgion PASA)']\n      delete thatPalette['France (hors rgion PASA)']\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region/hierarchie_destinations_des_navires_partant_de_la_region.csv'],\n            title: 'Destinations des navires partant depuis la rgion PASA vers l\\'tranger en 1789 (dimensionnes par tonnage cumul)',\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => `En 1789, ${d.tonnage} tonneaux cumuls sortis de la rgion PASA ont eu pour destination le port de ${d.port} - ${d.category_2}.`,\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'ports'],\n            color: {\n              field: 'category_2',\n              palette: thatPalette\n            },\n            leaf: {\n              labelField: 'port',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'exports-eau-de-vie-la-rochelle-longitudinal':\n      return (\n      <LineChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              // .sort((a, b) => {\n              //   if (+a.order > +b.order) {\n              //     return 1;\n              //   }\n              //   return -1;\n              // })\n              // .slice(0, 20)\n          }\n          title=\"volution des exports d'eau-de-vie et liqueurs par la direction de La Rochelle (ports francs non pris en compte - pas de donnes pour Montpellier en 1770)\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n          orientation={'horizontal'}\n          // layout={'groups'}\n          y={{\n            field: 'value',\n            title: 'valeur',\n            tickFormat: d => formatNumber(d) + ' lt'\n          }}\n          x={{\n            field: 'year',\n            title: 'Anne',\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => `En ${d.year}, la direction des fermes de La Rochelle a export ${d.value} livres tournois d'eau-de-vie et liqueurs.`}\n        />\n      );\n    case 'exports-eau-de-vie-comparaison-directions-des-fermes':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n                // .sort((a, b) => {\n                //   if (+a.order > +b.order) {\n                //     return 1;\n                //   }\n                //   return -1;\n                // })\n                // .slice(0, 20)\n            }\n            title=\"Comparaison des exports d'eau-de-vie et liqueurs par diffrentes directions des fermes (ports francs non pris en compte)\"\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'year',\n              title: 'anne',\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: 'valeur',\n              tickSpan: 1000000,\n              tickFormat: d => formatNumber(d) + ' lt'\n            }}\n            color={{\n              field: 'customs_region',\n              title: 'direction des fermes'\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => `En ${d.year}, la direction des fermes de ${d.customs_region} a export ${parseInt(d.value)} livres tournois d'eau-de-vie et liqueurs.`}\n          />\n        );\n    case 'origines-exports-eau-de-vie-1789-la-rochelle':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n            }\n            title=\"Origine des exports d'eau-de-vie de la direction des fermes de La Rochelle en 1789 (ports francs non pris en compte)\"\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'origin',\n              title: 'origine',\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: 'valeur',\n              tickFormat: d => formatNumber(d / 100) + ' lt'\n            }}\n            color={{\n              field: 'type',\n              title: \"type d'eau de vie\",\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => `La direction des fermes de La Rochelle a export ${parseInt(d.value)} livres tournois d'eau-de-vie et liqueurs de type \"${d.type}\", originaires de ${d.origin}.`}\n          />\n        );\n    case 'partie-1-ports-dattache-vers-etranger':\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger/hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger.csv'],\n            title: 'Ports dattache des navires en provenance de la rgion PASA et en direction de ltranger en 1789 (dimensionnes par tonnages cumuls)',\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => `En 1789, ${d.tonnage} tonneaux cumuls sortis de la rgion PASA taient rattachs au port de ${d.homeport} - ${d.category_2}.`,\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'homeport'],\n            color: {\n              field: 'category_2',\n              palette: colorPalettes.portsTreemaps\n            },\n            leaf: {\n              labelField: 'homeport',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\nconst VisualizationController = ({\n  lang,\n  activeVisualization,\n  atlasMode,\n  screenshotMode\n}) => {\n  const [dimensions, setDimensions] = useState({\n    width: 1000,\n    height: 1000\n  });\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer lang={lang} screenshotMode={screenshotMode} atlasMode={atlasMode} id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} {...visProps} dimensions={dimensions} />\n            </>\n            : null // <div>Pas de visualisation  afficher</div>\n          }\n  \n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import { useState } from 'react';\nimport { homepage } from '../../../package.json';\nimport copy from 'copy-to-clipboard';\nimport VisualizationController from '../VisualizationController/VisualizationController.js';\nimport Md from 'react-markdown';\n\n\nconst VisualizationFocus = ({ visualization, lang, onClose }) => {\n\n  const [copyClicked, setCopyClicked] = useState(false);\n  let howDone, howRead;\n  if (visualization) {\n    howDone = visualization[`comment_cest_fait_${lang}`];\n    howRead = visualization[`comment_lire_${lang}`];\n  }\n\n  const messages = {\n    howDone: {\n      fr: 'Comment les donnes et la visualisations ont-elles t produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    },\n    copyLink: {\n      fr: 'copier le lien de cette visualisation',\n      en: 'copy this visualization link'\n    },\n    linkCopied: {\n      fr: 'lien copi dans le presse-papier !',\n      en: 'link copied in the clipboard !'\n    }\n  }\n\n  const handleCopyClick = (e) => {\n    e.stopPropagation();\n    const url = `${homepage}/${lang}/atlas/${visualization.id}`;\n    setCopyClicked(true);\n    copy(url);\n    setTimeout(() => setCopyClicked(false), 5000);\n  }\n  return (\n    <div className={`VisualizationFocus ${visualization ? 'is-visible' : 'is-hidden'}`}>\n      <div onClick={onClose} className=\"lightbox-background\" />\n      {\n        visualization ?\n          <div className=\"lightbox-contents-container\">\n            <div className=\"lightbox-contents\">\n\n              <div className=\"visualization-details\">\n                <div className=\"details-header\">\n                  <h2>{visualization[`titre_${lang}`]}</h2>\n                  <button className=\"close-btn\" onClick={onClose}>\n                    \n                  </button>\n                </div>\n                <div className=\"copy-link-container\">\n                  <button onClick={handleCopyClick}>{copyClicked ? messages.linkCopied[lang] : messages.copyLink[lang]}</button>\n                </div>\n                <div className=\"details-contents\">\n                  {\n                    howDone && howDone.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howDone[lang]}</h3>\n                        <Md>\n                          {howDone.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                  {\n                    howRead && howRead.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howRead[lang]}</h3>\n                        <Md>\n                          {howRead.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                </div>\n              </div>\n              <div className=\"visualization-wrapper\">\n                <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n              </div>\n            </div>\n          </div>\n          : null\n      }\n\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import VisualizationFocus from './VisualizationFocus';\n\nexport default VisualizationFocus;","import { useState, useReducer, useEffect, useRef } from 'react';\nimport { Helmet } from \"react-helmet\";\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport VisualizationFocus from '../../components/VisualizationFocus';\nimport { VisualizationControlContext } from '../../helpers/contexts';\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport visualizations from '../../visualizationsList';\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  // mobile mode: focus on text or on viz\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  // whether to open the active viz in \"atlas mode\"\n  const [visualizationIsFullScreen, setVisualizationIsFullScreen] = useState(false);\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const updateCurrentVisualization = () => {\n    if (visualizationIsFullScreen) {\n      return;\n    } \n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const y = scrollY + DISPLACE_Y;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n    const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n    if (y > sectionEnd) {\n      if (activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n      return;\n    }\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      }\n    }\n    if (scrollY === 0 && visualizationEntries.length) {\n      setActiveVisualization(visualizationEntries[0][1])\n    }\n    else if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n        <section ref={sectionRef} className={cx({ 'is-focused': !focusOnViz })}>\n          <ContentSync />\n        </section>\n        <aside className={cx({ 'is-focused': focusOnViz })}>\n          <VisualizationController activeVisualization={activeVisualization} />\n          {\n            activeVisualization ?\n              <div className=\"fullscreen-viz-toggle-container\">\n                <button\n                  data-for=\"contents-tooltip\"\n                  data-tip=\"plus d'informations sur cette visualisation\"\n                  onClick={() => setVisualizationIsFullScreen(true)}\n                >\n                  <span>+</span>\n                </button>\n              </div>\n              : null\n          }\n        </aside>\n        <VisualizationFocus\n          visualization={visualizationIsFullScreen && activeVisualization ? visualizationsMap[activeVisualization.visualizationId] : undefined}\n          lang={lang}\n          onClose={() => {\n            setVisualizationIsFullScreen(false);\n          }}\n        />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n        })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n        <ReactTooltip id=\"contents-tooltip\" />\n      </div>\n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\n// import TestScrollyFr from '!babel-loader!mdx-loader!./contents/fr/test-scrolly.mdx';\n// import testScrollyEn from '!babel-loader!mdx-loader!./contents/en/test-scrolly.mdx';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\n// import Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2-intro.mdx';\n// import Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\n// import Part21Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-1.mdx';\n// import Part21En from '!babel-loader!mdx-loader!./contents/en/part-2-1.mdx';\n\n// import Part22Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-2.mdx';\n// import Part22En from '!babel-loader!mdx-loader!./contents/en/part-2-2.mdx';\n\n// import Part23Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-3.mdx';\n// import Part23En from '!babel-loader!mdx-loader!./contents/en/part-2-3.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/about.mdx';\n\nimport ReferencesFr from '!babel-loader!mdx-loader!./contents/fr/references.mdx';\nimport ReferencesEn from '!babel-loader!mdx-loader!./contents/en/references.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le dclin de la rgion de La Rochelle suite  la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le dclin de la rgion de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spcialisation portuaire: le cas de la traite ngrire, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spcialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'references',\n      en: 'references'\n    },\n    titles: {\n      fr: 'Rfrences',\n      en: 'References'\n    },\n    shortTitles: {\n      fr: 'rfrences',\n      en: 'references'\n    },\n    contents: {\n      fr: 'fr/references.mdx',\n      en: 'en/references.mdx'\n    },\n    contentsProcessed: {\n      fr: ReferencesFr,\n      en: ReferencesEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: ' propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: ' propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang = 'fr', summary }) {\n  const messages = {\n    intro: {\n      fr: 'dcouvrir les 3 chapitres de ltude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accder  l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .filter(item => item.routes[lang])\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        {/* @todo this is a react-snap trick that should be cleaned some day, removing it somehow breaks the pages building process */}\n        <Link to={navigator.userAgent === \"ReactSnap\" ? '/fr/atlas' : `/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang = 'fr' }\n} }) {\n  const introRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const [inVis, setInVis] = useState(false);\n  const currentMetadata = metadata[lang] || metadataFr;\n  const title = currentMetadata.title;\n  const titleHTML = currentMetadata.titleHTML;\n  const subtitle = currentMetadata.subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    let newActiveVisualization;\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    let firstOneY = Infinity;\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (visY < firstOneY) {\n          firstOneY = visY;\n        }\n        if (index === 0 && y < visY) {\n          found = true;\n          newActiveVisualization = visualization;\n        } /*else if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          newActiveVisualization = undefined;\n          break;\n        }*/ else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            newActiveVisualization = visualization;\n          } else {\n            newActiveVisualization = undefined;\n          }\n          break;\n        }\n      } else {\n        // console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n\n    if (scrollY > window.innerHeight * .9 && !inVis) {\n      setInVis(true);\n    } else if (scrollY < window.innerHeight * .9 && inVis) {\n      setInVis(false);\n    }\n\n    if (!found && scrollY < firstOneY && visualizationEntries.length) {\n      newActiveVisualization = visualizationEntries[0][1]\n    }\n    if (!found && activeVisualization) {\n      newActiveVisualization = undefined;\n    }\n    if (activeVisualization !== !newActiveVisualization) {\n      setActiveVisualization(newActiveVisualization)\n    } else if ((!activeVisualization && newActiveVisualization) || activeVisualization.id !== newActiveVisualization.id) {\n      setActiveVisualization(newActiveVisualization)\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n          <span></span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            \n            <section className={cx({'is-focused': !focusOnViz})}>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside className={cx({'is-focused': focusOnViz, 'is-fixed': inVis})}>\n              <VisualizationController activeVisualization={activeVisualization} />\n            </aside>\n            \n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n      </main>\n      <ReactTooltip id=\"contents-tooltip\" />\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la rgion Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from '../../components/VisualizationFocus/VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang = 'fr'\n    }\n  }\n}) {\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  const [isLoading, setIsLoading] = useState(false);\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className={cx(\"Atlas secondary-page\", {'has-focus': shownVisualization})}>\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>{lang === 'fr' ? 'Atlas des visualisations' : 'Visualizations atlas'}</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations.map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                setIsLoading(true);\n                setTimeout(() => {\n                  history.push({\n                    pathname: `/${lang}/atlas/${visualization.id}`\n                  });\n                  setIsLoading(false);\n                }, 100)\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                      <img\n                        src={`${process.env.PUBLIC_URL}/thumbnails/${lang}/${visualization.id}.png`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n        <VisualizationFocus \n          visualization={shownVisualization} \n          lang={lang}\n          onClose={() => {\n            history.push({\n              pathname: `/${lang}/atlas/`\n            })\n          }}\n        />\n        <div className={cx(\"loader-indication-wrapper\", {'is-loading': isLoading})}>\n          <div className=\"loader-indication-container\">\n            Chargement de la visualisation\n          </div>\n        </div>\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import StandaloneVisualization from './StandaloneVisualization';\n\nexport default StandaloneVisualization;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\nimport visualizationsList from '../../visualizationsList.json';\nconst StandaloneVisualization = ({\n  id,\n  lang\n}) => {\n  const visualization = visualizationsList.find(({id: thatId}) => thatId === id)\n  return (\n    <div className=\"StandaloneVisualization\">\n      <VisualizationController lang={lang} atlasMode screenshotMode activeVisualization={visualization} />\n    </div>\n  )\n}\n\nexport default StandaloneVisualization;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import {Suspense} from 'react';\nimport {Helmet} from \"react-helmet\";\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst PlainPage = ({\n  Content,\n  contentsURL,\n  title,\n  lang = 'fr'\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <Suspense fallback={<div>Chargement</div>}>\n          <Content />\n        </Suspense>\n      </div>\n  </div>\n  )\n}\n\nexport default PlainPage;","import React, { useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { NavLink as Link } from 'react-router-dom';\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport { scaleLinear } from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/part')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n  const liveScrollY = useScrollYPosition();\n\n  const scrollY = useDebounce(liveScrollY, 50)\n\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const { fontColor, backgroundColor } = useMemo(() => {\n    // const wrapper = document.getElementById('wrapper');\n    // if (!wrapper) {\n    //   return {fontColor: undefined, backgroundColor: undefined}\n    // }\n    // const scrollHeight = wrapper.offsetHeight;\n    const screenHeight = window.innerHeight;\n    switch (pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n\n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: colorBackground\n        }\n\n    }\n\n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                  :\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link to={`/${lang}/atlas`}>\n              {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n\n          {\n            // @todo delete this ternary when english contents are ready\n            process.env.NODE_ENV === 'development' ?\n              <>\n                <li className=\"navitem-container lang-toggle\">\n                  <button\n                    className={lang === 'fr' ? 'is-active' : ''}\n                    onClick={() => onLangChange('fr')}\n                  >fr</button>\n                </li>\n                <li className=\"navitem-container lang-toggle\">\n                  <button\n                    className={lang === 'en' ? 'is-active' : ''}\n                    onClick={() => onLangChange('en')}\n                  >en</button>\n                </li>\n              </>\n              : null\n          }\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", { 'is-open': drawerIsOpen })}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n          <ul className=\"primary-nav-container\">\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link exact to={`/${lang}/`}>\n                {lang === 'fr' ? 'accueil' : 'home'}\n              </Link>\n            </li>\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n          </ul>\n          <ul className=\"secondary-nav-container\">\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n                <li className=\"navitem-container lang-toggle\">\n                  <ul className=\"lang-toggle-container\">\n                    <li>\n                      <button\n                        className={lang === 'fr' ? 'is-active' : ''}\n                        onClick={() => onLangChange('fr')}\n                      >fr</button>\n                    </li>\n                    <li>\n                      <button\n                        className={lang === 'en' ? 'is-active' : ''}\n                        onClick={() => onLangChange('en')}\n                      >en</button>\n                    </li>\n                  </ul>\n\n                </li>\n                :\n                null\n            }\n\n\n          </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n            }} dangerouslySetInnerHTML={{ __html: title }} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","import cx from 'classnames';\nconst Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className={cx(\"loader-container\", {'is-complete': percentsLoaded === 100})}>\n      <div className=\"loader\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\n\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  // HashRouter as Router,\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n  Link,\n} from \"react-router-dom\";\nimport uniq from 'lodash/uniq';\nimport { csvParse, tsvParse } from 'd3-dsv';\nimport axios from 'axios';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\nimport StandaloneVisualization from \"./pages/StandaloneVisualization\";\nimport PlainPage from './pages/PlainPage';\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\nimport Footer from \"./components/Footer\";\n\n/* import utils */\nimport { DatasetsContext } from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport visualizationsList from './visualizationsList';\nimport { homepage } from '../package.json';\nimport routes from './summary';\n\nconst LANGUAGES = ['fr', 'en'];\n\nfunction App() {\n\n  const history = useHistory();\n  const location = useLocation();\n\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n  useEffect(() => {\n    // loading all datasets from the atlas\n    // @todo do this on a page-to-page basis if datasets happens to be too big/numerous\n    const datasetsNames = uniq(visualizationsList.filter(d => d.datasets).reduce((res, d) => [...res, ...d.datasets.split(',').map(d => d.trim())], []));\n    // console.groupCollapsed('loading data');\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          // console.info('get', url);\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              let status = progressEvent.loaded / progressEvent.total;\n              status = status > 1 ? 1 : status;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              // console.info(parseInt(globalFraction * 100) + '%')\n              setLoadingFraction(globalFraction + status / datasetsNames.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({ ...res, [datasetName]: loadedData })\n              })\n            })\n            // make get errors non-blocking to get all available datasets in the app even if some are broken\n            .catch(err => {\n              console.error(err);\n              return resolve(res);\n            })\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n      .then(newDatasets => {\n        // console.groupEnd('loading data');\n        setLoadingFraction(1);\n        setDatasets(newDatasets)\n      })\n      .catch(console.error)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    // @todo refactor this to be handled based on the routes config JSON ?\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n    lang,\n  }) => (\n    <>\n      <ThatComponent\n        {\n        ...{\n          Content,\n          ContentSync,\n          title,\n          lang\n        }\n        }\n      />\n    </>\n\n  );\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        <header>\n          <HeaderNav {...{ onLangChange, routes }} />\n        </header>\n        <main>\n          <Switch>\n            {// looping through the page\n              LANGUAGES.map(lang => {\n                return routes\n                  .map(({\n                    titles,\n                    routes: inputRoute,\n                    contents,\n                    Component: ThatComponent,\n                    contentsProcessed\n                  }, index) => {\n                    const route = `/${lang}/page/${inputRoute[lang]}`\n                    const title = titles[lang];\n                    // @todo remove Content as it is not used anymore ? (importing md content with React.lazy did not play nice with scrollytelling-related features)\n                    const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                    const ContentSync = contentsProcessed[lang];\n                    return (\n                      <Route key={index} path={route} exact>\n                        {renderRoute({ Content, ThatComponent, title, ContentSync, lang })}\n                      </Route>\n                    )\n                  })\n              })\n            }\n            {\n              LANGUAGES.map(lang => {\n                return visualizationsList\n                  .map(({\n                    id\n                  }, index) => {\n                    const route = `/${lang}/visualization/${id}`;\n                    return (\n                      <Route key={index} path={route} exact component={() => <StandaloneVisualization {...{ id, lang }} />} />\n                    )\n                  })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/fr/`} />\n          </Switch>\n            <Loader percentsLoaded={loadingFraction * 100} />\n        </main>\n        <Footer\n          lang={'fr'}\n        />\n\n\n      </div>\n      {/* following react fragment is aimed at allowing react-snap to parse all the pages that have a dynamic URL */}\n      <React.Fragment>\n        {// looping through the pages to add a blank link to all of them\n          LANGUAGES.map(lang => {\n            return routes\n              // @todo this is dirty and should be removed at some point (test page is not exported in prod, so no need for react-snap)\n              .filter(({ routes }) => routes[lang] && !routes[lang].includes('test'))\n              .map(({\n                titles,\n                routes: inputRoute,\n                contents,\n                Component: ThatComponent,\n                contentsProcessed\n              }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n        {// looping through all the atlas visualizations links\n          LANGUAGES.map(lang => {\n            return visualizationsList\n              .map(({\n                id\n              }, index) => {\n                const route = `/${lang}/atlas/${id}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n      </React.Fragment>\n    </DatasetsContext.Provider>\n  );\n}\n\n/**\n * the following variable is aimed at allowing browser-router to function\n * for deployments on gh-pages (prefixing all routes with the repo name to match ghp URL pattern e.g. https://username.github.io/projectname/)\n */\nconst BASE_NAME =\n  process.env.NODE_ENV === 'development'\n    ? undefined\n    : `/${homepage.split('/').pop()}`;\n\n\nexport default function Wrapper() {\n  return (\n    <Router basename={BASE_NAME}>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","\nimport React from 'react';\n\nexport const VisualizationControlContext = React.createContext({\n\n})\n\nexport const DatasetsContext = React.createContext({\n\n})\n","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au XVIII<sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}"],"sourceRoot":""}