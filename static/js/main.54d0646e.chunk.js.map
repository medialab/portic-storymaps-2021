{"version":3,"sources":["visualizations/PrincipalVisualizationPart3/ExtraversionObject.js","visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js","components/NetworkGraphChart/reducers.js","components/NetworkGraphChart/GraphContainer.js","i18n/translate.js","helpers/misc.js","components/TriangleChart/PortGroup.js","components/TriangleChart/TriangleChart.js","colorPalettes.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","contents/fr/partie-1.mdx","components/Caller/Caller.js","components/Caller/index.js","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/a-propos.mdx","contents/fr/references.mdx","contents/en/references.mdx","contents/en/tests.mdx","contents/fr/footer.mdx","contents/en/footer.mdx","components/SvgChart/SvgChart.js","components/GeographicMapChart/index.js","components/NetworkGraphChart/index.js","components/DataProvider/index.js","components/TriangleChart/index.js","components/DataProvider/DataProvider.js","contents/fr/tests.mdx","components/LineChart/LineChart.js","components/LineChart/index.js","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","helpers/contexts.js","components/GeographicMapChart/ChoroplethLayer.js","components/GeographicMapChart/PointsLayer.js","components/GeographicMapChart/FlowsLayer.js","components/GeographicMapChart/CustomObjectLayer.js","components/GeographicMapChart/Button.js","components/GeographicMapChart/Input.js","components/GeographicMapChart/Legend.js","components/GeographicMapChart/GeographicMapChart.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/BarChart.js","components/BarChart/index.js","../ /^/.//.*$/ groupOptions: {} namespace object","components/CitationWidget/mla-fr.mdx","components/CitationWidget/iso-fr.mdx","components/CitationWidget/apa-fr.mdx","components/CitationWidget/doi.mdx","components/CitationWidget/CitationWidget.js","components/CitationWidget/index.js","visualizations/Test.js","components/DeclineChart/LongitudinalTradeChart.js","components/DeclineChart/ProductsDistributionChart.js","components/DeclineChart/index.js","components/DeclineChart/DeclineChart.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialChart/animatedPrimities.js","components/CircularAlluvialChart/CircularAlluvialChart.js","components/CircularAlluvialChart/utils.js","components/SliderRange/SliderRange.js","components/SliderRange/index.js","components/RadarPlot/AxisObject.js","components/RadarPlot/VisObject.js","components/RadarPlot/index.js","components/RadarPlot/RadarPlot.js","visualizations/PrincipalVisualizationPart2/RadarWrapper.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/Step2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/IntroBureaux/IntroBureaux.js","visualizations/IntroBureaux/index.js","visualizations/HomeportFlows/HomeportFlows.js","components/TreemapChart/TreemapChart.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","components/VisualizationFocus/VisualizationFocus.js","components/VisualizationFocus/index.js","pages/ScrollyPage/ScrollyPage.js","pages/ScrollyPage/index.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","pages/StandaloneVisualization/index.js","pages/StandaloneVisualization/StandaloneVisualization.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/hooks.js","contents/fr/metadata.js","contents/en/metadata.js"],"names":["ExtraversionObject","navigoValues","metric1","metric2","toflitPct","transformGroup","inputCircleRadius","circleRadius","inputWidth","width","inputHeight","height","name","legendMode","isActive","isMinified","onClick","fixSvgDimension","useState","isInited","setIsInited","useEffect","setTimeout","ReactTooltip","rebuild","leftPath","rightPath","transform","useSpring","to","immediate","maxTriangleHeight","maxArea","area1","area2","leftTriangleHeight","Math","sqrt","rightTriangleHeight","start","end","PI","partialCircle","map","command","join","lang","useContext","SettingsContext","labelFontSize","parseInt","g","className","cx","undefined","d","stroke","colorsPalettes","generic","accent2","strokeWidth","fill","data-for","data-tip","translate","number","toFixed","onclick","ui","colorAccentBackground","max","font-size","textAnchor","x","y","x1","y1","x2","y2","markerEnd","Step3Object","datum","projection","projectionTemplate","longitude","latitude","totalTonnage","parseFloat","cumulated_tonnage_out_region","cumulated_tonnage_in_region","type_of_object","navigoMetric1","navigoMetric2","inPercentage","totalValue","cumulated_exports_value_from_region","cumulated_exports_value_from_ext","noOverlapTransform","includes","isNaN","Step3Objects","data","customsOffices","ports","selectedBureau","setSelectedBureau","handleClick","visiblePorts","useMemo","filter","customs_office","portsSpaceStartY","portsSpaceHeight","portsSpaceWidth","portRowHeight","length","sort","a","b","yA","port","portIndex","initialCircleRadius","objectX","objectY","cy","r","style","dark","index","SmallMultiples","bureaux","unshift","margin","multiplesY","columnWidth","xObjectsStart","opacity","position","left","bottom","custom_office","id","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient","renderTriangles","atlasMode","TriangleChart","totalWidth","rowHeight","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","ratio","sizes","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","field","values","attr","uniq","palette","colors","generatePalette","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","smallerNode","Color","lighten","rgb","string","createEdgeReducer","container","useRef","renderer","setRenderer","getCamera","animate","needToRefresh","settings","labelGrid","cell","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","labelFont","camera","setState","getState","disable","on","state","current","ref","minHeight","minWidth","NetworkGraphChart","gexfString","spatialize","inputCameraPosition","angle","title","headerRef","headerHeight","getBoundingClientRect","setCameraPosition","find","prop","gexf","parse","Graph","forceAtlas2","inferSettings","assign","iterations","flex","cam","matchDollarBracket","RegExp","vizId","label","args","json","result","replace","match","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","currentMetadata","trimText","str","limit","words","split","output","slice","cartesian2Polar","distance","radians","atan2","polarToCartesian","theta","cos","sin","count","accent1","iwanthue","colorSpace","seed","clustering","num","abs","formatNumber","n","reverse","reduce","digit","PortGroup","numberOfColumns","scaleX","scaleY","legendWidth","totalHeight","margins","fontSize","triangleWidth","nb_pointcalls_out","triangleHeight","mean_tonnage","xTransform","yTransform","markerRadius","staticTransform","cellCenterX","textStartY","triangleStartY","legendTextWidth","labelBgWidth","line","strokeDasharray","circle","markerStart","xmlns","transformOrigin","inputMargins","right","offset","stopColor","stopOpacity","xa","tonnageClasses","franceAlone","portsTreemaps","readingTime","layoutProps","MDXContent","components","props","mdxType","href","target","rel","isMDXComponent","tableOfContents","frontMatter","step","Caller","visualizationId","genId","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","payload","e","process","highlight","minTonnage","level","children","parentName","SvgChart","GeographicMapChart","DataProvider","dataFilename","setData","loadingData","setLoadingData","dataURL","then","newData","extension","pop","csvParse","catch","err","backgroundData","visData","layers","type","renderObjects","colorPalettes","provinces","admiralties","backgroundFilename","markerColor","markerSize","showLabels","LineChart","initialWidth","initialHeight","tooltip","annotations","headersHeight","setHeadersHeight","setLegendWidth","legendRef","newHeadersHeight","newLegendWidth","colorPalette","top","yTickFormat","tickFormat","yTickSpan","tickSpan","initialYDomain","fillGaps","xTickFormat","xTickSpan","initialXDomain","colorModalities","colorValues","modality","xDomain","yDomain","xScale","nice","yScale","groups","Object","entries","groupBy","xAxisValues","axisPropsFromTickScale","yAxisValues","legendTitle","marginLeft","value","valueIndex","axis","annotation","annotationIndex","labelPosition","thatHeight","thatY1","thatY2","points","patternUnits","thatX1","thatX2","groupIndex","groupName","items","item","itemIndex","next","consecutive","hasNext","genreIndex","genre","background","PASS_DURATION","Hull","bottomRightX","bottomLeftX","Sail","sailSpeed","randomFactor","random","minRightX","maxLeftX","maxRightX","step1","step2","loop","from","config","duration","polygon","Matt","secondWidth","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","BoatsIllustration","useReducer","action","boat","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","clearTimeout","useInterval","now","React","createContext","DatasetsContext","GeoPart","initialD","project","layer","isAnimated","animated","boundsAbs","geoPath","bounds","xMin","xMax","yMin","yMax","outOfBounds","currentD","animationProps","path","properties","shortname","ChoroplethLayer","reverseColors","console","info","features","generatedPalette","geometry","PointGroup","onGroupMouseEnter","onGroupMouseLeave","displayLabel","area","rawSize","labelSize","zIndex","onMouseEnter","onMouseMove","onMouseLeave","displayMetric","labelsColor","StackedLabelGroup","thatIndex","stackedRowHeight","transformLabel","window","innerWidth","labelY","PointsLayer","hoveredIndex","setHoveredIndex","visibleMarkers","coordsMap","mark","grouped","sizeCoef","custom","areaRange","sizeScale","labelSizeScale","stackedLabelsTop","maxLabelFontSize","innerHeight","stackLabels","enter","leave","FlowGroup","hovered","inputXDep","xDep","inputYDep","yDep","inputXDest","xDest","inputYDest","yDest","inputStrokeWidth","actualXDep","actualYDep","actualXDest","actualYDest","arrowLength","arrowPath","FlowsLayer","markerData","strokeWidthScale","flow","arrowSizeScale","copy","arrowSize","latitude_dep","longitude_dep","latitude_dest","longitude_dest","hideOverflowingFlows","depLabelPosition","destLabelPosition","depLabelTextAnchor","depLabelX","depLabelY","destLabelTextAnchor","destLabelX","destLabelY","labels","newLabels","depId","fields","largerStrokeWidth","flows","destId","actualX","j","label1","label2","minAx","minAy","maxAx","maxAy","minBx","minBy","maxBx","aAboveB","aBelowB","distanceY","hoverIds","setHoverIds","thatLabel","isVisible","hoveredId","CustomObjectLayer","renderObject","Button","onMouseDown","isMouseDown","interval","log","setInterval","clearInterval","onMouseUp","Input","inputValue","onBlur","setValue","onChange","Legend","layerFilter","l","hasSize","hasColors","modalityIndex","initialProjectionTemplate","inputProjectionConfig","projectionConfig","debug","withLegend","legendLayerFilter","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","setProjectionTemplate","defaultProjectionConfig","rotationDegree","geoEqualEarth","center","placeHolder","val","layerIndex","HorizontalBarChart","orientation","layout","Tooltip","yField","sortY","fillXGaps","xField","sortX","sortYField","ascending","sortYAscending","sortYType","autoSort","yAutoSort","sortXField","sortXAscending","sortXType","xValues","vizWidth","bandsNb","scaleBand","xExtent","sum","bandWidth","yStackScale","multiplier","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","fixedRowHeight","formatLabel","vizHeight","indexOf","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX","thatWidth","BarChart","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","keys","module","exports","CONTENTS","FrMla","FrIso690","FrApa","Doi","CitationWidget","blockquoteRef","isCollapsed","setIsCollapsed","currentStyle","setCurrentStyle","Contents","Test","datasets","datasetName","JSON","stringify","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","barTooltipFn","cityName","highlightYears","colorScaleMessages","year","footerRef","setHeight","newHeight","offsetHeight","yearsExtent","yearsEnumerated","xBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","yShareScale","rightYAxisValues","leftYAxisValue","maximum","minimum","marginRight","bandwidth","aStartYear","aEndYear","data-effect","data-html","data-class","data-place","initialEndYear","row","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","her","labelScale","element","maxWidth","backgroundColor","DeclineChart","productTradePartThreshold","rows","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","austriaWar","usIndependance","laRochelleDiaspora","totalRows","renderRow","rowFlex","rowIndex","region","comparison","rowId","PrincipalVisualizationPart1","G","inputProps","Text","text","Line","Circle","Rect","rect","Path","colorSchemes","colorScheme1","colorScheme2","colorScheme3","CircularAlluvialChart","sumBy","filters","centerHorizontalLabels","displaceHorizontalLabels","tooltips","align","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","spec","stepsSpec","_id","stepIndex","stepData","valueAbs","actualValue","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","VERTICAL_BAR_SIZE","stepScales","0","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","legendX1","legendX2","legendTopYInternal","legendTopYExternal","legendBottomYInternal","legendBottomYExternal","tooltipContent","fontWeight","fontStyle","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","flow_type","partner","tContent","trim","nodeHeight","initialY","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","flowX","flowY","flowWidth","flowHeight","Range","createSliderWithTooltip","Slider","SliderRange","allowCross","AxisObject","MARGIN","axisIndex","axisRankScale","rawX1","rawY1","rawX2","rawY2","labelXDisplace","labelYDisplace","foreignObject","inputX","inputY","inputR","VisObject","axisIndexMap","radiusScale","xRaw","yRaw","joinedPoints","tooltipValues","sumOfParts","portionA","portion","fillOpacity","RadarPlot","wholeSize","aIndex","visCenter","visSize","meta","normalizeRadarValues","datas","destCaptions","maxValue","maxBy","hasOwnProperty","dkey","RadarWrapper","globalWidth","minified","navigoAgregation","maxTonnage","selectedBureaux","setSelectedBureaux","aggregationMethod","setAggregationMethod","tonnageFilterValues","setTonnageFilterValues","datasetMaximumTonnage","setDatasetMaximumTonnage","destination_radar","ferme_bureau","tonnage","bureauxList","uniqBy","filteredData","bureauxToKeep","cleanBureaux","radarData","bureauName","relevantData","preparedData","_","dest","rObj","prepareTravelData","method","bureau","newSelectedBureaux","has","delete","add","PrincipalVisualizationPart2","showOnlyToflit","screenshotMode","sumToflitBy","alluvialFilters","toflit18titles","navigoTitles","importTranslate","exportTranslate","flow_direction","Step2","paddingLeft","metrics_type","PrincipalVisualizationPart3","currentMapTemplate","setCurrentMapTemplate","gradientTransform","colorBackgroundBlue","customs_region","BureauBackground","radius","BureauLabel","labelOnRight","IntroBureaux","dimensions","renderBureaux","HomeportFlows","englishCategoriesTranslation","France","hotFixedData","port_dest","category","port_dest_category","formatNestResults","input","isArray","TreemapChart","fieldsHierarchy","leaf","labelField","countField","root","nest","hierarchy","treemap","tile","treemapBinary","leaves","x0","y0","rectWidth","rectHeight","labelText","VisualizationContainer","inputDimensions","relevantDatasets","viz","visualizationsList","datasetsIds","Provider","order","value_rel_per_direction","entite","entity","nb_pointcalls","country","englishTypesTranslation","obj","borderBottom","raw_size","omit","homeport","category_2","thatPalette","customsRegion","origin","VisualizationController","setDimensions","visProps","onResize","contentRect","measureRef","VisualizationFocus","howDone","howRead","visualization","onClose","copyClicked","setCopyClicked","inputRef","focus","copyLink","linkCopied","onKeyUp","keyCode","stopPropagation","url","homepage","visualizationsMap","visualizations","ScrollyPage","ContentSync","sectionRef","focusOnViz","setFocusOnViz","visualizationIsFullScreen","setVisualizationIsFullScreen","isLoading","setIsLoading","setActiveVisualization","newState","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","visualizationEntries","sectionDims","visY","behavior","params","finalParams","newVis","thatId","Helmet","summary","routes","titles","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","ReferencesFr","ReferencesEn","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","route","navigator","userAgent","Home","introRef","inVis","setInVis","titleHTML","subtitle","newActiveVisualization","firstOneY","Infinity","dangerouslySetInnerHTML","__html","Atlas","history","useHistory","shownVisualization","visualizationIndex","pathname","src","alt","StandaloneVisualization","PlainPage","Content","fallback","colorText","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","useDebounce","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","tsvParse","error","newDatasets","renderRoute","ThatComponent","currentLang","ln","otherLang","pathOtherLang","routeItem","lazy","component","Fragment","BASE_NAME","Wrapper","basename","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","callback","delay","savedCallback","debouncedValue","setDebouncedValue","handler"],"mappings":"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","file":"static/js/main.54d0646e.chunk.js","sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { animated, useSpring } from 'react-spring';\nimport cx from 'classnames';\nimport colorsPalettes from '../../colorPalettes';\n\nimport partialCircle from 'svg-partial-circle';\nimport { max } from 'd3';\nimport ReactTooltip from 'react-tooltip';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport { SettingsContext } from '../../helpers/contexts';\nimport translate from '../../i18n/translate';\n\n\n/**\n * Renders custom viz object (triangles + donuts)\n * @param {array<number>} navigoValues\n * @param {number} toflitPct - pct of exports of locally produced products\n * @param {string} transformGroup - css transform\n * @param {number} circleRadius\n * @param {number} width\n * @param {number} height\n * @param {string} name\n * @param {boolean} legendMode\n * @param {boolean} isActive\n * @param {boolean} isMinified\n * @param {function} onClick\n * @returns {React.ReactElement} - React component\n */\nconst ExtraversionObject = ({\n  navigoValues: [metric1, metric2],\n  toflitPct,\n  transformGroup,\n  circleRadius: inputCircleRadius,\n  width: inputWidth,\n  height: inputHeight,\n  name,\n  legendMode,\n  isActive,\n  isMinified,\n  onClick,\n}) => {\n  const circleRadius = fixSvgDimension(inputCircleRadius);\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  const { transform } = useSpring({\n    to: {\n      transform: transformGroup\n    },\n    immediate: !isInited\n  });\n\n\n  const maxTriangleHeight = (circleRadius) * 1.4;\n  // dimensionning triangles based on their area (and not triangle height)\n  // Area = (height * base) / 2;\n  const maxArea = maxTriangleHeight * (maxTriangleHeight) / 2;\n  const area1 = metric1 * maxArea;\n  const area2 = metric2 * maxArea;\n  const leftTriangleHeight = Math.sqrt(area1 * metric1);\n  const rightTriangleHeight = Math.sqrt(area2 * metric2);\n\n  let start = null\n  let end = null\n  let leftPath;\n  let rightPath;\n  if (toflitPct) {\n    // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement réparti en bas à droite si co sans coords\n\n    // calcul des angles de départ et d'arrivée de l'arc de cercle, en fonction des données\n    start = Math.PI / 2 + (toflitPct - 50) / 100 * Math.PI\n    end = Math.PI * 3 / 2 - (toflitPct - 50) / 100 * Math.PI\n\n    leftPath = partialCircle(\n      0, 0,         // center X and Y\n      circleRadius,              // radius\n      start,          // start angle in radians --> Math.PI / 4\n      end             // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n    rightPath = partialCircle(\n      0, 0,             // center X and Y\n      circleRadius,                  // radius\n      start,              // start angle in radians --> Math.PI / 4\n      end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n  }\n\n  const { lang } = useContext(SettingsContext);\n\n  let labelFontSize = parseInt(height * 0.013);\n  labelFontSize = labelFontSize > 8 ? labelFontSize : 8;\n  return (\n    <animated.g\n      className={cx('ExtraversionObject', { 'is-active': isActive, 'is-minified': isMinified })}\n      // transform={noOverlapTransform}\n      transform={transform}\n      onClick={() => typeof onClick === 'function' ? onClick(name) : undefined}\n    // { datum.longitude === 0 ? x=1 : null }\n    >\n\n      <>\n        {\n          toflitPct && leftPath != null ?\n            <>\n\n              <path\n                d={`${leftPath}\n                  `}\n                stroke={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n                strokeWidth={width * 0.005} // à ajuster en fonction de la largeur de l'écran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                // data-tip={`${(100 - toflitPct ).toFixed(1)}% de valeur d'exports de produits fabriqués hors de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le détail des ports)' : ''}`}\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_export_out', lang, { number: (100 - toflitPct ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le détail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_export_out', lang, { number: (100 - toflitPct ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n              />\n\n              <path\n                d={`${rightPath}\n                  `}\n                stroke={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n                strokeWidth={width * 0.005} // à ajuster en fonction de la largeur de l'écran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_export_in', lang, { number: (toflitPct).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le détail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_export_in', lang, { number: (toflitPct).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n              />\n            </>\n            :\n            null\n        }\n        <path className='left-triangle'\n          fill={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n          d={`M ${0} ${-leftTriangleHeight / 2}\n            V ${leftTriangleHeight / 2}\n            L ${-leftTriangleHeight} ${0}\n            Z\n                `}\n                data-for=\"geo-tooltip\"\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_tonnage_out', lang, { number: (metric1 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le détail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_tonnage_out', lang, { number: (metric1 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n        />\n\n        <path\n          className='right-triangle'\n          fill={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n          d={`M ${0} ${-rightTriangleHeight / 2}\n            L ${rightTriangleHeight} ${0}\n            L ${0} ${rightTriangleHeight / 2}\n            Z\n            `}\n            data-for=\"geo-tooltip\"\n            data-tip={\n              (lang === 'fr' && translate('viz-principale-partie-3', 'value_tonnage_in', lang, { number: (metric2 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le détail des ports)' : '' })) ||\n              translate('viz-principale-partie-3', 'value_tonnage_in', lang, { number: (metric2 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n            }\n        />\n        <g\n          transform={`translate(${parseInt(0)}, ${toflitPct ? parseInt(circleRadius) + 15 : max([leftTriangleHeight, rightTriangleHeight]) / 2 + 10})`}\n        >\n          <text\n            className='object-label'\n            font-size={labelFontSize}\n            textAnchor=\"middle\"\n          >\n            {name}\n          </text>\n        </g>\n      </>\n      {\n        legendMode ?\n          <g className=\"legend-container\">\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={-circleRadius * 1.7}\n              className=\"top left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_export_out', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * .95}\n              y1={-circleRadius * 1.5}\n              x2={-circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={-circleRadius * 1.7}\n              className=\"top right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                {translate('viz-principale-partie-3', 'foreignObject_export_in', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 1.15}\n              y1={-circleRadius * 1.5}\n              x2={circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={0}\n              className=\"bottom left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_flow_out', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * 1.8}\n              y1={circleRadius * .2}\n              x2={-circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={0}\n              className=\"bottom right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_flow_in', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 2}\n              y1={circleRadius * .2}\n              x2={circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n\n          </g>\n          : null\n      }\n    </animated.g>);\n}\n\nexport default ExtraversionObject;","/*\nDOCUMENTATION : sommaires des fonctions\n\n- renderLabel (renderObject)\npositionner geographiquement des labels\n\n- renderStep3Object (renderObject)\ncréation d'un double triangle et d'un cercle autour (deux courbes de bézier), positionné géographiquement\n(objet associé à un bureau des Fermes)\n\n- fonction renderStep3SmallMultiples (renderObjects)\ncréation des objets double triangle et cercles pour les small multiples de la viz 3.3, positionnés en bas à droite du SVG\n+ un objet de légende\n\n- renderTriangles (renderObjects)\ncréation des triangles pour la viz 3.1, reliés par une courbe pointillée à des points positionnés géographiquement\n+ un triangle de légende\n\n@TODO : compléter la fonction step3Object (ou créer une nouvelle fonction), pour gérer l'apparition des doubles triangles pour chaque port\n-  cette fonctionnalité est déjà prévue dans la fonction renderStep3Object (dans la boucle   if (datum.type_of_object === \"port\") { ...}) mais en l'état les objets ports sont positionnés géographiquement\n- il faudrait adapter pour positionner les objets ports en colonne, sur la gauche du SVG, et qu'ils aient par défaut une opacité à 0% sauf au hover de l'objet bureau des fermes correspondant => apparition\n\n*/\nimport { useMemo, useState, useContext } from 'react';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport ExtraversionObject from './ExtraversionObject';\n\nimport { SettingsContext } from '../../helpers/contexts';\n\nimport TriangleChart from '../../components/TriangleChart/TriangleChart';\nimport { fixSvgDimension } from '../../helpers/misc';\nimport translate from '../../i18n/translate';\n\nexport function Label(datum, projection, { width }) { // à terme on pourrait mettre un objet \n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text size={width * 0.05}>{datum.label}</text>\n    </g>);\n}\n\n/**\n * Render an object in viz 3.3\n * @param {object} datum\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @param {boolean} isActive\n * @param {boolean} isMinified\n * @param {function} onClick\n * @returns {React.ReactElement} - React component\n */\nfunction Step3Object({\n  datum,\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate,\n  isActive,\n  isMinified,\n  onClick\n}) { // à priori plus besoin de datum et de width qui sont déjà passés au composant CustomObjectLayer\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  let circleRadius = width * 0.05;\n  const totalTonnage = parseFloat(datum.cumulated_tonnage_out_region) + parseFloat(datum.cumulated_tonnage_in_region)\n\n  if (datum.type_of_object === \"port\") {\n    // définition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la définition des classes est expérimentale)\n    // se gérerait bien avec un switch\n    if (totalTonnage < 1000) { // * 1000\n      circleRadius = width * 0.025\n    }\n    else {\n      if (totalTonnage > 5000) {\n        circleRadius = width * 0.075\n      }\n    }\n  }\n\n  const navigoMetric1 = parseFloat(datum.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n  const navigoMetric2 = parseFloat(datum.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n  let inPercentage = 0;\n  if (datum.type_of_object === \"customs_office\") {\n    const totalValue = parseFloat(datum.cumulated_exports_value_from_region) + parseFloat(datum.cumulated_exports_value_from_ext)\n    inPercentage = parseFloat(datum.cumulated_exports_value_from_region) / totalValue * 100\n    inPercentage = inPercentage === 100 ? 99.99 : inPercentage;\n  }\n\n  // handle overlap \n  let noOverlapTransform = `translate(${x},${y})` // mettre entre accolades ??\n  if (projectionTemplate.includes('Poitou')) {\n    if (datum.name === 'Tonnay-Charente') {\n      noOverlapTransform = `translate(${x + width * 0.15},${y})`\n    }\n    else if ((datum.name === 'Rochefort')) {\n      noOverlapTransform = `translate(${x + width * 0.04},${y - height * 0.0})`\n    }\n    else if ((datum.name === 'Marennes')) {\n      noOverlapTransform = `translate(${x - width * 0.03},${y + height * 0.05})`\n    }\n    else if ((datum.name === 'Marans')) {\n      noOverlapTransform = `translate(${x + width * 0.03},${y - height * 0.05})`\n    }\n    else if ((datum.name === 'Saint-Martin-de-Ré')) {\n      noOverlapTransform = `translate(${x - width * 0.06},${y})`\n    }\n    else if ((datum.name === `Les Sables-d'Olonne`)) {\n      noOverlapTransform = `translate(${x - width * 0.01},${y - height * 0.03})`\n    }\n  }\n  \n\n  const transformGroup = projectionTemplate === 'France' ? noOverlapTransform + ' scale(0.1)' : noOverlapTransform + ` scale(${isMinified ? 0.5 : 1})`;\n  return (\n    <ExtraversionObject\n      {\n      ...{\n        transformGroup,\n        navigoValues: [navigoMetric1, navigoMetric2],\n        toflitPct: !isNaN(inPercentage) ? inPercentage : 100,\n        circleRadius,\n        width,\n        height,\n        name: datum.name,\n        isActive,\n        isMinified,\n        onClick\n      }\n      }\n    />\n  )\n}\n\n/**\n * Renders objects for step 3.3\n * @param {array} data\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nexport function Step3Objects({\n  data: { customsOffices = [], ports = [] },\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [selectedBureau, setSelectedBureau] = useState(undefined);\n  const handleClick = (name) => {\n    if (name === selectedBureau) {\n      setSelectedBureau(undefined);\n    } else setSelectedBureau(name);\n  }\n\n  const visiblePorts = useMemo(() => {\n    if (selectedBureau) {\n      return ports.filter(d => d.customs_office === selectedBureau)\n    }\n    return [];\n  }, [selectedBureau, ports])\n\n  const partsSpaceStartX = 15;\n  const portsSpaceStartY = height * 0.18;\n  const portsSpaceHeight = height * 0.55;\n  const portsSpaceWidth = width * .35;\n\n  const portRowHeight = visiblePorts.length ?  portsSpaceHeight / visiblePorts.length : portsSpaceHeight;\n\n  return (\n    <g className=\"Step3Objects\">\n      {\n        selectedBureau ?\n          <g className=\"ports-details\">\n            <foreignObject\n              x={0}\n              y={0}\n              width={width * .4}\n              height={height / 2}\n              className=\"ports-details-title\"\n            >\n              <h5>Ports associés au bureau des fermes de {selectedBureau} ({visiblePorts.length})</h5>\n            </foreignObject>\n            <g\n              className=\"ports-space\"\n              transform={`translate(${partsSpaceStartX}, ${portsSpaceStartY})`}\n            >\n              {/* <rect\n                x={0}\n                y={0}\n                width={portsSpaceWidth}\n                height={portsSpaceHeight}\n                style={{ fill: 'red' }}\n              /> */}\n              {\n                visiblePorts\n                .sort((a, b) => {\n                  const [_xA, yA] = projection([+a.longitude, +a.latitude]);/* eslint no-unused-vars : 0 */\n                  const [_xB, yB] = projection([+b.longitude, +b.latitude]);/* eslint no-unused-vars : 0 */\n                  if (yA > yB) {\n                    return 1;\n                  }\n                  return -1;\n                })\n                .map((port, portIndex) => {\n                  const [x, y] = projection([+port.longitude, +port.latitude]);\n                  const initialCircleRadius = width * 0.05;\n                  let circleRadius = initialCircleRadius;\n                  const totalTonnage = parseFloat(port.cumulated_tonnage_out_region) + parseFloat(port.cumulated_tonnage_in_region)\n\n                  // définition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la définition des classes est expérimentale)\n                  // se gérerait bien avec un switch\n                  if (totalTonnage < 1000) { // * 1000\n                    circleRadius = width * 0.025\n                  }\n                  else {\n                    if (totalTonnage > 5000) {\n                      circleRadius = width * 0.075\n                    }\n                  }\n                  const navigoMetric1 = parseFloat(port.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n                  const navigoMetric2 = parseFloat(port.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n                  const objectX = portsSpaceWidth / 2 - initialCircleRadius * 2 + (visiblePorts.length > 5 ? portIndex % 2 === 0 ? 0 : initialCircleRadius * 2 : 0);\n                  const objectY = portRowHeight * portIndex;\n                  // const transformGroup = projectionTemplate === 'France' ? `translate(${x},${y})` + ' scale(0.1)' : `translate(${x},${y})` + ` scale(1)`;\n                  const transformGroup = `translate(${objectX}, ${objectY})`;\n                  return (\n                    <g className=\"port-group\" key={port.name}>\n                      <line\n                        x1={objectX}\n                        y1={objectY}\n                        x2={x - partsSpaceStartX}\n                        y2={y - portsSpaceStartY}\n                      />\n                      <circle\n                        cx={x - partsSpaceStartX}\n                        cy={y - portsSpaceStartY}\n                        r={width * 0.002}\n                        style={{ fill: colorsPalettes.generic.dark }}\n                        className=\"marker\"\n                      />\n                      <ExtraversionObject\n                        {\n                        ...{\n                          transformGroup,\n                          navigoValues: [navigoMetric1, navigoMetric2],\n                          circleRadius,\n                          width,\n                          height,\n                          name: port.name,\n                        }\n                        }\n                      />\n                    </g>\n                  )\n                })\n              }\n            </g>\n\n          </g>\n          : null\n      }\n      {\n        customsOffices.map((datum, index) => (\n          <Step3Object\n            key={datum.name}\n            {\n            ...{\n              datum,\n              projection,\n              width,\n              height,\n              projectionTemplate,\n              onClick: handleClick,\n              isActive: datum.name === selectedBureau,\n              isMinified: selectedBureau && datum.name !== selectedBureau\n            }\n            }\n          />\n        ))\n      }\n    </g>\n  )\n}\n\n/**\n * Renders small multiples for 3.3\n * @param {array} data\n * @param {number} width\n * @param {number} height\n * @returns {React.ReactElement} - React component\n */\nexport function SmallMultiples({ \n  data, \n  width: inputWidth, \n  height: inputHeight\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // could be parametered in props too\n  const bureaux = data.filter(({ name }) => name === 'Le Havre' || name === 'Nantes' || name === 'Bordeaux' || name === 'La Rochelle')\n    .sort((a, b) => {\n      if (a.cumulated_exports_value_from_region > b.cumulated_exports_value_from_region) {\n        return -1;\n      }\n      return 1;\n    })\n  const legendCustomOffice = {\n    name: 'Légende',\n    cumulated_tonnage_in_region: 60,\n    cumulated_tonnage_out_region: 60,\n    cumulated_exports_value_from_region: 50,\n    cumulated_exports_value_from_ext: 50,\n    legendMode: true\n  }\n  bureaux.unshift(legendCustomOffice)\n\n  const margin = 15;\n  let circleRadius = width * 0.05;\n  const multiplesY = height - circleRadius - margin * 2;\n\n  const legendFactor = 1;\n\n  const columnWidth = (circleRadius * 2 + margin);\n\n  const xObjectsStart = width * .4 // circleRadius * legendFactor + circleRadius + margin;\n\n  const { lang } = useContext(SettingsContext);\n\n  return (\n    <g className=\"small-multiples-and-legend-and-title\">\n      <rect\n        x={xObjectsStart + margin * 2}\n        y={multiplesY - circleRadius * 3}\n        width={width - xObjectsStart - margin * 4}\n        height={height - multiplesY + circleRadius * 3 - margin / 2}\n        style={{ fill: 'white' }}\n        opacity={0.5}\n      />\n      <foreignObject\n        x={xObjectsStart + circleRadius * 1.5}\n        y={multiplesY - circleRadius * 3}\n        width={(circleRadius * 2 + margin) * (bureaux.length - 1)}\n        height={height}\n      >\n        <div style={{ position: 'relative' }}>\n          <h5 className=\"visualization-title\" style={{ position: 'absolute', left: 0, bottom: 0 }}>\n            {translate('viz-principale-partie-3', 'SmallMultiples_title', lang)}\n          </h5>\n        </div>\n      </foreignObject>\n      <g className=\"small-multiples\">\n        {\n          bureaux\n            .map((custom_office, index) => {\n              const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n\n              const navigoMetric1 = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n              const navigoMetric2 = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n\n              const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n              const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n\n              return custom_office.legendMode ?\n                (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${circleRadius * legendFactor * 4 + margin + index * (circleRadius * legendFactor + margin)}, ${multiplesY - (circleRadius * legendFactor - circleRadius)})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius: circleRadius * legendFactor,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n                : (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${xObjectsStart + index * columnWidth}, ${multiplesY})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n            })\n        }\n\n      </g>\n      <defs>\n        <marker id=\"triangle-end\" viewBox=\"-10 0 10 10\"\n          refX=\"1\" refY=\"5\"\n          markerUnits=\"strokeWidth\"\n          markerWidth={width * 0.01}\n          markerHeight={width * 0.01}\n          orient=\"auto\">\n          <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n        </marker>\n      </defs>\n    </g>\n  );\n\n}\n\n/**\n * Renders a row of triangles\n * @param {array} data\n * @param {number} width\n * @param {number} height\n * @param {function} projection\n * @param {string} projectionTemplate\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nexport function renderTriangles({ \n  data, \n  width: inputWidth, \n  height: inputHeight, \n  projection, \n  projectionTemplate, \n  atlasMode,\n  lang\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // console.log(\"data : layder.data \", data)\n  return (\n    <TriangleChart\n      data={data}\n      totalWidth={width} // @TODO : il faudrait réduire cette width \n      rowHeight={height * 0.3}\n      projection={projection}\n      projectionTemplate={projectionTemplate}\n      atlasMode={atlasMode}\n      lang={lang}\n    />\n  );\n}","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      // console.log('color the attr', nodeColor.name, attr[nodeColor.name]);\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      // console.log('size attr', nodeSize.name, attr);\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const smallerNode = sourceNodeSize < targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (smallerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = smallerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[smallerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React, { useCallback, useRef, useState, useEffect, useMemo } from 'react';\nimport gexf from 'graphology-gexf';\nimport forceAtlas2 from 'graphology-layout-forceatlas2';\nimport Graph from 'graphology';\nimport { WebGLRenderer as Renderer } from 'sigma';\nimport { scaleLinear } from 'd3-scale';\nimport { min, max, extent } from 'd3-array';\nimport { uniq } from 'lodash';\n// import get from 'axios';\n\nimport { createNodeReducer, createEdgeReducer } from './reducers';\nimport { generatePalette } from '../../helpers/misc';\nimport { usePrevious } from '../../helpers/hooks';\n\nimport './GraphContainer.scss';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\n// function rescale(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedReset(renderer);\n// }\n\n// function zoomIn(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedZoom(renderer);\n// }\n\n// function zoomOut(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedUnzoom(renderer);\n// }\n\n/**\n * Network graph wrapper\n * @todo this should be enterely refactored using https://github.com/sim51/react-sigma-v2\n * @param {object} graph\n * @param {string} nodeColor -  field name\n * @param {string} nodeSize -  field name\n * @param {number} labelDensity\n * @param {string} nodeLabel - fieldName\n * @param {function} onCameraUpdate\n * @param {object} cameraPosition\n * @param {number} updateTimestamp\n * @param {number} width\n * @param {number} height\n * @param {number} ratio - camera ratio/zoom level\n * @returns {React.ReactElement} - React component \n */\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n  width,\n  height,\n  ratio,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n\n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable && nodeColorVariable.field) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable.field])\n      })\n      values = uniq(values);\n      let palette = {};\n      if (nodeColorVariable.palette) {\n        palette = nodeColorVariable.palette;\n      } else {\n        const colors = generatePalette(nodeColorVariable.field, values.length);\n        let i = 0;\n        values.forEach(option => {\n          palette[option] = colors[i];\n          i++;\n        });\n      }\n\n      return {\n        palette,\n        name: nodeColorVariable.field\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n        m.set(edge, { sourceNode: sourceAttributes, targetNode: targetAttributes })\n      });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n\n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n\n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n      const camera = renderer.getCamera();\n      // console.log('animate camera', camera);\n      camera.animate(cameraPosition);\n    }\n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n\n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n  useEffect(() => {\n    if (renderer) {\n      renderer.refresh();\n    }\n  }, [width, height])\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, { nodeReducer, edgeReducer });\n\n        newRenderer.settings.labelFont = 'IBM Plex Sans';\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        camera.setState({ ...camera.getState(), ratio: ratio || 1 });\n        camera.disable();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{ width: '100%', height: '100%', minHeight: '10vh', minWidth: '1vw' }}></div>\n      {/*renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )*/}\n    </div>\n  );\n}\n\n\nexport default function NetworkGraphChart({\n  data: gexfString,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  spatialize,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 },\n  width = 0,\n  height,\n  ratio,\n  title\n}) {\n  const headerRef = useRef(null);\n  const headerHeight = useMemo(\n    () => headerRef.current ? headerRef.current.getBoundingClientRect().height : 0, [headerRef.current])\n\n  // useState renvoie un state et un seter qui permet de le modifier\n  const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n\n  useEffect(() => {\n    if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n      setCameraPosition(inputCameraPosition);\n    }\n  }, [inputCameraPosition])\n\n  const onCameraUpdate = cam => {\n    setCameraPosition(cam);\n  }\n  const graph = useMemo(() => {\n    const g = gexf.parse(Graph, gexfString);\n    if (spatialize) {\n      const settings = forceAtlas2.inferSettings(g);\n      // To directly assign the positions to the nodes:\n      forceAtlas2.assign(g, {\n        settings,\n        iterations: 50\n      });\n    }\n    return g;\n  }, [gexfString]);\n\n  if (!graph) {\n    return null;\n  }\n  return (\n    <div className=\"NetworkGraphChart\" style={{ \n      width: '100%', \n      height: height || '100%',\n    }}>\n      <div ref={headerRef} className=\"row visualization-title-container\">\n        {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n      </div>\n      <div style={{\n        position: 'relative',\n        flex: 1,\n        // top: headerHeight,\n        // background: 'red',\n        // height: height - headerHeight\n      }}>\n\n        <GraphContainer\n          {\n          ...{\n            graph,\n            cameraPosition,\n            nodeColor,\n            nodeSize,\n            labelDensity,\n            nodeLabel,\n            ratio,\n            onCameraUpdate,\n            width,\n            height: height - headerHeight\n          }\n          }\n        />\n      </div>\n    </div>\n  )\n}","import json from './lang.json'\n\n/**\n * \n * @param {string} vizId Viz identifier as 'viz-principale-partie-1'\n * @param {string} label Ref to the viz label from the translate file 'lang.yml'\n * @param {'fr'|'en'} lang \n */\n\nconst matchDollarBracket = new RegExp(/\\$\\{(\\w+)\\}/g)\n\nexport default function translate (vizId, label, lang, args) {\n    if (json[vizId] === undefined || json[vizId][label] === undefined || json[vizId][label][lang] === undefined) {\n        return `pas de traduction disponible (${vizId} | ${label})`;\n    }\n\n    let result = json[vizId][label][lang];\n\n    if (!!result === false) {\n        return `pas de traduction disponible (${vizId} | ${label})`;\n    }\n\n    if (args === undefined) {\n        return result;\n    }\n\n    result = result.replace(matchDollarBracket, (match, key) => {\n        return args[key] || key\n    })\n\n    return result;\n}","/**\n * A series of miscellaneous helper functions\n */\n\n/* import external library */\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\n/* import other assets */\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\nimport palettes from '../colorPalettes';\n\nconst { generic } = palettes;\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\n\n/**\n * Generates a head's title for the current page\n * @param {string} title\n * @param {string} lang='fr'\n * @returns {string}\n */\nexport function buildPageTitle(title, lang = 'fr') {\n  const currentMetadata = metadata[lang] || metadataFr;\n  return `${title} | ${currentMetadata.title} | PORTIC`;\n}\n\n/**\n * Trims a text given a certain length limit/maximum\n * @param {string} str\n * @param {number} limit=30\n * @returns {string}\n */\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\n/**\n * Transform cartesian coordinates to polar coordinates\n * @param {number} x\n * @param {number} y\n * @returns {object} - distance and radians of the polar coordinates\n */\nexport function cartesian2Polar(x, y) {\n  const distance = Math.sqrt(x * x + y * y);\n  const radians = Math.atan2(y, x);\n  return {\n    distance, radians\n  }\n}\n/**\n * Transform polar coordinates to cartesian coordinates\n * @param {number} r\n * @param {number} theta\n * @returns {array} - array of x and y positions\n */\nexport const polarToCartesian = (r, theta) => [\n  r * Math.cos(theta),\n  r * Math.sin(theta)\n]\n\n/**\n * Generate a color palette in a deterministic way for the app\n * @param {string} name\n * @param {number} count - number of colors to generate\n * @returns {any}\n */\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n/**\n * Normalizes a dimension so that it is fitable for svg dimensions (not NaN, positive)\n * @param {number} num\n * @returns {number}\n */\nexport const fixSvgDimension = num => isNaN(num) ? 0 : Math.abs(+num);\n\n/**\n * Format a number so that it is more legible\n * @param {number} n\n * @param {string} style='fr'\n * @returns {string}\n */\nexport const formatNumber = (n, style = 'fr') => {\n  return ('' + n)\n    .split('')\n    .reverse()\n    .reduce(({ count, result }, digit, index) => {\n      const endOfLine = count === 3 || (count === 0 && index === ('' + n).length - 1);\n      if (endOfLine) {\n        return {\n          count: 1,\n          result: [...result, style === 'fr' ? ' ' : ',', digit]\n        }\n      } else return {\n        count: count + 1,\n        result: [...result, digit]\n      }\n\n    }, {\n      count: 0,\n      result: []\n    })\n    .result\n    .reverse()\n    .join('')\n}\n\n\n/**\n * ===============\n * DEPRECATED\n * Cécile's code for when we directly queryied data from source APIs\n * ==============\n */\n\n\n\n/**\n * Filters data given certain parameters\n * @param {array} data\n * @param {object} params\n * @returns {array}\n */\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: ”Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajouté startYear et endYear pour\n      // la récupération de portic il s'agira de déduire ce year des données\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble être indiçable mais pas sur qu'on doive pas le mettre dans un format spécial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas à garder dans le résultats (colonne données dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau à une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        // à partir de là, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptées par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intéressent dans le résultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'était else { ... } et on passait jamais dedans apparemment du coup là c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // différencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"après le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n/**\n * Gets toflit18 flows (from local csv) according to certain  filter parameters\n * @param {object} params\n * @returns {promise}\n */\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // méthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // méthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // méthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : récupère les flux toflit18\n  --- \n  Paramètres :\n  * startYear : <int> # année de début\n  * endYear : <int> # année de fin\n  * params : <arr> # propriétés à renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs à filtrer dans les flux (peut être une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // ça sert à quelque chose ?? pour moi c'est pas utilisé, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validité des paramètres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'état ça ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les résultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}","import React, { useEffect, useState } from 'react';\nimport cx from 'classnames';\nimport { animated, useSpring } from 'react-spring';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Returns a given port visual elements in triangles comparison visualization (for viz 3.1)\n * @param {number} numberOfColumns\n * @param {object} port\n * @param {function} scaleX\n * @param {function} scaleY\n * @param {number} legendWidth\n * @param {number} columnWidth\n * @param {umber} totalHeight\n * @param {number} totalWidth\n * @param {function} projection\n * @param {number} index\n * @param {object} margins\n * @param {number} rowHeight\n * @param {number} fontSize\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst PortGroup = ({\n  numberOfColumns,\n  port,\n  scaleX,\n  scaleY,\n  legendWidth,\n  columnWidth,\n  totalHeight,\n  totalWidth,\n  projection,\n  index,\n  margins,\n  rowHeight,\n  fontSize,\n  projectionTemplate,\n  lang\n}) => {\n\n\n  const triangleWidth = scaleX(+port.nb_pointcalls_out)\n  const triangleHeight = scaleY(+port.mean_tonnage)\n\n  const xIndex = index % numberOfColumns;\n  // const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n  const xTransform = xIndex * columnWidth + margins.left // + (legendWidth + margins.left) * totalWidth;\n  const yTransform = totalHeight * 2.3;\n\n  // const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform, x1, y1, x2, y2, staticTransform, markerRadius } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`,\n      x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : x,\n      y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : y,\n      // x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : totalWidth * 0.1,\n      // y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : index * (totalHeight / numberOfColumns),\n\n      markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 0,\n      // markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 1,\n      \n      // x1: xTransform + columnWidth / 2,\n      // y1: yTransform + rowHeight / 7,\n      x2: x,\n      y2: y,\n      staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${x},${y}) scale(${projectionTemplate === 'rotated Poitou' ? 1 : 0.1})`\n      // staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${totalWidth * 0.1},${index * (totalHeight / numberOfColumns)}) scale(${projectionTemplate === 'France' ? 0.2 : 1})`\n    },\n    immediate: !isInited\n  });\n\n  const cellCenterX = columnWidth / 2;\n  const cellCenterY = rowHeight / 2;\n  const textStartY = rowHeight / 7;\n  const triangleStartY = cellCenterY + textStartY / 2 - triangleHeight / 2;\n  const legendTextWidth= totalWidth * 0.08;\n\n  let labelBgWidth = fontSize * 12;\n  if (port.port.length <= 10) {\n    labelBgWidth = fontSize * 6;\n  } else if (port.port.length <= 12) {\n    labelBgWidth = fontSize * 7;\n  } else if (port.port.length <= 15) {\n    labelBgWidth = fontSize * 8;\n  } else if (port.port.length <= 18) {\n    labelBgWidth = fontSize * 10;\n  }\n\n  return (\n    <g className={cx('port-point-and-triangle', {'is-minified': projectionTemplate !== 'rotated Poitou'})}>\n\n      <animated.line\n        x1={x1}\n        y1={y1}\n        x2={x2}\n        y2={y2}\n        stroke='grey'\n        strokeDasharray='2, 8'\n      />\n\n      <animated.g className='port-point' transform={transform}>\n        <animated.circle\n          cx={0}\n          cy={0}\n          r={markerRadius}\n          style={{ fill: colorsPalettes.generic.dark }}\n          className=\"marker\"\n        />\n      </animated.g>\n\n      <animated.g className='port-triangle'\n        // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n        transform={staticTransform}\n      >\n        {/* <rect\n          x={0}\n          y={0}\n          width={columnWidth}\n          height={rowHeight}\n          style={{stroke: 'red'}}\n        /> */}\n\n        {/* <path class='vertical-line'\n          d={`M ${cellCenterX} ${(rowHeight - triangleHeight) / 1.2} \n              V ${rowHeight / 7}\n              `}\n        /> */}\n        <path className='vertical-line'\n          d={`M ${cellCenterX} ${textStartY} \n              V ${triangleStartY}\n              `}\n        />\n\n        <g transform={`translate(${cellCenterX}, ${triangleStartY})`}>\n\n          <path className='triangle'\n            d={`M ${-triangleWidth / 2} ${0} \n                L ${triangleWidth / 2} ${0}\n                L ${0} ${triangleHeight}\n                Z\n                `}\n            fill=\"url(#TriangleGradient)\"\n          />\n          {/* <circle\n            fill=\"red\"\n            r={2}\n            cx={-triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={0}\n            cy={triangleHeight}\n          /> */}\n        </g>\n        <g className=\"local-legend\">\n          {/* horizontal line */}\n          <line\n            x1={cellCenterX - triangleWidth/2}\n            x2={cellCenterX + triangleWidth/2}\n            y1={triangleStartY - 3}\n            y2={triangleStartY - 3}\n            markerStart=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* vertical line */}\n          <line\n            x1={cellCenterX - triangleWidth/2 - 3}\n            x2={cellCenterX - triangleWidth/2 - 3}\n            y1={triangleStartY}\n            y2={triangleStartY + triangleHeight}\n            markerStart=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* pointing arrows */}\n          <path\n            d={`\n            M ${-(legendTextWidth* .2) - triangleWidth / 3} ${triangleStartY * .65}\n            Q ${cellCenterX - 10} ${triangleStartY * .65} ${cellCenterX - 2} ${triangleStartY - 5}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <path\n            d={`\n            M ${-triangleHeight / 3 + 3} ${triangleStartY + triangleHeight * .6 + 7}\n            L ${cellCenterX - triangleWidth/2 - 3} ${triangleStartY + triangleHeight * .6 + 7}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <foreignObject \n            y={triangleStartY / 2}\n            x={-legendTextWidth - triangleWidth / 3}\n            width={legendTextWidth}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n              {translate('viz-principale-partie-3', 'nb_pointcalls_out', lang)}  : <strong>{port.nb_pointcalls_out}</strong>\n            </span>\n          </foreignObject>\n          <foreignObject \n            x={-legendTextWidth - triangleWidth / 3}\n            y={triangleStartY + triangleHeight * .6}\n            width={totalWidth * 0.08}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n            {translate('viz-principale-partie-3', 'mean_tonnage', lang)} : <strong>{(+port.mean_tonnage || 0).toFixed(1)}</strong>\n            </span>\n          </foreignObject>\n          \n        </g>\n        <g className='label' transformOrigin=\"bottom left\" transform={`translate(${columnWidth / 2}, ${rowHeight / 7 - totalHeight * 0.025})`}>\n          <path\n            d={`M 0 ${-fontSize} L ${labelBgWidth} ${-fontSize} ${labelBgWidth - 5} ${(-fontSize + fontSize * 0.2) / 2} ${labelBgWidth} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // d={`M 0 ${-fontSize} L ${port.port.length * fontSize * .64} ${-fontSize} ${port.port.length * fontSize * .64 - 5} ${(-fontSize + fontSize * 0.2) / 2} ${port.port.length * fontSize * .64} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // x={0}\n            // y={-fontSize}\n            // height={fontSize * 1.2}\n            // width={port.port.length * fontSize * .65}\n            style={{ fill: colorsPalettes.generic.dark }}\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n          />\n          <text\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n            font-size={fontSize}\n            style={{ fill: 'white' }}\n            x={3}\n            y={0}\n            textAnchor=\"left\"\n          > {port.port} </text>\n        </g>\n\n      </animated.g>\n    </g>\n  )\n}\n\nexport default PortGroup;","/* DOCUMENTATION : API de ce TriangleChart\n\n  Principe :\n    Composant conçu spécifiquement pour les triangles de la viz 3.1, mais pourrait être décliné\n    -> permet de produire une série d'objets en SVG, qui se disposent dans une grille en fonction de la longueur du dataset, et les dimensions de cette grille sont paramètrables\n\n  Paramètres : \n    data : données à afficher sur la carte,\n    totalWidth : largeur totale du composant (1 objet de légende + grille d'objets) (par défaut à 1200 px)\n    legendWidth : largeur de la légende (par défaut à un dizième de la largeur totale)\n    margins : marges de gauche (entre l'objet de la légende et la grille) et de froite (entr la droite de la grille et l'extrémité droite de l'écran)\n    rowHeight : hauteur d'une ligne de la grille (par défaut à 200px)\n    projection : on passe en paramètre la projection de d3 geo pour pouvoir donner accès au positionnement géographique sur une carte (permet dans le cas de la viz 3.1 de lier les triangles au point de localisation géographique du port qu'ils représentent => point et triangle sont nesté dans un même objet, ce qui permet d'établir une courbe pointillée entre eux et gérer l'interaction avec des jeux d'opacité au hover)\n\n  Pistes d'amélioration : \n  - filtrer les objets à l'entrée ? (par exemple pour la viz 3.1 on pourrait choisir d'afficher le triangle associé à un port que si les dimensions dépassent un certain seuil) => cela permettrait d'alléger la carte, en affichant seulement les ports pour lesquels on a des données représentatives\n\n  @TODO : documenter ce component de maière standardisée\n  */\n\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\nimport cx from 'classnames';\n\nimport './TriangleChart.scss'\nimport colorsPalettes from '../../colorPalettes';\n\n// import TriangleLegend from './TriangleLegend';\nimport PortGroup from './PortGroup';\n\n\n/**\n * Returns triangles comparison visualization (for viz 3.1)\n * @param {array} data\n * @param {number} totalWidth\n * @param {number} legendWidth - portion in [0,1]\n * @param {object} margins\n * @param {number} rowHeight\n * @param {function} projection\n * @param {string} projectionTemplate\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst TriangleChart = ({\n  data,\n  totalWidth = 1200,\n  legendWidth = 0.1,\n  margins: inputMargins,\n  rowHeight = 200,\n  projection,\n  projectionTemplate,\n  atlasMode,\n  lang\n}) => {\n\n  const margins = inputMargins ||  {\n    left: totalWidth * .1,\n    right: totalWidth * .1\n  }\n  // {\n  //   left: 0.0,\n  //   right: 0.09\n  // }\n  const numberOfColumns = data.length;\n  const columnWidth = (totalWidth - margins.left - margins.right) / (numberOfColumns) // (totalWidth * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns; // (totalWidth) / (numberOfColumns + 4) //\n  const numberOfRows = data.length / numberOfColumns;\n  const totalHeight = numberOfRows * rowHeight;\n  const fontSize = totalHeight * 0.05;\n\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n    // ]).range([0, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter à la taille d'une colonne (+ centre de mon triangle à gérer)\n  ]).range([5, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter à la taille d'une colonne (+ centre de mon triangle à gérer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([5, rowHeight * 0.85]); // pour l'instant j'ai mis le max de longueur à 85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupée par le texte]\n\n  // const legendTriangleWidth = 35;\n  // const legendTriangleHeight = 60;\n\n  return (\n\n    <g className={cx(\"TriangleChart\", {'is-atlas-mode': atlasMode})}>\n\n      <defs>\n        <linearGradient id=\"TriangleGradient\" x2='0%' y2='100%'>\n          <stop offset=\"10%\" stopColor={`rgb(100,100,100)`} stopOpacity={0.6} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} />\n          {/* <stop offset=\"20%\" stopColor={colorsPalettes.generic.dark} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} stoOpacity={0.3} /> */}\n        </linearGradient>\n      </defs>\n      {/* <TriangleLegend\n        {\n        ...{\n          legendWidth,\n          totalWidth,\n          totalHeight,\n          legendTriangleWidth,\n          legendTriangleHeight,\n          rowHeight,\n          fontSize,\n        }\n        }\n      /> */}\n      <g className=\"triangles\">\n        {\n          // sorting groups regarding their projected projection on the horizontal axis (to avoid lines crossings)\n          data.sort((a, b) => {\n            const [xa] = projection([+a.longitude, +a.latitude]);\n            const [xb] = projection([+b.longitude, +b.latitude]);\n\n            if (xa > xb) {\n              return 1;\n            }\n            return -1;\n          })\n            .map((port, index) => {\n\n              return (\n                <PortGroup\n                  lang={lang}\n                  key={index}\n                  {\n                  ...{\n                    numberOfColumns,\n                    port,\n                    scaleX,\n                    scaleY,\n                    legendWidth,\n                    columnWidth,\n                    totalHeight,\n                    totalWidth,\n                    projection,\n                    index,\n                    margins,\n                    rowHeight,\n                    fontSize,\n                    projectionTemplate\n                  }\n                  }\n                />\n              )\n            })\n\n        }\n        <defs>\n            <marker id=\"triangle-left\" viewBox=\"0 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.02}\n              orient=\"auto\">\n              <path d=\"M 10 0 L 0 5 L 10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n            <marker id=\"triangle-right\" viewBox=\"-10 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.024}\n              orient=\"auto\">\n              <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n          </defs>\n      </g>\n\n    </g>\n  )\n\n}\n\nexport default TriangleChart;","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Poitou': '#668EDB',\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produits coloniaux': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites îles': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indéterminé supposé Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-Ré': '#277262',\n    'Saint-Martin île de Ré': '#277262',\n    'Tonnay-Charente': '#5AD0F4',\n    'Marans': '#67CBB6',\n    \"Les Sables-d'Olonne\": '#668EDB',\n    \"Sables d'Olonne\": '#668EDB',\n    'Marennes': '#A7E6F9',\n    'Charente': '#A7E6F9',\n    'Alligre': '#349883',\n    \"Tous les bureaux\": \"grey\"\n  },\n  tonnageClasses: {\n    '100%': '#A07BEE',\n    '75% ou plus': '#41BEA3',\n    'moins de 75%': '#FEA43B',\n  },\n  franceAlone: {\n    'France': '#41BEA3',\n  },\n  portsTreemaps: {\n    'France (région PASA)': '#41BEA3',\n    'Indéterminé': 'rgb(240,240,240)',\n    'zone maritime': '#98a9d9',\n    'multi-Etat': '#a42e0d',\n    'France (hors région PASA)': '#FED63B',\n\n    'Hambourg': '#F7E0DE',\n    'Duché d\\'Oldenbourg': '#F3D1CE',\n    'Prusse': '#EFC1BD',\n    'Lubeck': '#E7A39C',\n    'Brême': '#EBB2AD',\n    'Mecklenbourg': '#E3938C',\n    'Autriche': '#bd6a62',\n\n    'Grande-Bretagne': '#A07BEE',\n    'Provinces-Unies': '#2759e3',\n    'Danemark': '#8e7bee',\n\n    'Etats-Unis d\\'Amérique': '#EBB2AD',\n    'Pologne': '#804a45',\n    'Russie': '#804a45',\n    'Espagne': '#e35027',\n    'Portugal': '#e35027',\n  }\n}\n\nexport default colorsPalettes;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.285,\"time\":257100,\"words\":857}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`La France du dix-huitième siècle se caractérise par le fort dynamisme des ports et des hinterlands de la façade atlantique, stimulés par le commerce avec les Antilles et une demande européenne en biens de consommation en hausse. La guerre maritime qui commence en 1793 et qui se poursuit pendant plus de vingt ans, entraînant la perte définitive de Saint-Domingue en 1804 et de l’île de France (île Maurice) en 1815, sonne le glas de cette dynamique et déplace le centre de l’économie française vers l’intérieur. `}</p>\n    <p>{`L’étude de cas présentée ici s’intéresse à la navigation et au commerce maritime des côtes poitevines et charentaises à la veille de la Révolution. Cela correspond à la direction des fermes de la Rochelle et à la façade maritime des provinces du Poitou, de l’Aunis, de la Saintonge et de l’Angoumois (région « PASA »). Cette aire possède un dense maillage portuaire, avec une quarantaine de ports en activité. Certains ne font que du cabotage micro-local, d’autres intègrent petit et grand cabotage, d’autres enfin s’adonnent également à une navigation de long-cours. Cette région se prête donc particulièrement à une étude portant sur l’articulation entre les différentes échelles du commerce maritime à l’aube de la Révolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Nous reconstituons l’histoire maritime et commerciale de la région PASA à partir de deux sources historiques. D’une part, nous disposons de traces administratives de la navigation maritime grâce aux redevances qui pèsent sur celle-ci sous l’Ancien Régime. Les registres des congés répertorient les navires à leur départ d’un port et le montant dû, qui varie le plus souvent selon leur tonnage et leur destination. Ces registres, rédigés par les greffiers de l’amirauté locale, ont été numérisés et structurés dans une base de données appelée `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`. Elle compte entre autres plus de 32 000 congés pour l’année 1787 pour l’ensemble des ports français, et quelque 6 900 congés pour 1789 relatifs aux côtes poitevines et charentaises.`}</p>\n    <p>{`Les registres des congés nous permettent de repérer les dates de départ des bâtiments, ainsi que diverses informations relatives à l’objet de leur voyage, leur tonnage, leur capitaine, etc. Ces données ne sont cependant pas dénuées d’incertitude : comme nous le verrons, le tonnage des navires est parfois surestimé dans certains ports. Aussi, dans le cadre de la présente étude, nous avons pris en compte l’itinéraire déclaré par les capitaines de navires au moment du départ, tout en étant conscients que la déclaration ne correspond pas nécessairement au voyage effectif. Les congés permettent toutefois une bonne mesure des trafics de la région de La Rochelle, y compris à toute petite échelle, tout en demandant une attention fine à la dimension d’incertitude inhérente à la source mobilisée.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`D’autre part, nous disposons de traces administratives relatives au commerce de la région PASA. La base de données `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{` se fonde sur la numérisation des documents du Bureau de la balance du commerce de 1716 à 1821. Ces documents ont été produits grâce aux services des Fermes : chaque bureau des Fermes enregistrait localement les états de sortie et d’entrée des marchandises entre la France et l’étranger. Plus de 550 000 flux de sortie / entrée ont été documentés dans la base de données Toflit18. La direction des fermes de La Rochelle correspondait à la façade maritime de la région PASA.`}</p>\n    <p>{`Grâce aux données de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les sept différents bureaux de ferme de la région PASA et les partenaires étrangers du royaume de France. Les informations que l’on peut extraire de ces flux sont, entre autres, le nom du produit échangé, la quantité, la valeur, le partenaire commercial, et l’entité administrative ayant enregistré le flux au niveau local. En 1789, elles précisent en outre, sauf pour le commerce de réexportation des denrées coloniales, l’origine du produit commercialisé (ville ou province française, ou État étranger). Elles fournissent donc des informations complémentaires à celles données par les sources relatives à la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congés de navigation et données du Bureau de la balance du commerce rendu possible par les bases de données Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de préciser les flux et leur valeur pour ce qui est du commerce international, et d’explorer les relations et l’articulation entre les différents trafics de cette région.`}</p>\n        <p>{`La présente étude de cas décrit en trois temps l’histoire de la région PASA à l’aube de la Révolution française. D’abord, nous constatons la relative perte d’importance et de diversité commerciale de la région à la suite de la perte du Canada par le royaume de France durant la guerre de Sept Ans. Nous proposons ensuite une analyse détaillée de la restructuration de la région en relation avec cet événement, selon des filières spécialisées qui associent des ports particuliers avec le commerce de produits spécifiques. Nous démontrons enfin que, bien que dominant dans sa région, le port de la Rochelle ne structure pas en 1789 la région au profit d’un réseau d’échange plus diversifié.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.045,\"time\":242700,\"words\":809}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`Eighteenth-century France was known for its vibrant Atlantic coast ports and their hinterlands, thriving on West Indian trade as well as the increasing European demand for consumer goods. As a result of the French Revolutionary wars - beginning in 1793 and lasting over twenty years – Saint-Domingue was lost in 1804, followed by Isle de France (Mauritius) in 1815, marking the end of this dynamic period and moving the center of gravity of the French economy to the interior. `}</p>\n    <p>{`This case study focuses on seafaring and maritime trade along the Poitou and Charente coasts on the eve of the Revolution. The area encompassed the La Rochelle customs region, corresponding to the Poitou, Aunis, and Saintonge maritime provinces and their hinterland, the Angoumois (hereafter « PASA » region), representing a dense network of ports, numbering around forty active ports. Some ports were limited to micro-local coastal trade, others were open to more distant cabotage, while yet others also engaged in long-distance navigation. The region therefore is particularly suited to a study of the connections between the various kinds of maritime trade practiced on the eve of the Revolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Our reconstruction of the maritime and trade history of the PASA region is based on two historical sources. Firstly, we have relied on the administrative records listing departure fees imposed on maritime shipping during the Old Regime. Clearance (i.e. permission to leave) records provide lists of vessels departing from a port and the amount of duty they owed, usually reflecting the ships’ tonnage and destination. These records compiled by officials of the local Amirauté were digitized and organized in a database called `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`. The records for 1787 include more than 32,000 clearances for all French ports, and a further 6,900 in 1789 for the Poitou and Charente coast.`}</p>\n    <p>{`These records allow us to identify vessel departure dates and reveal other information regarding the purpose of its voyage, its tonnage, its captain, etc. However, these data are not entirely trustworthy as a ship’s tonnage was sometimes overestimated in some ports, as will be explained below. In the context of this study, we also took into account the itinerary declared by vessel captains at the time of departure, albeit that the declaration was not necessarily reflective of the actual trip. Clearance documents present a good overview of traffic in the La Rochelle region, including on a very small scale, but must nevertheless by used with caution given the uncertainty of tonnages and declared destinations.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`The second source-base is the PASA region trade records. The `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{` database contains the digitized documents of the Balance of Trade Department (Bureau de la Balance du Commerce) from 1716 to 1821. These documents were produced by local customs offices which recorded the export and import figures of international and colonial trade goods. Over 550,000 import or export flows (a « flow » being defined in this context as the record of the import or export of one item from/to a given country in a given year) were documented in the Toflit18 database. The La Rochelle customs region (‘direction de La Rochelle’) represented the PASA region’s maritime activities.`}</p>\n    <p>{`The Toflit18 data enabled us to list exports and imports between the seven different customs offices (‘bureaux’) of the PASA region and their foreign trade partners. The information extracted from this dataset includes, for example, the name of the product exchanged, its quantity and value, the trade partner, and the administrative entity that recorded the transaction at the local level. In 1789, these lists also specified the origin of the traded product (French city or province, or foreign state), except in the case of re-exported colonial commodities. This information therefore complements the information provided by the navigation sources.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`The combination of data from navigation clearance taxes and from the Balance of Trade Department provided by the Toflit18 and Navigocorpus databases allows us to better understand local, national, and international trade, to more precisely define the transactions and their value in terms of international trade, and to explore the relations and links between the various trade activities of this region.`}</p>\n        <p>{`This case study presents the history of the PASA region on the eve of the French Revolution in three stages. First, we note how the loss of Canada during the Seven Years’ War led subsequently to a reduction in importance and commercial diversity in the region. Next, we offer a detailed analysis of the region’s restructuring following that loss as we examine specialized sectors linking particular ports with the trade of specific products. Finally, we demonstrate that by 1789 the port of La Rochelle, although still dominant in the region, no longer served as a trade hub in the region, which had by then greatly diversified its networks.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"7 min read\",\"minutes\":6.35,\"time\":381000,\"words\":1270}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-déclin-de-la-région-de-la-rochelle-suite-à-la-perte-du-canada\"\n    }}>{`Partie 1. Le déclin de la région de La Rochelle suite à la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitième siècle, la France a pleinement profité du développement des relations économiques entre l’Afrique, l’Amérique et l’Europe. L’ « Atlantique français » reposant sur la traite des Africains et leur exploitation dans les Îles françaises (Antilles et Mascareignes) a connu son apogée juste avant la révolte des esclaves de Saint-Domingue en août 1791 et le début de la guerre maritime avec l’Angleterre en février 1793. L’ancienne région Poitou-Charente, correspondant approximativement aux généralités de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une longue tradition maritime à son actif et était bien située pour bénéficier de cette phase de prospérité. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`L’examen du commerce avec les pays étrangers et les colonies de la direction des Fermes de La Rochelle, qui était leur façade maritime, montre toutefois un dynamisme limité. Il y a bien eu croissance du commerce, mais cette croissance a été plus lente que celle des autres grands ports du royaume. Cela s’explique en grande partie par les relations privilégiées de la direction de la Rochelle avec le Canada. D’une part, celui-ci se développe beaucoup moins vite que les Antilles, et la région souffre de ce manque de dynamisme durant la première moitié du siècle. D’autre part, le Canada est cédé aux Anglais lors du traité de Paris qui clôt la guerre de Sept Ans en 1763. Québec avait déjà été pris en 1759. Cette perte est sévère pour la région dont le commerce entame alors un recul relatif très net. La trajectoire de la région de la Rochelle contraste ainsi avec celles de Bordeaux et de Nantes dans la seconde moitié du siècle. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et sa part du commerce français ne cesse d’augmenter jusqu’en 1789. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`Après une année exceptionnelle en 1747, qui s’explique par l’organisation de convois transatlantiques au départ de La Rochelle escortés par la Marine pour échapper aux prédations britanniques, la direction de La Rochelle effectue 4,6% du total du commerce français en 1750. En 1789 sa part ne représente plus que 2,2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`Le recul de La Rochelle n’est pas que quantitatif. En 1750, les données de la direction des Fermes de La Rochelle, chargée de la collecte des droits sur le commerce extérieur et colonial, montrent que cette partie du territoire commerce 21% des types de biens échangés par la France (645 sur 3055, après `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source\" target=\"blank\" rel=\"noopener noreferrer\">{`uniformisation des variations orthographiques`}</a>{`). En 1789, elle n’en commerce plus que 7% (248/3565). Cette forte réduction de la typologie des biens commercialisés s’observe à la fois pour les exportations et pour les importations. À un niveau plus agrégé de typologie des produits, parmi les 150 secteurs de la `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\" target=\"blank\" rel=\"noopener noreferrer\">{`classification ”Révolution et Empire”, utilisée dans le cadre du programme ANR Toflit18`}</a>{`, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diversifiées en 1750 qu’en 1789. L’indice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Un bien pour lequel il n’y a pas beaucoup de concurrence nationale (les eaux-de-vie) et deux denrées coloniales réexportées (le café et le sucre) dominent en 1789 les exportations. Les toiles de coton, souvent réexportées en direction de l’Afrique, viennent en quatrième place, suivies du sel (dont la valeur est faible par rapport au tonnage qu’il mobilise, car c’est une marchandise très pondéreuse). En 1750, la mercerie et les étoffes de laine font partie des cinq principales exportations (avec l’indigo, les eaux-de-vie et le sucre : le sel est en 14e position). `}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`La direction des Fermes de La Rochelle s’est donc spécialisée dans les produits agricoles et les réexportations de denrées coloniales, aux dépens des biens manufacturés de la région. Ce constat négatif est toutefois nuancé par l’intensité capitalistique de la production d’eaux-de-vie qui la rapproche des biens manufacturés. La spécialisation et l’importance de ce produit d’exportation ressort avec évidence en comparant la part de la direction des Fermes de La Rochelle à la moyenne nationale.`}</p>\n    <p>{`Nous ne connaissons pas la destination des réexportations coloniales en 1789. En les excluant, on constate que la concentration des marchés de la direction des Fermes de La Rochelle est la même en 1750 et en 1789 (entre 0,41 et 0,44), mais que l’Angleterre a pris la place de l’Amérique (terme qui désigne en 1789 essentiellement les Antilles françaises). Cela est confirmé par la distribution des tonnages des navires partant depuis la région PASA vers l’étranger en 1789 : l’Angleterre y a une part très importante.`}</p>\n    <p>{`Pour aller vite, on pourrait résumer en disant que la direction des Fermes de La Rochelle n’exporte plus des biens différenciés vers le Canada, mais essentiellement des eaux-de-vie vers l’Angleterre. Du point de vue de la navigation, le fort tonnage destiné à ce type de commerce est inférieur à celui engagé pour l’exportation du sel vers les mers du Nord et Baltique.`}</p>\n    <p>{`Les données de la navigation collectées ne nous permettent pas de contribuer à l’analyse du déclin de cette région: d’une part, car nous n’avons le détail des sorties que pour la fin de l’Ancien Régime, ce qui empêche une analyse diachronique. D’autre part, car les données collectées pour 1789 n’apportent que des informations limitées pour ce qui est des produits transportés : les congés du port de La Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports de la région le greffier se limite le plus souvent à noter seulement l’article principal qui compose la cargaison. Les registres des congés indiquent, toutefois, les destinations de chaque navire sorti et cette donnée permet de constater un relatif éclatement des marchés de cette région. `}</p>\n    <Caller id=\"partie-1-ports-destinations\" mdxType=\"Caller\" />\n    <p>{`Sans que l’on puisse affirmer qu’il s’agit d’une nouveauté, la marginalisation de la région vers la fin de l’Ancien Régime est confirmée par son manque de capacité à assurer ses propres trafics. La navigation avec l’étranger est assurée, à 90%, par des pavillons étrangers ou extérieurs à la région étudiée. Il s’agit, pour l’essentiel, des pavillons britannique et nord-européens. Parmi les ports de la région, seul La Rochelle joue un rôle, mais comme nous le verrons (partie 2.1), cette navigation est liée aux activités de traite et au commerce colonial. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`Cette incapacité de la région à assurer les exportations vers l’étranger n’est pas liée à une absence d’activité maritime : au contraire, si on additionne le total des sorties de navires depuis les ports de la région étudiée en 1789, toute destination confondue, on mesure que les bâtiments régionaux assurent une partie considérable des trafics, supérieure à celle assurée par les navires des autres ports français, alors que la part de la navigation étrangère est très minoritaire. Toutefois, la part de navigation sous pavillon français assurée par les navires de la région étudiée, est inférieure à celle de la plupart des autres provinces françaises: en 1787, les ports de l’Aunis-Saintonge-Poitou assurent 51.6% du tonnage qu’ils expédient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne. `}</p>\n    <Caller id=\"partie-1-ports-dattache\" mdxType=\"Caller\" />\n    <p>{`La région n’est donc pas très dynamique, à la fin de l’Ancien Régime, en matière d’armement. Ce constat ne doit pas faire oublier les évolutions qui ont eu lieu en son sein au cours de la seconde moitié du XVIIIe siècle, notamment grâce au développement ou au maintien de productions locales destinées à l’exportation depuis d’autres ports que celui de La Rochelle. La section suivante étudie la forte diversification des ports de cette région.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\n/**\n * Visulization caller to place in contents\n * @param {string} id - visualization id used by visualization context to map caller with a specific vis\n * @param {object} props - visualization parameters passed as payload to visualization context\n * @returns  {React.ReactElement} - React component\n */\nconst Caller = ({id: visualizationId, lang = 'fr', ...props}) => {\n  const ref = useRef(null);\n  // we differentiate caller id and visualization id as their rel can theoretically be n-1\n  const [id] = useState(genId());\n  const {\n    // used to define whether caller is active\n    activeVisualization,\n    onBlockClick,\n    // callbacks used to register/unregister visualization data & HTML ref in upstream state\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  // register vis on caller's mount, unregister it on unmount\n  useEffect(() => {\n    // we wrap callback in a setTimeout in order to have a non-null ref to the HTML element\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        // currently is-hidden and is-devmode are logically symetrical, but this can be useful to differentiate the 2 in dev\n        'is-hidden': process.env.NODE_ENV !== 'development',\n        'is-devmode': process.env.NODE_ENV === 'development',\n      })}\n    >\n      {\n        process.env.NODE_ENV === 'development' ?\n        <>\n          {\n          visualizationId ?\n          <span>caller pour la visualisation <code>{visualizationId}</code> </span>\n          :\n          <span>caller sans id (agit comme un clearfix)</span>\n        }{\n          Object.keys(props).length ? \n            <span>avec les paramètres {JSON.stringify(props)}</span>\n          : null\n        }\n        </>\n        :\n        null\n      }\n      \n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"6 min read\",\"minutes\":5.92,\"time\":355200,\"words\":1184}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-1-the-decline-of-the-la-rochelle-region-following-the-loss-of-canada\"\n    }}>{`Part 1. The decline of the La Rochelle region following the loss of Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`During the eighteenth century, France took full advantage of the expanding economic relations between Africa, America, and Europe. The « French Atlantic » trade was based on the African slave trade and slave exploitation in the French Islands (West Indies and Mascarenes), which peaked before the Saint-Domingue slave revolt in August 1791 and sharply declined following the outbreak of a maritime war with Great Britain in February 1793. The former Poitou-Charente region, roughly comprising the provinces of Poitou, Aunis, Saintonge and Angoumois (PASA) under the Old Regime, had a long-established history of maritime activity and was ideally situated to benefit from this phase of prosperity. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`However, upon examination, the international and colonial sea trade of the La Rochelle customs region presents a somewhat limited growth. The slight increase in trade occurred at a slower pace than at other major ports of the kingdom. This is largely explained by La Rochelle and its region’s preference for trading with Canada, which simply could not match the success of West Indian trade.`}</p>\n    <p>{`This factor negatively impacted on the region’s growth in the first half of the eighteenth century. Further, following British victory in the Battle of Quebec in 1759 the Seven Years’ War came to an end in 1763 when France’s Canadian territories were ceded to Great Britain.`}</p>\n    <p>{`This severe loss led to a very clear trade decline in the region’s colonial trade. The contrast between trade developments in the La Rochelle region with those in Bordeaux and Nantes in the second half of the century are notable. Bordeaux, for example, was much more dynamic than La Rochelle and its share in French trade continued to increase until 1789. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`After an exceptional year in 1747, due largely to the organization of transatlantic convoys departing from La Rochelle and escorted by the French Navy, in an effort to avoid merchant ships being plundered by the British, the La Rochelle region was responsible for 4.6% of total French trade in 1750. In 1789, its share dropped to 2.2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`La Rochelle’s decline was not solely due to the quantity of trade. Data on foreign and colonial trade duties collected by the La Rochelle customs office, reveals that in 1750 this part of the territory handled 21% of the commodities traded by France (645 out of 3,055 after `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source\" target=\"blank\" rel=\"noopener noreferrer\">{`standardizing product spelling variations`}</a>{`). In 1789, it only traded 7% (248 out of 3,565). This sharp reduction in commodity types applies both to exports and imports. If these commodities are further combined in the 150 fields used in the `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\" target=\"blank\" rel=\"noopener noreferrer\">{`« Revolution and Empire » classification used by the ANR Toflit18`}</a>{` program, the La Rochelle region traded in 121 of these fields in 1750, but in only 88 in 1789.`}</p>\n    <p>{`Exports took a much more diversified form in 1750 than in 1789 with a concentration index (Herfindhal) of 0.1 in 1750 and 0.24 in 1789. Exports were dominated in 1789 by a product for which there was not much national competition (brandy) and two re-exported colonial goods (coffee and sugar). Cotton cloth, often re-exported to Africa, came in fourth place, followed by salt (the value of salt was low compared to its tonnage, as it is a bulky, cheap product). In 1750, haberdashery and woollen fabrics were among the five main exports (along with indigo, brandy and sugar; salt was in 14th position). `}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`The La Rochelle customs region thus specialized in agricultural products and the re-export of colonial goods, at the expense of goods manufactured in the region. However, this seemingly negative consequence is balanced out by the capital intensity of brandy production, which approximated that of manufactured goods. When comparing the La Rochelle customs region with the national average, the importance and specialization of this export product clearly stands out.`}</p>\n    <p>{`We do not know where colonial re-exports ended up in 1789. By excluding them, we can see that market concentration in the La Rochelle customs region was the same in 1750 and in 1789 (between 0.41 and 0.44), but that « England » (a category designating Great Britain in French trade statistics) had replaced « America » (a term that in 1789 essentially referred to the French West Indies). This is confirmed by the tonnage distribution of vessels departing from the PASA region to foreign countries in 1789, which shows that a very large share went to Great Britain.`}</p>\n    <p>{`In brief, the La Rochelle customs region largely ceased exporting differentiated goods to Canada and mainly sent brandy to British ports. From a navigation perspective, the tonnage devoted to this type of trade was smaller than the tonnage mobilized for exporting salt to the North and Baltic seas.`}</p>\n    <p>{`The collected navigation data does not allow for further analysis of the trade decline in the region. First, we only have details of departures for the end of the Old Regime and this makes diachronic analysis impossible. Second, the data collected for 1789 only provide limited information regarding the products transported: the La Rochelle clearance tax records, for example, do not mention the nature of the cargo and customs agents in the region’s other ports often only recorded the cargo’s main product. However, the clearance tax records indicate the destination of each departed ship and this shows a relative fragmentation of the markets in the region. `}</p>\n    <Caller id=\"partie-1-ports-destinations\" mdxType=\"Caller\" />\n    <p>{`Although we cannot substantiate that it was a new development, the region’s incapacity to handle its own flows towards the end of the Old Regime confirms that it became marginalized. Vessels under foreign flag or vessels from outside the region accounted for 90% of international maritime trade. They were mostly British and North European. La Rochelle was the only port in the region to maintain its position, but as explained further (part 2.1), this was related to the slave and colonial trade. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`The region’s inability to supply international exports was not due to a lack of maritime activity: on the contrary, the total number of ship departures from ports within the region in 1789, all destinations included, reveals that regional vessels accounted for a considerable share of the flows, higher than the share of ships from other French ports, while foreign vessels made up a very small share. However, the share of regional vessels navigating under French flag was lower than in most of the other French provinces: in 1787, the ports of Aunis-Saintonge-Poitou supplied 51.6% of the tonnage shipped, compared to 84.3% for Brittany or 58.7% for Guyenne. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`This shows that by the end of the Old Regime, the region was not very active in terms of equipping ships. This fact must not over-ride the changes that took place in the region during the second half of the 18th century, notably as a result of the development or extension of local production intended for export from ports other than La Rochelle. The next section examines the high diversification of ports in the region.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"17 min read\",\"minutes\":16.015,\"time\":960900,\"words\":3203}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spécialisation-portuaire--le-cas-de-la-traite-négrière-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spécialisation portuaire : le cas de la traite négrière, du commerce du sel et de l’eau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" bureaux=\"tous,La Rochelle,Rochefort,Saint-Martin-de-Ré,Les Sables-d'Olonne,Marennes,Charente,Marans,Tonnay-Charente\" mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La région PASA se caractérise par une densité importante de ports qui entretiennent des relations plus ou moins étendues et plus ou moins intenses avec le reste de la France et du monde. L’importance de leurs mouvements maritimes et des tonnages n’est pas directement corrélée à la valeur des marchandises transportées. Ainsi, les deux bureaux des Fermes qui dominent en valeur des exportations sont ceux de La Rochelle, très lié au commerce colonial et négrier, et de Tonnay-Charente, exportateur d’eau-de-vie essentiellement vers la Grande-Bretagne. Par contre, l’activité portuaire de Marennes (exportateur du sel vers les ports de la mer du Nord et de la Baltique) est en tonnage la plus importante de la région mais ses exportations sont de faible valeur. Les importations sont dominées par les ports du bureau des fermes de La Rochelle (c’est à dire, essentiellement, La Rochelle), en raison de la forte valeur des produits coloniaux. La balance du commerce de Rochefort, qui importe des matières premières navales, est très déficitaire.`}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Nos analyses ont certes montré que`}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{` les tonnages enregistrés à Marennes semblent `}</a><a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{`surestimés de 20%`}</a>{`, et même de 50% dans 10% des pires cas, mais cela ne remet pas en cause la primauté de ce port. La carte, qui représente le tonnage expédié en 1789, à partir des congés délivrés aux navires, toutes destinations confondues, met en outre en évidence le caractère très internationalisé des transporteurs dans les ports exportateurs de sel vers l’étranger (Noirmoutier et l’île de Ré) et d’eau-de-vie (Tonnay-Charente), ainsi qu’à Rochefort, largement approvisionné par les marines du Nord qui y apportent les matériaux nécessaires à l’arsenal. Ce sont ces transporteurs qui assurent la presque totalité du commerce avec l’étranger (hors traite) de la région PASA. Comme nous le verrons `}<a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{`dans la partie 3`}</a>{`, La Rochelle n’a plus un rôle structurant pour les ports de cette région: d’autres ports entretiennent des relations avec l’étranger et avec les marchés français, en commercialisant les productions locales, sans que la chaîne logistique ne passe par La Rochelle.`}</p>\n    <p>{`Cette section propose une étude de trois ports de la région à la fin de l’Ancien Régime afin de montrer la diversité des produits qu’ils commercialisent et de leurs marchés. De par ses relations exclusives avec les colonies et surtout son investissement dans la traite négrière, La Rochelle mérite une étude à part. L’importation de quantités considérables de denrées coloniales, majoritairement ré-exportées vers l’Europe du Nord, met ce port dans une situation unique. Pour le commerce des eaux-de-vie, nous étudierons le cas de Tonnay-Charente. La mention de l’eau-de-vie parmi les cargaisons indiquées par les congés étant rare, il faudra se tourner d’abord vers les sources de la Balance du commerce, pour affiner ensuite les données par l’analyse de la navigation. `}</p>\n    <Caller id=\"sorties-de-sel\" mdxType=\"Caller\" />\n    <p>{`Plusieurs autres ports de la région, enfin, se consacrent prioritairement à l’exportation du sel, comme on peut le constater sur le diagramme : Ars-en-Ré, Noirmoutier et surtout Marennes mobilisent de flottes dépassant en 1789 les 10000 tonneaux pour sa commercialisation. Nous développerons ici en détail le cas de Marennes, principal port exportateur de sel, dont la particularité est de miser largement sur l’approvisionnement du marché national.`}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" bureaux=\"tous,La Rochelle\" mdxType=\"Caller\" />\n    <p>{`Au dix-huitième siècle, les colonies antillaises augmentent très considérablement leur production de sucre, café, indigo et produits tinctoriaux, pour répondre à la hausse de la demande européenne. La croissance de la production passe par un nombre de plus en plus élevé de plantations, qui ont un recours massif à une main-d’œuvre d’esclaves, que les Européens déportent par centaines de milliers depuis l’Afrique dans le cadre de la traite négrière. Ce commerce transatlantique d’êtres humains, achetés sur les côtes d’Afrique par les négriers européens, a commencé au XVe siècle, mais il atteint son apogée au dix-huitième siècle, lorsque 6 millions d’Africains sont déportés aux Amériques. La moitié d’entre eux est vendue aux Antilles. On estime à un million le nombre d’Africains introduits dans les colonies françaises au dix-huitième siècle. La principale destination est la colonie de Saint-Domingue (aujourd’hui Haïti) qui compte, à la veille de la grande révolte de 1791, un demi-million d’esclaves, dont plus de la moitié sont nés en Afrique. Alors que dans la plupart des ports négriers français, la part des armements négriers est nettement inférieure à celle des armements en droiture vers les Antilles, cela n’est pas le cas à La Rochelle: sur les 15 départs de 1789 depuis ce port destinés à approvisionner les Antilles en hommes ou en produits, 12 sont des négriers qui font voile tout d’abord vers les côtes africaines dans le cadre d’un circuit triangulaire.. Comme à Honfleur, il y a donc clairement, en matière de trafics transatlantiques, une spécialisation négrière rochelaise. En 1789, les 12 négriers partis de La Rochelle sont tous armés par des négociants rochelais. Trois autres négriers partent depuis Rochefort.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" bureaux=\"tous,La Rochelle\" minTonnage=\"100\" mdxType=\"Caller\" />\n    <p>{`L’activité négrière est aux mains d’armateurs privés qui espèrent réaliser un profit lors de la revente des captifs aux Antilles. Si Nantes est le principal port négrier français, La Rochelle a joué un rôle significatif, tout particulièrement dans les années 1730–1740 : entre 1713 et 1744, La Rochelle arme 15% des expéditions négrières françaises; sa part tombe à 11% après la perte du Canada. Alors que La Rochelle est le deuxième port négrier le plus important en France avant 1763, il passe au quatrième rang par la suite.`}</p>\n    <p>{`Malgré un déclin relatif, l’activité négrière rochelaise augmente en termes absolus : les armateurs rochelais passent de 4,3 armements négriers par an pour la période 1713–1744 à 12,5 armements par an dans la décennie 1783–1793. Pendant cette dernière décennie, la traite est véritablement l’activité principale, voire presque exclusive, des armateurs rochelais : en 1789, sur un total de 200 départs depuis le port de La Rochelle de navires armés par des Rochelais, un peu plus de la moitié des tonnages se dirigent vers l’Afrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se répartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers l’étranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dépasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dépassant le 50 tonneaux (le plus grand faisant 827 tonneaux) sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et négrier. `}</p>\n    <p>{`Dès lors qu’on écarte la poussière des caboteurs, l’importance des destinations africaines et des colonies est lisible sur ce schéma, qui représente les destinations des navires sortis du port de La Rochelle en 1789, tout port d’attache confondu. Tous les navires qui se dirigent vers les Amériques, les Antilles ou l’océan Indien sauf un sont par ailleurs armés par des armateurs de La Rochelle. `}</p>\n    <p>{`Au total, dans les dernières années de l’Ancien Régime, une douzaine de navires reviennent chaque année à La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour d’une expédition négrière après une étape aux Antilles. Les données de la Balance du commerce confirment la centralité du commerce colonial et négrier : en 1789, les exportations vers l’Afrique représentent 23% du total des exportations du bureau des Fermes de La Rochelle, alors que 73% est constitué par les ré-exportations des denrées coloniales. La valeur des produits ramenés est estimée, en 1789, à 7,1 millions de livres tournois, dont 5,1 sont réexportés à l’étranger. Les négociants rochelais semblent s’être taillés une position forte dans le marché du café, ce qui peut s’expliquer par leurs liens quasi-exclusifs avec Saint-Domingue où plusieurs grandes familles de la ville (Belin, Garesché, Poupet Rasteau) sont très bien implantées. Saint-Domingue fournit en effet la presque totalité du café importé en France depuis les Antilles.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Si les données collectées par la Balance du commerce ne permettent pas de connaître les destinations des réexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative. Les Pays-Bas autrichiens (actuelle Belgique), les Provinces-Unies, Brême, Hambourg, les ports de la Baltique reçoivent chacun des navires totalisant entre 500 et 550 tonneaux. Parmi les autres destinations européennes des navires partis de La Rochelle, seule la Grande-Bretagne (1 048 tonneaux) n’est vraisemblablement pas destinataire des produits coloniaux, car elle s’approvisionne dans ses propres colonies. `}</p>\n    <p>{`Dès lors, il n’est pas surprenant que le négoce rochelais porte toute son attention aux questions liées au commerce colonial et négrier. Cela apparaît clairement parmi les sujets discutés par la chambre de commerce de La Rochelle. L’indexation faite à la main, à l’époque, sur la marge des registres de délibérations de la Chambre de Commerce de La Rochelle permet de constater que dans la seule année 1789, le commerce d’Afrique est discuté à une trentaine de reprises, et les colonies à une cinquantaine de reprises, le commerce de l’Inde à 9 reprises; à titre de comparaison, le commerce avec l’étranger est abordé 11 fois en tout, et la pêche (avec notamment la question de la concurrence et de l’admission de la pêche états-unienne, très débattue cette année là en France), 17 fois. Parmi les produits indexés en marge des registres de délibérations, les comestibles sont mentionnés 16 fois - ce qui dans la conjoncture céréalière particulière de l’époque n’est guère étonnant-, l’eau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure, en dépit d’un critère sans doute grossier, que le regard des membres de la Chambre de commerce est clairement rivé sur les colonies et la traite. `}</p>\n    <p>{`Si la question de la traite semble absente des cahiers de doléances de la région (l’analyse porte sur un échantillon de 163 cahiers sur les 522 rédigés dans l’ensemble de la région PASA), la défense des intérêts coloniaux apparaît, significativement, uniquement dans le cahier de doléances du tiers état de la ville de La Rochelle, dont les représentants envoyés à Versailles « demanderont la révocation de l’arrêt rendu au conseil du roi, le 30 août 1784, concernant le commerce étranger dans les colonies, et le rétablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrès qu’ont faits la navigation françoise et la culture des isles françoises de l’Amérique ». L’arrêt en question est celui qui a élargi l’exclusif mitigé, introduit en 1767, en facilitant l’approvisionnement des colonies par les navires étrangers dans des conditions restrictives précises. L’admission de navires étrangers aux colonies a provoqué les protestations de toutes les chambres du commerce de France concernées par le commerce colonial, car le négoce français refuse toute concurrence. Ce qui est intéressant c’est toutefois que nous ne sommes pas ici dans le cadre d’un document qui émane de la Chambre de commerce ou d’un groupe d’armateurs: le cahier de doléances du tiers état de La Rochelle se fait donc le porte-parole des intérêts du négoce colonial français, et demande également des lois interdisant la réexportation des sucres bruts afin d’encourager les raffineries locales. Enfin « les députés demanderont la révocation de l’arrêt du 14 avril 1785 , qui a créé une nouvelle compagnie des Indes et de celui pour l’admission des étrangers dans les isles de France et de Bourbon » (c’est -à-dire à l’île Maurice et à la Réunion), même si pendant l’époque du commerce libre (1769–1785), les armements vers l’océan Indien ou la Chine depuis La Rochelle (26) ont été inférieurs à ceux de Nantes (44), Bordeaux (41), Marseille (42) ou Saint-Malo (32) et bien sûr de Lorient (120). `}</p>\n    <p>{`La participation rocheloise à la navigation au-delà du cap de Bonne-Espérance à la fin de l’Ancien Régime est en effet modeste: l’état des exportations de 1789, n’indique que des exportations vers l’Inde d’une valeur de 38 060 livres tournois, et rien vers les Mascareignes. Ces données semblent toutefois incompatibles avec le départ du navire Henri IV pour l’île de France et l’île Bourbon, le 9 mai 1789, qui arrive à bon port en février 1790, et qui n’est pas un négrier `}{`[`}{`Toussaint, 1967, p. 291`}{`]`}{` à moins que sa cargaison ne vienne entièrement d’autres directions de Fermes du royaume. En 1787, ce sont trois navires qui partent de La Rochelle vers les Mascareignes : une certaine diversification des armements coloniaux apparaît donc, ici comme à Bordeaux, dans les années 1780, lorsque la baisse des profits du commerce antillais incite à chercher des investissements plus rentables.`}</p>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de l’eau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} bureaux=\"Charente, Saint-Martin-de-Ré, Rochefort,Tonnay-Charente\" mdxType=\"Caller\" />\n    <p>{`Les congés de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux d’eau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin d’annoter les cargaisons (il le fait 12 fois sur un total de 601 départs): nous avons donc un aperçu global de la navigation, sans pouvoir distinguer la nature des produits. L’analyse menée sur les sorties de l’année 1787 permet toutefois d’identifier les réseaux commerciaux. 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent à l’étranger (en Angleterre pour les deux tiers, le reste vers les îles anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent à Dunkerque. On identifie ici la flotte européenne de l’eau-de-vie, qui représente 22% du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, composé d’une poussière de petits caboteurs (tonnage moyen 35 tx) et qui représente tout de même 30% du tonnage sortant. Ces navires sont alignés sur une destination unique: La Rochelle. Ils sont pour partie occupés à l’approvisionnement de la ville et peut-être à un commerce régional ou national: en revanche, La Rochelle a perdu le rôle d’entrepôt pour le commerce international de l’eau-de-vie qu’elle avait dans les années 1730. Les principales maisons de négoce d’eau-de-vie, en particulier Martell, n’ont plus de bureaux à La Rochelle en 1789: leurs bureaux principaux ont été rapatriés à Tonnay-Charente et/ou déplacés à Paris. Enfin, des unités plus modestes (25 tx en moyenne) évoluent au sein de la mer des Pertuis (depuis la Seudre sud jusqu’aux Sables d’Olonne) : elles représentent 23% du tonnage à la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congés délivrés en 1787 dans ce port concernent les navires avalant et attachés à des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrière et les produits manufacturés de l’arrière-pays à Tonnay-Charente, leurs maîtres quittent ce port soit à vide, soit avec une cargaison destinée à Rochefort, La Rochelle ou bien aux ports de la mer des Pertuis, qui leur fournissent un fret de retour pour leur navigation vers l’amont du fleuve Charente. `}{`]`}</p>\n    <Caller id=\"exports-eau-de-vie-la-rochelle-longitudinal\" mdxType=\"Caller\" />\n    <p>{`Les exportations d’eau-de-vie charentaise en 1789 sont très supérieures à la moyenne séculaire. L’explication réside en partie dans les modifications induites par le Traité d’Eden de 1786, qui entraîne une augmentation extrêmement importante des exportations d’eau-de-vie vers l’Angleterre, notamment des eaux-de-vie de qualité produites dans la région de Cognac, au détriment de celles de moindre qualité. Le total des exportations d’eaux-de-vie françaises vers la Grande-Bretagne passe de 10 à 15 millions de livres tournois dans les années 1760–70, à 40 millions en 1787–89.`}</p>\n    <Caller id=\"exports-eau-de-vie-comparaison-directions-des-fermes\" mdxType=\"Caller\" />\n    <p>{`La Rochelle domine les exportations d’eaux-de-vie françaises en 1750, mais est dépassée par Bordeaux en 1770, qui exporte, en concurrence avec la Direction des fermes de la Rochelle, des eaux-de-vie de l’Angoumois. Par contre, l’explosion des exportations vers l’Angleterre permise par le traité Eden-Reynald de 1787 bénéficie beaucoup plus à La Rochelle qu’à Bordeaux. Nantes stagne alors que les exportations depuis Bayonne et Montpellier croissent.`}</p>\n    <Caller id=\"origines-exports-eau-de-vie-1789-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Parmis les zones de production, l’Angoumois domine, suivi par l’Aunis. Les valeurs exportées en eaux-de-vie double (ie à teneur d’alcool plus élevé) sont comparables à celles de eaux-de-vie simples. La dénomination « eaux-de-vie double » n’existe que dans les chiffres de 1788 et 1789 et que dans les données issues de la région PASA, indiquant peut-être les progrès des techniques de distillation dans la région.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} bureaux=\"Saint-Martin-de-Ré, Marennes\" mdxType=\"Caller\" />\n    <p>{`Denrée pondéreuse de faible valeur, le sel voyage dès que cela est possible par voie maritime. Les côtes de la région PASA sont, comme celles du sud de la Bretagne, de très grands producteurs de sel. Marennes est un port désigné comme fournisseur par l’administration des gabelle il approvisionne entre autres les greniers à sel de Libourne, de Honfleur, et de Saint-Valéry-sur-Somme. Ses marchés sont donc avant tout nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment à la grande pêche. L’étranger (pays de la mer du Nord et du pourtour de la Baltique) y est un partenaire moins important que pour Saint-Martin-de-Ré ou Noirmoutier. `}</p>\n    <Caller id=\"sorties-de-marennes\" mdxType=\"Caller\" />\n    <p>{`C’est pourquoi, en quantité, le bureau des fermes de Marennes est le principal exportateur de sel en France, si l’on inclut aussi les livraisons vers les ports francs français. Il vient en troisième position, derrière les bureaux du Croisic et de Saint-Martin-de-Ré, si on se limite aux marchés extérieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas élevées comparées à celles des flux commerciaux dont il a été question pour La Rochelle et Tonnay-Charente: le sel exporté depuis Marennes, y compris à destination des ports francs français, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers l’étranger). En revanche, son commerce alimente un mouvement portuaire extrêmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la région étudiée. Son commerce maritime est donc une activité importante, tant pour la production locale qu’il soutient, que pour l’activité induite liée à son transport (construction navale, emploi maritime). Comme on l’a vu plus haut (partie 1), les transporteurs ne sont pas de Marennes même, et les retombées concernent donc aussi bien les ports de cabotage de la région que ceux du littoral atlantique français.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" bureaux=\"Saint-Martin-de-Ré, Marennes\" mdxType=\"Caller\" />\n    <p>{`Les données sur la navigation aident à préciser la géographie commerciale du sel exporté, même si elles n’indiquent pas les quantités exportées. À compter du règne de Louis XIV, la législation relative aux gabelles fait obligation au chargeur de naviguer avec une cargaison complète. Le tonnage des navires chargés de sel est donc un assez bon indicateur des quantités exportées. Les congés confirment que, parmi les ports exportateurs de la région étudiée, la primauté revient incontestablement à Marennes: en 1787, le tonnage additionné de navires sortis avec du sel y est de plus du double qu’à Ars-en-Ré, le deuxième grand exportateur de la région. Même en prenant en compte la surévaluation des tonnages de navires à Marennes, que nous avons constatée en comparant le tonnage d’un même navire relevé en plusieurs ports, Marennes demeure le principal fournisseur de sel en France. `}</p>\n    <p>{`L’exportation de sel est en outre une activité quasi exclusive à Marennes : sur 1174 départs en 1787, 990 ont chargé du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de l’eau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":15.5,\"time\":930000,\"words\":3100}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-2-highly-specialized-ports-the-trade-in-slaves-salt-and-brandy\"\n    }}>{`Part 2 Highly specialized ports: the trade in slaves, salt, and brandy`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" bureaux=\"tous,La Rochelle,Rochefort,Saint-Martin-de-Ré,Les Sables-d’Olonne,Marennes,Charente,Marans,Tonnay-Charente\" mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`The PASA region contained a high density of ports that maintained fairly extensive and rather frequent trade relations with the rest of France and the world. The number and the aggregated tonnage of ships departing from these ports did not directly correlate with the value of the goods transported. The two dominant custom offices, in terms of export value, were those of La Rochelle, with its strong ties to the colonial and slave trades, and of Tonnay-Charente, which specialized in the export of brandy, mainly to Great Britain. The port of Marennes (a salt exporter to the North Sea and the Baltic), in contrast, represented the region’s highest tonnage levels albeit at low export value. Imports to the region were dominated by the customs region of La Rochelle (namely, La Rochelle itself) due to the high value of colonial products. The deficit of exports versus imports at Rochefort, which imported naval raw materials, was severe and exports were negligible at this port `}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Even though our analyses have shown that`}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{` the tonnages recorded at Marennes were probably`}</a>{` `}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{`overestimated by 20%`}</a>{`, sometimes even by 50% in 10% of the worst cases, the port’s supremacy remained undisputed. The map, which shows the tonnage shipped in 1789 based on the port’s clearance records, all destinations combined, also highlights the high part of foreign shipping in ports engaged in the international salt (Noirmoutier and the island de Ré) and brandy (Tonnay-Charente) trades. Additionally, there was a high proportion of foreign ships in Rochefort, transporting naval stores from the North to the French royal shipyard. These vessels handled almost all foreign trade (excluding the slave trade) in the PASA region. As we will see`}<a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{` `}</a><a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{`in part 3`}</a>{`, La Rochelle no longer played a central role among the region’s ports as other ports engaged in foreign trade as well as with French markets, selling local products without going through La Rochelle.`}</p>\n    <p>{`This section provides a comparative study of three ports in the region at the end of the Old Regime, showing the variety of products they traded and of their markets. Due to its exclusive relationship with the colonies, and especially its participation in the slave trade, La Rochelle deserves a separate study. Its considerable imports of colonial goods, most of which were re-exported to Northern Europe, gave the port a unique role. As for the brandy trade, the port of Tonnay-Charente serves as a case study. Since brandy was rarely mentioned as a cargo in the clearance records, we first examined the Balance of Trade sources and then refined the data by analyzing ship clearances. `}</p>\n    <Caller id=\"sorties-de-sel\" mdxType=\"Caller\" />\n    <p>{`Finally, several other ports in the region dedicated themselves primarily to the export of salt, as can be seen in the diagram. In 1789, the salt trade fleets at Ars-en-Ré, Noirmoutier, and especially Marennes, exceeded 10,000 French tonneaux (1 French tonneau = 1.44 cubic meters). Here we will focus in detail on Marennes, the chief salt-exporting port, which mainly concentrated on supplying the national market.`}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-and-the-triangular-trade\"\n    }}>{`2.1. La Rochelle and the triangular trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" bureaux=\"tous,La Rochelle\" mdxType=\"Caller\" />\n    <p>{`In the eighteenth century, the West Indian colonies considerably expanded their production of sugar, coffee, indigo, and dye products to meet the increased European demand. Production growth required ever more plantations, in turn massively reliant on slave labor sourced by the hundreds of thousands from Africa. The transatlantic trade of human beings purchased on the coasts of Africa by European slave traders began in the fifteenth century, and reached its peak in the eighteenth century, when six million Africans were forcibly transported to the Americas. Half of them were sold in the West Indies. It is estimated that one million Africans were shipped to the French colonies in the eighteenth century. Their main destination was the colony of Saint Domingue (now Haiti) which, on the eve of the great revolt of 1791, had a slave population of half a million, more than half of them African-born. Although the share of slave shipping in most French slave-trade ports was significantly lower than direct shipping to the West Indies, this was not the case for La Rochelle: out of 15 departures from its port in 1789 supplying slaves or products to the West Indies, 12 were slave ships headed initially for the African coast in a triangular circuit. The transatlantic traffic of La Rochelle, like that of Honfleur, was clearly specialized in the slave trade. In 1789, all 12 slave ships that departed from La Rochelle were outfitted by La Rochelle merchants. Three additional slave ships left from Rochefort. `}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" bureaux=\"tous,La Rochelle\" minTonnage=\"100\" mdxType=\"Caller\" />\n    <p>{`The slave trade was handled by private shipowners who expected to make a profit by reselling the captives in the West Indies. Even though Nantes was the main French slave port, La Rochelle still played a significant role, especially during the 1730s and the 1740s. Between 1713 and 1744, La Rochelle supplied 15% of French slaving expeditions. Its share decreased to 11% after Canada was lost. While La Rochelle was the second most important slave port in France before 1763, it later dropped to fourth position.`}</p>\n    <p>{`Despite a relative decline, La Rochelle’s slave trade increased in absolute terms: 4.3 slave ships per year were outfitted by La Rochelle shipowners in the 1713 to 1744 period, and this number increased to 12.5 ships per year in the decade from 1783 to 1793. During the latter decade, slave trade truly became the main, if not almost exclusive, activity of La Rochelle shipowners: in 1789, out of a total of 200 ship departures from La Rochelle outfitted by local merchants, over half of the tonnage went to Africa, to the West Indian colonies or the Mascarene islands, with Africa accounting for 42% of the total. The rest was divided between Newfoundland and Saint-Pierre-et-Miquelon (9.2%). The share of shipping to foreign countries was insignificant (0.2%), and shipping beyond neighboring ports (Aunis, Poitou, and Saintonge) did not exceed 5%. Three-quarters of the roughly 30 La Rochelle ships with a capacity exceeding 50 tonneaux (the largest holding 827 tonneaux) that left the port of La Rochelle in 1789 were engaged in the transatlantic and slave trade. `}</p>\n    <p>{`If we ignore the scattered coastal traffic, the importance of African destinations and colonies becomes clear in this diagram, which shows the destinations of ships departing La Rochelle in 1789, all home ports combined. Further, all the ships heading for the Americas, the West Indies, or the Indian Ocean except one were outfitted by shipowners from La Rochelle. `}</p>\n    <p>{`In total, during the final years of the Old Regime, each year a dozen ships returned to La Rochelle from the colonies, either in direct line or (most often) returning from a slaving expedition after a stopover in the West Indies. The Balance of Trade data confirm the centrality of the colonial and slave trade: in 1789, exports to Africa represented 23% of the total exports of the La Rochelle customs office, while 73% were re-exports of colonial goods. The value of the products shipped back to La Rochelle was estimated in 1789 at 7.1 million French livres, of which 5.1 million were re-exported abroad. La Rochelle merchants seem to have carved out a strong position in the coffee market, due to their almost exclusive ties with Saint Domingue where several prominent families of La Rochelle (Belin, Garesché, and Poupet Rasteau) were very well established. Saint Domingue supplied almost all the coffee imported into France from the West Indies.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Although the Balance of Trade data does not allow us to determine the destinations of La Rochelle colonial re-exports, the destinations of the ships that departed from the port in 1789 do give us an approximate indication. The Austrian Low Countries (now Belgium), the United Provinces (now the Netherlands), Bremen, Hamburg, and the Baltic ports each received ships with a total capacity of 500 to 550 tonneaux from La Rochelle. Of the other European destinations of ships leaving from La Rochelle, it was probably only Great Britain (1,048 tonneaux) that did not take in colonial products, because it was supplied by its own colonies. `}</p>\n    <p>{`Unsurprisingly, issues relating to colonial and slave trade were a predominant concern of La Rochelle merchants, as is clearly evident in the topics raised in the La Rochelle Chamber of Commerce. A contemporary hand-written index to these deliberations of the Chamber of Commerce was written in the margins of the registers, revealing that in the year 1789 alone, trade with Africa was discussed some 30 times, the topic of the colonies was raised close to 50 times, and trade with India 9 times. By way of comparison, trade with foreign countries was discussed just 11 times, and fishing (more specifically the question of authorizing American competition, much debated that year in France) 17 times. Among the products indexed in the margins of the registers of deliberations, foodstuffs were mentioned 16 times – which is hardly surprising considering the importance of cereal crops in these crisis years – while brandy and wine appear 6 times, sugars and refineries 8, and coal 3 times. Just this rough tabulation is enough to show that the members of the Chamber of Commerce clearly had their eyes glued to the colonies and the slave trade. `}</p>\n    <p>{`The issue of the slave trade may be largely absent from the 1789 lists of grievances (cahiers de doléances) prepared for the General Estates of the region (we analyzed a sample of 163 cahiers out of the 522 drafted in the entire PASA region), but the defense of colonial interests appears significantly in the lists of grievances of the third estate of the city of La Rochelle only. Its representatives sent to Versailles were asked to seek the revocation of the Act issued at the king’s council of August 30, 1784 which concerned foreign trade in the colonies, and the reestablishment of the provisions of the letters patent of 1717 and 1727 which the third estate of La Rochelle considered as an essential element to the progress made by French navigation and the culture of the French islands of America. The 1784 Act expanded the softened Exclusif mitigé system introduced in 1767, allowing more foreign ships under specific restrictive conditions to supply the colonies. This authorization of foreign ships in the colonies was met with protest by all the Chambers of Commerce in France involved in colonial trade, because French merchants were opposed to any foreign competition. What is interesting however is that even though this was not a document originating from the Chamber of Commerce or from a group of shipowners, the list of grievances of the third estate of La Rochelle defended French colonial trading interests and also called for laws to prohibit the re-export of raw sugars in order to protect local refineries. Finally, the deputies were to request the revocation of the decree of April 14, 1785, which created a new East India company, and of the decree that allowed foreigners into the Isles of France and Bourbon (i.e., Mauritius and Reunion), even if during the era of free trade (1769–1785), ship outfitting to the Indian Ocean or China from La Rochelle (26) was lower than from Nantes (44), Bordeaux (41), Marseille (42) or Saint-Malo (32) and of course Lorient (120). `}</p>\n    <p>{`La Rochelle was only modestly involved in navigation beyond the Cape of Good Hope at the end of the Old Regime. Records in 1789 only mention exports to India of a value of 38,060 French livres, and none to the Mascarene Islands. However, on May 9 that year the non-slaving ship Henri IV was recorded as departing for the Isle of France and the Isle of Bourbon, arriving safely in February 1790 `}{`[`}{`Toussaint, 1967, p. 291`}{`]`}{`. Perhaps its cargo originated entirely from other customs regions. In 1787, three ships left La Rochelle for the Mascarenes, which shows a certain diversification of colonial outfitting here as in Bordeaux in the 1780s when the decline in profits from the West Indian trade encouraged the search for more profitable investments.`}</p>\n    <h2 {...{\n      \"id\": \"22-the-brandy-trade\"\n    }}>{`2.2. The brandy trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} bureaux=\"Charente, Saint-Martin-de-Ré, Rochefort,Tonnay-Charente\" mdxType=\"Caller\" />\n    <p>{`The ships’ records we can access are unfortunately of little help in identifying trade flows in brandy. The customs agent of the port of Tonnay-Charente, for example, did not usually bother to identify the cargoes (he did so only 12 times out of a total of 601 departures), which means that we have an overview of navigation but not of the type of products exported. An analysis of departures for the year 1787 nevertheless allowed us to identify the commercial flows. Out of 67 ships of an average tonnage close to 100 tonneaux departing from Tonnay-Charente, 42 went overseas (two-thirds to English ports, the rest to the Channel Islands, Ostend, and the Baltic); the remaining 25 large coasters sailed to Dunkirk. We were able to identify the European brandy fleet, which represented 22% of the outgoing tonnage in 1787. We also identified a second group, composed of a scattering of small coasters (with an average tonnage of 35 tonneaux) which nevertheless represented 30% of the total outgoing tonnage. These ships were all headed to a single destination: La Rochelle. They partly supplied the city and perhaps also the regional or national trade, but it is clear that La Rochelle had lost the role of warehouse for the international trade of brandy that it held in the 1730s. The main brandy trading houses, such as Martell, no longer had offices in La Rochelle in 1789. Their headquarters had been repatriated to Tonnay-Charente or moved to Paris. Finally, more modest vessels (25 tonneaux on average) navigating within the sea of Pertuis (from La Seudre down to Les Sables-d’Olonne) represented 23% of the tonnage shipped out of Tonnay-Charente. It should be noted that 479 of the 743 clearances issued in 1787 in that port concerned ships based in river ports navigating downstream. These ships carried brandy along with quarry stones and manufactured products from the hinterland to Tonnay-Charente, and left the port either empty or with a cargo for Rochefort, La Rochelle or the seaports of Pertuis, which provided them with return freight for their navigation up the Charente river. `}</p>\n    <Caller id=\"exports-eau-de-vie-la-rochelle-longitudinal\" mdxType=\"Caller\" />\n    <p>{`Exports of Charente brandy in 1789 were much higher than the average during that century. This was in part due to the changes brought about by the Treaty of Eden of 1786, which led to an extremely large increase in brandy exports to Great Britain, notably quality brandy produced in the Cognac region, and a decrease in lower quality ones. The total exports of French brandy to Great Britain rose from 10–15 million French livres in the years 1760–1770 to 40 million in 1787–89.`}</p>\n    <Caller id=\"exports-eau-de-vie-comparaison-directions-des-fermes\" mdxType=\"Caller\" />\n    <p>{`La Rochelle dominated exports of French brandy in 1750, but was overtaken by Bordeaux in 1770, which competed with the La Rochelle customs region by exporting brandy from the Angoumois region. However, the aforenoted Eden-Reynald Treaty of 1787 that led to an explosion of exports to Great Britain benefited La Rochelle region much more than Bordeaux. Brandy export from Nantes was stagnating, while exports from Bayonne and Montpellier were growing.`}</p>\n    <Caller id=\"origines-exports-eau-de-vie-1789-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`The dominant production area was the Angoumois region, followed by the Aunis. The value of exported « double » brandy (i.e. with a higher alcohol content) was comparable to that of « simple » brandy. The « double brandy » designation first appeared in the 1788 and 1789 figures and only in data from the PASA region, perhaps indicating advanced distillation techniques in the region.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-and-the-salt-trade\"\n    }}>{`2.3. Marennes and the salt trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} bureaux=\"Saint-Martin-de-Ré, Marennes\" mdxType=\"Caller\" />\n    <p>{`Salt, a heavy commodity of low value, travelled mostly by sea. The coasts of the PASA region were major salt producers, as were those of southern Brittany. And the port of Marennes was designated as a supplier by the salt tax administration (gabelle). It supplied the salt granaries of Libourne, Honfleur, and Saint-Valéry-sur-Somme, among others. Its markets were therefore mostly national, and its demand was sustained, particularly in the Channel ports specialized in outfitting deep-sea fishing. Foreign countries (on the North Sea and around the Baltic) were less important partners in this case than for Saint-Martin-de-Ré or Noirmoutier. `}</p>\n    <Caller id=\"sorties-de-marennes\" mdxType=\"Caller\" />\n    <p>{`The Marennes customs region was then, in terms of quantity, the main French salt exporter, if we also include shipments to French free ports. It comes in third position, behind the regions of Croisic and Saint-Martin-de-Ré, if we only consider markets outside the kingdom.`}</p>\n    <p>{`The values involved were not high compared to the trade flows of La Rochelle and Tonnay-Charente mentioned above. The salt exported from Marennes, including to French free ports, amounted to around 360,000 French livres in 1789 (including 141,000 to foreign countries). Nevertheless, the salt trade contributed to extremely intense port activity, making Marennes the main port in our region of interest in terms of the number of departing ships and their tonnage. Its maritime trade represented an important activity, both because of the local production that it supported, and because of the activity induced by its transportation (shipbuilding and maritime employment). As seen above (part 1), the vessels did not originate from Marennes itself, and the trade therefore benefitted both the coastal ports in the region and those on the French Atlantic coast.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" bureaux=\"Saint-Martin-de-Ré, Marennes\" mdxType=\"Caller\" />\n    <p>{`Shipping data can be used to understand the commercial geography of exported salt, but it does not reveal the quantities exported. Starting from the reign of Louis XIV, however, salt tax laws required the captain to sail with a full cargo. The tonnage of vessels loaded with salt is therefore a fairly good indication of the quantities exported. The clearance documents confirm that, among the exporting ports of our region of interest, Marennes unquestionably comes in first place. In 1787, the cumulative tonnage of ships transporting salt departing from Marennes was more than twice the tonnage shipped from Ars-en-Ré, the second largest exporter in the region. Even after noting the ship tonnage overvaluation in Marennes, which we observed by comparing it with the tonnage of the same ships recorded in other ports, Marennes remains the main salt supplier of France. `}</p>\n    <p>{`Salt export is almost the exclusive activity of Marennes: out of 1,174 ship departures in 1787, 990 had a salt load. In 1789, it rose to 1,301 out of 1,481 ships. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-and-the-triangular-trade\",\n    level: 2,\n    title: \"2.1. La Rochelle and the triangular trade\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-the-brandy-trade\",\n    level: 2,\n    title: \"2.2. The brandy trade\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-and-the-salt-trade\",\n    level: 2,\n    title: \"2.3. Marennes and the salt trade\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"9 min read\",\"minutes\":8.25,\"time\":495000,\"words\":1650}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`En 1789, les navires qui sortent des ports exportateurs de sels (Marennes, Ars-en-Ré) et de Rochefort ont un tonnage moyen plus important que ceux sortant de La Rochelle. De manière plus surprenante, la quantité de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de Ré, voire même Rochefort - témoigne d’un dynamisme qui échappe largement au port dominant, La Rochelle. Cette particularité s’inscrit dans une histoire maritime longue de la région PASA.`}</p>\n    <p>{`Jusqu’à la perte des colonies nord-américaines, le port de La Rochelle a cultivé une certaine spécificité géographique. Quoique le port de La Rochelle pratiquait, comme la presque totalité des ports atlantiques, le commerce antillais et négrier, une part importante et qui a progressivement augmenté jusqu’à représenter plus de la moitié de ses armements pour les colonies dans les années 1750 était constituée par le commerce nord-américain - Canada, Louisiane et pêcheries de Terre-Neuve. Cette spécificité géographique a également influé sur sa spécialisation par produits. Le commerce des fourrures est ainsi une spécialité rochelaise jusqu’au début des années 1760. Les fourrures étaient importées non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de l’Ohio. Ces fourrures étaient pour partie ré-exportées en France et en Europe (principalement vers l’espace allemand et en Suisse). Une part importante, les peaux de castors en particulier, n’était pas réexportée, mais alimentait l’industrie de chamoiserie niortaise et d’autres localités françaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matières premières et en produits manufacturés. L’Amérique du Nord était donc un débouché important et facile pour les céréales de la région, les étoffes locales de basse qualité et, dans une moindre mesure, le sel nécessaire aux pêcheries de Terre-Neuve. Ce commerce quoique modeste avant les années 1740 fournissait des volumes importants d’emploi dans ces trois secteurs de l’économie régionale et contribuait à faire du port de La Rochelle le centre de gravité du complexe portuaire régional. Cette domination était renforcée par la prépondérance des capitaux rochelais, investis de manière prioritaire dans le commerce Atlantique - nord-américain et antillais. La domination rochelaise se mesurait notamment au début du siècle par la présence des bureaux principaux des maisons de Cognac à La Rochelle. Mais, dès la crise qui suivit la chute du système de Law, La Rochelle commença à perdre sa place et Tonnay-Charente à s’affirmer comme le principal port d’exportation de l’eau-de-vie produite dans la région, et du Cognac en particulier. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Ainsi, même si le port de la Rochelle a l’ascendant sur les autres ports de la région par la diversité des produits qu’il importe et exporte et, surtout, par son activité dans le commerce atlantique, les échanges des ports de la région sont largement autonomes comme le montre le réseau des voyages de la région PASA de 1787 comparé à ceux des deux autres régions situées au nord (la Loire-Atlantique) et au sud (l’Aquitaine). Les indices de centralité (la « betweeness centrality » ou « centralité d’intermédiarité » compte le nombre de plus courts chemins entre deux ports passant par le port donné ; le « pagerank » mesure la connexion relative à des ports eux-mêmes bien connectés. Voir `}<a href=\"https://fr.wikipedia.org/wiki/Centralit%25C3%25A9\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://fr.wikipedia.org/wiki/Centralit%C3%A9\"\n        }}>{`https://fr.wikipedia.org/wiki/Centralit%C3%A9`}</a></a>{`) comparées à ceux d’autres régions dominées par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacité à structurer les trafics maritimes locaux comme nous l’avons illustré dans la partie 2 avec les exemples de la traite, du commerce des eaux-de-vie et du commerce du sel.`}</p>\n    <p>{`Ce constat peut être lié historiquement à la perte des colonies nord-américaines (Canada et Louisiane) qui a brisé une dynamique vertueuse qui s’était établie dans les années suivant la guerre de succession d’Autriche. En effet, avant 1748, le commerce des Antilles en droiture et la traite négrière continuaient à dominer le commerce de la Direction de la Rochelle en valeur, étant donné le dynamisme limité de la demande émanant de l’Amérique du Nord. Mais, dès la fin de la guerre de Succession d’Autriche, s’ouvre une période de croissance exceptionnelle pour le commerce avec l’Amérique du Nord. Sur la période 1748–1758, La Rochelle reçoit annuellement plus de 1 300 000 livres de peaux d’Amérique du Nord, soit presque autant en valeur que de sucre des Antilles (1 450 000 livres). Le nombre d’armements à destination du Canada est multiplié par deux alors que celui pour la Louisiane augmente de moitié. Par rapport aux années précédant la guerre, le trafic lié au commerce colonial triangulaire baisse en moyenne d’un quart pour les Antilles et de plus de la moitié pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et même Dunkerque et Marseille. A l’inverse, les Rochelais ont un monopole de fait pour la Louisiane qui n’intéresse guère les ports plus importants et seul Bordeaux les concurrence pour l’approvisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilités complémentaires. D’un côté, le commerce à destination du Canada pouvait se transformer en commerce triangulaire inversé - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les îles à sucre en morue salée et, plus rarement, en céréales. La Louisiane permettait également de réaliser des opérations de contrebande avec les colons espagnols, offrant la possibilité de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1991).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limité en volume, mais créateur d’emplois locaux et, au milieu du siècle, facteur d’un dynamisme certain, s’écroule avec la perte des colonies françaises nord-américaines à la fin de la guerre de Sept Ans. Cette perte déstructure durablement le commerce rochelais qui perd ses marchés privilégiés et sa position dominante au sein du réseau portuaire régional. En 1789, le commerce extérieur du port de la Rochelle est quasi exclusivement colonial : près de 90% de ses exportations en valeur sont destinées à la traite africaine et aux Antilles. Son impact dans la structuration de la région étudiée apparaît faible, alors que les autres bureaux de Fermes de la région exportent essentiellement des produits régionaux, cela n’est pas le cas dans le bureau de La Rochelle. D’autres ports, par ailleurs, sont nettement plus « extravertis » en termes de navigation. Le profil de La Rochelle s’apparente à celui des autres grands ports coloniaux, à cela près que Bordeaux exporte une partie consistante de produits régionaux de son arrière-pays, qu’il contribue à structurer. Le Havre et Nantes, comme La Rochelle, n’exportent pas, eux, essentiellement des produits de leur région. La part des voyages internes à la région est en revanche importante pour La Rochelle, mais cela reflète plus les nécessités de l’approvisionnement de la ville et de la région qu’un rôle d’entrepôt pour l’exportation. Ainsi, à titre d’exemple, le total du tonnage expédié du seul port de Ribérou-Saujon en 1789 vers La Rochelle avec de la chaux est de 1640 tonneaux. Quant à la quarantaine de navires qui s’y rendent depuis Marennes, ils ont à bord du vin, des eaux-de-vie, du bois, des fèves, des huîtres, des meubles, des passagers, ou naviguent à vide.`}</p>\n    <p>{`Les graphiques que nous proposons illustrent fidèlement nos propos. Ce déclin se donne à voir, à la veille de la Révolution, sur le graphique en début de section, où l’infrastructure de la région PASA apparaît originale par le faible poids relatif de son port principal - La Rochelle - incapable de freiner le développement des ports qu’il maintenait dans sa dépendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-Ré. Dans la période pré-révolutionnaire (1787–1789), les flux de navires comme de marchandises témoignent ainsi de la recomposition de l’économie de la façade maritime. Désormais, la valeur des flux de marchandises au départ de Tonnay-Charente et à l’arrivée de Rochefort, qui entretient directement les productions locales, se rapproche de ceux de La Rochelle.`}</p>\n    <p>{`Cette évolution est la conséquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des négociants rochelais, conséquence directe de la vague de faillites qui secouent le milieu à la fin de la guerre de Sept Ans; la fermeture des marchés nord-américains subventionnés qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite négrière. Pour l’animer, les négociants rochelais se procurent les marchandises nécessaires à ce commerce dans toute la France et l’Europe et ne se fournissent que très peu dans l’arrière-pays rochelais. Le port n’est donc pas le point de passage obligé de son arrière-pays dans les relations avec le grand large, et ce, d’autant plus, que la faiblesse capitalistique de la place éloigne les maisons de commerce spécialisées dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux à Tonnay-Charente ou à Paris. Même dans le commerce colonial, La Rochelle doit faire une place aux autres ports de la région puisque Rochefort se voit accorder l’autorisation de faire le commerce colonial, témoignant du déclin économique et politique du port.`}</p>\n    <p>{`Pour conclure, La Rochelle reste en 1789 un port relativement dominant dans la région, notamment en ce qui concerne le commerce atlantique, mais cette domination a largement diminué au cours du siècle. De plus, la spécialisation des ports de la région dans le sel pour les uns (Marennes, Ars-en-Ré), dans l’eau-de-vie pour les autres (Tonnay-Charente et, dans une moindre mesure, les ports de l’île de Ré), n’est plus articulée par la place de La Rochelle. Le commerce colonial ne s’appuie plus sur le réseau des ports et des places manufacturières locales, mais survit grâce aux capitaux et aux marchandises venus d’ailleurs.`}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`Les guerres de la Révolution et napoléoniennes ont par la suite démontré la fragilité et l’artificialité d’un tel dispositif. Le blocus anglais et l’interdiction de la traite transatlantique sonnent pour le port de la Rochelle le glas de son destin de grand port commercial. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.575,\"time\":454500,\"words\":1515}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-3-la-rochelle-a-dominant-port-but-not-a-regional-hub\"\n    }}>{`Part 3. La Rochelle, a dominant port but not a regional hub`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`In 1789, ships departing from salt exporting ports (Marennes and Ars-en-Ré) or from Rochefort had a higher average tonnage than those departing from La Rochelle. Surprisingly, an analysis of the number of ships departing from secondary ports (Aligre, Charente, Marennes, Saint-Martin de Ré, and even Rochefort) shows that the dynamic activities at these ports were mostly unrelated to those of the dominant port, La Rochelle. This characteristic is a result of the long historical evolution of maritime trade in the PASA region.`}</p>\n    <p>{`The port of La Rochelle had cultivated a certain geographic distinctiveness until France lost its North American colonies. Like most Atlantic ports La Rochelle was involved in the West Indian and slave trade, but a considerable share of its shipments to the colonies was devoted to trade with North America (Canada, Louisiana, and Newfoundland fisheries), increasingly progressively to represent more than half of its colonial outfitting in the 1750s. This focus also influenced the nature of the products the port specialized in.`}</p>\n    <p>{`Fur trade was a La Rochelle specialty up to the early 1760s, with furs not only imported from Canada, but also from Louisiana, the main seaport for Ohio animal skins. These were for the most part re-exported in France and in Europe (mainly to the German territories and Switzerland). An important share – beaver furs notably – was not re-exported but went to the leather industry of Niort and other French towns. In return, La Rochelle supplied food, raw materials, and manufactured products to Canada and Louisiana. North America was an important and easy market for the region’s grain, low-quality local cloth, and to a lesser extent for the salt used by Newfoundland fisheries. While still modest in the 1740s, this trade provided high levels of employment in all three sectors of the regional economy and turned La Rochelle into the focal point of the regional port complex. This dominant position was compounded by the large share of La Rochelle capital invested in the Atlantic trade with North America and the West Indies. At the turn of the century La Rochelle’s superiority was reflected in the fact that Cognac companies established their headquarters in the town. However, following the crisis brought on by the end of the Law financial system in 1720, La Rochelle progressively lost its leading position and Tonnay-Charentes grew as the main port for the export of brandy produced in the region, and of Cognac more particularly. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`La Rochelle overshadowed other ports in the region in the diversity of exported and imported products, and especially in its involvement in the Atlantic trade. The other regional ports largely developed their own economic activities independently, as shown by a comparison of the network of ship routes in the PASA region in 1787 with two other regions in the North (Loire-Atlantique) and South (Aquitaine). The indicators of centrality (ie the “betweenness centrality“, which is the number of shortest routes between two ports that pass through a given port, or PageRank centrality measuring the connection with other well-connected ports – see https:// en.wikipedia/wiki/Centrality) confirm La Rochelle’s comparative weakness and inability to centralize local maritime traffic when contrasted against other regions dominated by a central port (such as South-West France, the Loire-Atlantique, or Normandy). This was illustrated in part 2 above in examples relating to the slave trade and the brandy and salt trades.`}</p>\n    <p>{`La Rochelle’s weaker position within its region is probably a consequence of the loss of the North American colonies (Canada and Louisiana), which broke a positive cycle that had been established in the period after the War of the Austrian Succession. Before 1748, direct trade with the West Indies and the slave trade remained dominant within the La Rochelle customs region in terms of value, because of the limited demand from North America. But, immediately after the War of the Austrian Succession, a period of exceptional growth began in trade with North America. From 1748 to 1758, La Rochelle annually imported more than 1,300,000 French livres of North American skins, almost equal in value to West Indian sugar (1,450,000 French livres). The number of ships outfitted to sail to Canada had doubled, while the number travelling to Louisiana increased by half. Compared to the pre-war years, traffic to the West Indies fell on average by a quarter and slave trade traffic decreased by more than half now that La Rochelle was in direct competition with ports such as Bordeaux, Nantes, Rouen, and even Dunkirk and Marseille. Conversely, La Rochelle had a de facto monopoly over Louisiana, which was of little interest to larger ports, and only competed with Bordeaux in supplying Canada. These two destinations offered complementary possibilities, allowing for other types of triangular trade between La Rochelle, Canada, and West Indies to arise, based on Canadian salted cod and, more rarely, grain that could supply the sugar islands. Trade with Louisiana also provided smuggling possibilities with Spanish settlers, and this could offer rich returns in the form of Spanish silver dollars (Augeron: 2004; Mathieu: 1991).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Although this niche trade was limited in volume, it created local jobs and, in the middle of the century, gave rise to a certain dynamism which collapsed with the loss of the French North American colonies at the end of the Seven Years’ War. This loss permanently disrupted La Rochelle trade, depriving it of its distinctive markets and forcing it to relinquish its dominant position within the regional port network. By 1789, La Rochelle export trade was almost exclusively colonial: the slave trade and trade with the West Indies represented nearly 90% of its export value and the port’s activities no longer no longer framed the regional export economy which fell to neighboring customs offices. La Rochelle’s profile was similar to that of other large colonial ports, except for Bordeaux which consistently exported a share of products originating from its hinterland and became a regional hub for that trade. Le Havre and Nantes, like La Rochelle, did not mainly export products from their region. While the share of maritime traffic between La Rochelle and its region was important, its purpose was mainly to supply the city and the region rather than to serve as a warehouse for export. Thus, for example, in 1789, the port of Ribérou-Saujon alone shipped lime to La Rochelle on ships totaling 1,640 tonneaux, and the forty or so ships that sailed to La Rochelle from Marennes carried wine, brandy, wood, beans, oysters, furniture, and passengers, or sailed empty.`}</p>\n    <p>{`This information is accurately illustrated in our charts. La Rochelle’s decline, which set in on the eve of the Revolution, is displayed in the opening chart in this section. La Rochelle – despite being the PASA region’s main port – saw comparatively low traffic post-1763, resulting in other regional ports expanding their own trade activities, such as Tonnay-Charente, Marennes, Rochefort, and Ars-en-Ré. In the pre-revolutionary period (1787–1789), the flow of ships and goods thus reflected this reconfigured seafront trade. The value of the flow of goods leaving Tonnay-Charente or those entering Rochefort, which directly supported local production, now rivaled those from La Rochelle.`}</p>\n    <p>{`This trend evolved out of several adverse circumstances that compounded each other: the decline in capitalization by La Rochelle merchants, a direct consequence of the wave of bankruptcies that shook the town from the middle to the end of the Seven Years’ War; the loss of subsidized North American markets that would have allowed La Rochelle to rapidly rebound; and strong competition from other ports on West Indian markets. All that remained for La Rochelle was the slave trade. To maintain it, merchants purchased the goods needed from all over France and Europe and were only rarely supplied by their own hinterland. The port no longer served as the hinterland’s main route towards the open sea, particularly after the town’s capital weakness had driven away the trading companies specialized in Cognac: for example, Martell moved its headquarters to Tonnay-Charente and Paris. La Rochelle even faced competition in the colonial trade from other ports in the region. Rochefort gained permission to engage in the colonial trade, confirming the economic and political decline of the port of La Rochelle.`}</p>\n    <p>{`In conclusion, in 1789, La Rochelle was still a relatively dominant port in the region, particularly as regards the Atlantic trade, but this dominance declined considerably over the course of the century. In addition, the specialization of regional ports in salt (Marennes and Ars-en-Ré) and in brandy (Tonnay-Charente and, to a lesser extent, the ports of the island of Ré) meant that trade no longer revolved around La Rochelle. Colonial trade no longer relied on local networks of ports and manufacturing centers but survived on capital and goods from elsewhere.`}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`The Revolutionary and Napoleonic wars subsequently demonstrated the fragility and artificiality of this situation. The British blockade and the ban on transatlantic trade put an end to the port of La Rochelle’s status as a major commercial port. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"17 min read\",\"minutes\":16.105,\"time\":966300,\"words\":3221}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"à-propos\"\n    }}>{`À propos`}</h1>\n    <p>{`Le présent site a été réalisé dans le cadre du `}<a href=\"https://anr.portic.fr/\" target=\"blank\" rel=\"noopener noreferrer\">{`programme de recherche ANR PORTIC`}</a>{`. Ce programme porte sur les dynamiques de navigation et du commerce extérieur au dix-huitième siècle, un commerce qui s’effectue largement par voie maritime. Outre la meilleure compréhension de ces dynamiques par le croisement de deux jeux de données, un enjeu fondamental du programme est de chercher des méthodes de qualification et d’appréhension de l’incertitude des données historiques, en expérimentant des modes de visualisation et d’écriture appropriés.`}</p>\n    <p>{`Dans ce cadre, le Working Package n°5 de ce programme de recherche consiste à effectuer une série d’études de cas tirant parti de deux corpus existants de sources historiques numérisées : `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`, une base de données portant sur l’histoire de la navigation pilotée par Silvia Marzagalli et Christine Plumejeaud ; et `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{`, une base de données portant sur le commerce extérieur de la France, pilotée par Loïc Charles et Guillaume Daudin.`}</p>\n    <p>{`Ce site web s’inscrit dans un mouvement second faisant suite aux premières entreprises de numérisation pour chacune des deux bases, en tentant de valoriser le travail déjà accompli via l’étude approfondie de sous-ensembles signifiants dans les données. Ces études éclairent des questions disciplinaires existantes sous un nouveau jour grâce aux nouveaux matériaux et méthodes offerts par les bases de données mobilisées par le programme. Les questions soulevées par une telle initiative sont multiples :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Comment mobiliser ensemble deux sources dont certaines dimensions sont incommensurables ou difficiles à mettre en équivalence ? Comment croiser les données numérisées des deux bases avec des connaissances plus denses et qualitatives sur les phénomènes étudiés, apportées par des historiens spécialistes de la région étudiée ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte, au moment de l’enquête et du raisonnement, l’importante stratification de transformations, de réductions et de décisions interprétatives constituant la chaîne qui relie les sources initiales avec les données qui en ont été tirées ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte l’incertitude ou l’incomplétude des données tout en proposant une analyse scientifiquement solide des phénomènes étudiés ? `}</li>\n      <li parentName=\"ul\">{`Comment faire dialoguer les formes classiques de l’écriture historique - le récit déployé phrase après phrase, l’argument déroulé paragraphe par paragraphe - avec les formes d’écriture diagrammatique et computationnelle qu’implique la réalisation d’un site web ? `}</li>\n      <li parentName=\"ul\">{`Comment gérer la collaboration interdisciplinaire et la partition d’expertises qu’implique une telle écriture multimodale ?`}</li>\n    </ul>\n    <p>{`Toutes ces questions ont été travaillées lors des six mois de collaboration qui ont mené à l’élaboration de ce site, dont voici un bref récit.`}</p>\n    <h2 {...{\n      \"id\": \"dune-série-de-questionnements-à-une-semaine-denquête\"\n    }}>{`D’une série de questionnements à une semaine d’enquête`}</h2>\n    <p>{`L’étude de cas dont ce site est l’aboutissement a été articulée autour d’un format de collaboration intensive que nous appelons datasprint et qui consiste à faire travailler ensemble des expert.e.s de plusieurs disciplines sur un temps court et avec des questions de recherche déterminées à l’avance, sur la base d’un ou plusieurs jeux de données préparés pour l’occasion.`}</p>\n    <p>{`En amont du datasprint, nous avons conduit pendant plusieurs mois un double travail de préparation des données, et de préparation des questions de recherche. Sur le plan des données, les équipes de Navigocorpus et de Toflit18 données ont dû effectuer un important travail de nettoyage et d’affinement concernant les régions et les périodes étudiées : le fait de projeter une étude de cas précise a fait émerger des problèmes qui étaient restés dans l’ombre faute de besoin d’un réexamen approfondi. Un travail très important a également été effectué pour « aligner » les deux bases, c’est-à-dire pour mettre en correspondance les lieux et les types de produits commercés ou transportés tels qu’ils sont décrits dans chacune des bases.`}</p>\n    <p>{`Sur le plan de la préparation des questions de recherche de départ, nous avons conduit une série de réunions préliminaires reliées par des documents en ligne rédigés collaborativement, qui nous ont aidé à identifier des questions à la fois pertinentes en regard de l’histoire de la région et de la littérature existante, mais aussi de ce que les données nous permettaient - ou pas - d’explorer et de visualiser. Ce travail d’ajustement et de mise en correspondance entre les questions et les données a ainsi couru d’octobre 2020 à avril 2021, et nous a permis à la fois d’identifier les activités d’exploration les plus pertinentes à proposer aux participants durant l’atelier, et d’éviter les chausses-trappes qui nous auraient conduit dans des questionnements impossibles à résoudre.`}</p>\n    <p>{`De ce travail de préparation est né un document de questionnement scientifique destiné à expliciter les questions de recherche à explorer partagé à tous les participant.e.s de la semaine de datasprint. Ainsi, au début du datasprint, l’étude de cas était structurée en deux groupes, correspondant à deux lignes d’enquête complémentaires mais aussi à la constitution de deux équipes équilibrées pour la collaboration :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`la première équipe devait se consacrer à étudier le dynamisme de la région du Poitou par rapport à la France et au monde en général (avec l’hypothèse d’un déclin par rapport au reste de la France au cours du dix-huitième siècle)`}</li>\n      <li parentName=\"ul\">{`la seconde équipe devait se consacrer à étudier les relations de complémentarité et de domination entre ports de la région, de manière notamment à distinguer les flux et circuits commerciaux qui y sont associés`}</li>\n    </ul>\n    <p>{`Sur cette base, un « kit de bienvenue » a été conçu pour permettre à tou.te.s les expert.e.s de rapidement saisir les multiples dimensions de l’atelier, et nous avons conduit quelques enquêtes préliminaires permettant de résoudre les questions les plus évidentes pour tirer le meilleur parti possible de la concentration d’expertises multiples sur le temps court et très dense du datasprint.`}</p>\n    <h3 {...{\n      \"id\": \"faire-avec-les-conditions-de-recherche\"\n    }}>{`Faire avec les conditions de recherche`}</h3>\n    <p>{`La semaine du datasprint, qui a eu lieu début avril 2021, s’est avérée coïncider avec un moment de forte reprise de l’épidémie de covid-19 en France en général et à Paris en particulier. Cela nous a contraint à effectuer l’atelier en ligne. Conduire un datasprint en ligne revenait à se priver de l’incommensurable apport des échanges informels et autres possibilités d’affichage, de circulation et de spatialisation offerts par le travail dans un même lieu physique. À cette contrainte s’est ajoutée la subite fermeture des écoles maternelles et primaires ladite semaine, qui a occasionné une sérieuse charge extra-professionnelle pour une part substantielle des participant.e.s.`}</p>\n    <p>{`Le datasprint a néanmoins eu lieu, et nous avons décidé de considérer les conditions particulières dans lesquelles il s’est conduit non seulement comme des contraintes demandant de recalibrer drastiquement nos attentes, mais aussi comme des occasions d’invention et d’expérimentation appelant à adapter nos manières de procéder par rapport aux modalités initialement planifiées.`}</p>\n    <h3 {...{\n      \"id\": \"improvisations-et-adaptations\"\n    }}>{`Improvisations et adaptations`}</h3>\n    <p>{`Durant le datasprint, la diversité des compétences des participant.e.s a impliqué de remettre à plat la répartition des tâches. Ainsi, chacun a pu être amené à suggérer des pistes de recherche, manipuler les données, et se pencher sur l’analyse et la mise en forme des résultats. Cette semaine a notamment été l’occasion d’expérimenter avec un grand nombre de technologies utilisées durant les activités d’enquête, notamment `}<a href=\"https://jupyter.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`jupyter notebook`}</a>{`, `}<a href=\"https://kepler.gl/\" target=\"blank\" rel=\"noopener noreferrer\">{`kepler.gl`}</a>{`, `}<a href=\"https://vega.github.io/vega/\" target=\"blank\" rel=\"noopener noreferrer\">{`vega`}</a>{`, ou encore `}<a href=\"https://matplotlib.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`matplotlib`}</a>{`. Nous avons néanmoins également parfois touché aux limites de ce principe en condition « zoomifiée », certaines discussions spécialisées (sur le plan technique ou sur le plan historique par exemple) nécessitant parfois de réformer les corps disciplinaires et de prévoir des moments d’aparté transversaux.`}</p>\n    <p>{`Le format datasprint implique par ailleurs une dimension expérimentale, parfois chaotique, et les difficultés de communications impliquées par la conduite en ligne ont amplifié cette dimension. Nous avons donc construit nos journées de travail sur un canevas allégé en terme d’amplitude horaire, et sous une forme tentant de varier les rythmes et les échelles d’interaction : un point de plénière en matinée, suivi de travail en deux groupes, eux-mêmes rapidement re-divisés en binômes ou en moments de travail individuel. `}</p>\n    <p>{`Sur le plan technique, nous avons opté pour une salle zoom permanente ouverte durant toute la semaine et divisée en « breakout rooms » (salles de travail) permettant de travailler en plus petits ensembles ; nous avons également soutenu la semaine avec un dossier google drive très organisé dans lequel l’ensemble des activités ont été archivées et consignées.`}</p>\n    <p>{`Pour faciliter le processus d’intercompréhension, des procédures méthodologiques ont également été proposées aux participants. Ainsi, des personnes jouant le rôle de facilitateurs ont fait le lien entre les différents groupes en circulant continuellement entre les différentes salles zoom de travail. Nous avons par ailleurs insisté sur l’importance de la documentation en structurant les activités de chaque jour autour de l’écriture de « rapports » remplis au fur et à mesure de la journée, dont une personne « scribe » était chargée de prendre soin afin de garder un maximum de traces et de permettre les échanges d’information asynchrones. Ces rapports ont finalement été progressivement abandonnés, car trop lourds étant donné le poids des autres activités. Nous avons également progressivement réduit les temps de visioconférence pour minimiser la fatigue liée aux échanges en ligne.`}</p>\n    <p>{`Les séances de travail d’un datasprint provoquent parfois un « effet bulle » dans lequel chaque équipe peut rapidement se déconnecter du travail effectué par les autres, entraînant des blocages, des tâches effectuées en doublon ou des « angles morts ». Ce problème est amplifié par la conduite en ligne. Pour faire face à ce défi, nous avons rythmé les journées de points d’étapes effectuées à plusieurs échelles - par petits groupes, par équipes, ou en plénière - afin de partager les avancées. Par ailleurs, des visites informelles et autres « zoom surfing » ont permis de favoriser certaines circulations d’idées et de méthodes.`}</p>\n    <p>{`L’un des intérêts du format datasprint est enfin de favoriser une unité de temps pour le travail interdisciplinaire. L’intensité qu’implique cette unité de temps appelle cependant une valorisation à la hauteur des efforts fournis sur le temps court. Le temps du datasprint est, en temps normal, à la fois un temps d’exploration et d’enquête, et un temps de production de résultats. Cependant, ce principe a été confronté à deux spécificités dans notre cas : les conditions de travail en ligne ont demandé de revoir les attentes plus modestement, mais aussi le principe et les objectifs mêmes des datasprint de PORTIC qui, parce qu’ils visent la publication de sites web finalisés et contribuant de manière relativement précise à des études de cas très serrées (et non de rapports d’exploration des données comme c’est souvent le cas pour les autres datasprints). Face à ces spécificités, il nous a fallu articuler l’atelier avec un travail postérieur cadré par d’autres temporalités pour arriver à un résultat publiable.`}</p>\n    <h2 {...{\n      \"id\": \"la-fabrication-dun-site-web-comme-pivot-pour-lécriture-multimodale--entretenir-une-infrastructure-technique-et-méthodologique\"\n    }}>{`La fabrication d’un site web comme pivot pour l’écriture multimodale : entretenir une infrastructure technique et méthodologique`}</h2>\n    <p>{`À partir du travail effectué lors du datasprint, nous avons engagé une seconde phase d’approfondissement. Sur le fond, les axes de recherche initialement envisagés ont été progressivement remaniés. Cela a été fait dès la fin de la semaine de datasprint, au moment de la rédaction d’un document de synthèse mettant en regard les visualisations produites durant la semaine. Ce travail a été ensuite continué par Cécile Asselin qui a effectué un travail de synthèse et de nettoyage sur les productions de la semaine.`}</p>\n    <h3 {...{\n      \"id\": \"une-écriture-multimodale\"\n    }}>{`Une écriture multimodale`}</h3>\n    <p>{`Afin de construire progressivement, à partir des explorations du datasprint, un document propre à être publié et à transmettre un récit et des arguments à partir des données des deux bases, nous avons tenté d’utiliser la perspective de la fabrication d’un site pour articuler trois types « d’écriture » : la confection de nouveaux fichiers de données correspondant aux enquêtes soulevées par les activités de la semaine (écriture computationnelle) ; la confection de visualisations d’informations (écriture diagrammatique) ; enfin, bien sûr, la mise en récit et en argument historique de l’étude de cas (écriture en prose).`}</p>\n    <p>{`Pour ce faire, nous avons décidé de structurer le site en une série de trois parties à la structure identique : une « visualisation principale » constituant l’argument principal de la partie, accompagné d’un texte se fondant d’abord sur elle puis suivant ses propres développements, accompagné de « visualisations secondaires ». Cette organisation visuelle et rhétorique a induit un mode de travail itératif sur le registre du « ping pong » qui s’est déployé en trois temps : `}</p>\n    <ul>\n      <li parentName=\"ul\">{`dans la foulée du datasprint, les historien.ne.s ont d’abord travaillé à préciser les arguments de chacune des trois parties (avril-mai 2021)`}</li>\n      <li parentName=\"ul\">{`nous avons ensuite organisé deux jours intensifs de conception avec une équipe réduite d’ingénieur.e.s et de designers (Cécile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, Maxime Zoffoli) durant lesquels nous avons conçu des propositions de visualisations principales (fin mai 2021)`}</li>\n      <li parentName=\"ul\">{`les historien.es ont, à la suite de ces deux jours, repris la main sur l’écriture, enrichie et structurée par les propositions constituées par les visualisations, en précisant leurs textes comme leurs besoins pour des visualisations complémentaires, qui ont été progressivement produites en fonction du texte (juin-septembre 2021)`}</li>\n    </ul>\n    <p>{`Dans ce cadre, nous avons progressivement négocié une infrastructure de travail orientée vers le développement progressif du présent site web. Ce dernier a tout autant servi d’objectif que de moyen de rencontre entre les différentes activités qui ont suivi la semaine d’atelier datasprint.`}</p>\n    <p>{`La fabrication du site présenté au public a été articulée autour d’un protocole automatisé qui a permis de mettre le site à jour quotidiennement pendant sa phase d’écriture et de développement, et ainsi de faire progresser conjointement sa structure, son aspect graphique et les divers contenus qui le peuplent (voir son `}<a href=\"https://github.com/medialab/portic-storymaps-2021\" target=\"blank\" rel=\"noopener noreferrer\">{`répertoire github`}</a>{` pour plus d’informations). Plus précisément, ce protocole automatisé consistait à récupérer les contenus écrits dans un google documents écrit par les historien.ne.s, les données des bases Navigocorpus et Toflit18 sur leurs espaces numériques respectifs, et enfin à produire un ensemble de données optimisées pour le web avant de refabriquer le site.`}</p>\n    <p>{`Cette méthode de travail sur mesure, alternative à l’utilisation d’un CMS (type wordpress) ou d’une intégration des contenus entièrement « artisanale », nous a permis de multiplier les itérations sur les données, les visualisations et les textes, afin de développer itérativement un document ajusté et cohérent pour la lecture. Elle nous a également permis d’échapper à une approche qui voudrait formater la production du site de manière trop séquentielle, c’est-à-dire faisant suivre un premier temps de « conception » puis un deuxième temps « d’exécution », pour plutôt faire place à la découverte et au dialogue avec les différents matériaux en train de se développer. `}</p>\n    <p>{`Ainsi, la méthode de travail et de montage du site adoptée ici, outre la dimension d’optimisation qu’implique l’automatisation de certaines tâches, a été le moyen de favoriser un dialogue plus organique entre les différentes écritures en jeu dans ce document : en réalisant simultanément le design du site, celui des visualisations, et les textes qui les accompagnent, nous avons tenté de faire profiter chacune de ces activités l’une de l’autre, comme des sources d’invention ou de solidification mutuelle, plutôt que de les considérer comme des tâches spécialisées et/ou articulées selon un régime de subordination (de l’histoire à la technique, ou du visuel au textuel, ou de l’argument à son illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"un-site-destiné-à-tisser-des-liens-avec-dautres-activités-et-dautres-publics\"\n    }}>{`Un site destiné à tisser des liens avec d’autres activités et d’autres publics`}</h3>\n    <p>{`Ce site est pensé à la fois comme un objet autonome déroulant le récit scientifique de l’histoire de la région de La Rochelle au dix-huitième siècle, et comme la première pièce d’assemblages scientifiques et didactiques encore à venir. Nous l’avons conçu avec le projet de l’adresser à un public constitué d’étudiant.e.s en histoire, de professeur.e.s d’histoire du secondaire, ou d’amateur.ice.s avancés passionnés par le Poitou et les Charentes. Cependant, le site est également pensé pour pouvoir s’articuler avec deux publics complémentaires :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`les personnes spécialisées dans la médiation et/ou la vulgarisation pourront utiliser certaines des visualisations pour des initiatives destinées à un plus grand public`}</li>\n      <li parentName=\"ul\">{`les historien.ne.s spécialisés pourront citer ces visualisations dans des publications conventionnelles en revues ou monographies et ainsi s’appuyer sur ces dernières pour continuer nos enquêtes`}</li>\n    </ul>\n    <p>{`Pour ce faire, nous avons notamment rendu chacune des visualisations « détachable » du récit proposé via la page atlas - et plus techniquement en dotant chacune des visualisations d‘une adresse URL propre.`}</p>\n    <p>{`Par ailleurs, le `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`code source du site`}</a>{`, partagé sous licence libre, a été construit et documenté de manière à pouvoir être dérivé - en tout ou partie - pour d’autres projets à venir : il pourra apporter des éléments utiles pour les prochaines études de cas du programme PORTIC mais aussi pour d’autres projets similaires. Il est enfin à noter que toutes les données utilisées - et les scripts qui les génèrent à partir des données complètes de Toflit18 et Navigocorpus, accessibles toutes les deux librement - sont également inclus dans le code source du site, rendant nos visualisations et résultats entièrement reproductibles.`}</p>\n    <h2 {...{\n      \"id\": \"une-écriture-collective\"\n    }}>{`Une écriture collective`}</h2>\n    <p>{`Ce site est le résultat d’un processus d’enquête et d’écriture collective qui a mobilisé des personnes issues de plusieurs disciplines : histoire, économie, informatique, géomatique, design. `}</p>\n    <p>{`Les textes de cette publication ont été écrits par `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{` (professeur d’histoire moderne, Université Côte d’Azur - CMMC, coordinatrice et co-responsable scientifique du programme PORTIC), `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loïc Charles`}</a>{` (professeur d’économie, INED, Université Paris 8 Vincennes - LED), `}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{` (professeur d’économie, Université Paris-Dauphine - LEDa-DIAL), et `}<a href=\"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/\" target=\"blank\" rel=\"noopener noreferrer\">{`Thierry Sauzeau`}</a>{` (professeur d’histoire moderne, Université de Poitiers - Criham).`}</p>\n    <p>{`L’ensemble du processus de médiation et d’articulation de la collaboration a été mené par l’ingénieure stagiaire `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{`, qui s’est consacrée à plein temps pendant six mois à la conduite méthodologique et technique de l’ensemble de l’étude de cas, accompagnée par `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{` (designer de recherche, médialab Sciences Po - co-responsable scientifique du programme PORTIC en charge des études de cas).`}</p>\n    <p>{`Les visualisations ont été conçues et développées par `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`, `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{` (géomaticienne, laboratoire LIENSs - co-responsable scientifique du programme PORTIC), `}<a href=\"https://fr.linkedin.com/in/paul-girard-57822118\" target=\"blank\" rel=\"noopener noreferrer\">{`Paul Girard`}</a>{` (ingénieur expert en humanités numériques - entreprise `}<a href=\"https://www.ouestware.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Ouestware`}</a>{`), `}<a href=\"https://www.maximezoffoli.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Maxime Zoffoli`}</a>{` (designer expert en visualisation d’information), `}<a href=\"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b\" target=\"blank\" rel=\"noopener noreferrer\">{`Géraldine Geoffroy`}</a>{` (data librarian, Université Côte d’Azur).`}</p>\n    <p>{`Les fonds de carte d’époque ont été constitués par `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`.`}</p>\n    <p>{`La préparation et la vérification des données ont été effectuée par les équipes de Navigocorpus (`}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`, `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{`), de Toflit18 (`}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{`, `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loïc Charles`}</a>{`) et du médialab (`}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{` et `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`).`}</p>\n    <p>{`Le site a été développé par `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{` et `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`.`}</p>\n    <p>{`À ces personnes s’ajoutent celles ayant participé au datasprint qui a conduit à cette publication : les ingénieurs en méthodes numériques et designers du laboratoire médialab de Sciences Po `}<a href=\"https://bmaz.github.io/\" target=\"blank\" rel=\"noopener noreferrer\">{`Béatrice Mazoyer`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/\" target=\"blank\" rel=\"noopener noreferrer\">{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/guillaume-plique/\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Plique`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/heloise-thero/\" target=\"blank\" rel=\"noopener noreferrer\">{`Héloïse Théro`}</a>{`, et `}<a href=\"https://paulinegourlet.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Pauline Gourlet`}</a>{` ; les chercheurs `}<a href=\"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\" target=\"blank\" rel=\"noopener noreferrer\">{`Pierrick Pourchasse`}</a>{` (professeur émérite d’histoire moderne, Université de Bretagne Occidentale), et `}<a href=\"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\" target=\"blank\" rel=\"noopener noreferrer\">{`Alain Bouju`}</a>{` (maître de conférence HDR en informatique, Université de La Rochelle).`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"dune-série-de-questionnements-à-une-semaine-denquête\",\n    level: 2,\n    title: \"D’une série de questionnements à une semaine d’enquête\",\n    children: [\n        {\n              id: \"faire-avec-les-conditions-de-recherche\",\n              level: 3,\n              title: \"Faire avec les conditions de recherche\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisations-et-adaptations\",\n              level: 3,\n              title: \"Improvisations et adaptations\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"la-fabrication-dun-site-web-comme-pivot-pour-lécriture-multimodale--entretenir-une-infrastructure-technique-et-méthodologique\",\n    level: 2,\n    title: \"La fabrication d’un site web comme pivot pour l’écriture multimodale : entretenir une infrastructure technique et méthodologique\",\n    children: [\n        {\n              id: \"une-écriture-multimodale\",\n              level: 3,\n              title: \"Une écriture multimodale\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"un-site-destiné-à-tisser-des-liens-avec-dautres-activités-et-dautres-publics\",\n              level: 3,\n              title: \"Un site destiné à tisser des liens avec d’autres activités et d’autres publics\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"une-écriture-collective\",\n    level: 2,\n    title: \"Une écriture collective\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"15 min read\",\"minutes\":14.615,\"time\":876900,\"words\":2923}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"about\"\n    }}>{`About`}</h1>\n    <p>{`This website was designed as part of the `}<a href=\"https://anr.portic.fr/\" target=\"blank\" rel=\"noopener noreferrer\">{`ANR PORTIC research program`}</a>{`. This program studies the navigation and foreign trade flows in the eighteenth century when trade was largely carried out at sea. In addition to gaining a better understanding of these dynamics by cross-referencing two sets of data, a fundamental objective of the program was to find methods to qualify and deal with the uncertainty of the historical data by experimenting with suitable methods of displaying and writing the information.`}</p>\n    <p>{`In this framework, Working Package 5 of the research program involved a series of case studies based on two existing corpora of digitized historical sources: `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`, a database covering the history of navigation, supervised by Silvia Marzagalli and Christine Plumejeaud; and `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{`, a database covering France’s foreign trade, supervised by Loïc Charles and Guillaume Daudin.`}</p>\n    <p>{`This website was designed as part of the second phase of the project, following a first phase of digitization to constitute the two databases, intending to take advantage of the work already accomplished and carrying out an in-depth study of significant data subsets. These studies shed new light on themes already studied within the discipline by providing new material and methods by means of the databases developed as part of the program. This initiative raised a number of questions:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`How can two sources be used together when some of their dimensions cannot be measured or are difficult to compare? How can the digitized data from the two databases be cross-referenced to acquire a deeper and more qualitative knowledge about the phenomena provided by historians specialized in the region studied? `}</li>\n      <li parentName=\"ul\">{`How can the survey and analysis take into account the considerable stratification of transformations, reductions and interpretative decisions that form the chain that connects the initial sources with the data drawn from them? `}</li>\n      <li parentName=\"ul\">{`How can the uncertainty or incompleteness of the data be taken into account, while proposing a scientifically sound analysis of the phenomena studied? `}</li>\n      <li parentName=\"ul\">{`How can the standard forms of historical writing –the narrative formed by consecutive sentences, the argument developed paragraph by paragraph– effectively serve the forms of diagrammatic and computational writing involved when creating a website? `}</li>\n      <li parentName=\"ul\">{`How is it possible to manage interdisciplinary collaboration and the division of expertise involved in this kind of multimodal writing?`}</li>\n    </ul>\n    <p>{`These questions were worked out across a six-month period of collaboration that led to the development of the website and will be briefly recounted below.`}</p>\n    <h2 {...{\n      \"id\": \"from-a-series-of-questions-to-a-week-of-investigation\"\n    }}>{`From a series of questions to a week of investigation`}</h2>\n    <p>{`The case study which led to this website was the outcome of intensive collaboration which we call a data sprint and which consists in gathering experts from several disciplines to work together over a short period of time on pre-determined research questions, based on one or more datasets prepared for the occasion.`}</p>\n    <p>{`Ahead of the data sprint, several months were devoted to preparing the data and the research questions. As regards data, the major task for the Navigocorpus and Toflit18 data teams was to clean and refine the data for the regions and periods studied, as the simple fact of planning a specific case study revealed new problems that had remained hidden until an in-depth study was implemented. Another major challenge was to align the two databases, i.e. to match the places and types of products traded or transported as described in each of the databases.`}</p>\n    <p>{`To prepare the initial research questions, we held a series of preliminary meetings based on collaboratively produced online documents that helped us identify pertinent questions with respect to the history of the region and the existing literature, but also with respect to what could or could not be explored and displayed with the data available. This work of adjustment and matching up questions and data ran from October 2020 to April 2021, allowing us to identify the most relevant exploration activities for submission to the workshop participants, and to avoid the pitfalls that would have led us to unsolvable questions`}</p>\n    <p>{`Following the preparation work we drafted a scientific questioning document that described the research questions to be examined and was shared with all the participants during a week-long data sprint. At the beginning of the data sprint, the case study was divided into two complementary lines of inquiry and two teams were formed with a balanced composition to allow interdisciplinary collaboration:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The first team was appointed to study the dynamism of the Poitou region compared to France and the world in general (with the hypothesis of a decline compared to the rest of France during the eighteenth century).`}</li>\n      <li parentName=\"ul\">{`The second team was in charge of studying the relationships of complementarity and domination between ports in the region, with the aim, notably, of distinguishing the trade flows and commercial networks associated with them.`}</li>\n    </ul>\n    <p>{`Background material was then prepared to help the experts quickly grasp the multiple dimensions of the workshop, and preliminary surveys were conducted to solve the most obvious questions and make the most of the wide panel of expertise available during the short and very dense data sprint.`}</p>\n    <h3 {...{\n      \"id\": \"unusual-research-conditions\"\n    }}>{`Unusual research conditions`}</h3>\n    <p>{`The data sprint was scheduled for early April 2021, and this coincided with a strong upsurge in the COVID-19 epidemic in France in general and in Paris in particular, which forced us to hold the workshop online. An online data sprint meant that we were deprived of the invaluable contribution of informal discussions and other possibilities for displaying and circulating information and occupying different spaces when working in the same physical environment. The situation was compounded by the French government’s sudden decision to close kindergartens and primary schools that week, adding a heavy extra-professional burden on a substantial number of participants.`}</p>\n    <p>{`The data sprint nevertheless took place, and we decided to consider the unusual circumstances not only as constraints requiring a drastic readjustment of our expectations, but also as opportunities for invention and experimentation in finding new ways of proceeding that departed from the methods initially planned.`}</p>\n    <h3 {...{\n      \"id\": \"improvisation-and-adaptation\"\n    }}>{`Improvisation and adaptation`}</h3>\n    <p>{`During the data sprint, the diversity of the participants’ competencies led us to reexamine the division of tasks. As a result, each person was given the opportunity to suggest research topics, manipulate the data, and examine the treatment and formatting of the results. The workshop also provided an opportunity to experiment with a large number of technologies used during the investigation, including `}<a href=\"https://jupyter.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`the Jupyter notebook`}</a>{`, `}<a href=\"https://kepler.gl/\" target=\"blank\" rel=\"noopener noreferrer\">{`kepler.gl`}</a>{`, `}<a href=\"https://vega.github.io/vega/\" target=\"blank\" rel=\"noopener noreferrer\">{`vega`}</a>{`, and `}<a href=\"https://matplotlib.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`matplotlib`}</a>{`. However, we were occasionally hindered by « Zoom » conditions, and specialized discussions (from a technical or historical perspective, for example) sometimes required groups to form once again along disciplinary lines with moments of transversal collaboration.`}</p>\n    <p>{`The data sprint format also implied an experimental, sometimes chaotic dimension, amplified by online communication problems. Our working days were therefore organized around a lighter schedule and in a format that sought to vary the rhythms and scales of interaction: a plenary update in the morning was followed by work in two groups that quickly divided into pairs or even individual work. `}</p>\n    <p>{`From a technical point of view, we opted for a permanent Zoom room open throughout the week divided into breakout rooms for work in smaller groups. We also filled a well-organized google drive folder throughout the week, in which all the activities were archived and recorded.`}</p>\n    <p>{`Methodological procedures were also implemented to facilitate the process of mutual understanding. Some of the participants, for example, acted as facilitators and were in charge of maintaining communication between the different groups by constantly circulating between the different work Zoom rooms. We also stressed the importance of documentation by including daily writing of « reports » completed as the day progressed, and by appointing « scribes » who were in charge of these reports and responsible for keeping as many traces as possible to allow asynchronous exchanges of information. These reports were eventually phased out, as they were too burdensome given the weight of the other activities. We also gradually cut down video conferencing time to reduce the fatigue associated with online communication.`}</p>\n    <p>{`Data sprint work sessions can sometimes cause a « bubble effect » in which each team can quickly become disconnected from the work accomplished by the others, leading to dead ends, duplicated tasks, and « blind spots ». This problem is amplified when working online. To meet this challenge, we scheduled progress update meetings at regular times during the day to share information on different scales: in small groups, in teams, and all together. In addition, informal visits and « Zoom surfing » made it possible to circulate ideas and methods to a certain extent.`}</p>\n    <p>{`One of the advantages of the data sprint format is that it assigns a specific time for interdisciplinary work. However, because work during this short time is intense, the expectation is that results equal to the efforts invested will be produced. In normal times, the data sprint is a time for exploration and investigation but also a time for generating results. However, in our case this principle was challenged in two ways: by online working conditions, which made us lower our expectations, but also by the very principle and objectives of the PORTIC data sprint which aimed at publication of finalized websites contributing in a relatively precise way to very specific case studies (and not data mining reports as is often the case with other data sprints). Faced with these challenges, we had to prolong our work after the workshop and change the time frame to achieve a publishable result.`}</p>\n    <h2 {...{\n      \"id\": \"the-website-a-pivotal-tool-for-multimodal-writing-and-defining-a-technical-and-methodological-infrastructure\"\n    }}>{`The website, a pivotal tool for multimodal writing and defining a technical and methodological infrastructure`}</h2>\n    <p>{`Based on the work completed during the data sprint, we began a second deeper phase of the project. In terms of content, the research topics initially selected were gradually reformulated. This work started at the end of the data sprint week, following the completion of a summary document based on the visuals produced during the week. Cécile Asselin then carried on summarizing and tidyng up the productions of the week.`}</p>\n    <h3 {...{\n      \"id\": \"multimodal-writing\"\n    }}>{`Multimodal writing`}</h3>\n    <p>{`In order to progressively draft a publishable document from the data sprint explorations, creating a story and arguments based on the two databases, we combined the three types of « writing » needed to develop the future website: computational writing for the new data files that grew out of data sprint investigations, diagrammatic writing for the visuals, and finally, of course, prose for the narrative and historical argument based on the case study.`}</p>\n    <p>{`We decided to divide the website into three similarly-structured sections: a « main visual » presenting the section’s main argument together with text based on the visual and expanding outwards, combined with « secondary visuals ». This visual and rhetorical organization induced an iterative work method similar to « ping pong » which was conducted in three stages: `}</p>\n    <ul>\n      <li parentName=\"ul\">{`Immediately after the data sprint, historians first worked on clarifying the arguments of each of the three sections (April-May 2021).`}</li>\n      <li parentName=\"ul\">{`We then organized two intensive days to design the main visual proposals (at the end of May 2021) with a small team of engineers and designers (Cécile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, and Maxime Zoffoli).`}</li>\n      <li parentName=\"ul\">{`Finally, the historians returned to the text which had been enriched and framed by the information proposed in the visuals. As they clarified the text, the need for additional visuals arose and these were gradually produced to fit the text (June to September 2021).`}</li>\n    </ul>\n    <p>{`This framework allowed us to progressively develop a work infrastructure adapted to the continuous development of the website. The website thus not only served as the goal but also as the point of contact between the different activities that arose after the data sprint workshop.`}</p>\n    <p>{`The website presented to the public was created using an automated protocol enabling daily updates as written content and further website developements emerged, which meant that progress was made jointly on its structure, graphics and the various contents (see its `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`github`}</a>{` directory for more information). The automated protocol consisted more specifically in retrieving content written by the historians and stored in a Google document, and data from the Navigocorpus and Toflit 18 databases in their respective digital spaces, and finally producing web-optimized data before updating the website.`}</p>\n    <p>{`This customized method, instead of using a CMS (such as Wordpress) or totally DIY content integration, allowed us to multiply iterations on the data, visuals, and text and develop a website by iteration with consistent and readable content. It also allowed us to avoid a website production approach that would have been too sequential with a first phase of « design » followed by a second phase of « development », and instead left room for discovery and dialogue with the different materials as they were being developed. `}</p>\n    <p>{`Thus, the method of preparing and assembling the website, which nevertheless required some optimization with the automation of certain tasks, enabled a more organic dialogue to develop between the different types of writing in this document: by simultaneously producing the website, the visuals, and the textual content to go with them, we tried to make each of these activities benefit from the others and be the source of mutual invention or confirmation, rather than consider them as specialized or coordinated tasks in a process of subordination (from history to technique, or from visual to text, or from argument to illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"a-website-designed-to-connect-with-other-activities-and-audiences\"\n    }}>{`A website designed to connect with other activities and audiences`}</h3>\n    <p>{`This website is intended to be both a stand-alone product that presents a scientific narrative of the history of the La Rochelle region in the eighteenth century, and a building stone for a scientific and didactic construction yet to come. Its target audiences include history students, secondary history teachers, and advanced amateurs passionate about the Poitou and Charentes regions. However, the website can also be of interest to two further complementary audiences:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Professionals working in historical outreach (for either an expert or general audience) who can use some of the visuals for initiatives aimed at a wider audience.`}</li>\n      <li parentName=\"ul\">{`Specialized historians who can cite these visuals in conventional publications in journals or monographs and use them for future investigations.`}</li>\n    </ul>\n    <p>{`To this end, we have ensured that each visual can be separated from the narrative and can be accessed via the atlas page, and more technically we have provided each visual with its own URL.`}</p>\n    <p>{`Furthermore, the `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`website source code`}</a>{`, shared under a free license, was developed and documented to allow it to be used –in whole or in part– for future projects. Useful elements can serve for the next case studies of the PORTIC program but also for other similar projects. Finally, it should be noted that all the data used and the scripts that generated them from the entire Toflit18 and Navigocorpus databases (both freely accessible) are also included in the website source code, which means that our visuals and results can be fully reproduced.`}</p>\n    <h2 {...{\n      \"id\": \"collective-writing\"\n    }}>{`Collective writing`}</h2>\n    <p>{`This website is the result of a process of collective investigation and writing that brought together people from several disciplines: history, economics, computer science, geomatics, and graphic design. `}</p>\n    <p>{`The website texts were written by `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{` (Professor of Modern History, Université Côte d’Azur - CMMC, Principal Investigator of the PORTIC program), `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loïc Charles`}</a>{` (Professor of Economics, INED, Université Paris 8 Vincennes - LED), `}<a href=\"https://leda.dauphine.fr/en/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{` (Professor of Economics, Université Paris-Dauphine - LEDa-DIAL), and `}<a href=\"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/\" target=\"blank\" rel=\"noopener noreferrer\">{`Thierry Sauzeau`}</a>{` (Professor of Modern History, Université de Poitiers - Criham).`}</p>\n    <p>{`The entire process of collaboration was led and managed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{`, an engineer intern who worked full-time for six months on the methodological and technical supervision of the entire case study, with the assistance of `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{` (research designer, Sciences Po medialab - scientific co-leader of the PORTIC program in charge of case studies).`}</p>\n    <p>{`The visuals were designed and developed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`, `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{` (geomatician, LIENSs laboratory - scientific co-leader of the PORTIC program), `}<a href=\"https://fr.linkedin.com/in/paul-girard-57822118\" target=\"blank\" rel=\"noopener noreferrer\">{`Paul Girard`}</a>{` (engineer specialized in digital humanities - `}<a href=\"https://www.ouestware.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Ouestware`}</a>{`), `}<a href=\"https://www.maximezoffoli.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Maxime Zoffoli`}</a>{` (graphic designer specialized in infographics), `}<a href=\"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b\" target=\"blank\" rel=\"noopener noreferrer\">{`Géraldine Geoffroy`}</a>{` (data librarian, Université Côte d’Azur).`}</p>\n    <p>{`The basemaps were designed by `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`.`}</p>\n    <p>{`The data were prepared and checked by the Navigocorpus team (`}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`, `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{`), the Toflit18 team (`}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{`, `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loïc Charles`}</a>{`) and the medialab team (`}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{`, and `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`).`}</p>\n    <p>{`The website was developed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Cécile Asselin`}</a>{` and `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`.`}</p>\n    <p>{`The website is also the work of those who took part in the data sprint: the engineers in digital methods and designers of the medialab laboratory of Sciences Po `}<a href=\"https://bmaz.github.io/\" target=\"blank\" rel=\"noopener noreferrer\">{`Béatrice Mazoyer`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/\" target=\"blank\" rel=\"noopener noreferrer\">{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/guillaume-plique/\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Plique`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/heloise-thero/\" target=\"blank\" rel=\"noopener noreferrer\">{`Héloïse Théro`}</a>{`, and `}<a href=\"https://paulinegourlet.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Pauline Gourlet`}</a>{`; the researchers `}<a href=\"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\" target=\"blank\" rel=\"noopener noreferrer\">{`Pierrick Pourchasse`}</a>{` (Professor Emeritus of Modern History, Université de Bretagne Occidentale, Brest), and `}<a href=\"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\" target=\"blank\" rel=\"noopener noreferrer\">{`Alain Bouju`}</a>{` (HDR Associate Professor in computer science, Université de La Rochelle).`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"from-a-series-of-questions-to-a-week-of-investigation\",\n    level: 2,\n    title: \"From a series of questions to a week of investigation\",\n    children: [\n        {\n              id: \"unusual-research-conditions\",\n              level: 3,\n              title: \"Unusual research conditions\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisation-and-adaptation\",\n              level: 3,\n              title: \"Improvisation and adaptation\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"the-website-a-pivotal-tool-for-multimodal-writing-and-defining-a-technical-and-methodological-infrastructure\",\n    level: 2,\n    title: \"The website, a pivotal tool for multimodal writing and defining a technical and methodological infrastructure\",\n    children: [\n        {\n              id: \"multimodal-writing\",\n              level: 3,\n              title: \"Multimodal writing\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"a-website-designed-to-connect-with-other-activities-and-audiences\",\n              level: 3,\n              title: \"A website designed to connect with other activities and audiences\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"collective-writing\",\n    level: 2,\n    title: \"Collective writing\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.115,\"time\":186900,\"words\":623}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"références\"\n    }}>{`Références`}</h1>\n    <h3 {...{\n      \"id\": \"sources-archivistiques\"\n    }}>{`Sources archivistiques`}</h3>\n    <p>{`Les données sur la navigation proviennent de la base de données Navigocorpus. Pour cette enquête, il s’agit plus particulièrement des:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`congés issus de la sous-série G5 conservés aux Archives Nationales de France`}</li>\n      <li parentName=\"ul\">{`congés de Lorient, Archives départementales du Morbihan, 10B-19`}</li>\n      <li parentName=\"ul\">{`congés de Saint-Tropez, Archives départementales du Var, 7 B 10`}</li>\n      <li parentName=\"ul\">{`Registres du Bureau de Santé de Marseille, 200 E 543 et 545`}</li>\n    </ul>\n    <p>{`Les données relatives aux expéditions négrières ont été complétées avec la base de données `}<a href=\"https://www.slavevoyages.org/voyage/database\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://www.slavevoyages.org/voyage/database\"\n        }}>{`https://www.slavevoyages.org/voyage/database`}</a></a></p>\n    <p>{`Les données relatives au commerce extérieur proviennent de la base de données Toflit18 (voir `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/exploration/sources\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"http://toflit18.medialab.sciences-po.fr/#/exploration/sources\"\n        }}>{`http://toflit18.medialab.sciences-po.fr/#/exploration/sources`}</a></a>{`).`}</p>\n    <p>{`Pour cette enquête, il s’agit plus particulièrement des : `}</p>\n    <p>{`Archives Nationales d’Outre-Mer (pour 1789) : Col. F2 B 14 (présent aussi en AN Marine B 7 514)`}</p>\n    <p>{`Archives Nationales de France (pour 1789) : AN F12 1665 et 1666 AN Marine B 7 514 (présent aussi en ANOM Col F2 B 14)`}</p>\n    <p>{`Archives départementales de la Charente-Maritime : 41 ETP 270 (pour l’historique des exportations de La Rochelle) `}</p>\n    <p>{`Bibliothèque municipale de Saint-Brieuc : Fonds Gournay, M84–87 (pour 1750)`}</p>\n    <p>{`La majeure partie des cahiers de doléances étudiés sont tirés des Archives départementales de Charente-Maritime (AD17). En effet, les Archives départementales de la Vendée (AD85) ne conservent que de rares cahiers pour littoral du Poitou (Bouin, Noirmoutier, l’Ile d’Elle dans le marais poitevin). La collecte et/ou la transcription ont été réalisées selon deux modalités. Nous avons tout d’abord récupéré un ensemble de cahiers charentais transcrits sur le site `}<a href=\"http://www.histoirepassion.eu/?-1789-Cahiers-de-doleances-et-Etats-generaux-\" target=\"blank\" rel=\"noopener noreferrer\">{`Histoire Passion - Saintonge Aunis Angoumois`}</a>{`. Nous avons ensuite complété ce corpus grâce à la collaboration des AD17 et des AD85. Ainsi, de nouveaux cahiers ont été récupérés et transcrits par Thierry Sauzeau et Silvia Marzagalli, le tout permettant d’évaluer l’exhaustivité et la teneur de l’échantillon utilisé. Le corpus de 163 cahiers recèle 14 cahiers de paroisses que complètent 5 cahiers de districts (groupes de paroisses) du littoral. L’ensemble de ce travail de consolidation et de mise en données est disponible et réutilisable `}<a href=\"https://docs.google.com/spreadsheets/d/1A8-OiTSYv7opCcWvF8tsJ0dmEXkHZMgN-7lhj-4hqFw/edit?usp%3Dsharing\" target=\"blank\" rel=\"noopener noreferrer\">{`à cette adresse`}</a>{`.`}</p>\n    <p>{`Les registres de délibération de la Chambre de Commerce de La Rochelle sont conservés aux Archives départementales de la Charente-Maritime, 41 ETP 8 (accessibles en ligne: `}<a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir%5C_ead%5C_visu%5C_lien.html?ir=11431&id=490014227\"\n        }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir\\\\_ead\\\\_visu\\\\_lien.html?ir=11431`}{`&`}{`id=490014227`}</a></a>{`) `}</p>\n    <h3 {...{\n      \"id\": \"bibliographie\"\n    }}>{`Bibliographie`}</h3>\n    <p>{`Augeron, Mickaël et Guillemet, Dominique (dir.), Champlain ou les portes du Nouveau Monde. Cinq siècles d’échanges entre le Centre-Ouest français et l’Amérique du Nord, La Crèche, Geste Éditions, 2004.`}</p>\n    <p>{`Clark, John G., La Rochelle and the Atlantic Economy during the Eighteenth Century, Baltimore, Johns Hopkins University Press, 1981.`}</p>\n    <p>{`Delafosse, Marcel (dir.), Histoire de La Rochelle, Toulouse, Privat, 2002.`}</p>\n    <p>{`Deveau, Jean-Michel, La traite rochelaise, Paris, Karthala, 1990.`}</p>\n    <p>{`Hocquet, Jean-Claude, « Navigation et transport du sel atlantique », dans Ménanteau, Loïc (dir.), Sel et salines de l’Europe atlantique, Rennes, PUR, 2018, p. 223–234.`}</p>\n    <p>{`Martinetti, Brice, Les négociants de La Rochelle au XVIIIe siècle, Rennes, PUR, 2013.`}</p>\n    <p>{`Mathieu, Jacques, La Nouvelle-France. Les Français en Amérique du Nord, XVIe-XVIIIe siècles, Paris, Belin, 1991.`}</p>\n    <p>{`Robert, Henri, Les trafics coloniaux du port de la Rochelle au XVIIIe siècle, Poitiers, Mémoire de la Société des Antiquaires de l’Ouest, 4e série, tome IV, 1960.`}</p>\n    <p>{`Sauzeau, Thierry et Normand, Eric (dir.), De Tonnay à Charente : histoire d’une porte maritime des pays charentais, La Crèche, Geste éditions, 2013, 203 p.`}</p>\n    <p>{`Sauzeau, Thierry, « Rochefort/Tonnay-Charente (XVIIe-XIXe siècles) entre concurrence et complémentarité », dans Fernandez, Alexandre et Marnot, Bruno (dir.), Les ports du golfe de Gascogne. De Concarneau à La Corogne (xve-xxie siècles), Paris, PUPS, 2013, p.109–122.`}</p>\n    <p>{`Sauzeau, Thierry, Les marins de la Seudre (XVIIIe-XIXe siècle), « Pays d’histoire », La Crèche, Geste Editions, 2005, 342 p.`}</p>\n    <p>{`Toussaint, Auguste, La route des Iles. Contribution à l’histoire maritime des Mascareignes, Paris, SEVPEN, 1967.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"sources-archivistiques\",\n    level: 3,\n    title: \"Sources archivistiques\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliographie\",\n    level: 3,\n    title: \"Bibliographie\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.045,\"time\":182700,\"words\":609}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"references\"\n    }}>{`References`}</h1>\n    <h3 {...{\n      \"id\": \"archival-sources\"\n    }}>{`Archival sources`}</h3>\n    <p>{`Navigation data was drawn from the Navigocorpus database and for this investigation more particularly from:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Clearances from the G5 sub-series kept at the Archives Nationales de France.`}</li>\n      <li parentName=\"ul\">{`Clearances of Lorient, Archives départementales du Morbihan (Lorient), 10B-19.`}</li>\n      <li parentName=\"ul\">{`Clearances of Saint-Tropez, Archives départementales du Var (Draguignan), 7 B 10.`}</li>\n      <li parentName=\"ul\">{`Records of the Marseille Health Office, Archives départementales des Bouches-du-Rhône (Marseille), 200 E 543 and 545.`}</li>\n    </ul>\n    <p>{`Additional data relating to slave shipments were provided by the database `}<a href=\"https://www.slavevoyages.org/voyage/database\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://www.slavevoyages.org/voyage/database\"\n        }}>{`https://www.slavevoyages.org/voyage/database`}</a></a></p>\n    <p>{`Data on foreign trade were provided by the Toflit18 database (see `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/exploration/sources\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"http://toflit18.medialab.sciences-po.fr/#/exploration/sources\"\n        }}>{`http://toflit18.medialab.sciences-po.fr/#/exploration/sources`}</a></a>{`), and for this investigation more particularly from: `}</p>\n    <p>{`Archives nationales d’Outre-Mer (ANOM) (Aix-en-Provence), for 1789: Col. F2 B 14 (also available in AN Marine B 7 514).`}</p>\n    <p>{`Archives nationales de France, for 1789: AN F12 1665 and 1666 AN Marine B 7 514 (also available in ANOM Col F2 B 14).`}</p>\n    <p>{`Archives départementales de Charente-Maritime (La Rochelle): 41 FTE 270 (for the history of La Rochelle exports).`}</p>\n    <p>{`Bibliothèque Municipale de Saint-Brieuc: Gournay Archives, M84–87 (for 1750).`}</p>\n    <p>{`Most of the grievance registers studied were provided by the Archives départementales de la Charente-Maritime (AD17) as the Archives départementales de Vendée (AD85) only hold a few registers for the coastal region of Poitou (Bouin, Noirmoutier, and the island of Elle in the Poitevin marsh). Collection and transcription when necessary were carried out in two ways. We first retrieved a set of Charentais registers transcribed on the website `}<a href=\"http://www.histoirepassion.eu/?-1789-Cahiers-de-doleances-et-Etats-generaux-\" target=\"blank\" rel=\"noopener noreferrer\">{`Histoire Passion - Saintonge Aunis Angoumois`}</a>{`. AD17 and AD85 provided additional data for this corpus: these registers were retrieved and transcribed by Thierry Sauzeau and Silvia Marzagalli, and they served to assess the comprehensiveness and content of the sample used. The corpus of 163 registers includes 14 parish registers and an additional 5 coastal district registers (groups of parishes). The entire process of data preparation and consolidation is available `}<a href=\"https://docs.google.com/spreadsheets/d/1A8-OiTSYv7opCcWvF8tsJ0dmEXkHZMgN-7lhj-4hqFw/edit?usp%3Dsharing\" target=\"blank\" rel=\"noopener noreferrer\">{`here`}</a>{`.`}</p>\n    <p>{`The records of the deliberations of the Chamber of Commerce of La Rochelle are archived at the Archives départementales de la Charente-Maritime, 41 FTE 8 (available online: `}<a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir%5C_ead%5C_visu%5C_lien.html?ir=11431&id=490014227\"\n        }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir\\\\_ead\\\\_visu\\\\_lien.html?ir=11431`}{`&`}{`id=490014227`}</a></a><a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\">{` `}</a>{` ) `}</p>\n    <h3 {...{\n      \"id\": \"bibliography\"\n    }}>{`Bibliography`}</h3>\n    <p>{`Augeron, Mickaël et Guillemet, Dominique (ed.), Champlain ou les portes du Nouveau Monde. Cinq siècles d’échanges entre le Centre-Ouest français et l’Amérique du Nord, La Crèche, Geste Éditions, 2004.`}</p>\n    <p>{`Clark, John G., La Rochelle and the Atlantic Economy during the Eighteenth Century, Baltimore, Johns Hopkins University Press, 1981.`}</p>\n    <p>{`Delafosse, Marcel (ed.), Histoire de La Rochelle, Toulouse, Privat, 2002.`}</p>\n    <p>{`Deveau, Jean-Michel, La traite rochelaise, Paris, Karthala, 1990.`}</p>\n    <p>{`Hocquet, Jean-Claude, « Navigation et transport du sel atlantique », in Ménanteau, Loïc (ed.), Sel et salines de l’Europe atlantique, Rennes, PUR, 2018, p. 223–234.`}</p>\n    <p>{`Martinetti, Brice, Les négociants de La Rochelle au XVIIIe siècle, Rennes, PUR, 2013.`}</p>\n    <p>{`Mathieu, Jacques, La Nouvelle-France. Les Français en Amérique du Nord, XVIe-XVIIIe siècles, Paris, Belin, 1991.`}</p>\n    <p>{`Robert, Henri, Les trafics coloniaux du port de la Rochelle au XVIIIe siècle, Poitiers, Mémoire de la Société des Antiquaires de l’Ouest, 4th serie, tome IV, 1960.`}</p>\n    <p>{`Sauzeau, Thierry and Normand, Eric (eds.), De Tonnay à Charente : histoire d’une porte maritime des pays charentais, La Crèche, Geste éditions, 2013, 203 p.`}</p>\n    <p>{`Sauzeau, Thierry, « Rochefort/Tonnay-Charente (XVIIe-XIXe siècles) entre concurrence et complémentarité », in Fernandez, Alexandre and Marnot, Bruno (eds.), Les ports du golfe de Gascogne. De Concarneau à La Corogne (xve-xxie siècles), Paris, PUPS, 2013, p.109–122.`}</p>\n    <p>{`Sauzeau, Thierry, Les marins de la Seudre (XVIIIe-XIXe siècle), « Pays d’histoire », La Crèche, Geste Editions, 2005, 342 p.`}</p>\n    <p>{`Toussaint, Auguste, La route des Iles. Contribution à l’histoire maritime des Mascareignes, Paris, SEVPEN,1967.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"archival-sources\",\n    level: 3,\n    title: \"Archival sources\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliography\",\n    level: 3,\n    title: \"Bibliography\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.55,\"time\":33000,\"words\":110}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme de recherche PORTIC (ANR-18-CE38–0010) se propose de croiser les données sur la navigation et sur la valeur du commerce étranger de la France à la veille de la Révolution française pour mieux saisir les dynamiques commerciales à l’œuvre. Pour ce faire, il offre des interfaces d’interrogation et de visualisation des données adaptées à des publics et des intérêts variés.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placés sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est placé sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accéder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.45,\"time\":27000,\"words\":90}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"the-portic-program\"\n      }}>{`The PORTIC Program`}</h2>\n      <p>{`The PORTIC research program (ANR-18-CE38–0010) aims at crossing french navigation and foreign trade data at the eve of the French Revolution, in order to understand ongoing commercial dynamics. To do so, it offers data visualization and querying interfaces adapted to various audiences and interests.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`Learn more about the PORTIC program`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`The contents of this website are published under `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`creative commons license CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`The source code of this website is published under `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0 license`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Access the source code of this website`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"the-portic-program\",\n    level: 2,\n    title: \"The PORTIC Program\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\n\n/**\n * Displays an svg image\n * @param {string} {path}\n * @returns {React.ReactElement} - React component\n */\nfunction SvgChart ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgChart;","import GeographicMapChart from './GeographicMapChart';\n\nexport default GeographicMapChart;","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import TriangleChart from './TriangleChart';\n\nexport default TriangleChart;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\n/**\n * Fetches data and provides it to children (used for tests)\n * @param {string} data\n * @param {function} children\n * @returns {React.ReactElement} - React component\n */\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: str }) => {\n          const extension = dataFilename.split('.').pop();\n          let newData;\n          if (extension === 'csv') {\n            newData = csvParse(str);\n          } else if (extension === 'geojson' || extension === 'json') {\n            newData = str;\n          }\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.975,\"time\":478500,\"words\":1595}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgChart from '../../components/SvgChart';\nimport VegaChart from '../../components/VegaChart';\nimport NetworkGraphChart from '../../components/NetworkGraphChart';\nimport GeographicMapChart from '../../components/GeographicMapChart';\nimport TriangleChart from '../../components/TriangleChart';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\nimport { Step3Objects } from '../../visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <p>{`Test en prod`}</p>\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + données avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h3 {...{\n      \"id\": \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\"\n    }}>{`Fond de carte - test custom layer avec config “coast from Nantes to Bordeaux”`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step3_viz_customs_offices_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname'\n          }\n        }, {\n          type: 'custom',\n          data: visData,\n          renderObjects: Step3Objects\n        }]} projectionTemplate='coast from Nantes to Bordeaux' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider> \n    <h3 {...{\n      \"id\": \"fond-de-carte---test-flows-avec-config-world\"\n    }}>{`Fond de carte - test flows avec config “World”`}</h3>\n    <DataProvider data={'world_1789_23mars2021_level0.json'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'aggregated_flows.json'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'flows',\n          data: visData,\n          size: {\n            field: 'tonnages_cumulés'\n          }\n        }]} projectionTemplate='World' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-france\"\n    }}>{`Fond de carte - config “France”`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'ports_locations_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'admiralty',\n            palette: colorPalettes.admiralties\n          },\n          size: {\n            field: 'customs_region'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='France' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-rotated-poitou\"\n    }}>{`Fond de carte - config “rotated Poitou”`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step1_viz_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'customs_office',\n            palette: colorPalettes.customs_office\n          },\n          size: {\n            field: 'mean_tonnage'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='rotated Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-poitou\"\n    }}>{`Fond de carte - config “Poitou”`}</h3>\n    <p>{`Cartographie des destination des bateaux aillant un port d’attache dans la région, par tonnage cumulé (couleur = amirauté) :`}</p>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels projectionTemplate='Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />\n    <h2 {...{\n      \"id\": \"fond-de-carte-sans-template-pour-la-config\"\n    }}>{`Fond de carte sans template pour la config`}</h2>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeographicMapChart\" />\n    {\n      /* # Tests composant LineChart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data.filter(d => d.region === 'France')}\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 5,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n             annotations={[\n                   {\n                     type: 'span',\n                     start: 1756,\n                     end: 1763,\n                     axis: 'x',\n                     label: 'guerre de sept ans'\n                   },\n                   {\n                     type: 'span',\n                     start: 400000000,\n                     end: 500000000,\n                     axis: 'y',\n                     label: 'période de faste'\n                   }\n                 ]}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de titre\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'Région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de line chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`,\n               fillGaps: true\n             }}\n             color={{\n               field: 'region',\n               title: 'Région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de linechart (minimum de props)\"\n             // width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               // title: 'année',\n             }}\n             y={{\n               field: 'Imports',\n               // title: 'imports',\n               // tickSpan: 100000000,\n               // tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               // title: 'Région'\n             }}\n             // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      # Tests composant BarChart\n      ## Horizontal bar chart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (sans fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             annotations={[\n               {\n                 type: 'span',\n                 start: 1756,\n                 end: 1763,\n                 axis: 'x',\n                 label: 'guerre de sept ans'\n               },\n               {\n                 type: 'span',\n                 start: 400000000,\n                 end: 500000000,\n                 axis: 'y',\n                 label: 'période de faste'\n               }\n             ]}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (grouped, fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped, no fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      ## Vertical bar charts\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'année',\n               // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               // tickSpan: 1000000,\n               //tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             height={200}\n             y={{\n               field: 'year',\n               title: 'année',\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'année',\n               rowHeight: 30,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'année',\n               tickSpan: 10,\n               rowHeight: 50\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'région'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      ## Test triangle \n      <TriangleChart \n       dataFilename=\"part_3_step1_viz_data.csv\" \n       rowHeight={300}\n       totalWidth = {1600}\n       />\n      ## Test courbes de bézier\n      <BezierComponent\n       dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n       cx={300}\n       cy={250}\n       r={210}\n       inPercentage={10}\n       // start={Math.PI / 2}\n       // end={Math.PI * 3 / 2}\n       />\n      # Test bateaux\n      <BoatsIllustration />\n      \n      # Commerce multi-échelle dans la région de La Rochelle\n      \n      Voici un tour d'horizon des modules react préparés pour faciliter le développement :\n      ## Image SVG (avec webpack)\n      On intègre une image  SVG depuis le local (elle sera donc packée par webpack) :\n      \n      ## Image SVG (sans webpack)\n      On intègre ici directement une image à partir de son URL en ligne (depuis le dossier `public`)\n      ##### ! cassé pour le moment\n      // <SvgChart path =\"/svg/ports-region-1789.svg\" />\n      ## Visualisation vega\n      Les visualisations vega ont besoin d'un fichier csv stocké dans le dossier `public/data` et d'une spec vega.\n      <VegaChart \n       data=\"sorties_navires_vers_colonies.csv\" \n       spec={{\n         \"mark\": \"rect\",\n         \"encoding\": {\n           \"x\": {\n             \"field\": \"port_depart\",\n             \"type\": \"nominal\"\n           },\n           \"y\": {\n             \"field\": \"port_destination\",\n             \"type\": \"nominal\"\n           },\n           \"color\": {\n             \"type\": \"quantitative\",\n             \"field\": \"tonnage\",\n             \"aggregate\": \"sum\"\n           }\n           \n         }\n       }}\n      />\n      ## Réseau avec sigma\n      Les visualisations sigma ont besoin d'un fichier gexf stocké dans le dossier `public/data`.\n      Paramètres :\n      * `nodeColor` : attribut pour couleur\n      * `nodeSize` : attribut pour taille\n      * `labelDensity` : densité des labels (float dans [0, 1])\n      \n      <NetworkGraphChart \n       data=\"toflit_aggregate_1789_only_out.gexf\" \n       nodeColor={`admiralty`}\n       nodeSize={`inside_degree`}\n       labelDensity={0.5}\n      />\n      */\n    }\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        {\n              id: \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\",\n              level: 3,\n              title: \"Fond de carte - test custom layer avec config “coast from Nantes to Bordeaux”\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---test-flows-avec-config-world\",\n              level: 3,\n              title: \"Fond de carte - test flows avec config “World”\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-france\",\n              level: 3,\n              title: \"Fond de carte - config “France”\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-rotated-poitou\",\n              level: 3,\n              title: \"Fond de carte - config “rotated Poitou”\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-poitou\",\n              level: 3,\n              title: \"Fond de carte - config “Poitou”\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"fond-de-carte-sans-template-pour-la-config\",\n    level: 2,\n    title: \"Fond de carte sans template pour la config\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nimport './LineChart.scss';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {React.ReactElement} - React component \n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Légende' : 'Legend';\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","import LineChart from './LineChart';\n\nexport default LineChart;","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\n/**\n * Returns a boat hull shape\n * @param {number} width\n * @param {number} height\n * @returns  {React.ReactElement} - React component\n */\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\n/**\n * Returns a boat sail shape\n * @param {number} width\n * @param {number} height\n * @param {number} sailSpeed - period in miliseconds\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\n/**\n * Returns a boat matt shape\n * @param {number} width\n * @param {number} height\n * @param {number} sailSpeed - period in miliseconds\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\n/**\n * Returns a boat shape\n * @param {number} x\n * @param {number} height\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\n/**\n * Returns a bird shape\n * @param {number} boatHeight\n * @param {number} containerHeight\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\n/**\n * Returns a moving boat + optional birds\n * @param {number} containerHeight\n * @param {number} containerWidth\n * @param {boolean} rightToLeft\n * @param {number} startAt - starting point in pixels\n * @param {number} size - factor for defining height relative to container height\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\n/**\n * Returns moving boats\n * @param {number} width\n * @param {number} height\n * @returns  {React.ReactElement} - React component\n */\nconst BoatsIllustration = ({\n  width: inputWidth = 1200,\n  height: inputHeight = 100,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","/**\n * Context providers for the app\n */\nimport React from 'react';\n\n/**\n * Context used for communicating currently displayed visualization\n */\nexport const VisualizationControlContext = React.createContext({\n\n})\n\n/**\n * Context used for datasets values passing\n */\nexport const DatasetsContext = React.createContext({\n\n})\n\nexport const SettingsContext = React.createContext({\n\n})","import { geoPath } from \"d3-geo\";\nimport { generatePalette } from '../../helpers/misc';\nimport { uniq } from 'lodash';\nimport cx from 'classnames';\nimport { useSpring, animated } from 'react-spring'\nimport { useEffect, useState } from \"react\";\nimport ReactTooltip from \"react-tooltip\";\n\n/**\n * Description\n * @param {string} d\n * @param {function} projection\n * @param {function} project\n * @param {object} palette\n * @param {object} layer\n * @param {number} width\n * @param {number} height\n * @returns {React.ReactElement} - React component\n */\nconst GeoPart = ({ \n  d: initialD, \n  projection, \n  project, \n  palette, \n  layer, \n  width, \n  height,\n  animated: isAnimated\n}) => {\n\n  // @todo do this cleanly (removing out of bound objects to improve performance)\n  const boundsAbs = geoPath().bounds(initialD);\n  const [[x1, y1], [x2, y2]] = [projection(boundsAbs[0]), projection(boundsAbs[1])];\n  const [xMin, xMax] = [x1, x2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const [yMin, yMax] = [y1, y2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const outOfBounds = (isNaN(xMin) || isNaN(xMax) || isNaN(yMin) || isNaN(yMax)) ? false : xMin > width || yMin > height || xMax < 0 || yMax < 0;\n\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const currentD = project(initialD);\n\n  const animationProps = useSpring({\n    to: {\n      d: currentD\n    },\n    immediate: !isInited\n  });\n\n  \n  useEffect(() => {\n    ReactTooltip.rebuild();\n  });\n  if (outOfBounds) {\n    return null;\n  }\n  if (!isAnimated) {\n    return (\n      <path\n        title={initialD.properties.shortname}\n        d={currentD}\n        className=\"geopart\"\n        data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n        data-for=\"geo-tooltip\"\n        style={{\n          fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n        }}\n      />\n    )\n  }\n  return (\n    <animated.path\n      title={initialD.properties.shortname}\n      d={animationProps.d}\n      className=\"geopart\"\n      data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n      data-for=\"geo-tooltip\"\n      style={{\n        fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n      }}\n    />\n  )\n  \n}\n\n\n// @TODO : mettre en place une palette de couleurs quantitative \n\nconst ChoroplethLayer = ({ \n  layer, \n  projection, \n  width, \n  height, \n  reverseColors,\n}) => {\n\n  let palette;\n  const project = geoPath().projection(projection);\n\n  if (!layer.data) {\n    console.info(layer);\n    return null;\n  }\n\n  if (layer.data.features && layer.color && layer.color.field) {\n    // colors palette building\n    const colorValues = uniq(layer.data.features.map(datum => datum.properties[layer.color.field]));\n    if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n      palette = layer.color.palette;\n    } else if (layer.color.generatedPalette) {\n      const colors = generatePalette('map', layer.data.features.length);\n      palette = colorValues.reduce((res, key, index) => ({\n        ...res,\n        [key]: colors[index]\n      }), {});\n    }\n  }\n\n  return (\n    <>\n      <g className={cx(\"ChoroplethLayer\", { 'reverse-colors': reverseColors })}>\n        {\n          layer.data.features\n          .filter(d => d.geometry)\n          .map((d, i) => {\n            return (\n              <GeoPart \n                key={d.properties.id || d.properties.name || i} \n                {...{\n                  projection, \n                  project, \n                  palette, \n                  layer, \n                  d, \n                  width, \n                  height, \n                  animated: layer.animated\n                }}\n              />\n            )\n          })\n        }\n      </g>  \n    </>\n  );\n\n}\n\nexport default ChoroplethLayer;","\nimport { useMemo } from 'react';\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\nimport { useSpring, animated, Transition } from 'react-spring'\nimport { useEffect, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\n\n\n/**\n * Returns a point and its label\n * @param {function} projection\n * @param {object} datum\n * @param {object} layer\n * @param {number} opacity\n * @param {function} onGroupMouseEnter\n * @param {function} onGroupMouseLeave\n * @param {boolean} displayLabel\n * @returns {React.ReactElement} - React component \n */\nconst PointGroup = ({\n  projection,\n  datum,\n  layer,\n  opacity,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  displayLabel\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, color, label, rawSize, labelPosition = 'right', labelSize, index } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <>\n      <animated.g\n        className=\"point-group\"\n        transform={transform}\n        style={{\n          zIndex: labelSize,\n          opacity: opacity\n        }}\n        onMouseEnter={() => onGroupMouseEnter(index)}\n        onMouseMove={() => onGroupMouseEnter(index)}\n        onMouseLeave={() => onGroupMouseLeave()}\n        data-for=\"geo-tooltip\"\n        data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n      >\n        <circle\n          cx={0}\n          cy={0}\n          r={size}\n          style={{ fill: color }}\n          className=\"marker\"\n        />\n        {\n          layer.size && layer.size.displayMetric && labelSize > 9 ?\n            <text\n              x={0}\n              y={labelSize * .8 * .33}\n              textAnchor=\"middle\"\n              fontSize={labelSize * .8}\n              fill=\"white\"\n            >\n              {rawSize}\n            </text>\n            : null\n        }\n\n        {\n          label && displayLabel ?\n            <text\n              x={labelPosition === 'right' ? size + 5 : -size - 5}\n              y={size / 2}\n              fill={layer.color && layer.color.labelsColor}\n              textAnchor={labelPosition === 'right' ? 'start' : 'end'}\n              fontSize={labelSize}\n            >\n              {label}\n            </text>\n            : null\n        }\n      </animated.g>\n    </>\n\n  );\n}\n\n/**\n * Returns label group in a stacked layout\n * @param {object} layer\n * @param {object} datum\n * @param {number} thatIndex\n * @param {number} opacity\n * @param {number} stackedRowHeight\n * @param {function} onGroupMouseEnter\n * @param {function} onGroupMouseLeave\n * @param {number} labelFontSize\n * @param {function} projection\n * @returns {React.ReactElement} - React component \n */\nconst StackedLabelGroup = ({\n  layer,\n  datum,\n  thatIndex,\n  opacity,\n  stackedRowHeight,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  labelFontSize,\n  projection\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, label, /*labelPosition = 'right', labelSize, index*/ } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { x2, y2, transformLabel } = useSpring({\n    to: {\n      x2: x - size,\n      y2: y,\n      transformLabel: `translate(${window.innerWidth * 0.01}, ${datum.labelY})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g\n      style={{\n        // zIndex: labelSize,\n        opacity: opacity\n      }}\n      onMouseEnter={() => onGroupMouseEnter(thatIndex)}\n      onMouseMove={() => onGroupMouseEnter(thatIndex)}\n      onMouseLeave={() => onGroupMouseLeave()}\n      data-for=\"geo-tooltip\"\n      data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n    >\n      <animated.g className=\"label-container\" transform={transformLabel}>\n        <text style={{ fontSize: labelFontSize }}>\n          {\n            label\n          }\n        </text>\n      </animated.g>\n      <animated.line\n        x1={labelFontSize * label.length * .5 + window.innerWidth * 0.01}\n        y1={datum.labelY - stackedRowHeight * .2}\n        x2={x2}\n        y2={y2}\n      />\n    </animated.g>\n  )\n}\n\nconst PointsLayer = ({ layer, projection, width, height }) => {\n\n  const [hoveredIndex, setHoveredIndex] = useState(null);\n\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // regroup data by coordinates\n      const coordsMap = {};\n      layer.data.forEach(datum => {\n        // id\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: layer.label ? datum[layer.label.field] : undefined,\n            labelPosition: layer.label ? layer.label.position : undefined,\n            latitude: +datum.latitude,\n            longitude: +datum.longitude,\n            color: layer.color !== undefined ? datum[layer.color.field] : 'default',\n            size: (layer.size !== undefined && layer.size.field !== undefined) ? isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field] : 0\n          }\n        } else if (layer.size !== undefined) {\n          coordsMap[mark].size += (isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field])\n        }\n      })\n\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g.color));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n      }\n\n      // size building\n\n      // compute size (would have been more elegand with a ternary but I did not manage to write it properly)\n      let sizeCoef = width / 300; // default size\n      if (layer.size !== undefined && layer.size.custom !== undefined) {\n        sizeCoef = parseInt(layer.size.custom * width / 100);\n      }\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      // basing the scale on area rather than radius\n      const radiusRange = [3, width * height / 20000];\n      const areaRange = radiusRange.map(r => Math.PI * r * r);\n      const sizeScale = scaleLinear().domain(sizeExtent).range(areaRange) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      const labelSizeScale = scaleLinear().domain(sizeExtent).range([8, width / 30]) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: layer.color !== undefined ? palette[datum.color] : 'grey',\n        size: layer.size !== undefined ? layer.size.custom !== undefined ? sizeCoef : sizeScale(datum.size) : width / 100,\n        rawSize: datum.size,\n        labelSize: layer.size !== undefined ? labelSizeScale(datum.size) : width * height / 30000\n      }))\n      return grouped;\n    }\n  }, [projection, width, layer])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  let visibleMarkers = markerData\n    .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n    .sort((a, b) => {\n      if (a.latitude > b.latitude) {\n        return 1;\n      }\n      return -1;\n    })\n\n  const onGroupMouseEnter = index => {\n    if (hoveredIndex !== index)\n      setHoveredIndex(index);\n  }\n  const onGroupMouseLeave = () => {\n    setTimeout(() => {\n      if (hoveredIndex !== null)\n        setHoveredIndex(null);\n    })\n  }\n  const stackedLabelsTop = height * .1;\n  const stackedLabelsHeight = height * .9;\n  const stackedRowHeight = stackedLabelsHeight / visibleMarkers.length;\n  const maxLabelFontSize = window.innerHeight * 0.02;\n  const labelFontSize = stackedRowHeight < maxLabelFontSize ? stackedRowHeight : maxLabelFontSize;\n  if (layer.stackLabels) {\n    visibleMarkers = visibleMarkers\n      .sort((a, b) => {\n        if (a.latitude > b.latitude) {\n          return -1;\n        }\n        return 1;\n      })\n      .map((d, i) => ({\n        ...d,\n        labelY: stackedRowHeight * i + stackedLabelsTop\n      }))\n  }\n  visibleMarkers = visibleMarkers.map((d, index) => ({ ...d, index }));\n  return (\n    <g className=\"PointsLayer\">\n      {\n        layer.stackLabels ?\n          <g className=\"stacked-labels-container\">\n            <Transition\n              // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n              items={visibleMarkers}\n              from={{ opacity: 0 }}\n              enter={{ opacity: 1 }}\n              leave={{ opacity: 0 }}\n            >\n              {({ opacity }, datum, thatIndex) => (\n                <StackedLabelGroup\n                  key={datum.label}\n                  {...{\n                    projection,\n                    datum,\n                    layer,\n                    opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n                    thatIndex: datum.index,\n                    onGroupMouseEnter,\n                    onGroupMouseLeave,\n                    stackedRowHeight,\n                    labelFontSize,\n                  }}\n                />\n              )\n\n              }\n            </Transition>\n          </g>\n          : null\n      }\n      <Transition\n        // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n        items={visibleMarkers}\n        from={{ opacity: 0 }}\n        enter={{ opacity: 1 }}\n        leave={{ opacity: 0 }}\n      >\n        {({ opacity }, datum, index) => (\n          <PointGroup\n            key={datum.label}\n            {...{\n              projection,\n              datum,\n              layer,\n              opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n              index: datum.index,\n              onGroupMouseEnter,\n              onGroupMouseLeave,\n              displayLabel: !layer.stackLabels\n            }}\n          />\n        )\n\n        }\n      </Transition>\n      {/* {\n        visibleMarkers\n          .map((datum, index) => {\n            return (\n              <PointGroup\n                key={datum.label}\n                {...{ projection, datum, layer }}\n              />\n            )\n          })\n      } */}\n    </g>\n  );\n}\n\nexport default PointsLayer;","\nimport { useMemo, useState, useEffect } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport cx from 'classnames';\nimport { max } from 'd3-array';\nimport { uniq } from 'lodash';\nimport { cartesian2Polar, fixSvgDimension, generatePalette, polarToCartesian } from '../../helpers/misc';\n\nimport { useSpring, animated } from 'react-spring'\n\n/*\nPrincipe : path entre deux point géographiques, dont le stroke peut varier, et on peut avoir la direction avec une fleche \n\nformat des données attendu (json) : \n\nExemple :\n\"flow_id\": \"45.95_-0.9_46.166667_-1.15\", \n\"port_dep\": \"Charente\", \n\"port_dest\": \"La Rochelle\", \n\"latitude_dep\": 45.95, \n\"longitude_dep\": -0.9, \n\"latitude_dest\": 46.166667, \n\"longitude_dest\": -1.15, \n\"nb_flows\": 22, \n\"tonnages_cumulés\": 730}\n\n*/\n\n/**\n * Displays a particular flow\n * @param {string} id\n * @param {boolean} hovered\n * @param {number} xDep\n * @param {number} yDep\n * @param {number} xDest\n * @param {number} yDest\n * @param {number} strokeWidth\n * @param {string} color\n * @param {string} path\n * @param {number} actualXDep\n * @param {number} actualYDep\n * @param {number} actualXDest\n * @param {number} actualYDest\n * @param {number} arrowLength\n * @param {function} onMouseEnter\n * @param {function} onMouseLeave\n * @returns {React.ReactElement} - React component \n */\nconst FlowGroup = ({\n  id,\n  hovered,\n  xDep: inputXDep,\n  yDep: inputYDep,\n  xDest: inputXDest,\n  yDest: inputYDest,\n  strokeWidth: inputStrokeWidth,\n  color = 'black',\n\n  path,\n  actualXDep,\n  actualYDep,\n  actualXDest,\n  actualYDest,\n  arrowLength,\n  onMouseEnter,\n  onMouseLeave,\n  // datum,\n  // layer,\n  // depLabelTextAnchor,\n  // depLabelX,\n  // depLabelY,\n  // destLabelTextAnchor,\n  // destLabelX,\n  // destLabelY,\n  // fontSize,\n}) => {\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  const { d, strokeWidth } = useSpring({\n    to: {\n      xDep: inputXDep,\n      yDep: inputYDep,\n      xDest: inputXDest,\n      yDest: inputYDest,\n      d: path,\n      strokeWidth: fixSvgDimension(inputStrokeWidth),\n      arrowPath: `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`\n    },\n    immediate: !isInited\n  });\n\n  return (\n    <g onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} className={cx(\"flow-group\", { hovered })}>\n      <defs>\n        <marker\n          id={`triangle-${id}`}\n          viewBox={`0 0 ${arrowLength} ${arrowLength}`}\n          refY={arrowLength / 2}\n          orient=\"auto\">\n          <path d={`M 0 0 L ${arrowLength} ${arrowLength / 2} L 0 ${arrowLength} Z`} fill={color} />\n        </marker>\n      </defs>\n      {/* hover placeholder */}\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth * 3}\n        fill=\"none\"\n        stroke={color}\n        opacity={0}\n      />\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth}\n        markerEnd={`url(#triangle-${id})`}\n        fill=\"none\"\n        stroke={color}\n      />\n    </g>\n  )\n}\n\n/**\n * Displays a series of flow and their labels\n * @param {array} layer\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst FlowsLayer = ({\n  layer,\n  projection,\n  width,\n  height,\n  projectionTemplate,\n}) => {\n\n  /**\n    * Data aggregation for viz\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // size building\n      const strokeWidthScale = scaleLinear().domain([\n        0,\n        max(\n          layer.data.map((flow) => {\n            return +flow[layer.size.field];\n          })\n        )\n      ]).range([1, width * height / 20000]);\n\n      const arrowSizeScale = strokeWidthScale.copy().range([0, width * height / 100000]);\n\n      let grouped = layer.data.map(flow => ({ // je ne sais pas si grouped reste le plus adapté\n        ...flow,\n        // color: palette[datum.color],\n        strokeWidth: strokeWidthScale(+flow[layer.size.field]),\n        arrowSize: arrowSizeScale(layer.data.strokeWidth)\n      }))\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g[layer.color.field]));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n        grouped = grouped.map(datum => ({\n          ...datum,\n          color: layer.color !== undefined ? palette[datum[layer.color.field]] : 'grey',\n        }))\n      }\n      // console.log(\"grouped : \", grouped)\n      return grouped\n        .filter(({ latitude_dep, longitude_dep, latitude_dest, longitude_dest }) => latitude_dep && longitude_dep && latitude_dest && longitude_dest && !isNaN(latitude_dep) && !isNaN(longitude_dep) && !isNaN(latitude_dest) && !isNaN(longitude_dest))\n        .map((datum, index) => {\n          const { latitude_dep, longitude_dep, latitude_dest, longitude_dest, strokeWidth, arrowSize, color } = datum;\n          const [xDep, yDep] = projection([+longitude_dep, +latitude_dep]);\n          const [xDest, yDest] = projection([+longitude_dest, +latitude_dest]);\n          // console.log(\"[xDep, yDep] / [xDest, yDest] : \", [xDep, yDep], \" / \", [xDest, yDest]);\n          if (layer.hideOverflowingFlows) {\n            if (xDep < 0 || xDep > width || xDest < 0 || xDest > width\n              || yDep < 0 || yDep > height || yDest < 0 || yDest > height\n            ) {\n              return null;\n            }\n          }\n          const id = `${xDep}-${yDep}-${xDest}-${yDest}`;\n\n          const arrowLength = fixSvgDimension(strokeWidth) * 3;\n\n          const { distance, radians } = cartesian2Polar(xDest - xDep, yDest - yDep);\n          const [relativeXDest, relativeYDest] = polarToCartesian(distance - arrowLength, radians);\n          let actualXDest = xDep + relativeXDest;\n          let actualYDest = yDep + relativeYDest;\n          let actualXDep = xDep;\n          let actualYDep = yDep;\n          let path = `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`;\n\n          let depLabelPosition = actualXDest < actualXDep ? 'right' : 'left';\n          let destLabelPosition = actualXDest > actualXDep ? 'right' : 'left';\n          if (actualXDest < width * .26) {\n            destLabelPosition = 'right';\n          }\n          if (actualXDest > width * .75) {\n            destLabelPosition = 'left';\n          }\n\n          const fontSize = width * 0.02;\n\n          const depLabelTextAnchor = depLabelPosition === 'right' ? 'start' : 'end';\n          const depLabelX = depLabelPosition === 'right' ? 10 : -10\n          const depLabelY = fontSize * .3\n\n          const destLabelTextAnchor = destLabelPosition === 'right' ? 'start' : 'end'\n          const destLabelX = destLabelPosition === 'right' ? 10 : -10\n          const destLabelY = fontSize * .3;\n\n          return {\n            id,\n            arrowSize,\n            xDep,\n            yDep,\n            xDest,\n            yDest,\n            strokeWidth,\n            datum,\n            layer,\n            width,\n            color,\n            height,\n            projectionTemplate,\n\n            fontSize,\n            path,\n            actualXDep,\n            actualYDep,\n            actualXDest,\n            actualYDest,\n            arrowLength,\n\n            depLabelTextAnchor,\n            depLabelX,\n            depLabelY,\n\n            destLabelTextAnchor,\n            destLabelX,\n            destLabelY,\n          }\n        })\n        .filter(d => d)\n    }\n    return []\n  }, [projection, width, layer, height])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const labels = useMemo(() => {\n    let newLabels = markerData.reduce((res, flow) => {\n      const {\n        id,\n        xDep,\n        yDep,\n        xDest,\n        yDest,\n        strokeWidth,\n  \n        depLabelX,\n        depLabelY,\n        depLabelTextAnchor,\n  \n        destLabelX,\n        destLabelY,\n        destLabelTextAnchor,\n        fontSize,\n        datum\n      } = flow;\n      const depId = datum[layer.label.fields[0]] // `${actualXDep}-${actualYDep}`;\n      if (res[depId]) {\n        // update position if we find a larger flow for this label\n        if (res[depId].largerStrokeWidth > strokeWidth) {\n          res[depId] = {\n            ...res[depId],\n            largerStrokeWidth: strokeWidth,\n            x: xDep + depLabelX,\n            y: yDep + depLabelY,\n            textAnchor: depLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[depId].flows = [...res[depId].flows, id]\n        // create a new entry for label\n      } else {\n        res[depId] = {\n          label: datum[layer.label.fields[0]],\n          largerStrokeWidth: strokeWidth,\n          x: xDep + depLabelX,\n          y: yDep + depLabelY,\n          textAnchor: depLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n  \n      const destId = datum[layer.label.fields[1]] // `${actualXDest}-${actualYDest}`;\n      if (res[destId]) {\n        // update position if we find a larger flow for this label\n        if (res[destId].largerStrokeWidth > strokeWidth) {\n          res[destId] = {\n            ...res[destId],\n            largerStrokeWidth: strokeWidth,\n            x: xDest + destLabelX,\n            y: yDest + destLabelY,\n            textAnchor: destLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[destId].flows = [...res[destId].flows, id]\n        // create a new entry for label\n      } else {\n        res[destId] = {\n          label: datum[layer.label.fields[1]],\n          largerStrokeWidth: strokeWidth,\n          x: xDest + destLabelX,\n          y: yDest + destLabelY,\n          textAnchor: destLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n      return res;\n    }, {})\n    newLabels = Object.entries(newLabels).map(([id, label]) => ({\n      id,\n      ...label,\n      width: label.label.length * label.fontSize * 0.5,\n      actualX: label.textAnchor === 'start' ? label.x : label.x - (label.label.length * label.fontSize * 0.5),\n      height: label.fontSize,\n    }))\n    newLabels = newLabels.sort((a, b) => {\n      if (a.y > b.y) {\n        return 1;\n      }\n      return -1;\n    })\n    // resolve labels collisions\n    for (let i = 0 ; i < newLabels.length ; i++) {\n      for (let j = i + 1 ; j < newLabels.length ; j++) {\n        const label1 = newLabels[i];\n        const label2 = newLabels[j];\n\n        const minAx = label1.x;\n        const minAy = label1.y - label1.height;\n        const maxAx = label1.x + label1.width;\n        const maxAy = label1.y;\n\n        const minBx = label2.x;\n        const minBy = label2.y - label2.height;\n        const maxBx = label2.x + label2.width;\n        const maxBy = label2.y;\n\n        const aLeftOfB = maxAx < minBx;\n        const aRightOfB = minAx > maxBx;\n        const aAboveB = minAy > maxBy;\n        const aBelowB = maxAy < minBy;\n\n        if (!( aLeftOfB || aRightOfB || aAboveB || aBelowB )) {\n          if (!aAboveB || aBelowB) {\n            const distanceY = Math.abs(label1.y - (label2.y - label2.height));\n            label1.y -= distanceY / 2 ;\n            label2.y += distanceY / 2 ;\n          }\n          // if (!aLeftOfB || aRightOfB) {\n          //   const distanceX = Math.abs(label1.x - (label2.x + label2.width));\n          //   label1.x -= distanceX / 2 ;\n          //   label2.x += distanceX / 2 ;\n          // }\n        }\n      }\n    }\n    newLabels = newLabels.sort((a, b) => {\n      if (a.largerStrokeWidth > b.largerStrokeWidth) {\n        return -1;\n      }\n      return 1;\n    })\n    return newLabels;\n  }, [markerData])\n  \n\n  const [hoverIds, setHoverIds] = useState(undefined);\n  return (\n    <g className=\"FlowsLayer\" >\n      {\n        markerData\n          .map((data, index) => {\n\n            const {\n              id,\n              arrowSize,\n              xDep,\n              yDep,\n              xDest,\n              yDest,\n              strokeWidth,\n              datum,\n              layer,\n              width,\n              color,\n              height,\n              projectionTemplate,\n\n              fontSize,\n              path,\n              actualXDep,\n              actualYDep,\n              actualXDest,\n              actualYDest,\n              arrowLength,\n              depLabelTextAnchor,\n              depLabelX,\n              depLabelY,\n              destLabelTextAnchor,\n              destLabelX,\n              destLabelY,\n            } = data;\n\n            const onMouseEnter = () => {\n              setHoverIds([id]);\n            }\n            const onMouseLeave = () => {\n              setHoverIds(undefined);\n            }\n            const hovered = hoverIds && hoverIds.includes(id);\n            return (\n              <FlowGroup\n                key={index}\n                {\n                ...{\n                  hovered,\n                  id,\n                  arrowSize,\n                  xDep,\n                  yDep,\n                  xDest,\n                  yDest,\n                  strokeWidth,\n                  datum,\n                  layer,\n                  width,\n                  color,\n                  height,\n                  projectionTemplate,\n\n                  fontSize,\n                  path,\n                  actualXDep,\n                  actualYDep,\n                  actualXDest,\n                  actualYDest,\n                  arrowLength,\n                  depLabelTextAnchor,\n                  depLabelX,\n                  depLabelY,\n                  destLabelTextAnchor,\n                  destLabelX,\n                  destLabelY,\n\n                  onMouseEnter,\n                  onMouseLeave,\n                }\n                }\n              />\n            );\n          })\n      }\n      {\n        labels.map((thatLabel, index) => {\n          const {\n            id,\n            label,\n            textAnchor,\n            x,\n            // actualX,\n            y,\n            fontSize,\n            flows,\n          } = thatLabel;\n          const isVisible = hoverIds ? hoverIds.find(hoveredId => flows.includes(hoveredId)) : true;\n          const onMouseEnter = () => {\n            setHoverIds(flows);\n          }\n          const onMouseLeave = () => {\n            setHoverIds(undefined);\n          }\n          return (\n            <g\n              id={id}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            >\n              {/* <rect\n                x={actualX}\n                y={y - height}\n                width={width}\n                height={height}\n                fill=\"pink\"\n              /> */}\n              <text\n                id={id}\n                className={cx(\"label\", {'is-visible': isVisible})}\n                textAnchor={textAnchor}\n                x={x}\n                y={y}\n                fontSize={fontSize}\n              >\n                {label}\n              </text>\n            </g>\n          )\n        })\n      }\n    </g>\n  );\n}\n\nexport default FlowsLayer;","\n\n\n/**\n * Allows to display custom objects on the map\n * @param {object} layer\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst CustomObjectLayer = ({ \n  layer, \n  projection, \n  width, \n  height, \n  projectionTemplate \n}) => {\n    return (\n        <g className=\"CustomObjectsLayer\">\n          {\n            typeof layer.renderObjects === 'function' ?\n                layer.renderObjects({data: layer.data, projection, width, height, projectionTemplate})\n            :\n            layer.data\n              .map((datum, index) => {\n                return <g key={index}>{layer.renderObject({ datum, projection, width, height, projectionTemplate })}</g>\n              })\n          }\n        </g>\n      );\n}\n\nexport default CustomObjectLayer;","import { useEffect, useState } from \"react\"\n\nconst Button = ({\n    children,\n    onMouseDown,\n    ...props\n  }) => {\n    const [isMouseDown, setState] = useState(false)\n  \n    useEffect(() => {\n      let interval\n      if (isMouseDown) {\n        console.log(\"setInterval\")\n        interval = setInterval(onMouseDown, 100)\n      }\n      return () => {\n        console.log(\"clearInterval\")\n        clearInterval(interval)\n      }\n    }, [isMouseDown, onMouseDown])\n  \n    return <button\n      {...props}\n      onMouseDown={() => {\n        setState(true)\n      }}\n      onMouseUp={() => {\n        setState(false)\n      }}\n      style={{ background: isMouseDown ? 'red' : undefined }}\n    >\n      {children}\n    </button>\n  }\n\n  export default Button ;","import { useState, useEffect } from \"react\";\n\n\n/**\n * A plain input for debug mode\n * @param {string} value\n * @param {function} onBlur\n * @param {object} props\n * @returns {React.ReactElement} - React component \n */\nconst Input = ({\n  value: inputValue,\n  onBlur,\n  ...props\n}) => {\n  const [value, setValue] = useState(inputValue)\n  useEffect(() => {\n    setValue(inputValue)\n  }, [inputValue])\n\n  return <input\n    value={value}\n    onChange={(e) => {\n      setValue(e.target.value)\n    }}\n    onBlur={(e) => {\n      onBlur(e.target.value)\n    }}\n  />\n}\n\nexport default Input;","import { useContext } from 'react';\n\nimport { uniq } from \"lodash-es\";\nimport { SettingsContext } from \"../../helpers/contexts\";\nimport { generatePalette } from '../../helpers/misc';\n\n\n/**\n * Centralized map legend\n * @param {array<object>} layers\n * @param {string} position - used as css suffix ('bottom', 'bottom left', ...)\n * @param {function} layerFilter - allows to hide some layers from legend\n * @returns {React.ReactElement} - React component \n */\nconst Legend = ({\n  layers,\n  position,\n  layerFilter\n}) => {\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Légende' : 'Legend';\n  return (\n    <div className={`Legend ${typeof position === 'string' ? position : ''}`}>\n      <h5 className=\"legend-main-title\">{legendTitle}</h5>\n      {\n        layers\n        .filter(l => {\n          if (typeof layerFilter === 'function') {\n            return layerFilter(l);\n          }\n          return true;\n        })\n        .map((layer, id) => {\n          let hasSize;\n          let hasColors;\n          let colorModalities;\n          if (layer.size && layer.size.field) {\n            hasSize = true;\n          }\n          if (layer.color && layer.color.field) {\n            hasColors = true;\n            const colorValues = uniq(layer.data.map(datum => datum[layer.color.field]))\n            // @todo refactor the following with PointsLayer as an util\n            let palette;\n            // colors palette building\n            if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n              palette = layer.color.palette;\n            } else {\n              const colors = generatePalette('map', colorValues.length);\n              palette = colorValues.reduce((res, key, index) => ({\n                ...res,\n                [key]: colors[index]\n              }), {});\n            }\n            colorModalities = Object.entries(palette);\n          }\n          return (\n            <>\n              {\n                hasSize ?\n                <div key={id} className=\"size-legend-container\">\n                  {/* <h6 className=\"legend-title\">Taille des cercles</h6> */}\n                  <div className=\"size-legend-item\">\n                  <span className=\"size-icon-container\">\n                    <span />\n                    <span />\n                  </span>\n                  <span className=\"label\">\n                  {layer.size.title || layer.size.field}\n                  </span>\n                  </div>\n                </div>\n                : null\n              }\n              {\n                hasColors ?\n                <div key={id + 'b'} className=\"color-legend-container\">\n                  <h6 className=\"legend-title\">{layer.color.title || layer.color.field}</h6>\n                  <ul className=\"modalities-list\">\n                    {\n                      colorModalities.map(([modality, color], modalityIndex) => (\n                        <li key={modalityIndex}>\n                          <span style={{background: color}} className=\"color-marker\" />\n                          <span className=\"label\">{modality}</span>\n                        </li>\n                      ))\n                    }\n                  </ul>\n                </div>\n                : null\n              }\n            </>\n          )\n        })\n      }\n    </div>\n  )\n}\n\nexport default Legend;","/* DOCUMENTATION : API de ce GéoComponent\n\n  Principe :\n    Composants réutilisable pour toutes les cartes utilisés sur les sites PORTIC\n    cartographie en SVG\n    -> permet de faire des cartes choroplèthes, de représenter des ports, des flux de navires, ...\n\n  Paramètres : \n    * width : largeur de la carte (par défaut à 1500 px)\n    * height : hauteur de la carte (par défaut à 1500 px)\n\n    * layers : différentes couches de la carte ('choropleth', 'points', 'flows', 'custom'), à chaque layer il faut donner un fichier de données (stocké dans public/data) pour construire le objets qui le constituent, les couleurs, tailles, labels de ces objets sont paramètrables \n        si layer 'custom' choisi, il faut passer au layer une fonction d'affichage des données :\n        - renderObject : donner un objet de donnée en paramètre, la fonction s'occupe de construire sa représentation SVG et de la positionner individuellement sur la carte\n        - renderObjects : donner un dataset, la fonction s'occupe de construire une représentation SVG de l'ensemble des objets, et de gérer leurs positionnement sur la carte (souvent adapté quand le positionnement n'est pas géographique, qu'on a besoin de gérer les espacements entre objets ...)\n\n    * projectionTemplate : configuration de carte utilisée fréquemment ('France', 'coast from Nantes to Bordeaux', 'Poitou', 'rotated Poitou')\n    * projectionConfig: configuration de carte customisée (ce paramètre prime sur projectionTemplate si les 2 sont données en même temps)\n\n    * debug : permet d'ajuster manuellement la configuration de la carte quand true (les paramètres de zoom, les coordonnées du centre, la rotation et les translations sont ajustables)\n    \n  @TODO : documenter ce component de manière standardisée\n  */\n\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport { geoEqualEarth } from \"d3-geo\";\nimport ChoroplethLayer from './ChoroplethLayer';\nimport PointsLayer from './PointsLayer';\nimport FlowsLayer from './FlowsLayer';\nimport CustomObjectLayer from './CustomObjectLayer';\n// import TriangleChart from '../TriangleChart/TriangleChart';\nimport Button from './Button';\nimport Input from './Input';\nimport Legend from './Legend';\n\nimport './GeographicMapChart.scss'\nimport { fixSvgDimension } from '../../helpers/misc';\n\n\n/**\n * Displays a multi-layers map\n * @param {number} width\n * @param {number} height\n * @param {string} title\n * @param {array} layers\n * @param {string} projectionTemplate\n * @param {object} projectionConfig\n * @param {boolean} debug\n * @param {string} withLegend - can directly take legend position\n * @param {function} legendLayerFilter\n * @returns {React.ReactElement} - React component \n */\nconst GeographicMapChart = ({\n  width: inputWidth = 1500,\n  height: inputHeight = 1500,\n  title,\n  layers = [],\n  projectionTemplate: initialProjectionTemplate,\n  projectionConfig: inputProjectionConfig, // customeconfig that will overwrite a template (optional argument) \n  debug = false, // @todo : à réparer\n  withLegend,\n  legendLayerFilter\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur région\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n  const [projectionTemplate, setProjectionTemplate] = useState(initialProjectionTemplate)\n\n  // trick for nice animations\n  useEffect(() => {\n    // setTimeout(() => {\n      setProjectionTemplate(initialProjectionTemplate);\n    // })\n  }, [initialProjectionTemplate])\n\n\n  // define a default map Config\n  const defaultProjectionConfig = useMemo(() => {\n    return {\n      rotationDegree: 0,\n      centerX: 2.4486203,\n      centerY: 46.8576176,\n      scale: height * 5\n    };\n  }, [height]) // repsonsive : se fait en fonction de la height de l'écran\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => { // def les bonnes valeurs pour la config de la projection // enregistrer dans le state // les appliquer dans la projection\n\n    let projectionConfig = { ...defaultProjectionConfig } // casser la référence à defaultProj pour respecter principe react qu'on ne modifie pas un objet reçu en argument\n\n    let projection = geoEqualEarth()\n\n    switch (projectionTemplate) {\n      case 'World':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * .5,\n          centerX: -1,\n          centerY:  15,\n          // translationX: width * 0.4,\n          // translationY: height * 0.28\n        }\n        break;\n      case 'coast from Nantes to Bordeaux':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 24,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.28\n        }\n        break;\n      case 'Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 30,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'Poitou zoomed':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 23,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'rotated Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          rotationDegree: 58,\n          scale: height * 32,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.29,\n          translationY: height * 0.25\n        }\n        break;\n      case 'France':\n      default: // as France config \n        // console.log('projection config in dry version', projectionConfig);\n        // console.log(`we are taking the config as specified in config parameters ===> if not specified, the view should correspond to France`);\n        break;\n    }\n\n    if (inputProjectionConfig !== undefined) {\n      projectionConfig = {\n        ...projectionConfig,\n        ...inputProjectionConfig\n      }\n    }\n\n    // update the config\n    setScale(projectionConfig.scale)\n\n    setRotation(projectionConfig.rotationDegree)\n\n    setCenterX(projectionConfig.centerX)\n    setCenterY(projectionConfig.centerY)\n\n    if (projectionConfig.translationX !== undefined) {\n      setTranslationX(projectionConfig.translationX)\n      setTranslationY(projectionConfig.translationY)\n    }\n    else {\n      projectionConfig.translationX = width / 2;\n      projectionConfig.translationY = height / 2;\n      setTranslationX(width / 2)\n      setTranslationY(height / 2)\n    }\n\n    projection\n      .scale(projectionConfig.scale)\n\n    projection.center([projectionConfig.centerX, projectionConfig.centerY])\n\n    if (projectionConfig.rotationDegree) {\n      projection.angle(projectionConfig.rotationDegree)\n    }\n\n    projection.translate([projectionConfig.translationX, projectionConfig.translationY])\n\n    return projection;\n  }, [width, height, defaultProjectionConfig, inputProjectionConfig, projectionTemplate]) \n\n\n\n  // const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n  return (\n    <div className=\"GeographicMapChartWrapper\">\n\n      {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div className=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg className=\"GeographicMapChart\" width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n\n        {\n          layers.map((layer, layerIndex) => {\n\n            switch (layer.type) {\n              case 'choropleth':\n                return <ChoroplethLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  reverseColors={layer.reverseColors}\n                />\n\n              case 'points':\n                return <PointsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'flows': \n                return <FlowsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  projectionTemplate={projectionTemplate}\n                />\n\n              case 'custom':\n                return <CustomObjectLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  projectionTemplate={projectionTemplate}\n                  width={width}\n                  height={height}\n                />\n\n              default:\n                return <g key={layerIndex}><text>Unsupported layer type</text></g>\n            }\n          })\n        }\n        {/* <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n        <rect x=\"58%\" y=\"78%\" width={width * 0.4} height={height * 0.2} rx=\"15\" ry=\"15\" fill={'white'} opacity={0.5} /> */}\n      </svg>\n      {\n        withLegend ?\n        <Legend layerFilter={legendLayerFilter} layers={layers} position={withLegend} />\n        : null\n      }\n      <ReactTooltip id=\"geo-tooltip\" />\n    </div>\n  )\n}\n\nexport default GeographicMapChart;","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  // const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      // const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      // setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number',\n    autoSort: yAutoSort = false\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + xExtent[1] % xTickSpan;\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  const xAxisValues = xTickSpan ? range(xDomain[0], xDomain[xDomain.length - 1], xTickSpan) : xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  \n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Légende' : 'Legend';\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 15} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = fixSvgDimension(height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom);\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={fixSvgDimension(xScale(end) - xScale(start))}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={fixSvgDimension(thatX2 - thatX1)}\n                        y={yScale(start)}\n                        height={fixSvgDimension(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          if (!yAutoSort) {\n                            return 0;\n                          }\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={fixSvgDimension(bandWidth)}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={fixSvgDimension(thatHeight)}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useMemo, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns  {React.ReactElement} - React component\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width: initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n\n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ? headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ? legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort: sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    autoSort = false,\n    ascending: sortYAscending = true,\n    type: sortYType,\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]))\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n    colorModalities = Object.entries(colorPalette).map(([id]) => id)\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixSvgDimension(fixedRowHeight || vizHeight / bandsNb);\n\n  const groups = useMemo(() => \n    Object.entries(groupBy(data, d => d[y.field]))\n    // sort groups\n    .sort((a, b) => {\n      if (!autoSort) {\n        return 0;\n      }\n      const multiplier = sortYAscending ? 1 : -1;\n      if (sortYField === y.field) {\n        const aVal = sortYType === 'number' ? +a[0] : a[0];\n        const bVal = sortYType === 'number' ? +b[0] : b[0];\n        if (aVal < bVal) {\n          return -1 * multiplier;\n        }\n        return 1 * multiplier;\n      }\n      const aVal = sortYType === 'number' ?\n        +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n        : a[1][sortYField];\n      const bVal = sortYType === 'number' ?\n        +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n        : b[1][sortYField];\n      if (aVal < bVal) {\n        return -1 * multiplier;\n      }\n      return 1 * multiplier;\n    })\n    // sort items\n    .map(([yModality, items]) => [\n      yModality,\n      items\n      .sort((a, b) => {\n        if (!autoSort) {\n          // sort in the order of colorpalette\n          if (colorModalities.indexOf(a[color.field]) > colorModalities.indexOf(b[color.field])) {\n            return 1;\n          }\n          return -1;\n        }\n        const multiplier = sortXAscending ? 1 : -1;\n        const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n        const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n        if (aVal > +bVal) {\n          return -1 * multiplier;\n        }\n        return 1 * multiplier;\n      })\n    ])\n  , [data, y, autoSort, sortYAscending, sortYField, sortYType, sortXAscending, sortXField, sortXType, color, colorModalities]);\n\n  const xDomain = initialXDomain || layout === 'stack' ?\n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) =>\n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n    )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n  let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n  const xScale = scaleLinear().domain(xDomain).range([0, width - margins.left - margins.right]).nice();\n  const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + xDomain[1] % xTickSpan;\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = (() => {\n    return lang === 'fr' ? 'Légende' : 'Legend';\n  })();\n  return (\n    <>\n      <figure style={{ width: initialWidth, height: finalHeight }} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={valueIndex}\n                    transform={`translate(${margins.left + xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                  .map(([yModality, items], groupIndex) => {\n                    let stackDisplaceX = margins.left;\n                    return (\n                      <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                        <foreignObject\n                          x={0}\n                          y={layout === 'stack' ? bandHeight / 4 : (bandHeight * items.length) / 2 /* + bandHeight * (items.length / 2)*/}\n                          width={margins.left}\n                          height={rowHeight * 2}\n                        >\n                          <div className=\"vertical-bar-label\">\n                            <div>{typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}</div>\n                          </div>\n                        </foreignObject>\n                        {/* <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                          {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                        </text> */}\n                        {\n                          items\n                            .map((item, itemIndex) => {\n\n                              const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                              const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) : xScale(item[x.field]);\n                              const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                              if (layout === 'stack') {\n                                stackDisplaceX += thatWidth;\n                              }\n                              const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                              return (\n                                <>\n                                  {\n                                    +item[x.field] > 0 ?\n                                      <rect key={itemIndex}\n                                        fill={thatColor}\n                                        width={fixSvgDimension(thatWidth)}\n                                        x={thatX}\n                                        y={thatY}\n                                        height={fixSvgDimension(bandHeight - 1)}\n                                        data-for=\"bar-tooltip\"\n                                        data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                      />\n                                      : null\n                                  }\n                                </>\n                              )\n                            })\n                        }\n                      </g>\n                    );\n                  })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color], modalityIndex) => (\n                        <li\n                          key={modalityIndex}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\nimport './BarChart.scss';\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {React.ReactElement} - React component\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","var map = {\n\t\"./en/a-propos.mdx\": [\n\t\t226\n\t],\n\t\"./en/footer.mdx\": [\n\t\t231\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t217\n\t],\n\t\"./en/metadata\": [\n\t\t341,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t341,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t220\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t656,\n\t\t5\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t657,\n\t\t6\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t658,\n\t\t7\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t659,\n\t\t8\n\t],\n\t\"./en/part-2.mdx\": [\n\t\t222\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t224\n\t],\n\t\"./en/references.mdx\": [\n\t\t228\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t660,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t229\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t225\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t230\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t216\n\t],\n\t\"./fr/metadata\": [\n\t\t342,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t342,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t219\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t221\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t223\n\t],\n\t\"./fr/references.mdx\": [\n\t\t227\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t661,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t232\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 649;\nmodule.exports = webpackAsyncContext;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.085,\"time\":5100,\"words\":17}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, Silvia, et al. Commerce multi-échelles autour du port de La Rochelle au XVIIIe siècle. 2021, `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a>{`.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.275,\"time\":16500,\"words\":55}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`MARZAGALLI, Silvia, ASSELIN, Cécile, BOUJU, Alain, CHARLES, Loïc, DAUDIN, Guillaume, GEOFFROY, Géraldine, GIRARD, Paul, GOURLET, Pauline, MAZOYER, Béatrice, de MOURAT, Robin, OOGHE-TABANOU, Benjamin, PLIQUE, Guillaume, PLUMEJEAUD, Christine, POURCHASSE, Pierrick, SAUZEAU, Thierry, THÉRO, Héloïse et ZOFFOLI, Maxime, 2021. Commerce multi-échelles autour du port de La Rochelle au XVIIIe siècle. `}{`[en ligne]`}{`. Octobre 2021. Disponible à l’adresse : `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a></p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.15,\"time\":9000,\"words\":30}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, S., Asselin, C., Bouju, A., Charles, L., Daudin, G., Geoffroy, G., … Zoffoli, M. (2021). Commerce multi-échelles autour du port de La Rochelle au XVIIIe siècle. Repéré à `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a></p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <a href=\"https://doi.org/10.5281/zenodo.5717883\" target=\"blank\">10.5281/zenodo.5717883</a>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","/* eslint import/no-webpack-loader-syntax: 0 */\nimport { useState, useRef, useEffect } from 'react';\nimport cx from 'classnames';\n// import copy from 'copy-to-clipboard';\n\nimport FrMla from '!babel-loader!mdx-loader!./mla-fr.mdx';\nimport FrIso690 from '!babel-loader!mdx-loader!./iso-fr.mdx';\nimport FrApa from '!babel-loader!mdx-loader!./apa-fr.mdx';\nimport Doi from '!babel-loader!mdx-loader!./doi.mdx';\n\nimport './CitationWidget.scss';\n\n\nconst CONTENTS = {\n  fr: {\n    'MLA': FrMla,\n    'ISO 690': FrIso690,\n    'APA': FrApa,\n    'DOI': Doi\n  },\n  en: {\n    'MLA': FrMla,\n    'DOI': Doi\n  }\n}\n\n\n/**\n * Description\n * @param {string} lang\n * @returns {React.ReactElement} - React component\n */\nconst CitationWidget = ({\n  lang = 'fr',\n}) => {\n  const blockquoteRef = useRef(null);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  // const [copyClicked, setCopyClicked] = useState(false);\n  const [currentStyle, setCurrentStyle] = useState(null);\n  useEffect(() => {\n    if (lang === 'fr' || lang === 'en') {\n      setCurrentStyle(Object.keys(CONTENTS[lang])[0]);\n    }\n  }, [lang])\n\n  const Contents = currentStyle ? CONTENTS[lang][currentStyle] : undefined;\n\n  const messages = {\n    title: {\n      fr: 'Citer cette publication',\n      en: 'Cite this publication',\n    },\n    copyCitation: {\n      fr: 'copier',\n      en: 'copy'\n    },\n    citationCopied: {\n      fr: 'copié dans le presse-papier !',\n      en: 'copied in the clipboard !'\n    }\n  }\n\n  // const handleCopyClick = (e) => {\n  //   e.stopPropagation();\n  //   setCopyClicked(true);\n  //   const contents = blockquoteRef.current.innerHTML;\n  //   copy(contents, { format: 'text/html' });\n  //   // copy(blockquoteRef.current.innerText);\n  //   setTimeout(() => setCopyClicked(false), 5000);\n  // }\n\n  if (!['fr', 'en'].includes(lang)) {\n    return null;\n  }\n\n  return (\n    <div className={cx(\"CitationWidget\", { 'is-collapsed': isCollapsed })}>\n      <button\n        className={cx(\"collapse-toggler\", { 'is-active': !isCollapsed })}\n        onClick={() => setIsCollapsed(!isCollapsed)}\n      >\n        {messages.title[lang]}\n      </button>\n      <div className={cx('collapsible-contents')}>\n        <blockquote ref={blockquoteRef}>\n          {currentStyle ? <Contents /> : null}\n        </blockquote>\n        <div className=\"widget-footer\">\n          {\n            Object.entries(CONTENTS[lang]).length > 1 ?\n              <ul className=\"styles-list\">\n                {\n                  lang && currentStyle ?\n                    Object.entries(CONTENTS[lang])\n                      .map(([id, Contents]) => (\n                        <li onClick={() => setCurrentStyle(id)} key={id} className={cx('list-item', { 'is-active': currentStyle === id })}>\n                          <span>{id}</span>\n                        </li>\n                      ))\n                    : null\n                }\n              </ul>\n              : null\n          }\n          {/* disabled: copy on click (gadget) */}\n          {/* <div className=\"copy-link-container\">\n            <span onClick={handleCopyClick}>{copyClicked ? messages.citationCopied[lang] : messages.copyCitation[lang]}</span>\n          </div> */}\n        </div>\n\n      </div>\n    </div>\n  )\n}\n\nexport default CitationWidget;","import CitationWidget from './CitationWidget';\n\nexport default CitationWidget;","const Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore été développée</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport { extent, max } from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\n/**\n * Improve the display of numbers\n * @param {string|number} str - the number to prettify\n * @returns {string}\n */\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n\n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ' ' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\n/**\n * Displays a double diagram displaying a histogram and a linechart, with optional additional annotations\n * @param {array} data\n * @param {string} absoluteField\n * @param {string} shareField\n * @param {string} herfindhalField\n * @param {number} width\n * @param {number} height\n * @param {string} axisLeftTitle\n * @param {string} axisRightTitle\n * @param {number} startYear\n * @param {number} endYear\n * @param {boolean} fillGaps - whether to display a line between two datapoints distant by more than one year\n * @param {function} barTooltipFn\n * @param {string} cityName\n * @param {array<number>} highlightYears\n * @param {string} title\n * @param {object} colorScaleMessages\n * @param {array<object>} annotations - in the form of {startYear: [int], endYear: [int], label: [string], row: [int], labelPosition: [string in ['left', 'right']]}\n * @param {object} margins - in the form {'left': [number],'right': [number],'top': [number],'bottom': [number]}\n * @returns {React.ReactElement} - React component\n */\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n\n  }, [wholeHeight])\n\n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n    .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[shareField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n\n  const { values: rightYAxisValues } = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  let { values: leftYAxisValue } = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  if (yShareScale.domain()[1] - yShareScale.domain()[0] <= 5) {\n    leftYAxisValue = axisPropsFromTickScale(yShareScale, 5).values;\n  }\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", { 'has-highlights': highlightYears !== undefined })}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n              <div className=\"color-scale-container\">\n                <div className=\"color-scale-detail\">\n                  <div\n                    className=\"bar\"\n                    style={{\n                      background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                    }}\n                  />\n                  <div className=\"labels\">\n                    <span>{colorScaleMessages.maximum}</span>\n                    {/* <span>{colorScaleMessages.title}</span> */}\n                    <span>{colorScaleMessages.minimum}</span>\n                  </div>\n                </div>\n              </div>\n              : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value / 1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n              .map((year, i) => {\n                const x = xBand(year) + xBand.bandwidth() / 2;\n                const y = height - margins.bottom;\n                return (\n                  <g\n                    key={i}\n                    className=\"axis-group\"\n                    transform={`translate(${x}, ${y})`}\n                  >\n                    <line\n                      x1={0}\n                      x2={0}\n                      y1={0}\n                      y2={margins.bottom / 6}\n                      stroke=\"grey\"\n                    />\n                    <g\n                      transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                    >\n                      <text fill=\"grey\">\n                        {year}\n                      </text>\n                    </g>\n                  </g>\n                )\n              })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    <rect\n                      x={xBand(startYear)}\n                      width={xBand(endYear) - xBand(startYear)}\n                      height={fixSvgDimension(height - margins.top - margins.bottom)}\n                      y={margins.top}\n                      fill=\"url(#diagonalHatch)\"\n                      opacity={.4}\n                    />\n                    <line\n                      x1={xBand(startYear)}\n                      x2={xBand(startYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <line\n                      x1={xBand(endYear)}\n                      x2={xBand(endYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={fixSvgDimension(yShareScale(0) - yShareScale(d[shareField]))}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ?\n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] || 0).toFixed(2))\n                      .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] || 0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', { 'is-highlighted': highlightYears && highlightYears.includes(+d.year) })}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {/* data points circles */\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .filter(datum => +datum[absoluteField])\n              .map((datum, index) => {\n                \n                const x = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const y = yAbsoluteScale(+datum[absoluteField]);\n                return (\n                  <>\n                    <circle\n                      key={index}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: width * 0.005\n                      }\n                      }\n                      fill={'transparent'}\n                      data-tip={`${datum.year} : export de <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois.`}\n                      data-for={cityName}\n                      data-class=\"bar-tooltip\"\n                      data-html={true}\n                    />\n                    <circle\n                      key={index + 'a'}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: 1.5\n                      }\n                      }\n                      fill={colorsPalettes.generic.accent1}\n                    />\n                  </>\n                )\n              })\n          }\n          {\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .map((datum, index) => {\n                const next = data[index + 1];\n                if (index === data.length - 1 || fillGaps ? false : +next.year !== +datum.year + 1) {\n                  return null;\n                }\n                if (!next) {\n                  return null;\n                }\n                const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const x2 = xBand(+next.year) + xBand.bandwidth() / 2;\n                const y1 = yAbsoluteScale(+datum[absoluteField]);\n                const y2 = yAbsoluteScale(+next[absoluteField]);\n                if (!+datum[absoluteField] || !+next[absoluteField]) {\n                  return null;\n                }\n                const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n                return (\n                  <line\n                    key={datum.year}\n                    {\n                    ...{\n                      x1,\n                      x2,\n                      y1,\n                      y2\n                    }\n                    }\n                    stroke={colorsPalettes.generic.accent1}\n                    title={`${datum.year}-${next.year}`}\n                    strokeWidth={2}\n                    data-tip={`${datum.year} → <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year} → <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                  />\n                )\n              })\n          }\n\n        </g>\n\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear, label, row = 0, labelPosition = 'right' } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    {\n                      labelPosition === 'right' ?\n                        <>\n                          <line\n                            x1={xBand(endYear) + 20}\n                            x2={xBand(endYear) + 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(endYear) + 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                        :\n                        <>\n                          <line\n                            x1={xBand(startYear) - 20}\n                            x2={xBand(startYear) - 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(startYear) - 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            textAnchor={'end'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                    }\n\n                    <defs>\n                      <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\"\n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                        <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                      </marker>\n                    </defs>\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n\n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo, useContext} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport { SettingsContext } from '../../helpers/contexts'\n\nimport translate from '../../i18n/translate'\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\n\n/**\n * Displays a comparison of exported products totalizing n% of total shares of exports\n * @param {array} data\n * @param {array} tradeData\n * @param {string} field\n * @param {number} partTreshold - limit of the total cumulated share of exports from which to display products - in [0,1]\n * @param {number} height\n * @param {number} barWidth\n * @param {string} herfindhalField\n * @param {array} years - two years to compare\n * @param {number} width\n * @param {string} title\n * @param {object} margins\n * @param {function} productTooltipFn\n * @param {boolean} compareFrom\n * @returns {React.ReactElement} - React component\n */\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  const { lang } = useContext(SettingsContext);\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = fixSvgDimension(wholeHeight);\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: translate('viz-principale-partie-1', 'other_product', lang, { number: thisYearData.length - dataTillTreshold.length }),\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3  className=\"visualization-title\" style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg \n        ref={svgRef} \n        className={cx(\"links-container\", {'has-highlights': hoveredProduct})} \n        style={{top: svgOffset}} \n        width={width} \n        height={height}\n      >\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      key={index}\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 10])\n\n          return (\n            <div\n            key={yearIndex}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d.product, (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d.product}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineChart from './DeclineChart';\n\nexport default DeclineChart;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineChart.scss';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate'\n\n/**\n * Configurable wrapper for main viz #1\n * @param {number} width\n * @param {number} height\n * @param {string} lang\n * @param {number} startYear\n * @param {number} endYear\n * @param {number} productTradePartThreshold\n * @param {array<string>} rows - list of visualization rows to display at a certain time\n * @param {datasets} object\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst DeclineChart = (props) => {\n  const {\n    width: inputWidth, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const width = fixSvgDimension(inputWidth);\n  const messages = {\n    franceOverviewTitle: (start, end) => translate('viz-principale-partie-1', 'franceOverviewTitle', lang, { start: start, end: end }),\n    tradeEvolutionTitle: (cityName, start, end) => translate('viz-principale-partie-1', 'tradeEvolutionTitle', lang, { cityName: cityName, start: start, end: end }),\n    top90PctTitle: (cityName, start, end) => translate('viz-principale-partie-1', 'top90PctTitle', lang, { cityName: cityName, start: start, end: end }),\n    partInPct: () => translate('viz-principale-partie-1', 'partInPct', lang),\n    absoluteValue: () => translate('viz-principale-partie-1', 'absoluteValue', lang),\n    herfindalLegendTitle: () => translate('viz-principale-partie-1', 'herfindalLegendTitle', lang),\n    herfindal0: () => translate('viz-principale-partie-1', 'herfindal0', lang),\n    herfindal1: () => translate('viz-principale-partie-1', 'herfindal1', lang),\n    barTooltip: (year, pct, city, herfindal) => translate('viz-principale-partie-1', 'barTooltip', lang, { year: year, pct: pct, city: city, herfindal: herfindal }),\n    productTooltip: (year, product, pct) => translate('viz-principale-partie-1', 'productTooltip', lang, { year: year, product: product, pct: pct }),\n    sevenYearsWar: (year, product, pct) => translate('viz-principale-partie-1', 'sevenYearsWar', lang, { year: year, product: product, pct: pct }),\n    austriaWar: () => translate('viz-principale-partie-1', 'austriaWar', lang),\n    usIndependance: () => translate('viz-principale-partie-1', 'usIndependance', lang),\n    laRochelleDiaspora: () => translate('viz-principale-partie-1', 'laRochelleDiaspora', lang)\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle(startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: .5,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance()\n              },\n\n              \n            ]}\n            // fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct()}\n            axisRightTitle={messages.absoluteValue()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 1,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1747,\n                endYear: 1747,\n                row: 2,\n                label: messages.laRochelleDiaspora()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance()\n              },\n              // {\n              //   type: 'span',\n              //   startYear: 1789,\n              //   endYear: 1789,\n              //   row: 4,\n              //   labelPosition: 'left',\n              //   label: messages.absolute1789[lang](datasets['decline_longitudinal_data.csv'].find((d) => d.region === \"La Rochelle\" && d.year === \"1789\"))\n              // },\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle(),\n              minimum: messages.herfindal0(),\n              maximum: messages.herfindal1(),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct()}\n            axisRightTitle={messages.absoluteValue()}\n            barTooltipFn={ messages.barTooltip}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                row: 0.5,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 0,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 1,\n                label: messages.usIndependance()\n              },\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle(),\n              minimum: messages.herfindal0(),\n              maximum: messages.herfindal1(),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products/decline_LR_products.csv`] || !datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products/decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data/decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineChart\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineChart;\n","import Decline from '../components/DeclineChart';\n\n/**\n * Renders main visualization #1\n * @param {number} width\n * @param {number} height\n * @param {string} step - in [1, 2, 3] - defines the step of storytelling\n * @param {objects} props - additional params to be passed to visualization components\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart1 = ({\n  width, \n  height, \n  step, \n  ...props\n}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useSpring, animated } from 'react-spring'\n\n\nexport const G =({children, className, onClick, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.g className={className} onClick={onClick} {...props}>\n      {children}\n    </animated.g>\n  )\n}\nexport const Text =({children, onClick, className, style, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.text className={className} onClick={onClick} style={style} {...props}>\n      {children}\n    </animated.text>\n  )\n}\nexport const Line = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.line className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Circle = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.circle className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Rect = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.rect className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Path = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.path className={className} onClick={onClick} style={style} {...props} />\n  )\n}","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialChart.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, fixSvgDimension, trimText } from '../../helpers/misc';\nimport ReactTooltip from 'react-tooltip';\n\nimport {G, Text, Line, Circle, Rect, Path} from './animatedPrimities';\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3];\n\n/**\n * Renders a circular alluvial diagram (duh)\n * @param {array} data\n * @param {string} sumBy - field in data to use to quantify flows\n * @param {array} steps - arrow of steps in the form: {field: [string], labels: {fr: [string], en: [string]}, filters: [{key: [string], value: [string]}]}\n * @param {number} width\n * @param {number} height\n * @param {array} filters - objects in the form {key, value} to highlight some flows in the vis\n * @param {boolean} debug\n * @param {string} title\n * @param {object} colorsPalettes\n * @param {boolean} centerHorizontalLabels\n * @param {boolean} displaceHorizontalLabels - avoid labels overlap (at the cost of invadint the center of the vis)\n * @param {object} tooltips - tooltips of nested functions in the form {node: {fr: [fn], en: [fn]}, flow: {fr: [fn], en: [fn]}}\n * @param {string} lang - enum ['fr', 'en']\n * @param {string} align - enum ['left', 'center']\n * @returns {React.ReactElement} - React component\n */\nconst CircularAlluvialChart = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width: inputWidth = 1200,\n  height : inputHeight = 800,\n  filters = [],\n  debug = false,\n  title,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true,\n  tooltips,\n  lang,\n  align = 'left'\n}) => {\n  const titleRef = useRef(null);\n  let height = titleRef.current ? inputHeight - titleRef.current.getBoundingClientRect().height : inputHeight;\n  height = fixSvgDimension(height);\n  const width = fixSvgDimension(inputWidth);\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters]);\n\n  let tooltipContent;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }, [filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 50]).domain([0, 1])\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n\n  // const legendX1 = smallestDimension * .36;\n  // const legendX2 = smallestDimension * .64;\n\n  const legendX1 = smallestDimension * .4;\n  const legendX2 = smallestDimension * .6;\n\n  const legendTopYInternal = smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH;\n  const legendTopYExternal = smallestDimension / 2 - HORIZONTAL_MARGIN + BAR_WIDTH;\n  const legendBottomYInternal = smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH;\n  const legendBottomYExternal = smallestDimension / 2 + HORIZONTAL_MARGIN;\n  return (\n    <>\n      <h5 ref={titleRef} className=\"visualization-title\">{title}</h5>\n      <svg \n        data-for=\"alluvial-tooltip\"\n        data-tip={tooltipContent}\n        width={width} \n        height={height} \n        className={cx(\"CircularAlluvialChart\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}\n      >\n        <G  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <G className=\"background-marks\" transform={`translate(${align === 'left' ?  0 : width / 2 - smallestDimension / 2}, 0)`} >\n          <Line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(1),\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </Text>\n          \n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(1),\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </Text>\n          <Path\n            d={`M ${legendX1} ${legendTopYInternal} \n            Q ${legendX1} ${legendTopYExternal}, ${smallestDimension/2} ${legendTopYExternal} \n            Q ${legendX2} ${legendTopYExternal}, ${legendX2} ${legendTopYInternal}`}\n            stroke={'grey'} strokeWidth={.5}\n            fill=\"none\"\n            markerEnd=\"url(#arrowhead)\"\n            style={{\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          />\n          <Text\n            x={legendX1 - 5}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'end',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[0].name}\n          </Text>\n          <Text\n            x={smallestDimension / 2}\n            y={legendTopYExternal - 5}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'middle',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[1].name}\n          </Text>\n          <Text\n            x={legendX2 + 5}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'start',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[2].name}\n          </Text>\n          \n          <Path\n            d={`M ${legendX2} ${legendBottomYInternal} \n            Q ${legendX2} ${legendBottomYExternal}, ${smallestDimension/2} ${legendBottomYExternal} \n            Q ${legendX1} ${legendBottomYExternal}, ${legendX1} ${legendBottomYInternal}`}\n            stroke={'grey'} \n            strokeWidth={.5}\n            fill=\"none\"\n            markerEnd=\"url(#arrowhead)\"\n            style={{\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          />\n          <Text\n            x={legendX1 - 5}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'end',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[5].name}\n          </Text>\n          <Text\n            x={smallestDimension / 2}\n            y={legendBottomYExternal + 10}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'middle',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[4].name}\n          </Text>\n          <Text\n            x={legendX2 + 5}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'start',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[3].name}\n          </Text>\n          \n\n          <defs>\n            <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"10\"\n            refX=\"0\" refY=\"5\" orient=\"auto\">\n              <polygon stroke=\"grey\" strokeWidth={1} fill=\"grey\" points=\"0 0, 10 5, 0 10\" />\n            </marker>\n          </defs>\n        </G>\n        <G \n          transform={`translate(${align === 'left' ? 0 : width / 2 - smallestDimension / 2}, 0)`}\n        >\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <G\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <Rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <G\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleClick = () => {\n                                      if (highlightedFlow && highlightedFlow._id === flow._id) {\n                                        setHighlightedFilter(undefined);\n                                        setHighlightedFlow(undefined);\n                                      }\n                                      else {\n                                        if (highlightedFilter) {\n                                          setHighlightedFilter(undefined);\n                                        }\n                                        setHighlightedFlow({...flow, stepIndex});\n                                      }\n                                      \n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH * 2;\n                                      y3 += BAR_WIDTH * 2;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH * 2;\n                                      y4 += BAR_WIDTH * 2;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    const {flow_type, customs_office, product, partner} = flow;\n                                    const value = flow[sumBy];\n                                    const tContent = tooltips.flow[lang]({flow_type, customs_office, product, sumBy, value, partner})\n                                    return (\n                                      <G\n                                        onClick={handleClick}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                        data-for=\"alluvial-tooltip\"\n                                        data-tip={tContent}\n                                      >\n                                        <Path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <Line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <Line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <Line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <Line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </G>\n                                    )\n                                  })\n                              }\n                            </G>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH * 2;\n                        }\n                        const handleClick = () => {\n                          if (highlightedFilter && highlightedFilter.value === node.id) {\n                            setHighlightedFlow(undefined);\n                            setHighlightedFilter(undefined);\n                          }\n                          else {\n                            if (highlightedFlow) {\n                              setHighlightedFlow(undefined);\n                            }\n                            setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                          }\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        const tContent = tooltips.node(node, stepIndex);\n                        return (\n                          <G\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onClick={handleClick}\n                            data-for=\"alluvial-tooltip\"\n                            data-tip={tContent}\n                          >\n                            <Rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <G\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <Text\n                                style={{\n                                  fontSize: stepIndex === 0 || [2, 3, 5].find(index => index === stepIndex) ? labelFontSize * .75 : labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </Text>\n                            </G>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <Line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 || stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH * 2;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <Rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </G>\n                        )\n                      })\n                    }\n\n                  </G>\n                )\n              })\n          }\n        </G>\n        </G>\n      </svg>\n      <ReactTooltip id=\"alluvial-tooltip\" />\n    </>\n  )\n}\n\nexport default CircularAlluvialChart;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import React from 'react';\nimport Slider/*, { SliderTooltip }*/ from 'rc-slider';\nimport 'rc-slider/assets/index.css';\n\nconst { createSliderWithTooltip } = Slider;\nconst Range = createSliderWithTooltip(Slider.Range);\n\n/**\n * Displays an interactive slider\n * @param {string} title\n * @param {number} min\n * @param {number} max\n * @param {number} value\n * @param {function} onChange\n * @returns {React.ReactElement} - React component\n */\nconst SliderRange = ({ \n  title, \n  min, \n  max, \n  value, \n  onChange \n}) => {\n  const style = { width: 300, margin: 50 };\n\n  return (\n    <div style={style}>\n      <p>{title}</p>\n      <Range\n        allowCross={false}\n        min={min}\n        max={max}\n        value={value}\n        onChange={onChange}\n      />\n    </div>\n  )\n}\n\nexport default SliderRange;","import SliderRange from './SliderRange';\n\nexport default SliderRange;","import React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { polarToCartesian } from '../../helpers/misc';\n\n\nconst AxisObject = ({\n  size,\n  MARGIN,\n  axisIndex,\n  axisRankScale,\n  axis,\n  label\n}) => {\n    const [rawX1, rawY1] = [size/2 + MARGIN / 2, size/2 + MARGIN / 2];\n    const [x2Rel, y2Rel] = polarToCartesian(size/2, axisRankScale(axisIndex))\n    const rawX2 = rawX1 + x2Rel;\n    const rawY2 = rawY1 + y2Rel;\n    let labelXDisplace = -MARGIN / 8;\n    let labelYDisplace = 15;\n    if (axisIndex > 0) {\n      labelYDisplace = -10;\n      if (axisIndex === axis.length / 2) {\n        labelYDisplace = -20;\n        labelXDisplace = -MARGIN / 6;\n      } else if (axisIndex < axis.length / 2) {\n        labelXDisplace = -MARGIN / 2;\n      } else {\n        labelXDisplace = 5;\n      }\n      // special cases\n      if (axisIndex === 3 || axisIndex === 5) {\n        labelYDisplace = -30;\n      }\n      if (axisIndex === 7) {\n        labelYDisplace = 5;\n      }\n      if (axisIndex === 1) {\n        labelYDisplace = 5;\n        labelXDisplace = -MARGIN/3;\n      }\n    }\n    const {\n      x1,\n      y1,\n      x2,\n      y2,\n      labelX,\n      labelY\n    } = useSpring({\n      x1: rawX1,\n      y1: rawY1,\n      x2: rawX2,\n      y2: rawY2,\n      labelX: rawX2 + labelXDisplace,\n      labelY: rawY2 + labelYDisplace\n    })\n    return (\n      <g key={axisIndex} className=\"AxisObject\">\n        <animated.line\n          {\n            ...{\n              x1,\n              y1,\n              x2,\n              y2,\n            }\n          }\n        />\n        <animated.foreignObject \n          x={labelX} \n          y={labelY} \n          width={MARGIN * .7} \n          height={MARGIN}\n        >\n          <div className=\"label\">\n            {label}\n          </div>\n        </animated.foreignObject>\n      </g>\n    )\n}\n\nexport default AxisObject;","import { sum } from 'lodash';\nimport React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { fixSvgDimension, polarToCartesian } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate'\n\n/**\n * A plain animated circle\n * @param {number} cx \n * @param {number}  cy \n * @param {number} r \n * @param {object} props\n * @returns {React.ReactElement} - React component \n */\nconst Circle = ({\n  cx: inputX,\n  cy: inputY,\n  r: inputR,\n  ...props\n}) => {\n  const {\n    cx,\n    cy,\n    r,\n  } = useSpring({\n    cx: fixSvgDimension(inputX),\n    cy: fixSvgDimension(inputY),\n    r: inputR\n  })\n  return (\n    <animated.circle\n      cx={cx}\n      cy={cy}\n      r={r}\n      {...props}\n    />\n  )\n}\n\n\n/**\n * Displays a radarplot object\n * @param {string} color\n * @param {object} data - single data object\n * @param {object} axisIndexMap\n * @param {function} axisRankScale\n * @param {array<number>} center - 2D coordinates of center in pixels\n * @param {string} name\n * @param {function} radiusScale\n * @returns {React.ReactElement} - React component \n */\nconst VisObject = ({\n  lang,\n  color,\n  data,\n  axisIndexMap,\n  axisRankScale,\n  center,\n  name,\n  radiusScale\n}) => {\n  const points = Object.entries(axisIndexMap)\n  .map(([key, index]) => {\n    const val = data[key] || 0;\n    const r = radiusScale(val);\n    const theta = axisRankScale(+index);\n    const [xRaw, yRaw] = polarToCartesian(r, theta);\n    const x = fixSvgDimension(xRaw + center[0]);\n    const y = fixSvgDimension(yRaw + center[1]);\n    return [x, y]\n  })\n  const {joinedPoints} = useSpring({\n    joinedPoints: points.map(([x, y]) => `${x},${y}`).join(' ')\n  });\n\n  let tooltipValues = Object.entries(data);\n  const sumOfParts = sum(tooltipValues.map(v => v[1]));\n  tooltipValues = tooltipValues.map(([key, val]) => [key, val / sumOfParts])\n  return (\n    <g \n      className=\"VisObject\"\n      data-for=\"radar-tooltip\"\n      data-html={true}\n      data-place=\"left\"\n      data-tip={`\n      <p>\n      ${name === 'Tous les bureaux' ? translate('viz-principale-partie-2', 'radar_tip_region', lang) : translate('viz-principale-partie-2', 'radar_tip_office', lang, { name: name })} :\n      </p>\n      <ol>\n        ${\n          tooltipValues\n          .sort(([_key, portionA], [_key2, portionB]) => {\n            if (portionA > portionB) {\n              return -1;\n            }\n            return 1;\n          })\n          .map(([key, portion]) => `\n            <li>\n              <strong>${key}</strong> : <strong>${(portion * 100).toFixed(2)}%</strong>\n            </li>\n          `).join('\\n')\n        }\n      </ol>\n  `}\n    >\n      <animated.polygon\n        points={joinedPoints}\n        fill={color}\n        fillOpacity={.5}\n      />\n      {\n        points\n        .map(([x, y], index) => {\n          return (\n            <Circle\n              key={index}\n              cx={x}\n              cy={y}\n              r={1}\n              fill={color}\n            />\n          )\n        })\n      }\n    </g>\n  )\n}\n\nexport default VisObject;","import RadarPlot from './RadarPlot';\n\nexport default RadarPlot;","import { scaleLinear } from 'd3-scale';\nimport React, { useEffect, useMemo } from 'react';\nimport { useSpring, animated } from 'react-spring'\nimport Tooltip from 'react-tooltip';\n\nimport AxisObject from './AxisObject';\nimport VisObject from './VisObject';\n\nimport './RadarPlot.scss';\n\n/**\n * Displays a radar plot\n * @todo this component should be genericized at some point, it was done in haste\n * @param {array} data\n * @param {number} size\n * @param {array<string>} axis - list of columns names to use as axis\n * @returns {React.ReactElement} - React component\n */\nconst RadarPlot= ({\n  lang,\n  data,\n  size : wholeSize = 100,\n  axis,\n}) => {\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  const axisIndexMap = useMemo(() =>\n    axis.reduce((res, a, aIndex) => ({\n      ...res,\n      [a]: aIndex\n    }), {})\n  , [axis])\n  const MARGIN = 100;\n  const size = wholeSize - MARGIN;\n  const { visCenter, visSize } = useSpring({\n    visCenter: size/2 + MARGIN / 2,\n    visSize: size/2,\n  })\n  const axisRankScale = scaleLinear().domain([0, axis.length]).range([Math.PI / 2, Math.PI * 2.5])\n  const radiusScale = scaleLinear().domain([0, 1]).range([0, size / 2])\n  return (\n    <>\n    <svg className=\"RadarPlot\" width={wholeSize} height={wholeSize}>\n      <animated.circle\n        cx={visCenter}\n        cy={visCenter}\n        r={visSize}\n        strokeWidth={.5}\n        stroke=\"grey\"\n        fill=\"none\"\n      />\n      <g className=\"background-container\">\n        {\n          axis.map((label, axisIndex) => (\n            <AxisObject\n              key={axisIndex}\n              {\n                ...{\n                  size,\n                  MARGIN,\n                  axisIndex,\n                  axisRankScale,\n                  axis,\n                  label\n                }\n              }\n            />\n          ))\n        }\n      </g>\n      <g className=\"objects-container\">\n        {\n          data.map((datum, datumIndex) => (\n            <VisObject\n              lang={lang}\n              key={datum.meta.name}\n              color={datum.meta.color}\n              name={datum.meta.name}\n              data={datum.data}\n              axisIndexMap={axisIndexMap}\n              axisRankScale={axisRankScale}\n              center={[size/2 + MARGIN / 2, size/2 + MARGIN / 2]}\n              radiusScale={radiusScale}\n            />\n          ))\n        }\n      </g>\n    </svg>\n    <Tooltip id=\"radar-tooltip\" />\n    </>\n  )\n}\n\nexport default RadarPlot;\n","/* eslint react-hooks/exhaustive-deps : 0 */\nimport { useEffect, useMemo, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport _, { maxBy, uniqBy, sumBy, values } from 'lodash';\nimport cx from 'classnames';\n\nimport SliderRange from '../../components/SliderRange';\nimport RadarPlot from '../../components/RadarPlot';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Prepares radar data\n * @author Géraldine Geoffroy\n * @param {array} datas \n * @returns {array}\n */\nconst prepareTravelData = datas => {\n  return _(datas)\n    .groupBy('destination_radar')\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = dest.length;\n      return rObj;\n    })\n    .value();\n};\n\n/**\n * Prepares radar data\n * @author Géraldine Geoffroy\n * @param {array} datas \n * @returns {array}\n */\nconst prepareTonnageData = (datas) => {\n  return _(datas)\n    .groupBy(\"destination_radar\")\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = sumBy(dest, \"tonnage\");\n      return rObj;\n    })\n    .value();\n};\n\n\n/**\n * Normalizes radar values so that they get comparable\n * @author Géraldine Geoffroy\n * @param {array} datas \n * @param {object} destCaptions \n * @returns {array}\n */\nconst normalizeRadarValues = (datas, destCaptions) => {\n  // mapping on max value\n  const maxValue = maxBy(values(datas), function (o) {\n    return o;\n  });\n  // if mapping on sum rather than max\n  // const maxValue = sum(values(datas))\n  var x = scaleLinear()\n    .domain([0, maxValue])\n    .range([0, 1]);\n  for (var key in datas) {\n    if (datas.hasOwnProperty(key)) {\n      datas[key] = x(datas[key]);\n    }\n  }\n  for (var dkey in destCaptions) {\n    if (!datas.hasOwnProperty(dkey)) {\n      datas[dkey] = 0\n    }\n  }\n\n  return datas;\n};\n\n/**\n * Wraps radar vis by controlling interactions and interpreting writers-level instructions\n * @param {array} data\n * @param {number} globalWidth\n * @param {boolean} minified\n * @param {string} title\n * @param {string} bureaux\n * @param {string} navigoAgregation\n * @param {number} minTonnage\n * @param {number} maxTonnage\n * @param {array} axis\n * @param {object} colorPalette\n * @returns {React.ReactElement} - React component\n */\nconst RadarWrapper = ({\n  data: inputData,\n  globalWidth = 500,\n  minified,\n  title,\n  bureaux = \"tous\",\n  navigoAgregation = \"tonnage\",\n  minTonnage,\n  maxTonnage,\n  lang,\n  axis = [],\n  colorPalette\n}) => {\n  const [selectedBureaux, setSelectedBureaux] = useState(new Set(['Tous les bureaux']));\n  const [aggregationMethod, setAggregationMethod] = useState('tonnage');\n  const [tonnageFilterValues, setTonnageFilterValues] = useState([]);\n  const [datasetMaximumTonnage, setDatasetMaximumTonnage] = useState();\n  const datasetMinimumTonnage = 0;\n\n  /**\n   * DATA UPDATE\n   */\n  const data = useMemo(() => {\n    if (inputData) {\n      const newData = inputData.map(d => {\n        // remove csv empty values\n        if ((d.destination_radar !== '') & (d.ferme_bureau !== '')) {\n          return {\n            ferme_bureau: d.ferme_bureau,\n            destination_radar: d.destination_radar.replace(/['\"]+/g, ''),\n            tonnage: +d.tonnage\n          };\n        }\n        return undefined;\n      })\n        .filter(d => d)\n      // setDestCaptions(Object.assign({}, ...prepareDestCaptions(newData)))\n      let max = maxBy(newData, 'tonnage').tonnage;\n      setDatasetMaximumTonnage(max);\n      if (maxTonnage) {\n        max = +maxTonnage;\n      }\n      let min = datasetMinimumTonnage;\n      if (minTonnage) {\n        min = +minTonnage;\n      }\n      setTonnageFilterValues([min, max]);\n      return newData;\n    }\n    return inputData;\n  }, [inputData])\n\n  const bureauxList = useMemo(() => {\n    return [\n      'Tous les bureaux',\n      ...uniqBy(data, 'ferme_bureau').map(({ ferme_bureau }) => ferme_bureau)\n    ]\n  }, [data])\n\n  const filteredData = useMemo(() => {\n    const bureauxToKeep = Array.from(selectedBureaux);\n    return data\n      .filter(datum => {\n        if (bureauxToKeep.includes('Tous les bureaux')) {\n          return true;\n        }\n        return bureauxToKeep.includes(datum.ferme_bureau)\n      })\n      .filter(datum => {\n        if (aggregationMethod === 'tonnage' && tonnageFilterValues && tonnageFilterValues.length) {\n          return datum.tonnage >= tonnageFilterValues[0]\n            && datum.tonnage <= tonnageFilterValues[1]\n        }\n        return true;\n      })\n  }, [data, selectedBureaux, tonnageFilterValues])\n\n  /**\n   * UPDATE FROM PROPS\n   */\n  /** update from navigoAgregation prop */\n  useEffect(() => {\n    setAggregationMethod(navigoAgregation);\n  }, [navigoAgregation])\n\n  /** update from bureaux prop */\n  useEffect(() => {\n    if (bureaux) {\n      const cleanBureaux = (bureaux).split(',')\n      .map(b => b.trim())\n      .map(b => b === 'tous' ? 'Tous les bureaux' : b)\n    setSelectedBureaux(new Set(cleanBureaux));\n    }\n    \n  }, [bureaux])\n\n  /** update from maxTonnage prop */\n  useEffect(() => {\n    if (maxTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([tonnageFilterValues[0], +maxTonnage]);\n      } else {\n        setTonnageFilterValues([0, +maxTonnage]);\n      }\n    }\n  }, [maxTonnage])\n\n  /** update from minTonnage prop */\n  useEffect(() => {\n    if (minTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([+minTonnage, tonnageFilterValues[1]]);\n      } else {\n        const max = maxBy(data, 'tonnage').tonnage;\n        setTonnageFilterValues([+minTonnage, max]);\n      }\n    }\n  }, [minTonnage])\n\n\n  const radarData = useMemo(() => {\n    const bureauxObjects = Array.from(selectedBureaux);\n\n    return bureauxObjects.map((bureauName) => {\n      const relevantData = bureauName === 'Tous les bureaux' ? filteredData :\n        filteredData.filter(datum => datum.ferme_bureau === bureauName);\n      const preparedData = aggregationMethod === 'tonnage' ? prepareTonnageData(relevantData) : prepareTravelData(relevantData);\n      return {\n        data: normalizeRadarValues\n          (Object.assign({}, ...preparedData)\n          ),\n        meta: {\n          color: colorPalette[bureauName],\n          name: bureauName\n        }\n      }\n    })\n  }, [selectedBureaux, tonnageFilterValues, aggregationMethod]);\n\n  if (!data || !radarData) {\n    return null;\n  }\n  return (\n    <div className={cx(\"RadarWrapper\", { 'is-minified': minified })}>\n\n      <h5 className=\"visualization-title\">{title}</h5>\n      <RadarPlot\n        lang={lang}\n        data={radarData.reverse()}\n        size={minified ? globalWidth * .4 : globalWidth * .7}\n        axis={axis}\n      />\n      <div\n        className={cx(\"controls-container\", { 'is-minified': minified })}\n      >\n        <div className=\"controls-contents\">\n          <strong>{filteredData.length}</strong> {translate('viz-principale-partie-2', 'travel_aggregate', lang)} <span className=\"aggregation-controls-container\">\n\n            <select value={aggregationMethod} onChange={e => setAggregationMethod(e.target.value)}>\n              <option\n                key={'tonnage'}\n                id={'tonnage'}\n                value={'tonnage'}\n              >{\n                (lang === 'fr' && translate('viz-principale-partie-2', 'radar_tonnage', 'fr', { method: aggregationMethod === 'tonnage' ? ` (navires de ${tonnageFilterValues[0]} à ${tonnageFilterValues[1]} tonneaux)` : '' }))\n                || translate('viz-principale-partie-2', 'radar_tonnage', 'en', { method: aggregationMethod === 'tonnage' ? ` (ships of ${tonnageFilterValues[0]} to ${tonnageFilterValues[1]} tonnage)` : '' })\n              }</option>\n              <option\n                key={'voyages'}\n                id={'voyages'}\n                value={'voyages'}\n              >{translate('viz-principale-partie-2', 'radar_flows', lang)}</option>\n            </select>\n            {\n              aggregationMethod && aggregationMethod === 'tonnage' &&\n              <span className=\"slider-container\">\n                <SliderRange\n                  min={datasetMinimumTonnage}\n                  max={datasetMaximumTonnage}\n                  value={tonnageFilterValues}\n                  onChange={value => [setTonnageFilterValues(value)]}\n                />\n              </span>\n            }\n          </span>\n          <p className=\"legend-explanation\">\n            {translate('viz-principale-partie-2', 'radar_legend', lang)}&nbsp;:\n          </p>\n          <ul className=\"bureaux-list\">\n            {\n              bureauxList.map((bureau, index) => {\n                const handleClick = () => {\n                  const newSelectedBureaux = new Set(selectedBureaux);\n                  if (selectedBureaux.has(bureau) && Array.from(selectedBureaux).length > 1) {\n                    newSelectedBureaux.delete(bureau);\n                  } else {\n                    newSelectedBureaux.add(bureau);\n                  }\n                  setSelectedBureaux(newSelectedBureaux);\n                }\n                return (\n                  <li\n                    key={index}\n                    onClick={handleClick}\n                    className={cx(\"bureau-item\", { 'is-active': selectedBureaux.has(bureau) })}\n                  >\n                    <span\n                      className=\"color-marker\"\n                      style={{ background: colorPalette[bureau] }}\n                    />\n                    <span className=\"bureau-label\">\n                      {bureau === 'Tous les bureaux' ? 'Ensemble des ports' : bureau}\n                    </span>\n                  </li>\n                )\n              })\n            }\n          </ul>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default RadarWrapper;","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import {useMemo} from 'react';\nimport cx from 'classnames';\nimport CircularAlluvialChart from \"../../components/CircularAlluvialChart/CircularAlluvialChart\";\nimport RadarWrapper from './RadarWrapper';\n\nimport colorsPalettes from '../../colorPalettes';\nimport {fixSvgDimension, formatNumber} from '../../helpers/misc';\n\nimport './PrincipalVisualizationPart2.scss';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Composes the principal visualization for part 2\n * @param {number} width\n * @param {number} height\n * @param {object} datasets\n * @param {boolean} showOnlyToflit\n * @param {boolean} atlasMode\n * @param {boolean} screenshotMode\n * @param {string} highlight - enum ['navigo', 'toflit18']\n * @param {string} lang\n * @param {string} filter - custom filters enum ['aucun', 'colonial', 'eau-de-vie', 'sel']\n * @param {string} bureaux - bureaux to highlight enum ['tous', <bureaux names separated by comas>']\n * @param {string} navigoAgregation - enum[\"tonnage\", ...]\n * @param {number} minTonnage\n * @param {number} maxTonnage\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart2 = ({\n  width: inputWidth, \n  height: containerHeight, \n  datasets, \n  showOnlyToflit = false, \n  atlasMode, \n  screenshotMode,\n  highlight = 'toflit18',\n  lang = 'fr',\n  filter = 'aucun',\n  bureaux=\"tous\",\n  navigoAgregation=\"tonnage\",\n  minTonnage,\n  maxTonnage,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const {sumToflitBy, alluvialFilters} = useMemo(() => {\n    let sumBy = 'value';\n    let filters = [];\n    switch(filter) {\n      case \"colonial\":\n        filters = [\n          {\n            key: 'product',\n            value: `produits coloniaux`\n          },\n          {\n            key: 'partner',\n            value: `Afrique`\n          },\n          {\n            key: 'partner',\n            value: `Colonies`\n          }\n        ];\n        break;\n      case \"eau-de-vie\":\n        filters = [\n          {\n            key: 'product',\n            value: `eau-de-vie et vins divers`\n          }\n        \n        ];\n        break;\n      case \"sel\":\n        filters = [{\n          key: 'product',\n          value: `sel`\n        }];\n        sumBy = 'product_weight_kg'\n        break;\n      default:\n        break;\n    }\n\n    return {\n      sumToflitBy: sumBy,\n      alluvialFilters: filters\n    }\n  }, [filter]);\n  const toflit18titles = (() => {\n    if (lang === 'fr') {\n      return translate('viz-principale-partie-2', 'toflit18titles', lang, {sumToflitBy: sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'})\n    }\n    return translate('viz-principale-partie-2', 'toflit18titles', lang, {sumToflitBy: sumToflitBy === 'value' ? 'commercial value' : 'weight of goods'})\n  })()\n  const navigoTitles = translate('viz-principale-partie-2', 'navigoTitles', lang)\n  return (\n    <div \n      className={cx(\"PrincipalVisualizationPart2\", \"highlight-\" + highlight, {'is-atlas-mode': atlasMode, 'is-screenshot-mode': screenshotMode})}\n    >\n     <div \n      className=\"circular-alluvial-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .5,\n        height: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .5,\n      }}\n    >\n        <CircularAlluvialChart\n          data={datasets['part_2_toflit_viz_data/part_2_toflit_viz_data.csv']}\n          width={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .45}\n          height={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .45}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          lang={lang}\n          title={toflit18titles}\n          displaceHorizontalLabels={highlight === 'toflit18'}\n          centerHorizontalLabels={highlight === 'toflit18'}\n          tooltips={{\n            node: ({id, ...node}, step) => {\n              const importTranslate = lang === 'fr' ? 'importé' : 'imported';\n              const exportTranslate = lang === 'fr' ? 'exporté' : 'exported';\n\n              if (step === 0 || step === 5) {\n                return translate('viz-principale-partie-2', 'node_0_5', lang, { id, step: step < 3 ? exportTranslate : importTranslate, number: formatNumber(parseInt(node.valueAbs)), sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' })\n              } else if (step === 1 || step === 4) {\n                return translate('viz-principale-partie-2', 'node_1_4', lang, { id, step: step < 3 ? exportTranslate : importTranslate, number: formatNumber(parseInt(node.valueAbs)), sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' })\n              } else {\n                return translate('viz-principale-partie-2', 'node_other', lang, { id, step: step < 3 ? exportTranslate : importTranslate, number: formatNumber(parseInt(node.valueAbs)), sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' })\n              }\n            },\n            flow: {\n              fr: ({flow_type, customs_office, product, sumBy, value, partner}) => translate('viz-principale-partie-2', 'flow', lang, { customs_office, flow_type: flow_type === 'import' ? 'importé' : 'exporté', value: formatNumber(parseInt(value)), sumBy: sumBy === 'value' ? 'livres tournois' : 'kg', product, flow_direction: flow_type === 'import' ? 'depuis' : 'vers', partner }),\n              en: ({flow_type, customs_office, product, sumBy, value, partner}) => translate('viz-principale-partie-2', 'flow', lang, { customs_office, flow_type: flow_type === 'import' ? 'imported' : 'exported', value: formatNumber(parseInt(value), 'en'), sumBy: sumBy === 'value' ? 'livres tournois' : 'kg', product, flow_direction: flow_type === 'import' ? 'from' : 'to', partner }),\n            }\n          }}\n          steps={[\n            {\n              field: \"customs_office\",\n              labels: translate('viz-principale-partie-2', 'customs_office', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'bureau' : 'office'\n            },\n            {\n              field: \"product\",\n              labels: translate('viz-principale-partie-2', 'product', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'produit' : 'product'\n            },\n            {\n              field: \"partner\",\n              labels: translate('viz-principale-partie-2', 'partner', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'partenaire' : 'partner'\n            },\n            {\n              field: \"partner\",\n              labels: translate('viz-principale-partie-2', 'partner', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'partenaire' : 'partner'\n            },\n            {\n              field: \"product\",\n              labels: translate('viz-principale-partie-2', 'product', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'produit' : 'product'\n            },\n            {\n              field: \"customs_office\",\n              labels: translate('viz-principale-partie-2', 'customs_office', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'bureau' : 'office'\n            },\n          ]}\n        />\n     </div>\n     <div \n      className=\"radar-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'navigo' ? width * .7 : width * .4\n      }}\n    >\n      <RadarWrapper \n        data={datasets['part_2_navigo_viz_data/part_2_navigo_viz_data.csv']}\n        minified={!atlasMode && highlight !== 'navigo'}\n        globalWidth={atlasMode ? window.innerWidth * .5 : width}\n        bureaux={bureaux}\n        navigoAgregation={navigoAgregation}\n        minTonnage={minTonnage}\n        maxTonnage={maxTonnage}\n        title={navigoTitles}\n        lang={lang}\n        axis={[\n          'Local',\n          'Afrique',\n          'Colonies',\n          'Grande-Bretagne',\n          'Europe',\n          'Ports francs et petites îles',\n          'France',\n          'Reste du monde',\n        ]}\n        colorPalette={colorsPalettes.customs_office}\n      />\n       {/* <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} /> */}\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","\nimport NetworkGraphChart from \"../../components/NetworkGraphChart/GraphContainer\";\nimport BarChart from \"../../components/BarChart\";\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport translate from \"../../i18n/translate\";\n\n/**\n * Viz 3.2 wrapper\n * @param {number} width\n * @param {number} height\n * @param {object} datasets\n * @returns {React.ReactElement} - React component\n */\nconst Step2 = ({\n  width: inputWidth,\n  height: inputHeight,\n  datasets,\n  lang\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  return (\n    <>\n          <div className=\"graphs-container\" style={{ position: 'relative', height: height * .6 }}>\n            <div className=\"graph-container\" style={{ width: width * .6, height: height * .6, position: 'absolute' }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_La Rochelle/flows_1787_around_La Rochelle.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne à la région': colorPalettes.generic.dark,\n                    'externe à la région': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                ratio={1.1}\n                title={translate('viz-principale-partie-3', 'network_1_title', lang)}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, top: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Bordeaux/flows_1787_around_Bordeaux.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne à la région': colorPalettes.generic.dark,\n                    'externe à la région': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                title={translate('viz-principale-partie-3', 'network_2_title', lang)}\n                ratio={1}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, bottom: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Nantes/flows_1787_around_Nantes.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne à la région': colorPalettes.generic.dark,\n                    'externe à la région': colorPalettes.generic.accent2,\n                  }\n                }}\n                title={translate('viz-principale-partie-3', 'network_3_title', lang)}\n                ratio={0.7}\n                spatialize\n              />\n            </div>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: '1rem',\n            left: 0,\n            width: width * .3,\n            height: height * .3,\n            paddingLeft: 0,\n            // marginBottom: '1rem'\n          }}\n            className=\"ColorLegend\"\n          >\n            <h5>{translate('viz-principale-partie-3', 'network_legend_title', lang)}</h5>\n            <ul className=\"color-legend\">\n              <li>\n                {translate('viz-principale-partie-3', 'network_legend_color_title', lang)}\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.dark }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  {translate('viz-principale-partie-3', 'network_legend_color_1', lang)}\n                </span>\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.accent2 }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  {translate('viz-principale-partie-3', 'network_legend_color_2', lang)}\n                </span>\n              </li>\n            </ul>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: width * .7,\n            height: height * .3,\n            // marginBottom: '2rem'\n          }}>\n            <BarChart\n              data={datasets['part_3_centralite_comparaison/part_3_centralite_comparaison.csv']}\n              title={translate('viz-principale-partie-3', 'barchart_title', lang)}\n              width={width * .7}\n              height={height * .3}\n              orientation={'vertical'}\n              layout={'groups'}\n              y={{\n                field: 'port',\n                title: translate('viz-principale-partie-3', 'barchart_y', lang),\n              }}\n              x={{\n                field: 'score',\n                title: translate('viz-principale-partie-3', 'barchart_x', lang),\n                // tickSpan: .1,\n                // tickFormat: (d, i) => parseInt(d * 100) + '%'\n              }}\n              color={{\n                field: 'metrics_type',\n                title: translate('viz-principale-partie-3', 'barchart_color', lang),\n                palette: {\n                  'PageRank': colorPalettes.generic.dark,\n                  'betweenness centrality': colorPalettes.generic.accent1,\n                }\n              }}\n              margins={{\n                bottom: 40\n              }}\n              tooltip={d => d.metrics_type === 'PageRank' ? translate('viz-principale-partie-3', 'barchart_toolip_pagerank', lang) : translate('viz-principale-partie-3', 'barchart_toolip_nopagerank', lang)}\n            />\n          </div>\n        </>\n  )\n}\n\nexport default Step2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\nimport { useState, useEffect } from 'react';\n\nimport GeographicMapChart from '../../components/GeographicMapChart/GeographicMapChart';\nimport { Step3Objects, SmallMultiples, renderTriangles } from './renderObjectsFunctions'; // pas sur que ça reste à terme\n\nimport './PrincipalVisualizationPart3.scss';\nimport colorsPalettes from '../../colorPalettes.js';\nimport Step2 from './Step2';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Renders main viz #3\n * @param {object} datasets\n * @param {number} step - scrollytelling step\n * @param {number} width\n * @param {number} height\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart3 = ({ \n  datasets, \n  step, \n  width: inputWidth, \n  height: inputHeight, \n  atlasMode,\n  lang\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? window.innerHeight : fixSvgDimension(inputHeight);\n  const [currentMapTemplate, setCurrentMapTemplate] = useState('France');\n  useEffect(() => {\n    setTimeout(() => {\n      switch (step) {\n        case 1:\n          setCurrentMapTemplate('rotated Poitou');\n          break;\n        case 3:\n          setCurrentMapTemplate('Poitou zoomed');\n          break;\n        default:\n          break;\n      }\n    })\n  }, [step])\n  return (\n    <div className={cx(\"PrincipalVisualizationPart3\", { 'is-atlas-mode': atlasMode })} style={{ height: atlasMode ? undefined : height }}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        <GeographicMapChart\n          title={translate('viz-principale-partie-3', 'GeographicMapChart_title', lang)}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],\n              animated: true\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: () => (\n                <>\n                  <rect\n                    x={0}\n                    y={0}\n                    width={width}\n                    height={height / 8}\n                    fill={`url(#radial-bg-${atlasMode})`}\n                  />\n                  <defs>\n                    <linearGradient id={`radial-bg-${atlasMode}`} gradientTransform=\"rotate(90)\">\n                      <stop offset=\"10%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} />\n                      <stop offset=\"100%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                </>\n              )\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: props => renderTriangles({...props, atlasMode, lang})\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'rotated Poitou' : currentMapTemplate}\n          height={atlasMode ? window.innerHeight * .9 : height}\n          width={width}\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })} style={{ height }}>\n        <Step2\n          lang={lang}\n          {\n          ...{\n            width,\n            height,\n            datasets,\n          }\n          }\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],\n              color: {\n                field: 'shortname'\n              },\n              animated: true,\n            },\n            {\n              type: 'custom',\n              data: {\n                customsOffices: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv']\n              .filter(d => \n                d.customs_region === 'La Rochelle' \n                && d.name !== 'undefined customs office'\n                && !d.name.includes('Bouin')\n                ),\n                ports: datasets['part_3_step3_viz_ports_data/part_3_step3_viz_ports_data.csv']\n              },\n              renderObjects: Step3Objects // besoin de montrer les labels des bureaux et ports => modifier la fonction\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n              renderObjects: SmallMultiples\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'Poitou zoomed' : currentMapTemplate}\n          height={height}\n          width={width}\n          title={translate('viz-principale-partie-3', 'GeographicMapChart_second_title', lang)}\n        />\n\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","import cx from 'classnames';\nimport GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\";\nimport { useSpring, animated } from 'react-spring'\n\nimport { useEffect, useState } from 'react';\nimport './IntroBureaux.scss';\n\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate';\n\nconst BureauBackground = ({\n  projection,\n  atlasMode,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <animated.circle\n        r={radius * 2}\n        cx={0}\n        cy={0}\n        fill={`url(#bureau-${index})`}\n      />\n      <radialGradient id={`bureau-${index}`}>\n        <stop offset={atlasMode ? '0%' : \"20%\"} stopColor={colorPalettes.customs_office[datum.name]} />\n        <stop offset=\"100%\" stopColor={atlasMode ? \"rgba(255,255,255,0)\" : \"rgba(51,109,124,0)\"} />\n      </radialGradient>\n    </animated.g>\n  )\n}\n\nconst BureauLabel = ({\n  projection,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n  const labelOnRight = ['La Rochelle', 'Tonnay-Charente'].includes(datum.name);\n  const thatWidth = fixSvgDimension(datum.name.length * width * height * .0005);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <circle\n        r={2}\n        cx={0}\n        cy={0}\n        fill={'white'}\n      />\n      <foreignObject\n        x={labelOnRight ? radius / 2 : -radius / 2 - thatWidth}\n        y={-height / 70}\n        fill=\"white\"\n        width={thatWidth}\n        height={height / 20}\n        className={cx(\"bureau-label\", {\n          'is-reversed': !labelOnRight\n        })}\n      >\n        <span xmlns=\"http://www.w3.org/1999/xhtml\">\n          {datum.name}\n        </span>\n      </foreignObject>\n    </animated.g>\n  )\n}\n\nconst renderBureaux = ({ data, projection, width, height, atlasMode }) => {\n  const radius = width * height * 0.00006;\n\n  return (\n    <g className={cx(\"IntroBureaux\", {'is-atlas-mode': atlasMode})}>\n      \n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauBackground\n              key={index}\n              {\n              ...{\n                projection,\n                atlasMode,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauLabel\n              key={index}\n              {\n              ...{\n                projection,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n    </g>\n  )\n}\n\n/**\n * Displays a basic visualization of bureaux des fermes with fancy blurry gradient backgrounds on points\n * @param {object} datasets\n * @param {boolean} atlasMode\n * @param {object} dimensions\n * @returns {React.ReactElement} - React component\n */\nconst IntroBureaux = ({\n  datasets,\n  atlasMode,\n  dimensions,\n  lang\n}) => {\n  return (\n    <GeographicMapChart\n      title={translate('intro-bureaux', 'title', lang)}\n      layers={[\n        {\n          type: 'choropleth',\n          data: datasets['map_backgrounds/map_france_1789.geojson'],\n          reverseColors: atlasMode ? false : true,\n          // color:{\n          //   field: 'shortname',\n          //   palette: colorPalettes.provinces\n          // }\n        },\n        {\n          type: 'custom',\n          data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n          renderObjects: props => renderBureaux({...props, atlasMode})\n        }\n      ]}\n      projectionTemplate='Poitou'\n      width={fixSvgDimension(dimensions.width)}\n      height={atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height)}\n    />\n  )\n}\n\nexport default IntroBureaux;","import IntroBureaux from './IntroBureaux';\n\nexport default IntroBureaux;","import GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\"\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport translate from \"../../i18n/translate\";\n\nimport './HomeportFlows.scss';\n\n/**\n * Displays the homport flows vis (multiple flow maps)\n * @param {object} datasets\n * @param {boolean} atlasMode\n * @param {object} dimensions\n * @returns {React.ReactElement} - React component\n */\nconst HomeportFlows = ({\n  datasets,\n  atlasMode,\n  dimensions,\n  lang\n}) => {\n  const englishCategoriesTranslation = {\n    'région PASA': 'PASA region',\n    France: 'France'\n  }\n  const totalHeight = atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height);\n  const hotFixedData = datasets['voyages-bateaux-homeport-larochelle-1787/voyages-bateaux-homeport-larochelle-1787.csv']\n  .map(datum => {\n    if (datum.port_dest.includes(`Côte d'Or`)) {\n      return {\n        ...datum,\n        latitude_dest: 5,\n        longitude_dest: -0.6107851\n      }\n    }\n    return datum;\n  })\n  .map(datum => {\n    if (lang === 'fr') {\n      return datum;\n    }\n    return {\n      ...datum,\n      category: englishCategoriesTranslation[datum.category] || datum.category\n    }\n  })\n  return (\n    <div className=\"HomeportFlows\">\n      <div className=\"column\">\n        <GeographicMapChart\n          title={translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'title', lang)}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData,\n              size: {\n                field: 'tonnages_cumulés',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              },\n              hideOverflowingFlows: true\n            }\n          ]}\n          projectionTemplate={'coast from Nantes to Bordeaux'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          withLegend={'bottom left'}\n          legendLayerFilter={l => l.type === 'flows'}\n          height={totalHeight}\n        />\n      </div>\n      <div className=\"column\">\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'], // currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category !== 'pasa'),\n              hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumulés',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              }\n            },\n          ]}\n          projectionTemplate={'France'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_world_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category === 'étranger'),\n              // hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumulés',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              }\n            },\n          ]}\n          projectionTemplate={'World'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default HomeportFlows","\nimport { useRef, useState, useEffect, useMemo, useContext } from 'react';\nimport {nest} from 'd3-collection';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\nimport {\n  treemap, \n  hierarchy, \n  // treemapResquarify,\n  treemapBinary,\n} from 'd3-hierarchy';\n\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst formatNestResults = (input) => {\n  if (Array.isArray(input)) {\n    return {\n      name: 'root',\n      children: input.map(formatNestResults)\n    }\n  } else if (input.key && input.values) {\n    return {\n      name: input.key,\n      children: input.values.map(formatNestResults)\n    }\n  } else return input;\n}\n\n\n\n/**\n * Returns a treemap visualization\n * @param {array<object>} data - tabular data\n * @param {array} fieldsHierarchy - array of fieldnames to use to build the nested hierarchy from tabular data\n * @param {string} title\n * @param {number} width\n * @param {number} height\n * @param {object} leaf - parameters for computing leafs in the form {labelField: [string], countField: [string]}\n * @param {object} color\n * @param {function} tooltip\n * @param {object} margins\n * @returns {React.ReactElement} - React component\n */\nconst TreemapChart = ({\n  data,\n  fieldsHierarchy = [],\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  leaf: {\n    labelField,\n    countField,\n  },\n  color,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth - 10);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const root = useMemo(() => {\n    const res = nest()\n    fieldsHierarchy.forEach((field) => {\n      res.key((d) => d[field])\n    })\n    \n    const visData = formatNestResults(res.entries(data))\n    const result = hierarchy(visData).sum(d => +d[countField]);\n    treemap()\n    .size([width, height])\n    .tile(treemapBinary)\n    .round(true)\n    (result);\n    return result;\n  }, [data, fieldsHierarchy, width, height, countField])\n\n\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n    // return () => {\n    //   setHeadersHeight(0);\n    //   setLegendWidth(0);\n    // };\n  }, [width, height, color, data])\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  \n\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Légende' : 'Legend';\n\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"TreemapChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" >{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            {\n              root.leaves().map((datum, datumIndex) => {\n                const {x0, y0, x1, y1} = datum;\n                const rectWidth = x1 - x0;\n                const rectHeight = y1 - y0;\n                const labelText = `${datum.data[labelField]} (${datum.data[countField]})`;\n                const fontSize = rectWidth / labelText.length * 1.5\n                // const labelWidth = window.innerWidth * 0.003 * labelText.length;\n                return (\n                  <g \n                    key={`${x0}-${y0}`} \n                    transform={`translate(${x0},${y0})`}\n                    data-for=\"treemap-tooltip\"\n                    data-tip={tooltip ? tooltip(datum.data) : undefined}\n                  >\n                    <rect\n                      stroke=\"white\"\n                      x={0}\n                      y={0}\n                      width={rectWidth}\n                      height={rectHeight}\n                      fill={colorPalette[datum.data[color.field]]}\n                    />\n                    {\n                      rectHeight > fontSize ?\n                        <text\n                          x={rectWidth/2}\n                          y={rectHeight / 2 + 5}\n                          style={{\n                            fontSize\n                          }}\n                          textAnchor=\"middle\"\n                        >\n                          {labelText}\n                        </text>\n                      : null\n                    }\n                  </g>\n                )\n              })\n            }\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"treemap-tooltip\" />\n    </>\n  )\n}\nexport default TreemapChart;","// @TODO : colorLegends et titres à mettre en place pour cartes notamment\n// @TODO : faire une passe sur visualizationList.json que j'ai rempli approximativement pour les vizs 'intro-provinces', 'intro-ports', et 'intro-bureaux'\n\nimport { useContext, useMemo } from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\nimport BarChart from '../components/BarChart';\nimport LineChart from '../components/LineChart';\nimport GeographicMapChart from '../components/GeographicMapChart/GeographicMapChart';\nimport colorPalettes from '../colorPalettes'\n\nimport {formatNumber} from '../helpers/misc'\nimport { DatasetsContext } from '../helpers/contexts';\nimport { SettingsContext } from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\nimport IntroBureaux from './IntroBureaux';\nimport HomeportFlows from './HomeportFlows/HomeportFlows';\nimport TreemapChart from '../components/TreemapChart/TreemapChart';\nimport { omit } from 'lodash';\nimport translate from '../i18n/translate';\n\n/**\n * This script is the bridge between visualization code, visualizations list, and visualization callers in contents.\n * It returns a visualization component depending on the provided id\n * @param {string} id\n * @param {object} dimensions\n * @param {object} - additional props\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationContainer = ({ \n  id, \n  dimensions: inputDimensions, \n  ...props \n}) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n\n  const hasData = Object.keys(relevantDatasets || {}).length && !Object.entries(relevantDatasets).find(([id, payload]) => !payload);\n  if (!hasData) {\n    // console.log('no data for ', id, 'looked for', visualizationsList.find(v => v.id === id))\n    return null;\n  }\n  switch (id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return (\n        <SettingsContext.Provider value={{ lang: props.lang }}>\n          <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />\n        </SettingsContext.Provider>\n      );\n    case 'partie-1-produits-importants-pour-la-rochelle':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              .sort((a, b) => {\n                if (+a.order > +b.order) {\n                  return 1;\n                }\n                return -1;\n              })\n              .slice(0, 20)\n          }\n          title={translate('partie-1-produits-importants-pour-la-rochelle', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n          orientation={'vertical'}\n          layout={'groups'}\n          y={{\n            field: 'product',\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'y', props.lang),\n          }}\n          x={{\n            field: 'value_rel_per_direction',\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'x', props.lang),\n            tickSpan: .1,\n            tickFormat: (d, i) => parseInt(d * 100) + '%'\n          }}\n          color={{\n            field: 'entity',\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'color', props.lang),\n            palette: {\n              'direction des fermes de La Rochelle': '#00C4AF',\n              'France (moyenne)': '#FEA43B'\n            }\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => translate('partie-1-produits-importants-pour-la-rochelle', 'tooltip', props.lang, { product: d.product, value: (d.value_rel_per_direction * 100).toFixed(2), entite: d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle' })}\n        />\n      )\n    case 'partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height * .5}\n          orientation={'horizontal'}\n          layout={'stack'}\n          y={{\n            field: 'portion',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'y', props.lang),\n            tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'year',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'x', props.lang),\n            fillGaps: true,\n            tickSpan: 5,\n            // tickFormat: d => d%10 === 0 ? d : undefined\n          }}\n          color={{\n            field: 'type',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'color', props.lang)\n          }}\n          margins={{\n            left: 140,\n            right: 20,\n            bottom: 30\n          }}\n          tooltip={d =>translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'tooltip', props.lang, { year: d.year, direction: d.type === 'import' ? 'importé' : 'exporté', value: (+d.portion * 100).toFixed(2), type: d.type === 'import' ? 'imports' : 'exports' })}\n        />\n      )\n    case 'sorties-de-sel':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('sorties-de-sel', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'port',\n            title: translate('sorties-de-sel', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: translate('sorties-de-sel', 'x', props.lang),\n            title: 'Tonnage cumulé',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('sorties-de-sel', 'y', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls })}\n        />\n      )\n    case 'sorties-de-marennes':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('sorties-de-marennes', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height / 2}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: translate('sorties-de-marennes', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: translate('sorties-de-marennes', 'x', props.lang),\n            title: 'Tonnage cumulé',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('sorties-de-marennes', 'tooltip', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls, country: d.country })}\n        />\n      )\n    case 'partie-1-pays-port-d-attache':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('partie-1-pays-port-d-attache', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: translate('partie-1-pays-port-d-attache', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: translate('partie-1-pays-port-d-attache', 'x', props.lang),\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('partie-1-pays-port-d-attache', 'tooltip', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls })}\n        />\n      )\n    case 'partie-3-comparaison-exports-coloniaux':\n      const englishTypesTranslation = {\n        'produits de la région PASA': 'PASA region products',\n        'produits coloniaux': 'colonial products',\n        'autres produits': 'other products'\n      }\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n            .map(obj => {\n              if (props.lang === 'fr') {\n                return obj\n              }\n              else {\n                return {\n                  ...obj,\n                  type: englishTypesTranslation[obj.type]\n                }\n              }\n            })\n\n          }\n          title={translate('partie-3-comparaison-exports-coloniaux', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height * .5}\n          orientation={'vertical'}\n          layout={'grouped'}\n          y={{\n            field: 'customs_office',\n            title: translate('partie-3-comparaison-exports-coloniaux', 'y', props.lang),\n            // tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'value',\n            title: translate('partie-3-comparaison-exports-coloniaux', 'x', props.lang),\n            tickSpan: 1000000,\n            domain: [0, 6000000],\n            tickFormat: d => formatNumber(d) + ' lt'\n          }}\n          color={{\n            field: 'type',\n            title: translate('partie-3-comparaison-exports-coloniaux', 'color', props.lang)\n          }}\n          margins={{\n            left: 140,\n            right: 50,\n          }}\n          tooltip={d => translate('partie-3-comparaison-exports-coloniaux', 'tooltip', props.lang, { customs_office: d.customs_office, value: d.value, type: d.type })}\n        />\n      )\n    case 'intro-provinces':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('intro-provinces', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                color: {\n                  field: 'shortname',\n                  palette: colorPalettes.provinces\n                },\n                tooltip: (d) => {\n                  return d.properties.shortname\n                }\n              }\n            ]}\n            projectionTemplate='France'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n          />\n        </>\n      )\n    case 'sorties-de-marennes-avec-sel-destinations':\n      return (\n        <div>\n          <div style={{borderBottom: '2px solid #333'}}>\n            <GeographicMapChart\n              title={translate('sorties-de-marennes-avec-sel-destinations', 'title', props.lang)}\n              layers={[\n                {\n                  type: 'choropleth',\n                  data: datasets['map_backgrounds/map_france_1789.geojson']\n                },\n                {\n                  type: 'points',\n                  data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country === 'France'),\n                  // color: {\n                  //   field: 'country',\n                  //   title: 'Pays',\n                  //   palette: colorPalettes.franceAlone\n                  // },\n                  size: {\n                    field: 'tonnage',\n                    title: translate('sorties-de-marennes-avec-sel-destinations', 'size', props.lang),\n                    // custom: '20'\n                  },\n                  tooltip: d => translate('sorties-de-marennes-avec-sel-destinations', 'tooltip', props.lang, { raw_size: d.rawSize, label : d.label}),\n                  label: {\n                    field: 'port',\n                    position: 'left'\n                  },\n                  stackLabels: true\n                }\n              ]}\n              projectionTemplate='France'\n              width={dimensions.width}\n              height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n            />\n          </div>\n          <GeographicMapChart\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_world_1789.geojson']\n              },\n              {\n                type: 'points',\n                data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country !== 'France'),\n                // color: {\n                //   field: 'country',\n                //   title: 'Pays',\n                //   // labelsColor: props.atlasMode ? undefined : 'white'\n                // },\n                size: {\n                  field: 'tonnage',\n                  title: translate('sorties-de-marennes-avec-sel-destinations', 'size', props.lang),\n                  // custom: '20'\n                },\n                tooltip: d => translate('sorties-de-marennes-avec-sel-destinations', 'tooltip', props.lang, { rawSize: d.rawSize, label : d.label}),\n                label: {\n                  field: 'port',\n                },\n                stackLabels: true\n              }\n            ]}\n            projectionTemplate='World'\n            projectionConfig={{\n              scale: (props.atlasMode ? window.innerHeight : dimensions.height) * .8,\n              centerY:  45,\n              centerX: -30\n            }}\n            width={dimensions.width}\n            withLegend={'bottom right'}\n            height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n          />\n        </div>\n      )\n    case 'intro-ports':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('intro-ports', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['ports_locations_data_intro/ports_locations_data_intro.csv'],\n                color: {\n                  field: 'province',\n                  title: translate('intro-ports', 'color', props.lang),\n                  palette: omit(colorPalettes.provinces, ['Angoumois']),\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'nb_pointcalls',\n                  title: translate('intro-ports', 'size', props.lang),\n                  // custom: '20'\n                },\n                tooltip: d => translate('intro-ports', 'tooltip', props.lang, { rawSize: d.rawSize, label: d.label }),\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      )\n    case 'intro-bureaux':\n      // console.log(\"heyyyyyy bureaux map\");\n      return (\n        <IntroBureaux\n          lang={props.lang}\n          {\n            ...{\n              datasets,\n              atlasMode: props.atlasMode,\n              dimensions\n            }\n          }\n        />\n      )\n    case 'partie-2-part-navigation-francaise':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('partie-2-part-navigation-francaise', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['part_navigation_fr/part_navigation_fr.csv'],\n                color: {\n                  field: 'tonnage_part_of_french',\n                  title: translate('partie-2-part-navigation-francaise', 'color', props.lang),\n                  palette: colorPalettes.tonnageClasses,\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'tonnage',\n                  title: translate('partie-2-part-navigation-francaise', 'size', props.lang),\n                  displayMetric: true,\n                  // custom: '20'\n                },\n                // tooltip: d => `${d.rawSize} mouvements de bateaux ont été enregistrés par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      );\n    case 'partie-2-carte-direction-bateaux-de-la-rochelle':\n      // voyages-bateaux-homeport-larochelle-1787.csv\n      return (\n        <HomeportFlows\n        lang={props.lang}\n        {\n          ...{\n            datasets,\n            atlasMode: props.atlasMode,\n            dimensions,\n          }\n        }\n        />\n      );\n    case 'partie-1-ports-dattache':\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_ports_dattache_des_navires_partant_de_la_region/hierarchie_ports_dattache_des_navires_partant_de_la_region.csv'],\n            title: translate('partie-1-ports-dattache', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => translate('partie-1-ports-dattache', 'tooltip', props.lang, { tonnage: d.tonnage, homeport: d.homeport, category: d.category_2 }),\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'ports'],\n            color: {\n              field: 'category_2',\n              palette: colorPalettes.portsTreemaps\n            },\n            leaf: {\n              labelField: 'homeport',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      )\n    case 'partie-1-ports-destinations':\n      const thatPalette = {\n        ...colorPalettes.portsTreemaps\n      }\n      delete thatPalette['France (région PASA)']\n      delete thatPalette['France (hors région PASA)']\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region/hierarchie_destinations_des_navires_partant_de_la_region.csv'],\n            title: translate('partie-1-ports-destinations', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => translate('partie-1-ports-destinations', 'tooltip', props.lang, { tonnage: d.tonnage, homeport: d.homeport, category: d.category_2 }),\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'ports'],\n            color: {\n              field: 'category_2',\n              palette: thatPalette\n            },\n            leaf: {\n              labelField: 'port',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'exports-eau-de-vie-la-rochelle-longitudinal':\n      return (\n      <LineChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              // .sort((a, b) => {\n              //   if (+a.order > +b.order) {\n              //     return 1;\n              //   }\n              //   return -1;\n              // })\n              // .slice(0, 20)\n          }\n          title={translate('exports-eau-de-vie-la-rochelle-longitudinal', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n          orientation={'horizontal'}\n          // layout={'groups'}\n          y={{\n            field: 'value',\n            title: translate('exports-eau-de-vie-la-rochelle-longitudinal', 'y', props.lang),\n            tickFormat: d => formatNumber(d) + ' lt'\n          }}\n          x={{\n            field: 'year',\n            title: translate('exports-eau-de-vie-la-rochelle-longitudinal', 'x', props.lang),\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => translate('exports-eau-de-vie-la-rochelle-longitudinal', 'y', props.lang, { year: d.year, value: d.value })}\n        />\n      );\n    case 'exports-eau-de-vie-comparaison-directions-des-fermes':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n                // .sort((a, b) => {\n                //   if (+a.order > +b.order) {\n                //     return 1;\n                //   }\n                //   return -1;\n                // })\n                // .slice(0, 20)\n            }\n            title={translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'title', props.lang)}\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'year',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'y', props.lang),\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'x', props.lang),\n              tickSpan: 1000000,\n              tickFormat: d => formatNumber(d) + ' lt'\n            }}\n            color={{\n              field: 'customs_region',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'color', props.lang)\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'tooltip', props.lang, { year: d.year, customsRegion: d.customs_region, value: parseInt(d.value) })}\n          />\n        );\n    case 'origines-exports-eau-de-vie-1789-la-rochelle':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n            }\n            title={translate('origines-exports-eau-de-vie-1789-la-rochelle', 'title', props.lang)}\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'origin',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'y', props.lang),\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'x', props.lang),\n              tickFormat: d => formatNumber(d / 100) + ' lt'\n            }}\n            color={{\n              field: 'type',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'color', props.lang),\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => translate('origines-exports-eau-de-vie-1789-la-rochelle', 'tooltip', props.lang, { value: parseInt(d.value), type: d.type, origin: d.origin })}\n          />\n        );\n    case 'partie-1-ports-dattache-vers-etranger':\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger/hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger.csv'],\n            title: translate('partie-1-ports-dattache-vers-etranger', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            // tooltip: d => `En 1789, ${d.tonnage} tonneaux cumulés sortis de la région PASA étaient rattachés au port de ${d.homeport} - ${d.category_2}.`,\n            tooltip: d => translate('partie-1-ports-dattache-vers-etranger', 'tooltip', props.lang, { tonnage: d.tonnage, homeport: d.homeport, category: d.category_2 }),\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'homeport'],\n            color: {\n              field: 'category_2',\n              palette: colorPalettes.portsTreemaps\n            },\n            leaf: {\n              labelField: 'homeport',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\n/**\n * Controller preparing a given visualization for rendering (cleaning props, providing dimensions)\n * @param {object} activeVisualization - JSON data about the visualization to display\n * @param {string} lang\n * @param {boolean} atlasMode\n * @param {boolean} screenshotMode\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationController = ({\n  activeVisualization,\n  lang,\n  atlasMode,\n  screenshotMode\n}) => {\n  const [dimensions, setDimensions] = useState({\n    width: 1000,\n    height: 1000\n  });\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer \n                lang={lang} \n                screenshotMode={screenshotMode} \n                atlasMode={atlasMode} \n                id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} \n                {...visProps} \n                dimensions={dimensions} \n              />\n            </>\n            : null // <div>Pas de visualisation à afficher</div>\n          }\n  \n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import { useState, useRef, useEffect } from 'react';\nimport { homepage } from '../../../package.json';\nimport copy from 'copy-to-clipboard';\nimport VisualizationController from '../VisualizationController/VisualizationController.js';\nimport Md from 'react-markdown';\n\nimport './VisualizationFocus.scss';\n\n\n/**\n * Displays an overlay with a visualization and its meta and descriptions in a 2-to-1 columns layout\n * @param {object} visualization - JSON data about the visualization to display\n * @param {string} lang\n * @param {function} onClose\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationFocus = ({ \n  visualization, \n  lang, \n  onClose \n}) => {\n\n  const [copyClicked, setCopyClicked] = useState(false);\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    if (inputRef && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [visualization])\n  let howDone, howRead;\n  if (visualization) {\n    howDone = visualization[`comment_cest_fait_${lang}`];\n    howRead = visualization[`comment_lire_${lang}`];\n  }\n\n  const messages = {\n    howDone: {\n      fr: 'Comment les données et la visualisation ont-elles été produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    },\n    copyLink: {\n      fr: 'copier le lien de cette visualisation',\n      en: 'copy this visualization link'\n    },\n    linkCopied: {\n      fr: 'lien copié dans le presse-papier !',\n      en: 'link copied in the clipboard !'\n    }\n  }\n\n  const handleCopyClick = (e) => {\n    e.stopPropagation();\n    const url = `${homepage}/${lang}/atlas/${visualization.id}`;\n    setCopyClicked(true);\n    copy(url);\n    setTimeout(() => setCopyClicked(false), 5000);\n  }\n  const handleKeyUp = (e) => {\n    // on press escape\n    if (e.keyCode === 27 && visualization) {\n      onClose();\n    }\n  }\n  // handle click on wrapper (and wrapper only - not children)\n  const handleWrapperClick = e => {\n    if (e.target.className === 'visualization-wrapper') {\n      onClose();\n    }\n  }\n  return (\n    <div className={`VisualizationFocus ${visualization ? 'is-visible' : 'is-hidden'}`}>\n      <input style={{ opacity: 0, zIndex: -10, 'pointerEvents': 'none' }} type=\"text\" onKeyUp={handleKeyUp} ref={inputRef} />\n      <div onClick={onClose} className=\"lightbox-background\" />\n      {\n        visualization ?\n          <div className=\"lightbox-contents-container\">\n            <div className=\"lightbox-contents\">\n\n              <div className=\"visualization-details\">\n                <div className=\"details-header\">\n                  <h2>{visualization[`titre_${lang}`]}</h2>\n                  <button className=\"close-btn\" onClick={onClose}>\n                    ✕\n                  </button>\n                </div>\n                <div className=\"copy-link-container\">\n                  <button onClick={handleCopyClick}>{copyClicked ? messages.linkCopied[lang] : messages.copyLink[lang]}</button>\n                </div>\n                <div className=\"details-contents\">\n                  {\n                    howDone && howDone.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howDone[lang]}</h3>\n                        <Md>\n                          {howDone.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                  {\n                    howRead && howRead.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howRead[lang]}</h3>\n                        <Md>\n                          {howRead.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                </div>\n              </div>\n              <div className=\"visualization-wrapper\" onClick={handleWrapperClick}>\n                <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n              </div>\n            </div>\n          </div>\n          : null\n      }\n\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import VisualizationFocus from './VisualizationFocus';\n\nexport default VisualizationFocus;","import { useState, useReducer, useEffect, useRef } from 'react';\nimport { Helmet } from \"react-helmet\";\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport VisualizationFocus from '../../components/VisualizationFocus';\nimport { VisualizationControlContext } from '../../helpers/contexts';\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport visualizations from '../../visualizationsList';\n\nimport './ScrollyPage.scss';\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  // mobile mode: focus on text or on viz\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  // whether to open the active viz in \"atlas mode\"\n  const [visualizationIsFullScreen, setVisualizationIsFullScreen] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const updateCurrentVisualization = () => {\n    if (visualizationIsFullScreen) {\n      return;\n    } \n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const y = scrollY + DISPLACE_Y;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n    const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n    if (y > sectionEnd) {\n      if (activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n      return;\n    }\n    // on parcourt la liste à l'envers pour récupérer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'écran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      }\n    }\n    if (scrollY === 0 && visualizationEntries.length) {\n      setActiveVisualization(visualizationEntries[0][1])\n    }\n    else if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n        <section ref={sectionRef} className={cx({ 'is-focused': !focusOnViz })}>\n          <ContentSync />\n        </section>\n        <aside className={cx({ 'is-focused': focusOnViz })}>\n          <VisualizationController lang={lang} activeVisualization={activeVisualization} />\n          {\n            activeVisualization ?\n              <div className=\"fullscreen-viz-toggle-container\">\n                <button\n                  data-for=\"contents-tooltip\"\n                  data-tip={lang === 'fr' ? \"plus d'informations sur cette visualisation\" : 'More information about this visualization'}\n                  onClick={() => {\n                    setIsLoading(true);\n                    setTimeout(() => {\n                      setVisualizationIsFullScreen(true);\n                      setIsLoading(false);\n                    }, 100)\n                  }}\n                >\n                  <span>+</span>\n                </button>\n              </div>\n              : null\n          }\n        </aside>\n        <VisualizationFocus\n          visualization={visualizationIsFullScreen && activeVisualization ? visualizationsMap[activeVisualization.visualizationId] : undefined}\n          lang={lang}\n          onClose={() => {\n            setVisualizationIsFullScreen(false);\n          }}\n        />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n        })}>\n          <button \n            data-for=\"contents-tooltip\" \n            data-effect=\"solid\" \n            data-tip={lang === 'fr' ? 'voir la visualisation associée' : 'see associated visualization'} \n            onClick={() => {\n              setFocusOnViz(!focusOnViz);\n            }}>\n            <span>{'˃'}</span>\n          </button>\n        </div>\n        <ReactTooltip id=\"contents-tooltip\" />\n        <div className={cx(\"loader-indication-wrapper\", {'is-loading': isLoading})}>\n          <div className=\"loader-indication-container\">\n            {lang === 'fr' ? 'Chargement de la visualisation' : 'Loading visualization'}\n          </div>\n        </div>\n      </div>\n      \n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/a-propos.mdx';\n\nimport ReferencesFr from '!babel-loader!mdx-loader!./contents/fr/references.mdx';\nimport ReferencesEn from '!babel-loader!mdx-loader!./contents/en/references.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le déclin de la région de La Rochelle suite à la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le déclin de la région de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spécialisation portuaire: le cas de la traite négrière, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spécialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'references',\n      en: 'references'\n    },\n    titles: {\n      fr: 'Références',\n      en: 'References'\n    },\n    shortTitles: {\n      fr: 'références',\n      en: 'references'\n    },\n    contents: {\n      fr: 'fr/references.mdx',\n      en: 'en/references.mdx'\n    },\n    contentsProcessed: {\n      fr: ReferencesFr,\n      en: ReferencesEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: 'À propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: 'à propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang = 'fr', summary }) {\n  const messages = {\n    intro: {\n      fr: 'découvrir les 3 chapitres de l’étude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accéder à l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .filter(item => item.routes[lang])\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        {/* @todo this is a react-snap trick that should be cleaned some day, removing it somehow breaks the pages building process */}\n        <Link to={navigator.userAgent === \"ReactSnap\" ? '/fr/atlas' : `/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport CitationWidget from '../../components/CitationWidget';\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nimport './Home.scss';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang = 'fr' }\n} }) {\n  const introRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const [inVis, setInVis] = useState(false);\n  const currentMetadata = metadata[lang] || metadataFr;\n  const title = currentMetadata.title;\n  const titleHTML = currentMetadata.titleHTML;\n  const subtitle = currentMetadata.subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    let newActiveVisualization;\n    // on parcourt la liste à l'envers pour récupérer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'écran\n    let firstOneY = Infinity;\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (visY < firstOneY) {\n          firstOneY = visY;\n        }\n        if (index === 0 && y < visY) {\n          found = true;\n          newActiveVisualization = visualization;\n        } /*else if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          newActiveVisualization = undefined;\n          break;\n        }*/ else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            newActiveVisualization = visualization;\n          } else {\n            newActiveVisualization = undefined;\n          }\n          break;\n        }\n      } else {\n        // console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n\n    if (scrollY > window.innerHeight * .9 && !inVis) {\n      setInVis(true);\n    } else if (scrollY < window.innerHeight * .9 && inVis) {\n      setInVis(false);\n    }\n\n    if (!found && scrollY < firstOneY && visualizationEntries.length) {\n      newActiveVisualization = visualizationEntries[0][1]\n    }\n    if (!found && activeVisualization) {\n      newActiveVisualization = undefined;\n    }\n    if (activeVisualization !== !newActiveVisualization) {\n      setActiveVisualization(newActiveVisualization)\n    } else if ((!activeVisualization && newActiveVisualization) || activeVisualization.id !== newActiveVisualization.id) {\n      setActiveVisualization(newActiveVisualization)\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <CitationWidget\n            lang={lang}\n          />\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n            <span>⌄</span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            \n            <section className={cx({'is-focused': !focusOnViz})}>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside className={cx({'is-focused': focusOnViz, 'is-fixed': inVis})}>\n              <VisualizationController lang={lang} activeVisualization={activeVisualization} />\n            </aside>\n            \n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associée' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{'˃'}</span>\n          </button>\n        </div>\n      </main>\n      <ReactTooltip id=\"contents-tooltip\" />\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la région Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from '../../components/VisualizationFocus/VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nimport './Atlas.scss';\n\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang = 'fr'\n    }\n  }\n}) {\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  const [isLoading, setIsLoading] = useState(false);\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className={cx(\"Atlas secondary-page\", {'has-focus': shownVisualization})}>\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>{lang === 'fr' ? 'Atlas des visualisations' : 'Visualizations atlas'}</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations.map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                setIsLoading(true);\n                setTimeout(() => {\n                  history.push({\n                    pathname: `/${lang}/atlas/${visualization.id}`\n                  });\n                  setIsLoading(false);\n                }, 100)\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                      <img\n                        src={`${process.env.PUBLIC_URL}/thumbnails/${lang}/${visualization.id}.png`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n        <VisualizationFocus \n          visualization={shownVisualization} \n          lang={lang}\n          onClose={() => {\n            history.push({\n              pathname: `/${lang}/atlas/`\n            })\n          }}\n        />\n        <div className={cx(\"loader-indication-wrapper\", {'is-loading': isLoading})}>\n          <div className=\"loader-indication-container\">\n            {lang === 'fr' ? 'Chargement de la visualisation' : 'Loading visualization'}\n          </div>\n        </div>\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import StandaloneVisualization from './StandaloneVisualization';\n\nexport default StandaloneVisualization;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\nimport './StandaloneVisualization';\n\nimport visualizationsList from '../../visualizationsList.json';\nconst StandaloneVisualization = ({\n  id,\n  lang\n}) => {\n  const visualization = visualizationsList.find(({id: thatId}) => thatId === id)\n  return (\n    <div className=\"StandaloneVisualization\">\n      <VisualizationController lang={lang} atlasMode screenshotMode activeVisualization={visualization} />\n    </div>\n  )\n}\n\nexport default StandaloneVisualization;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import { Suspense } from 'react';\nimport { Helmet } from \"react-helmet\";\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport './PlainPage.scss';\n\nconst PlainPage = ({\n  Content,\n  ContentSync,\n  title,\n  lang = 'fr',\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        {\n          ContentSync ?\n            <ContentSync />\n            :\n            <Suspense fallback={<div>Chargement</div>}>\n              <Content />\n            </Suspense>\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default PlainPage;","import React, { useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { NavLink as Link } from 'react-router-dom';\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport { scaleLinear } from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\n/**\n * Displays header nav handling active link and background color change\n * @param {array<object>} routes\n * @param {function} onLangChange\n * @returns {React.ReactElement} - React component \n */\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/part')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n\n  const liveScrollY = useScrollYPosition();\n  const scrollY = useDebounce(liveScrollY, 50)\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const { fontColor, backgroundColor } = useMemo(() => {\n    const screenHeight = window.innerHeight;\n    switch (pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n\n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: colorBackground\n        }\n\n    }\n\n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                  :\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link to={`/${lang}/atlas`}>\n              {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n          <li className=\"navitem-container lang-toggle\">\n            <button\n              className={lang === 'fr' ? 'is-active' : ''}\n              onClick={() => onLangChange('fr')}\n            >fr</button>\n          </li>\n          <li className=\"navitem-container lang-toggle\">\n            <button\n              className={lang === 'en' ? 'is-active' : ''}\n              onClick={() => onLangChange('en')}\n            >en</button>\n          </li>\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", { 'is-open': drawerIsOpen })}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n          <ul className=\"primary-nav-container\">\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link exact to={`/${lang}/`}>\n                {lang === 'fr' ? 'accueil' : 'home'}\n              </Link>\n            </li>\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n          </ul>\n          <ul className=\"secondary-nav-container\">\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n                <li className=\"navitem-container lang-toggle\">\n                  <ul className=\"lang-toggle-container\">\n                    <li>\n                      <button\n                        className={lang === 'fr' ? 'is-active' : ''}\n                        onClick={() => onLangChange('fr')}\n                      >fr</button>\n                    </li>\n                    <li>\n                      <button\n                        className={lang === 'en' ? 'is-active' : ''}\n                        onClick={() => onLangChange('en')}\n                      >en</button>\n                    </li>\n                  </ul>\n\n                </li>\n                :\n                null\n            }\n\n\n          </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n            }} dangerouslySetInnerHTML={{ __html: title }} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","import cx from 'classnames';\n\nimport './Loader.scss';\n\n/**\n * A basic full-size loader with loading bar\n * @param {number} percentsLoaded\n * @returns {React.ReactElement} - React component \n */\nconst Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className={cx(\"Loader\", {'is-complete': percentsLoaded === 100})}>\n      <div className=\"loader-container\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/en/footer.mdx';\n\n/**\n * Displays the footer from attached mdx contents\n * @param {string} lang\n * @returns {React.ReactElement} - React component\n */\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/**\n * Entrypoint of the application\n */\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n  Link,\n} from \"react-router-dom\";\nimport uniq from 'lodash/uniq';\nimport { csvParse, tsvParse } from 'd3-dsv';\nimport axios from 'axios';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\nimport StandaloneVisualization from \"./pages/StandaloneVisualization\";\nimport PlainPage from './pages/PlainPage';\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\nimport Footer from \"./components/Footer\";\n\n/* import utils */\nimport { DatasetsContext } from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport visualizationsList from './visualizationsList';\nimport { homepage } from '../package.json';\nimport routes from './summary';\n\nconst LANGUAGES = ['fr', 'en'];\n\n\n/**\n * General application container - handles routing logic, data retrieval, and lang toggle\n * @returns  {React.ReactElement} - React component\n */\nfunction App() {\n  const history = useHistory();\n  const location = useLocation();\n\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n  useEffect(() => {\n    // loading all datasets from the atlas\n    // note: it would be preferable to do this on a page-to-page basis if datasets happens to be too big/numerous\n    const datasetsNames = uniq(\n      visualizationsList\n        .filter(d => d.datasets)\n        .reduce(\n          (res, d) => [\n            ...res,\n            ...d.datasets.split(',').map(d => d.trim())],\n          [])\n    );\n    // console.groupCollapsed('loading data');\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          // console.info('get', url);\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              let status = progressEvent.loaded / progressEvent.total;\n              status = status > 1 ? 1 : status;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              // console.info(parseInt(globalFraction * 100) + '%')\n              setLoadingFraction(globalFraction + status / datasetsNames.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({ ...res, [datasetName]: loadedData })\n              })\n            })\n            // make get errors non-blocking to get all available datasets in the app even if some are broken\n            .catch(err => {\n              console.error(err);\n              return resolve(res);\n            })\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n      .then(newDatasets => {\n        // console.groupEnd('loading data');\n        setLoadingFraction(1);\n        setDatasets(newDatasets)\n      })\n      .catch(console.error)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    // @todo this is dirty, refactor this to be handled based on the routes config JSON ?\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n    lang,\n  }) => {\n    return (\n      <>\n        <ThatComponent\n          {\n          ...{\n            Content,\n            ContentSync,\n            title,\n            lang\n          }\n          }\n        />\n      </>\n\n    )\n  };\n  const currentLang = location.pathname.includes('/en/') ? 'en' : 'fr';\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        <header>\n          <HeaderNav {...{ onLangChange, routes }} />\n        </header>\n        <main>\n          <Switch>\n            {// looping through the page\n              LANGUAGES.map(lang => {\n                return routes\n                  .map(({\n                    titles,\n                    routes: inputRoute,\n                    contents,\n                    Component: ThatComponent,\n                    contentsProcessed,\n                  }, index) => {\n                    const route = `/${lang}/page/${inputRoute[lang]}`\n                    const title = titles[lang];\n                    // @todo remove Content as it is not used anymore ? (importing md content with React.lazy did not play nice with scrollytelling-related features)\n                    const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                    const ContentSync = contentsProcessed[lang];\n                    return (\n                      <Route key={index} path={route} exact>\n                        {renderRoute({ Content, ThatComponent, title, ContentSync, lang })}\n                      </Route>\n                    )\n                  })\n              })\n            }\n            {\n              LANGUAGES.map(lang => {\n                return visualizationsList\n                  .map(({\n                    id\n                  }, index) => {\n                    const route = `/${lang}/visualization/${id}`;\n                    return (\n                      <Route key={index} path={route} exact component={() => <StandaloneVisualization {...{ id, lang }} />} />\n                    )\n                  })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/${currentLang}/`} />\n          </Switch>\n          <Loader percentsLoaded={loadingFraction * 100} />\n        </main>\n        <Footer\n          lang={currentLang}\n        />\n\n\n      </div>\n      {/* following react fragment is aimed at allowing react-snap to parse all the pages that have a dynamic URL */}\n      <React.Fragment>\n        {// looping through the pages to add a blank link to all of them\n          LANGUAGES.map(lang => {\n            return routes\n              // @todo this is dirty and should be removed at some point (test page is not exported in prod, so no need for react-snap)\n              .filter(({ routes }) => routes[lang] && !routes[lang].includes('test'))\n              .map(({\n                routes: inputRoute,\n              }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n        {// looping through all the atlas visualizations links\n          LANGUAGES.map(lang => {\n            return visualizationsList\n              .map(({\n                id\n              }, index) => {\n                const route = `/${lang}/atlas/${id}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n      </React.Fragment>\n    </DatasetsContext.Provider>\n  );\n}\n\n/**\n * the following variable is aimed at allowing browser-router to function\n * for deployments on gh-pages (prefixing all routes with the repo name to match ghp URL pattern e.g. https://username.github.io/projectname/)\n */\nconst BASE_NAME =\n  process.env.NODE_ENV === 'development'\n    ? undefined\n    : `/${homepage.split('/').pop()}`;\n\n\n/**\n * Wrapper of the router and application\n * @returns  {React.ReactElement} - React component\n */\nexport default function Wrapper() {\n  return (\n    <Router basename={BASE_NAME}>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { useEffect, useRef, useState } from 'react';\n\n/**\n * Runs a given function each {delay} miliseconds\n * @param {function} callback\n * @param {number} delay - in ms\n * @returns {void}\n */\nexport function useInterval(callback, delay = 100) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\n/**\n * Debounces the update of a value given a certain delay\n * @param {any} value\n * @param {number} delay - in ms\n * @returns {any} - returned value\n */\nexport function useDebounce(value, delay = 100) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay]\n  );\n\n  return debouncedValue;\n}\n\n/**\n * Records the previous value of a given value\n * @param {any} value\n * @returns {any} previous value\n */\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-échelles autour du port de La Rochelle au XVIIIème siècle\",\n  \"titleHTML\": \"Commerce multi-échelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> siècle\",\n  \"subtitle\": \"Une étude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Multiscale trade in eighteenth-century La Rochelle region\",\n  \"titleHTML\": \"Multiscale trade in eighteenth-century La Rochelle region\",\n  \"subtitle\": \"A case study from the PORTIC interdisciplinary research program\"\n}"],"sourceRoot":""}