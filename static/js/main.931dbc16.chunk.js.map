{"version":3,"sources":["visualizations/PrincipalVisualizationPart3/ExtraversionObject.js","visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js","components/NetworkGraphChart/reducers.js","components/NetworkGraphChart/GraphContainer.js","i18n/translate.js","helpers/misc.js","components/TriangleChart/PortGroup.js","components/TriangleChart/TriangleChart.js","colorPalettes.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","contents/fr/partie-1.mdx","components/Caller/Caller.js","components/Caller/index.js","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/a-propos.mdx","contents/fr/references.mdx","contents/en/references.mdx","contents/en/tests.mdx","contents/fr/footer.mdx","contents/en/footer.mdx","components/SvgChart/SvgChart.js","components/GeographicMapChart/index.js","components/NetworkGraphChart/index.js","components/DataProvider/index.js","components/TriangleChart/index.js","components/DataProvider/DataProvider.js","contents/fr/tests.mdx","components/LineChart/LineChart.js","components/LineChart/index.js","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","helpers/contexts.js","components/GeographicMapChart/ChoroplethLayer.js","components/GeographicMapChart/PointsLayer.js","components/GeographicMapChart/FlowsLayer.js","components/GeographicMapChart/CustomObjectLayer.js","components/GeographicMapChart/Button.js","components/GeographicMapChart/Input.js","components/GeographicMapChart/Legend.js","components/GeographicMapChart/GeographicMapChart.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/BarChart.js","components/BarChart/index.js","../ /^/.//.*$/ groupOptions: {} namespace object","components/CitationWidget/mla-fr.mdx","components/CitationWidget/mla-en.mdx","components/CitationWidget/iso-fr.mdx","components/CitationWidget/apa-fr.mdx","components/CitationWidget/apa-en.mdx","components/CitationWidget/doi.mdx","components/CitationWidget/CitationWidget.js","components/CitationWidget/index.js","visualizations/Test.js","components/DeclineChart/LongitudinalTradeChart.js","components/DeclineChart/ProductsDistributionChart.js","components/DeclineChart/index.js","components/DeclineChart/DeclineChart.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialChart/animatedPrimities.js","components/CircularAlluvialChart/CircularAlluvialChart.js","components/CircularAlluvialChart/utils.js","components/SliderRange/SliderRange.js","components/SliderRange/index.js","components/RadarPlot/AxisObject.js","components/RadarPlot/VisObject.js","components/RadarPlot/index.js","components/RadarPlot/RadarPlot.js","visualizations/PrincipalVisualizationPart2/RadarWrapper.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/Step2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/IntroBureaux/IntroBureaux.js","visualizations/IntroBureaux/index.js","visualizations/HomeportFlows/HomeportFlows.js","components/TreemapChart/TreemapChart.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","components/VisualizationFocus/VisualizationFocus.js","components/VisualizationFocus/index.js","pages/ScrollyPage/ScrollyPage.js","pages/ScrollyPage/index.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","pages/StandaloneVisualization/index.js","pages/StandaloneVisualization/StandaloneVisualization.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/hooks.js","contents/fr/metadata.js","contents/en/metadata.js"],"names":["ExtraversionObject","navigoValues","metric1","metric2","toflitPct","transformGroup","inputCircleRadius","circleRadius","inputWidth","width","inputHeight","height","name","legendMode","isActive","isMinified","onClick","fixSvgDimension","useState","isInited","setIsInited","useEffect","setTimeout","ReactTooltip","rebuild","leftPath","rightPath","transform","useSpring","to","immediate","maxTriangleHeight","maxArea","area1","area2","leftTriangleHeight","Math","sqrt","rightTriangleHeight","start","end","PI","partialCircle","map","command","join","lang","useContext","SettingsContext","labelFontSize","parseInt","g","className","cx","undefined","d","stroke","colorsPalettes","generic","accent2","strokeWidth","fill","data-for","data-tip","translate","number","toFixed","onclick","ui","colorAccentBackground","max","font-size","textAnchor","x","y","x1","y1","x2","y2","markerEnd","Step3Object","datum","projection","projectionTemplate","longitude","latitude","totalTonnage","parseFloat","cumulated_tonnage_out_region","cumulated_tonnage_in_region","type_of_object","navigoMetric1","navigoMetric2","inPercentage","totalValue","cumulated_exports_value_from_region","cumulated_exports_value_from_ext","noOverlapTransform","includes","isNaN","Step3Objects","data","customsOffices","ports","selectedBureau","setSelectedBureau","handleClick","visiblePorts","useMemo","filter","customs_office","portsSpaceStartY","portsSpaceHeight","portsSpaceWidth","portRowHeight","length","sort","a","b","yA","port","portIndex","initialCircleRadius","objectX","objectY","cy","r","style","dark","index","SmallMultiples","bureaux","unshift","margin","multiplesY","columnWidth","xObjectsStart","opacity","position","left","bottom","custom_office","id","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient","renderTriangles","atlasMode","TriangleChart","totalWidth","rowHeight","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","ratio","sizes","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","field","values","attr","uniq","palette","colors","generatePalette","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","smallerNode","Color","lighten","rgb","string","createEdgeReducer","container","useRef","renderer","setRenderer","getCamera","animate","needToRefresh","settings","labelGrid","cell","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","labelFont","camera","setState","getState","disable","on","state","current","ref","minHeight","minWidth","NetworkGraphChart","gexfString","spatialize","inputCameraPosition","angle","title","headerRef","headerHeight","getBoundingClientRect","setCameraPosition","find","prop","gexf","parse","Graph","forceAtlas2","inferSettings","assign","iterations","flex","cam","matchDollarBracket","RegExp","vizId","label","args","json","result","replace","match","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","currentMetadata","trimText","str","limit","words","split","output","slice","cartesian2Polar","distance","radians","atan2","polarToCartesian","theta","cos","sin","count","accent1","iwanthue","colorSpace","seed","clustering","num","abs","formatNumber","n","reverse","reduce","digit","PortGroup","numberOfColumns","scaleX","scaleY","legendWidth","totalHeight","margins","fontSize","triangleWidth","nb_pointcalls_out","triangleHeight","mean_tonnage","xTransform","yTransform","markerRadius","staticTransform","cellCenterX","textStartY","triangleStartY","legendTextWidth","labelBgWidth","line","strokeDasharray","circle","markerStart","xmlns","transformOrigin","inputMargins","right","offset","stopColor","stopOpacity","xa","tonnageClasses","tonnageClassesEn","franceAlone","portsTreemaps","portsTreemapsEn","readingTime","layoutProps","MDXContent","components","props","mdxType","href","target","rel","isMDXComponent","tableOfContents","frontMatter","step","Caller","visualizationId","genId","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","payload","e","process","highlight","minTonnage","level","children","parentName","SvgChart","GeographicMapChart","DataProvider","dataFilename","setData","loadingData","setLoadingData","dataURL","then","newData","extension","pop","csvParse","catch","err","backgroundData","visData","layers","type","renderObjects","colorPalettes","provinces","admiralties","backgroundFilename","markerColor","markerSize","showLabels","LineChart","initialWidth","initialHeight","tooltip","annotations","headersHeight","setHeadersHeight","setLegendWidth","legendRef","newHeadersHeight","newLegendWidth","colorPalette","top","yTickFormat","tickFormat","yTickSpan","tickSpan","initialYDomain","fillGaps","xTickFormat","xTickSpan","initialXDomain","colorModalities","colorValues","modality","xDomain","yDomain","xScale","nice","yScale","groups","Object","entries","groupBy","xAxisValues","axisPropsFromTickScale","yAxisValues","legendTitle","marginLeft","value","valueIndex","axis","annotation","annotationIndex","labelPosition","thatHeight","thatY1","thatY2","points","patternUnits","thatX1","thatX2","groupIndex","groupName","items","item","itemIndex","next","consecutive","hasNext","genreIndex","genre","background","PASS_DURATION","Hull","bottomRightX","bottomLeftX","Sail","sailSpeed","randomFactor","random","minRightX","maxLeftX","maxRightX","step1","step2","loop","from","config","duration","polygon","Matt","secondWidth","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","BoatsIllustration","useReducer","action","boat","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","clearTimeout","useInterval","now","React","createContext","DatasetsContext","GeoPart","initialD","project","layer","isAnimated","animated","boundsAbs","geoPath","bounds","xMin","xMax","yMin","yMax","outOfBounds","currentD","animationProps","path","properties","shortname","ChoroplethLayer","reverseColors","console","info","features","generatedPalette","geometry","PointGroup","onGroupMouseEnter","onGroupMouseLeave","displayLabel","area","rawSize","labelSize","zIndex","onMouseEnter","onMouseMove","onMouseLeave","displayMetric","labelsColor","StackedLabelGroup","thatIndex","stackedRowHeight","transformLabel","window","innerWidth","labelY","PointsLayer","hoveredIndex","setHoveredIndex","visibleMarkers","coordsMap","mark","grouped","sizeCoef","custom","areaRange","sizeScale","labelSizeScale","stackedLabelsTop","maxLabelFontSize","innerHeight","stackLabels","enter","leave","FlowGroup","hovered","inputXDep","xDep","inputYDep","yDep","inputXDest","xDest","inputYDest","yDest","inputStrokeWidth","actualXDep","actualYDep","actualXDest","actualYDest","arrowLength","arrowPath","FlowsLayer","markerData","strokeWidthScale","flow","arrowSizeScale","copy","arrowSize","latitude_dep","longitude_dep","latitude_dest","longitude_dest","hideOverflowingFlows","depLabelPosition","destLabelPosition","depLabelTextAnchor","depLabelX","depLabelY","destLabelTextAnchor","destLabelX","destLabelY","labels","newLabels","depId","fields","largerStrokeWidth","flows","destId","actualX","j","label1","label2","minAx","minAy","maxAx","maxAy","minBx","minBy","maxBx","aAboveB","aBelowB","distanceY","hoverIds","setHoverIds","thatLabel","isVisible","hoveredId","CustomObjectLayer","renderObject","Button","onMouseDown","isMouseDown","interval","log","setInterval","clearInterval","onMouseUp","Input","inputValue","onBlur","setValue","onChange","Legend","layerFilter","l","hasSize","hasColors","modalityIndex","initialProjectionTemplate","inputProjectionConfig","projectionConfig","debug","withLegend","legendLayerFilter","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","setProjectionTemplate","defaultProjectionConfig","rotationDegree","geoEqualEarth","center","placeHolder","val","layerIndex","HorizontalBarChart","orientation","layout","Tooltip","yField","sortY","fillXGaps","xField","sortX","sortYField","ascending","sortYAscending","sortYType","autoSort","yAutoSort","sortXField","sortXAscending","sortXType","xValues","vizWidth","bandsNb","scaleBand","xExtent","sum","bandWidth","yStackScale","multiplier","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","fixedRowHeight","formatLabel","vizHeight","indexOf","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX","thatWidth","BarChart","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","keys","module","exports","CONTENTS","FrMla","FrIso690","FrApa","Doi","EnMla","APA","EnApa","CitationWidget","blockquoteRef","isCollapsed","setIsCollapsed","currentStyle","setCurrentStyle","Contents","Test","datasets","datasetName","JSON","stringify","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","barTooltipFn","cityName","highlightYears","colorScaleMessages","year","footerRef","setHeight","newHeight","offsetHeight","yearsExtent","yearsEnumerated","xBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","yShareScale","rightYAxisValues","leftYAxisValue","maximum","minimum","marginRight","bandwidth","aStartYear","aEndYear","data-effect","data-html","data-class","data-place","initialEndYear","row","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","her","labelScale","element","maxWidth","backgroundColor","DeclineChart","productTradePartThreshold","rows","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","austriaWar","usIndependance","laRochelleDiaspora","totalRows","renderRow","rowFlex","rowIndex","region","comparison","rowId","PrincipalVisualizationPart1","G","inputProps","Text","text","Line","Circle","Rect","rect","Path","colorSchemes","colorScheme1","colorScheme2","colorScheme3","CircularAlluvialChart","sumBy","filters","centerHorizontalLabels","displaceHorizontalLabels","tooltips","align","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","spec","stepsSpec","_id","stepIndex","stepData","valueAbs","actualValue","labelField","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","VERTICAL_BAR_SIZE","stepScales","0","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","legendX1","legendX2","legendTopYInternal","legendTopYExternal","legendBottomYInternal","legendBottomYExternal","tooltipContent","fontWeight","fontStyle","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","flow_type","tContent","partner","trim","nodeHeight","initialY","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","flowX","flowY","flowWidth","flowHeight","Range","createSliderWithTooltip","Slider","SliderRange","allowCross","AxisObject","MARGIN","axisIndex","axisRankScale","rawX1","rawY1","rawX2","rawY2","labelXDisplace","labelYDisplace","foreignObject","inputX","inputY","inputR","VisObject","axisIndexMap","radiusScale","xRaw","yRaw","joinedPoints","tooltipValues","sumOfParts","portionA","portion","fillOpacity","RadarPlot","wholeSize","aIndex","visCenter","visSize","meta","normalizeRadarValues","datas","destCaptions","maxValue","maxBy","hasOwnProperty","dkey","RadarWrapper","globalWidth","minified","navigoAgregation","maxTonnage","selectedBureaux","setSelectedBureaux","aggregationMethod","setAggregationMethod","tonnageFilterValues","setTonnageFilterValues","datasetMaximumTonnage","setDatasetMaximumTonnage","destination_radar","ferme_bureau","destination_radar_fr","destination_radar_en","tonnage","bureauxList","uniqBy","filteredData","bureauxToKeep","cleanBureaux","radarData","bureauName","relevantData","preparedData","_","dest","rObj","prepareTonnageData","prepareTravelData","method","bureau","newSelectedBureaux","has","delete","add","PrincipalVisualizationPart2","showOnlyToflit","screenshotMode","sumToflitBy","alluvialFilters","toflit18titles","navigoTitles","importTranslate","exportTranslate","flow_direction","Step2","paddingLeft","metrics_type","PrincipalVisualizationPart3","currentMapTemplate","setCurrentMapTemplate","gradientTransform","colorBackgroundBlue","customs_region","BureauBackground","radius","BureauLabel","labelOnRight","IntroBureaux","dimensions","renderBureaux","HomeportFlows","hotFixedData","port_dest","port_dest_category","formatNestResults","input","isArray","TreemapChart","fieldsHierarchy","leaf","countField","root","nest","hierarchy","treemap","tile","treemapBinary","leaves","x0","y0","rectWidth","rectHeight","labelText","VisualizationContainer","inputDimensions","relevantDatasets","viz","visualizationsList","datasetsIds","Provider","order","value_rel_per_direction","entite","entity","nb_pointcalls","country","borderBottom","raw_size","omit","homeport","category","category_2","category_2_en","thatPalette","homeport_en","customsRegion","origin","VisualizationController","setDimensions","visProps","onResize","contentRect","measureRef","VisualizationFocus","howDone","howRead","visualization","onClose","copyClicked","setCopyClicked","inputRef","focus","copyLink","linkCopied","onKeyUp","keyCode","stopPropagation","url","homepage","visualizationsMap","visualizations","ScrollyPage","ContentSync","sectionRef","focusOnViz","setFocusOnViz","visualizationIsFullScreen","setVisualizationIsFullScreen","isLoading","setIsLoading","setActiveVisualization","newState","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","visualizationEntries","sectionDims","visY","behavior","params","finalParams","newVis","thatId","Helmet","summary","routes","titles","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","ReferencesFr","ReferencesEn","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","route","navigator","userAgent","Home","introRef","inVis","setInVis","titleHTML","subtitle","newActiveVisualization","firstOneY","Infinity","dangerouslySetInnerHTML","__html","Atlas","history","useHistory","shownVisualization","visualizationIndex","pathname","src","alt","StandaloneVisualization","PlainPage","Content","fallback","colorText","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","useDebounce","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","tsvParse","error","newDatasets","renderRoute","ThatComponent","currentLang","ln","otherLang","pathOtherLang","routeItem","lazy","component","Fragment","BASE_NAME","Wrapper","basename","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","callback","delay","savedCallback","debouncedValue","setDebouncedValue","handler"],"mappings":"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","file":"static/js/main.931dbc16.chunk.js","sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { animated, useSpring } from 'react-spring';\nimport cx from 'classnames';\nimport colorsPalettes from '../../colorPalettes';\n\nimport partialCircle from 'svg-partial-circle';\nimport { max } from 'd3';\nimport ReactTooltip from 'react-tooltip';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport { SettingsContext } from '../../helpers/contexts';\nimport translate from '../../i18n/translate';\n\n\n/**\n * Renders custom viz object (triangles + donuts)\n * @param {array<number>} navigoValues\n * @param {number} toflitPct - pct of exports of locally produced products\n * @param {string} transformGroup - css transform\n * @param {number} circleRadius\n * @param {number} width\n * @param {number} height\n * @param {string} name\n * @param {boolean} legendMode\n * @param {boolean} isActive\n * @param {boolean} isMinified\n * @param {function} onClick\n * @returns {React.ReactElement} - React component\n */\nconst ExtraversionObject = ({\n  navigoValues: [metric1, metric2],\n  toflitPct,\n  transformGroup,\n  circleRadius: inputCircleRadius,\n  width: inputWidth,\n  height: inputHeight,\n  name,\n  legendMode,\n  isActive,\n  isMinified,\n  onClick,\n}) => {\n  const circleRadius = fixSvgDimension(inputCircleRadius);\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  const { transform } = useSpring({\n    to: {\n      transform: transformGroup\n    },\n    immediate: !isInited\n  });\n\n\n  const maxTriangleHeight = (circleRadius) * 1.4;\n  // dimensionning triangles based on their area (and not triangle height)\n  // Area = (height * base) / 2;\n  const maxArea = maxTriangleHeight * (maxTriangleHeight) / 2;\n  const area1 = metric1 * maxArea;\n  const area2 = metric2 * maxArea;\n  const leftTriangleHeight = Math.sqrt(area1 * metric1);\n  const rightTriangleHeight = Math.sqrt(area2 * metric2);\n\n  let start = null\n  let end = null\n  let leftPath;\n  let rightPath;\n  if (toflitPct) {\n    // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement rparti en bas  droite si co sans coords\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (toflitPct - 50) / 100 * Math.PI\n    end = Math.PI * 3 / 2 - (toflitPct - 50) / 100 * Math.PI\n\n    leftPath = partialCircle(\n      0, 0,         // center X and Y\n      circleRadius,              // radius\n      start,          // start angle in radians --> Math.PI / 4\n      end             // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n    rightPath = partialCircle(\n      0, 0,             // center X and Y\n      circleRadius,                  // radius\n      start,              // start angle in radians --> Math.PI / 4\n      end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n  }\n\n  const { lang } = useContext(SettingsContext);\n\n  let labelFontSize = parseInt(height * 0.013);\n  labelFontSize = labelFontSize > 8 ? labelFontSize : 8;\n  return (\n    <animated.g\n      className={cx('ExtraversionObject', { 'is-active': isActive, 'is-minified': isMinified })}\n      // transform={noOverlapTransform}\n      transform={transform}\n      onClick={() => typeof onClick === 'function' ? onClick(name) : undefined}\n    // { datum.longitude === 0 ? x=1 : null }\n    >\n\n      <>\n        {\n          toflitPct && leftPath != null ?\n            <>\n\n              <path\n                d={`${leftPath}\n                  `}\n                stroke={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n                strokeWidth={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                // data-tip={`${(100 - toflitPct ).toFixed(1)}% de valeur d'exports de produits fabriqus hors de la direction ${typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : ''}`}\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_export_out', lang, { number: (100 - toflitPct ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_export_out', lang, { number: (100 - toflitPct ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n              />\n\n              <path\n                d={`${rightPath}\n                  `}\n                stroke={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n                strokeWidth={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n                data-for=\"geo-tooltip\"\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_export_in', lang, { number: (toflitPct).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_export_in', lang, { number: (toflitPct).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n              />\n            </>\n            :\n            null\n        }\n        <path className='left-triangle'\n          fill={legendMode ? 'darkgrey' : colorsPalettes.generic.accent2}\n          d={`M ${0} ${-leftTriangleHeight / 2}\n            V ${leftTriangleHeight / 2}\n            L ${-leftTriangleHeight} ${0}\n            Z\n                `}\n                data-for=\"geo-tooltip\"\n                data-tip={\n                  (lang === 'fr' && translate('viz-principale-partie-3', 'value_tonnage_out', lang, { number: (metric1 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : '' })) ||\n                  translate('viz-principale-partie-3', 'value_tonnage_out', lang, { number: (metric1 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n                }\n        />\n\n        <path\n          className='right-triangle'\n          fill={legendMode ? 'grey' : colorsPalettes.ui.colorAccentBackground}\n          d={`M ${0} ${-rightTriangleHeight / 2}\n            L ${rightTriangleHeight} ${0}\n            L ${0} ${rightTriangleHeight / 2}\n            Z\n            `}\n            data-for=\"geo-tooltip\"\n            data-tip={\n              (lang === 'fr' && translate('viz-principale-partie-3', 'value_tonnage_in', lang, { number: (metric2 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(cliquer pour voir le dtail des ports)' : '' })) ||\n              translate('viz-principale-partie-3', 'value_tonnage_in', lang, { number: (metric2 * 100 ).toFixed(1), onclick: typeof onClick === 'function' ? '(click to see the details of the ports)' : '' })\n            }\n        />\n        <g\n          transform={`translate(${parseInt(0)}, ${toflitPct ? parseInt(circleRadius) + 15 : max([leftTriangleHeight, rightTriangleHeight]) / 2 + 10})`}\n        >\n          <text\n            className='object-label'\n            font-size={labelFontSize}\n            textAnchor=\"middle\"\n          >\n            {name}\n          </text>\n        </g>\n      </>\n      {\n        legendMode ?\n          <g className=\"legend-container\">\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={-circleRadius * 1.7}\n              className=\"top left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_export_out', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * .95}\n              y1={-circleRadius * 1.5}\n              x2={-circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={-circleRadius * 1.7}\n              className=\"top right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                {translate('viz-principale-partie-3', 'foreignObject_export_in', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 1.15}\n              y1={-circleRadius * 1.5}\n              x2={circleRadius * .5}\n              y2={-circleRadius * 1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={-circleRadius * 3}\n              y={0}\n              className=\"bottom left\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_flow_out', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={-circleRadius * 1.8}\n              y1={circleRadius * .2}\n              x2={-circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n            <foreignObject\n              width={circleRadius * 2}\n              height={circleRadius * 2}\n              x={circleRadius * 1.2}\n              y={0}\n              className=\"bottom right\"\n            >\n              <div className=\"label-wrapper\">\n                <span>\n                  {translate('viz-principale-partie-3', 'foreignObject_flow_in', lang)}\n                </span>\n              </div>\n            </foreignObject>\n            <line\n              x1={circleRadius * 2}\n              y1={circleRadius * .2}\n              x2={circleRadius * .3}\n              y2={circleRadius * .1}\n              markerEnd=\"url(#triangle-end)\"\n            />\n\n          </g>\n          : null\n      }\n    </animated.g>);\n}\n\nexport default ExtraversionObject;","/*\nDOCUMENTATION : sommaires des fonctions\n\n- renderLabel (renderObject)\npositionner geographiquement des labels\n\n- renderStep3Object (renderObject)\ncration d'un double triangle et d'un cercle autour (deux courbes de bzier), positionn gographiquement\n(objet associ  un bureau des Fermes)\n\n- fonction renderStep3SmallMultiples (renderObjects)\ncration des objets double triangle et cercles pour les small multiples de la viz 3.3, positionns en bas  droite du SVG\n+ un objet de lgende\n\n- renderTriangles (renderObjects)\ncration des triangles pour la viz 3.1, relis par une courbe pointille  des points positionns gographiquement\n+ un triangle de lgende\n\n@TODO : complter la fonction step3Object (ou crer une nouvelle fonction), pour grer l'apparition des doubles triangles pour chaque port\n-  cette fonctionnalit est dj prvue dans la fonction renderStep3Object (dans la boucle   if (datum.type_of_object === \"port\") { ...}) mais en l'tat les objets ports sont positionns gographiquement\n- il faudrait adapter pour positionner les objets ports en colonne, sur la gauche du SVG, et qu'ils aient par dfaut une opacit  0% sauf au hover de l'objet bureau des fermes correspondant => apparition\n\n*/\nimport { useMemo, useState, useContext } from 'react';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport ExtraversionObject from './ExtraversionObject';\n\nimport { SettingsContext } from '../../helpers/contexts';\n\nimport TriangleChart from '../../components/TriangleChart/TriangleChart';\nimport { fixSvgDimension } from '../../helpers/misc';\nimport translate from '../../i18n/translate';\n\nexport function Label(datum, projection, { width }) { //  terme on pourrait mettre un objet \n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text size={width * 0.05}>{datum.label}</text>\n    </g>);\n}\n\n/**\n * Render an object in viz 3.3\n * @param {object} datum\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @param {boolean} isActive\n * @param {boolean} isMinified\n * @param {function} onClick\n * @returns {React.ReactElement} - React component\n */\nfunction Step3Object({\n  datum,\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate,\n  isActive,\n  isMinified,\n  onClick\n}) { //  priori plus besoin de datum et de width qui sont dj passs au composant CustomObjectLayer\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  let circleRadius = width * 0.05;\n  const totalTonnage = parseFloat(datum.cumulated_tonnage_out_region) + parseFloat(datum.cumulated_tonnage_in_region)\n\n  if (datum.type_of_object === \"port\") {\n    // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n    // se grerait bien avec un switch\n    if (totalTonnage < 1000) { // * 1000\n      circleRadius = width * 0.025\n    }\n    else {\n      if (totalTonnage > 5000) {\n        circleRadius = width * 0.075\n      }\n    }\n  }\n\n  const navigoMetric1 = parseFloat(datum.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n  const navigoMetric2 = parseFloat(datum.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n  let inPercentage = 0;\n  if (datum.type_of_object === \"customs_office\") {\n    const totalValue = parseFloat(datum.cumulated_exports_value_from_region) + parseFloat(datum.cumulated_exports_value_from_ext)\n    inPercentage = parseFloat(datum.cumulated_exports_value_from_region) / totalValue * 100\n    inPercentage = inPercentage === 100 ? 99.99 : inPercentage;\n  }\n\n  // handle overlap \n  let noOverlapTransform = `translate(${x},${y})` // mettre entre accolades ??\n  if (projectionTemplate.includes('Poitou')) {\n    if (datum.name === 'Tonnay-Charente') {\n      noOverlapTransform = `translate(${x + width * 0.15},${y})`\n    }\n    else if ((datum.name === 'Rochefort')) {\n      noOverlapTransform = `translate(${x + width * 0.04},${y - height * 0.0})`\n    }\n    else if ((datum.name === 'Marennes')) {\n      noOverlapTransform = `translate(${x - width * 0.03},${y + height * 0.05})`\n    }\n    else if ((datum.name === 'Marans')) {\n      noOverlapTransform = `translate(${x + width * 0.03},${y - height * 0.05})`\n    }\n    else if ((datum.name === 'Saint-Martin-de-R')) {\n      noOverlapTransform = `translate(${x - width * 0.06},${y})`\n    }\n    else if ((datum.name === `Les Sables-d'Olonne`)) {\n      noOverlapTransform = `translate(${x - width * 0.01},${y - height * 0.03})`\n    }\n  }\n  \n\n  const transformGroup = projectionTemplate === 'France' ? noOverlapTransform + ' scale(0.1)' : noOverlapTransform + ` scale(${isMinified ? 0.5 : 1})`;\n  return (\n    <ExtraversionObject\n      {\n      ...{\n        transformGroup,\n        navigoValues: [navigoMetric1, navigoMetric2],\n        toflitPct: !isNaN(inPercentage) ? inPercentage : 100,\n        circleRadius,\n        width,\n        height,\n        name: datum.name,\n        isActive,\n        isMinified,\n        onClick\n      }\n      }\n    />\n  )\n}\n\n/**\n * Renders objects for step 3.3\n * @param {array} data\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nexport function Step3Objects({\n  data: { customsOffices = [], ports = [] },\n  projection,\n  width: inputWidth,\n  height: inputHeight,\n  projectionTemplate\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const [selectedBureau, setSelectedBureau] = useState(undefined);\n  const handleClick = (name) => {\n    if (name === selectedBureau) {\n      setSelectedBureau(undefined);\n    } else setSelectedBureau(name);\n  }\n\n  const visiblePorts = useMemo(() => {\n    if (selectedBureau) {\n      return ports.filter(d => d.customs_office === selectedBureau)\n    }\n    return [];\n  }, [selectedBureau, ports])\n\n  const partsSpaceStartX = 15;\n  const portsSpaceStartY = height * 0.18;\n  const portsSpaceHeight = height * 0.55;\n  const portsSpaceWidth = width * .35;\n\n  const portRowHeight = visiblePorts.length ?  portsSpaceHeight / visiblePorts.length : portsSpaceHeight;\n\n  return (\n    <g className=\"Step3Objects\">\n      {\n        selectedBureau ?\n          <g className=\"ports-details\">\n            <foreignObject\n              x={0}\n              y={0}\n              width={width * .4}\n              height={height / 2}\n              className=\"ports-details-title\"\n            >\n              <h5>Ports associs au bureau des fermes de {selectedBureau} ({visiblePorts.length})</h5>\n            </foreignObject>\n            <g\n              className=\"ports-space\"\n              transform={`translate(${partsSpaceStartX}, ${portsSpaceStartY})`}\n            >\n              {/* <rect\n                x={0}\n                y={0}\n                width={portsSpaceWidth}\n                height={portsSpaceHeight}\n                style={{ fill: 'red' }}\n              /> */}\n              {\n                visiblePorts\n                .sort((a, b) => {\n                  const [_xA, yA] = projection([+a.longitude, +a.latitude]);/* eslint no-unused-vars : 0 */\n                  const [_xB, yB] = projection([+b.longitude, +b.latitude]);/* eslint no-unused-vars : 0 */\n                  if (yA > yB) {\n                    return 1;\n                  }\n                  return -1;\n                })\n                .map((port, portIndex) => {\n                  const [x, y] = projection([+port.longitude, +port.latitude]);\n                  const initialCircleRadius = width * 0.05;\n                  let circleRadius = initialCircleRadius;\n                  const totalTonnage = parseFloat(port.cumulated_tonnage_out_region) + parseFloat(port.cumulated_tonnage_in_region)\n\n                  // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n                  // se grerait bien avec un switch\n                  if (totalTonnage < 1000) { // * 1000\n                    circleRadius = width * 0.025\n                  }\n                  else {\n                    if (totalTonnage > 5000) {\n                      circleRadius = width * 0.075\n                    }\n                  }\n                  const navigoMetric1 = parseFloat(port.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n                  const navigoMetric2 = parseFloat(port.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n                  const objectX = portsSpaceWidth / 2 - initialCircleRadius * 2 + (visiblePorts.length > 5 ? portIndex % 2 === 0 ? 0 : initialCircleRadius * 2 : 0);\n                  const objectY = portRowHeight * portIndex;\n                  // const transformGroup = projectionTemplate === 'France' ? `translate(${x},${y})` + ' scale(0.1)' : `translate(${x},${y})` + ` scale(1)`;\n                  const transformGroup = `translate(${objectX}, ${objectY})`;\n                  return (\n                    <g className=\"port-group\" key={port.name}>\n                      <line\n                        x1={objectX}\n                        y1={objectY}\n                        x2={x - partsSpaceStartX}\n                        y2={y - portsSpaceStartY}\n                      />\n                      <circle\n                        cx={x - partsSpaceStartX}\n                        cy={y - portsSpaceStartY}\n                        r={width * 0.002}\n                        style={{ fill: colorsPalettes.generic.dark }}\n                        className=\"marker\"\n                      />\n                      <ExtraversionObject\n                        {\n                        ...{\n                          transformGroup,\n                          navigoValues: [navigoMetric1, navigoMetric2],\n                          circleRadius,\n                          width,\n                          height,\n                          name: port.name,\n                        }\n                        }\n                      />\n                    </g>\n                  )\n                })\n              }\n            </g>\n\n          </g>\n          : null\n      }\n      {\n        customsOffices.map((datum, index) => (\n          <Step3Object\n            key={datum.name}\n            {\n            ...{\n              datum,\n              projection,\n              width,\n              height,\n              projectionTemplate,\n              onClick: handleClick,\n              isActive: datum.name === selectedBureau,\n              isMinified: selectedBureau && datum.name !== selectedBureau\n            }\n            }\n          />\n        ))\n      }\n    </g>\n  )\n}\n\n/**\n * Renders small multiples for 3.3\n * @param {array} data\n * @param {number} width\n * @param {number} height\n * @returns {React.ReactElement} - React component\n */\nexport function SmallMultiples({ \n  data, \n  width: inputWidth, \n  height: inputHeight\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // could be parametered in props too\n  const bureaux = data.filter(({ name }) => name === 'Le Havre' || name === 'Nantes' || name === 'Bordeaux' || name === 'La Rochelle')\n    .sort((a, b) => {\n      if (a.cumulated_exports_value_from_region > b.cumulated_exports_value_from_region) {\n        return -1;\n      }\n      return 1;\n    })\n  const legendCustomOffice = {\n    name: 'Lgende',\n    cumulated_tonnage_in_region: 60,\n    cumulated_tonnage_out_region: 60,\n    cumulated_exports_value_from_region: 50,\n    cumulated_exports_value_from_ext: 50,\n    legendMode: true\n  }\n  bureaux.unshift(legendCustomOffice)\n\n  const margin = 15;\n  let circleRadius = width * 0.05;\n  const multiplesY = height - circleRadius - margin * 2;\n\n  const legendFactor = 1;\n\n  const columnWidth = (circleRadius * 2 + margin);\n\n  const xObjectsStart = width * .4 // circleRadius * legendFactor + circleRadius + margin;\n\n  const { lang } = useContext(SettingsContext);\n\n  return (\n    <g className=\"small-multiples-and-legend-and-title\">\n      <rect\n        x={xObjectsStart + margin * 2}\n        y={multiplesY - circleRadius * 3}\n        width={width - xObjectsStart - margin * 4}\n        height={height - multiplesY + circleRadius * 3 - margin / 2}\n        style={{ fill: 'white' }}\n        opacity={0.5}\n      />\n      <foreignObject\n        x={xObjectsStart + circleRadius * 1.5}\n        y={multiplesY - circleRadius * 3}\n        width={(circleRadius * 2 + margin) * (bureaux.length - 1)}\n        height={height}\n      >\n        <div style={{ position: 'relative' }}>\n          <h5 className=\"visualization-title\" style={{ position: 'absolute', left: 0, bottom: 0 }}>\n            {translate('viz-principale-partie-3', 'SmallMultiples_title', lang)}\n          </h5>\n        </div>\n      </foreignObject>\n      <g className=\"small-multiples\">\n        {\n          bureaux\n            .map((custom_office, index) => {\n              const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n\n              const navigoMetric1 = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage; // portion for left triangle\n              const navigoMetric2 = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage; // portion for right triangle\n\n              const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n              const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n\n              return custom_office.legendMode ?\n                (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${circleRadius * legendFactor * 4 + margin + index * (circleRadius * legendFactor + margin)}, ${multiplesY - (circleRadius * legendFactor - circleRadius)})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius: circleRadius * legendFactor,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n                : (\n                  <ExtraversionObject\n                    {\n                    ...{\n                      transformGroup: `translate(${xObjectsStart + index * columnWidth}, ${multiplesY})`,\n                      navigoValues: [navigoMetric1, navigoMetric2],\n                      toflitPct: inPercentage,\n                      circleRadius,\n                      width,\n                      height,\n                      name: custom_office.name,\n                      legendMode: custom_office.legendMode\n                    }\n                    }\n                  />\n                )\n            })\n        }\n\n      </g>\n      <defs>\n        <marker id=\"triangle-end\" viewBox=\"-10 0 10 10\"\n          refX=\"1\" refY=\"5\"\n          markerUnits=\"strokeWidth\"\n          markerWidth={width * 0.01}\n          markerHeight={width * 0.01}\n          orient=\"auto\">\n          <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n        </marker>\n      </defs>\n    </g>\n  );\n\n}\n\n/**\n * Renders a row of triangles\n * @param {array} data\n * @param {number} width\n * @param {number} height\n * @param {function} projection\n * @param {string} projectionTemplate\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nexport function renderTriangles({ \n  data, \n  width: inputWidth, \n  height: inputHeight, \n  projection, \n  projectionTemplate, \n  atlasMode,\n  lang\n}) {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // console.log(\"data : layder.data \", data)\n  return (\n    <TriangleChart\n      data={data}\n      totalWidth={width} // @TODO : il faudrait rduire cette width \n      rowHeight={height * 0.3}\n      projection={projection}\n      projectionTemplate={projectionTemplate}\n      atlasMode={atlasMode}\n      lang={lang}\n    />\n  );\n}","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      // console.log('color the attr', nodeColor.name, attr[nodeColor.name]);\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      // console.log('size attr', nodeSize.name, attr);\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const smallerNode = sourceNodeSize < targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (smallerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = smallerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[smallerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React, { useCallback, useRef, useState, useEffect, useMemo } from 'react';\nimport gexf from 'graphology-gexf';\nimport forceAtlas2 from 'graphology-layout-forceatlas2';\nimport Graph from 'graphology';\nimport { WebGLRenderer as Renderer } from 'sigma';\nimport { scaleLinear } from 'd3-scale';\nimport { min, max, extent } from 'd3-array';\nimport { uniq } from 'lodash';\n// import get from 'axios';\n\nimport { createNodeReducer, createEdgeReducer } from './reducers';\nimport { generatePalette } from '../../helpers/misc';\nimport { usePrevious } from '../../helpers/hooks';\n\nimport './GraphContainer.scss';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\n// function rescale(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedReset(renderer);\n// }\n\n// function zoomIn(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedZoom(renderer);\n// }\n\n// function zoomOut(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedUnzoom(renderer);\n// }\n\n/**\n * Network graph wrapper\n * @todo this should be enterely refactored using https://github.com/sim51/react-sigma-v2\n * @param {object} graph\n * @param {string} nodeColor -  field name\n * @param {string} nodeSize -  field name\n * @param {number} labelDensity\n * @param {string} nodeLabel - fieldName\n * @param {function} onCameraUpdate\n * @param {object} cameraPosition\n * @param {number} updateTimestamp\n * @param {number} width\n * @param {number} height\n * @param {number} ratio - camera ratio/zoom level\n * @returns {React.ReactElement} - React component \n */\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n  width,\n  height,\n  ratio,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n\n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable && nodeColorVariable.field) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable.field])\n      })\n      values = uniq(values);\n      let palette = {};\n      if (nodeColorVariable.palette) {\n        palette = nodeColorVariable.palette;\n      } else {\n        const colors = generatePalette(nodeColorVariable.field, values.length);\n        let i = 0;\n        values.forEach(option => {\n          palette[option] = colors[i];\n          i++;\n        });\n      }\n\n      return {\n        palette,\n        name: nodeColorVariable.field\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n        m.set(edge, { sourceNode: sourceAttributes, targetNode: targetAttributes })\n      });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n\n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n\n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n      const camera = renderer.getCamera();\n      // console.log('animate camera', camera);\n      camera.animate(cameraPosition);\n    }\n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n\n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n  useEffect(() => {\n    if (renderer) {\n      renderer.refresh();\n    }\n  }, [width, height])\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, { nodeReducer, edgeReducer });\n\n        newRenderer.settings.labelFont = 'IBM Plex Sans';\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        camera.setState({ ...camera.getState(), ratio: ratio || 1 });\n        camera.disable();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{ width: '100%', height: '100%', minHeight: '10vh', minWidth: '1vw' }}></div>\n      {/*renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )*/}\n    </div>\n  );\n}\n\n\nexport default function NetworkGraphChart({\n  data: gexfString,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  spatialize,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 },\n  width = 0,\n  height,\n  ratio,\n  title\n}) {\n  const headerRef = useRef(null);\n  const headerHeight = useMemo(\n    () => headerRef.current ? headerRef.current.getBoundingClientRect().height : 0, [headerRef.current])\n\n  // useState renvoie un state et un seter qui permet de le modifier\n  const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n\n  useEffect(() => {\n    if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n      setCameraPosition(inputCameraPosition);\n    }\n  }, [inputCameraPosition])\n\n  const onCameraUpdate = cam => {\n    setCameraPosition(cam);\n  }\n  const graph = useMemo(() => {\n    const g = gexf.parse(Graph, gexfString);\n    if (spatialize) {\n      const settings = forceAtlas2.inferSettings(g);\n      // To directly assign the positions to the nodes:\n      forceAtlas2.assign(g, {\n        settings,\n        iterations: 50\n      });\n    }\n    return g;\n  }, [gexfString]);\n\n  if (!graph) {\n    return null;\n  }\n  return (\n    <div className=\"NetworkGraphChart\" style={{ \n      width: '100%', \n      height: height || '100%',\n    }}>\n      <div ref={headerRef} className=\"row visualization-title-container\">\n        {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n      </div>\n      <div style={{\n        position: 'relative',\n        flex: 1,\n        // top: headerHeight,\n        // background: 'red',\n        // height: height - headerHeight\n      }}>\n\n        <GraphContainer\n          {\n          ...{\n            graph,\n            cameraPosition,\n            nodeColor,\n            nodeSize,\n            labelDensity,\n            nodeLabel,\n            ratio,\n            onCameraUpdate,\n            width,\n            height: height - headerHeight\n          }\n          }\n        />\n      </div>\n    </div>\n  )\n}","import json from './lang.json'\n\n/**\n * \n * @param {string} vizId Viz identifier as 'viz-principale-partie-1'\n * @param {string} label Ref to the viz label from the translate file 'lang.yml'\n * @param {'fr'|'en'} lang \n */\n\nconst matchDollarBracket = new RegExp(/\\$\\{(\\w+)\\}/g)\n\nexport default function translate(vizId, label, lang = 'fr', args) {\n\n  if (json[vizId] === undefined || json[vizId][label] === undefined || json[vizId][label][lang] === undefined) {\n    return `pas de traduction disponible (${vizId} | ${label})`;\n  }\n\n  let result = json[vizId][label][lang];\n\n  if (!!result === false) {\n    return `pas de traduction disponible (${vizId} | ${label})`;\n  }\n\n  if (args === undefined) {\n    return result;\n  }\n\n  result = result.replace(matchDollarBracket, (match, key) => {\n    return args[key] || key\n  })\n\n  return result;\n}","/**\n * A series of miscellaneous helper functions\n */\n\n/* import external library */\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\n/* import other assets */\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\nimport palettes from '../colorPalettes';\n\nconst { generic } = palettes;\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\n\n/**\n * Generates a head's title for the current page\n * @param {string} title\n * @param {string} lang='fr'\n * @returns {string}\n */\nexport function buildPageTitle(title, lang = 'fr') {\n  const currentMetadata = metadata[lang] || metadataFr;\n  return `${title} | ${currentMetadata.title} | PORTIC`;\n}\n\n/**\n * Trims a text given a certain length limit/maximum\n * @param {string} str\n * @param {number} limit=30\n * @returns {string}\n */\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\n/**\n * Transform cartesian coordinates to polar coordinates\n * @param {number} x\n * @param {number} y\n * @returns {object} - distance and radians of the polar coordinates\n */\nexport function cartesian2Polar(x, y) {\n  const distance = Math.sqrt(x * x + y * y);\n  const radians = Math.atan2(y, x);\n  return {\n    distance, radians\n  }\n}\n/**\n * Transform polar coordinates to cartesian coordinates\n * @param {number} r\n * @param {number} theta\n * @returns {array} - array of x and y positions\n */\nexport const polarToCartesian = (r, theta) => [\n  r * Math.cos(theta),\n  r * Math.sin(theta)\n]\n\n/**\n * Generate a color palette in a deterministic way for the app\n * @param {string} name\n * @param {number} count - number of colors to generate\n * @returns {any}\n */\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n/**\n * Normalizes a dimension so that it is fitable for svg dimensions (not NaN, positive)\n * @param {number} num\n * @returns {number}\n */\nexport const fixSvgDimension = num => isNaN(num) ? 0 : Math.abs(+num);\n\n/**\n * Format a number so that it is more legible\n * @param {number} n\n * @param {string} style='fr'\n * @returns {string}\n */\nexport const formatNumber = (n, style = 'fr') => {\n  return ('' + n)\n    .split('')\n    .reverse()\n    .reduce(({ count, result }, digit, index) => {\n      const endOfLine = count === 3 || (count === 0 && index === ('' + n).length - 1);\n      if (endOfLine) {\n        return {\n          count: 1,\n          result: [...result, style === 'fr' ? ' ' : ',', digit]\n        }\n      } else return {\n        count: count + 1,\n        result: [...result, digit]\n      }\n\n    }, {\n      count: 0,\n      result: []\n    })\n    .result\n    .reverse()\n    .join('')\n}\n\n\n/**\n * ===============\n * DEPRECATED\n * Ccile's code for when we directly queryied data from source APIs\n * ==============\n */\n\n\n\n/**\n * Filters data given certain parameters\n * @param {array} data\n * @param {object} params\n * @returns {array}\n */\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajout startYear et endYear pour\n      // la rcupration de portic il s'agira de dduire ce year des donnes\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble tre indiable mais pas sur qu'on doive pas le mettre dans un format spcial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas  garder dans le rsultats (colonne donnes dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau  une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        //  partir de l, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptes par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intressent dans le rsultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'tait else { ... } et on passait jamais dedans apparemment du coup l c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // diffrencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"aprs le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n/**\n * Gets toflit18 flows (from local csv) according to certain  filter parameters\n * @param {object} params\n * @returns {promise}\n */\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // mthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // mthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // mthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : rcupre les flux toflit18\n  --- \n  Paramtres :\n  * startYear : <int> # anne de dbut\n  * endYear : <int> # anne de fin\n  * params : <arr> # proprits  renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs  filtrer dans les flux (peut tre une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // a sert  quelque chose ?? pour moi c'est pas utilis, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'tat a ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les rsultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}","import React, { useEffect, useState } from 'react';\nimport cx from 'classnames';\nimport { animated, useSpring } from 'react-spring';\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Returns a given port visual elements in triangles comparison visualization (for viz 3.1)\n * @param {number} numberOfColumns\n * @param {object} port\n * @param {function} scaleX\n * @param {function} scaleY\n * @param {number} legendWidth\n * @param {number} columnWidth\n * @param {umber} totalHeight\n * @param {number} totalWidth\n * @param {function} projection\n * @param {number} index\n * @param {object} margins\n * @param {number} rowHeight\n * @param {number} fontSize\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst PortGroup = ({\n  numberOfColumns,\n  port,\n  scaleX,\n  scaleY,\n  legendWidth,\n  columnWidth,\n  totalHeight,\n  totalWidth,\n  projection,\n  index,\n  margins,\n  rowHeight,\n  fontSize,\n  projectionTemplate,\n  lang\n}) => {\n\n\n  const triangleWidth = scaleX(+port.nb_pointcalls_out)\n  const triangleHeight = scaleY(+port.mean_tonnage)\n\n  const xIndex = index % numberOfColumns;\n  // const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n  const xTransform = xIndex * columnWidth + margins.left // + (legendWidth + margins.left) * totalWidth;\n  const yTransform = totalHeight * 2.3;\n\n  // const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [x, y] = projection([+port.longitude, +port.latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform, x1, y1, x2, y2, staticTransform, markerRadius } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`,\n      x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : x,\n      y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : y,\n      // x1: projectionTemplate === 'rotated Poitou' ? xTransform + columnWidth / 2 : totalWidth * 0.1,\n      // y1: projectionTemplate === 'rotated Poitou' ? yTransform + rowHeight / 7 : index * (totalHeight / numberOfColumns),\n\n      markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 0,\n      // markerRadius: projectionTemplate === 'rotated Poitou' ? totalHeight * 0.02 : 1,\n      \n      // x1: xTransform + columnWidth / 2,\n      // y1: yTransform + rowHeight / 7,\n      x2: x,\n      y2: y,\n      staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${x},${y}) scale(${projectionTemplate === 'rotated Poitou' ? 1 : 0.1})`\n      // staticTransform: projectionTemplate === 'rotated Poitou' ? `translate(${xTransform}, ${yTransform}) scale(1)` : `translate(${totalWidth * 0.1},${index * (totalHeight / numberOfColumns)}) scale(${projectionTemplate === 'France' ? 0.2 : 1})`\n    },\n    immediate: !isInited\n  });\n\n  const cellCenterX = columnWidth / 2;\n  const cellCenterY = rowHeight / 2;\n  const textStartY = rowHeight / 7;\n  const triangleStartY = cellCenterY + textStartY / 2 - triangleHeight / 2;\n  const legendTextWidth= totalWidth * 0.08;\n\n  let labelBgWidth = fontSize * 12;\n  if (port.port.length <= 10) {\n    labelBgWidth = fontSize * 6;\n  } else if (port.port.length <= 12) {\n    labelBgWidth = fontSize * 7;\n  } else if (port.port.length <= 15) {\n    labelBgWidth = fontSize * 8;\n  } else if (port.port.length <= 18) {\n    labelBgWidth = fontSize * 10;\n  }\n\n  return (\n    <g className={cx('port-point-and-triangle', {'is-minified': projectionTemplate !== 'rotated Poitou'})}>\n\n      <animated.line\n        x1={x1}\n        y1={y1}\n        x2={x2}\n        y2={y2}\n        stroke='grey'\n        strokeDasharray='2, 8'\n      />\n\n      <animated.g className='port-point' transform={transform}>\n        <animated.circle\n          cx={0}\n          cy={0}\n          r={markerRadius}\n          style={{ fill: colorsPalettes.generic.dark }}\n          className=\"marker\"\n        />\n      </animated.g>\n\n      <animated.g className='port-triangle'\n        // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n        transform={staticTransform}\n      >\n        {/* <rect\n          x={0}\n          y={0}\n          width={columnWidth}\n          height={rowHeight}\n          style={{stroke: 'red'}}\n        /> */}\n\n        {/* <path class='vertical-line'\n          d={`M ${cellCenterX} ${(rowHeight - triangleHeight) / 1.2} \n              V ${rowHeight / 7}\n              `}\n        /> */}\n        <path className='vertical-line'\n          d={`M ${cellCenterX} ${textStartY} \n              V ${triangleStartY}\n              `}\n        />\n\n        <g transform={`translate(${cellCenterX}, ${triangleStartY})`}>\n\n          <path className='triangle'\n            d={`M ${-triangleWidth / 2} ${0} \n                L ${triangleWidth / 2} ${0}\n                L ${0} ${triangleHeight}\n                Z\n                `}\n            fill=\"url(#TriangleGradient)\"\n          />\n          {/* <circle\n            fill=\"red\"\n            r={2}\n            cx={-triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={triangleWidth / 2}\n            cy={0}\n          />\n          <circle\n            fill=\"red\"\n            r={2}\n            cx={0}\n            cy={triangleHeight}\n          /> */}\n        </g>\n        <g className=\"local-legend\">\n          {/* horizontal line */}\n          <line\n            x1={cellCenterX - triangleWidth/2}\n            x2={cellCenterX + triangleWidth/2}\n            y1={triangleStartY - 3}\n            y2={triangleStartY - 3}\n            markerStart=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* vertical line */}\n          <line\n            x1={cellCenterX - triangleWidth/2 - 3}\n            x2={cellCenterX - triangleWidth/2 - 3}\n            y1={triangleStartY}\n            y2={triangleStartY + triangleHeight}\n            markerStart=\"url(#triangle-left)\" \n            markerEnd=\"url(#triangle-right)\"\n          />\n          {/* pointing arrows */}\n          <path\n            d={`\n            M ${-(legendTextWidth* .2) - triangleWidth / 3} ${triangleStartY * .65}\n            Q ${cellCenterX - 10} ${triangleStartY * .65} ${cellCenterX - 2} ${triangleStartY - 5}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <path\n            d={`\n            M ${-triangleHeight / 3 + 3} ${triangleStartY + triangleHeight * .6 + 7}\n            L ${cellCenterX - triangleWidth/2 - 3} ${triangleStartY + triangleHeight * .6 + 7}\n            `}\n            markerEnd=\"url(#triangle-right)\"\n          />\n          <foreignObject \n            y={triangleStartY / 2}\n            x={-legendTextWidth - triangleWidth / 3}\n            width={legendTextWidth}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n              {translate('viz-principale-partie-3', 'nb_pointcalls_out', lang)}  : <strong>{port.nb_pointcalls_out}</strong>\n            </span>\n          </foreignObject>\n          <foreignObject \n            x={-legendTextWidth - triangleWidth / 3}\n            y={triangleStartY + triangleHeight * .6}\n            width={totalWidth * 0.08}\n            height={rowHeight}\n          >\n            <span xmlns=\"http://www.w3.org/1999/xhtml\">\n            {translate('viz-principale-partie-3', 'mean_tonnage', lang)} : <strong>{(+port.mean_tonnage || 0).toFixed(1)}</strong>\n            </span>\n          </foreignObject>\n          \n        </g>\n        <g className='label' transformOrigin=\"bottom left\" transform={`translate(${columnWidth / 2}, ${rowHeight / 7 - totalHeight * 0.025})`}>\n          <path\n            d={`M 0 ${-fontSize} L ${labelBgWidth} ${-fontSize} ${labelBgWidth - 5} ${(-fontSize + fontSize * 0.2) / 2} ${labelBgWidth} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // d={`M 0 ${-fontSize} L ${port.port.length * fontSize * .64} ${-fontSize} ${port.port.length * fontSize * .64 - 5} ${(-fontSize + fontSize * 0.2) / 2} ${port.port.length * fontSize * .64} ${fontSize * 0.2} 0 ${fontSize * 0.2} Z`}\n            // x={0}\n            // y={-fontSize}\n            // height={fontSize * 1.2}\n            // width={port.port.length * fontSize * .65}\n            style={{ fill: colorsPalettes.generic.dark }}\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n          />\n          <text\n            transformOrigin=\"bottom left\"\n            transform=\"rotate (-45)\"\n            font-size={fontSize}\n            style={{ fill: 'white' }}\n            x={3}\n            y={0}\n            textAnchor=\"left\"\n          > {port.port} </text>\n        </g>\n\n      </animated.g>\n    </g>\n  )\n}\n\nexport default PortGroup;","/* DOCUMENTATION : API de ce TriangleChart\n\n  Principe :\n    Composant conu spcifiquement pour les triangles de la viz 3.1, mais pourrait tre dclin\n    -> permet de produire une srie d'objets en SVG, qui se disposent dans une grille en fonction de la longueur du dataset, et les dimensions de cette grille sont paramtrables\n\n  Paramtres : \n    data : donnes  afficher sur la carte,\n    totalWidth : largeur totale du composant (1 objet de lgende + grille d'objets) (par dfaut  1200 px)\n    legendWidth : largeur de la lgende (par dfaut  un dizime de la largeur totale)\n    margins : marges de gauche (entre l'objet de la lgende et la grille) et de froite (entr la droite de la grille et l'extrmit droite de l'cran)\n    rowHeight : hauteur d'une ligne de la grille (par dfaut  200px)\n    projection : on passe en paramtre la projection de d3 geo pour pouvoir donner accs au positionnement gographique sur une carte (permet dans le cas de la viz 3.1 de lier les triangles au point de localisation gographique du port qu'ils reprsentent => point et triangle sont nest dans un mme objet, ce qui permet d'tablir une courbe pointille entre eux et grer l'interaction avec des jeux d'opacit au hover)\n\n  Pistes d'amlioration : \n  - filtrer les objets  l'entre ? (par exemple pour la viz 3.1 on pourrait choisir d'afficher le triangle associ  un port que si les dimensions dpassent un certain seuil) => cela permettrait d'allger la carte, en affichant seulement les ports pour lesquels on a des donnes reprsentatives\n\n  @TODO : documenter ce component de maire standardise\n  */\n\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\nimport cx from 'classnames';\n\nimport './TriangleChart.scss'\nimport colorsPalettes from '../../colorPalettes';\n\n// import TriangleLegend from './TriangleLegend';\nimport PortGroup from './PortGroup';\n\n\n/**\n * Returns triangles comparison visualization (for viz 3.1)\n * @param {array} data\n * @param {number} totalWidth\n * @param {number} legendWidth - portion in [0,1]\n * @param {object} margins\n * @param {number} rowHeight\n * @param {function} projection\n * @param {string} projectionTemplate\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst TriangleChart = ({\n  data,\n  totalWidth = 1200,\n  legendWidth = 0.1,\n  margins: inputMargins,\n  rowHeight = 200,\n  projection,\n  projectionTemplate,\n  atlasMode,\n  lang\n}) => {\n\n  const margins = inputMargins ||  {\n    left: totalWidth * .1,\n    right: totalWidth * .1\n  }\n  // {\n  //   left: 0.0,\n  //   right: 0.09\n  // }\n  const numberOfColumns = data.length;\n  const columnWidth = (totalWidth - margins.left - margins.right) / (numberOfColumns) // (totalWidth * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns; // (totalWidth) / (numberOfColumns + 4) //\n  const numberOfRows = data.length / numberOfColumns;\n  const totalHeight = numberOfRows * rowHeight;\n  const fontSize = totalHeight * 0.05;\n\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n    // ]).range([0, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n  ]).range([5, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([5, rowHeight * 0.85]); // pour l'instant j'ai mis le max de longueur  85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupe par le texte]\n\n  // const legendTriangleWidth = 35;\n  // const legendTriangleHeight = 60;\n\n  return (\n\n    <g className={cx(\"TriangleChart\", {'is-atlas-mode': atlasMode})}>\n\n      <defs>\n        <linearGradient id=\"TriangleGradient\" x2='0%' y2='100%'>\n          <stop offset=\"10%\" stopColor={`rgb(100,100,100)`} stopOpacity={0.6} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} />\n          {/* <stop offset=\"20%\" stopColor={colorsPalettes.generic.dark} />\n          <stop offset=\"100%\" stopColor={colorsPalettes.generic.dark} stoOpacity={0.3} /> */}\n        </linearGradient>\n      </defs>\n      {/* <TriangleLegend\n        {\n        ...{\n          legendWidth,\n          totalWidth,\n          totalHeight,\n          legendTriangleWidth,\n          legendTriangleHeight,\n          rowHeight,\n          fontSize,\n        }\n        }\n      /> */}\n      <g className=\"triangles\">\n        {\n          // sorting groups regarding their projected projection on the horizontal axis (to avoid lines crossings)\n          data.sort((a, b) => {\n            const [xa] = projection([+a.longitude, +a.latitude]);\n            const [xb] = projection([+b.longitude, +b.latitude]);\n\n            if (xa > xb) {\n              return 1;\n            }\n            return -1;\n          })\n            .map((port, index) => {\n\n              return (\n                <PortGroup\n                  lang={lang}\n                  key={index}\n                  {\n                  ...{\n                    numberOfColumns,\n                    port,\n                    scaleX,\n                    scaleY,\n                    legendWidth,\n                    columnWidth,\n                    totalHeight,\n                    totalWidth,\n                    projection,\n                    index,\n                    margins,\n                    rowHeight,\n                    fontSize,\n                    projectionTemplate\n                  }\n                  }\n                />\n              )\n            })\n\n        }\n        <defs>\n            <marker id=\"triangle-left\" viewBox=\"0 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.02}\n              orient=\"auto\">\n              <path d=\"M 10 0 L 0 5 L 10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n            <marker id=\"triangle-right\" viewBox=\"-10 0 10 10\"\n              refX=\"1\" refY=\"5\"\n              markerUnits=\"strokeWidth\"\n              markerWidth={legendWidth * totalWidth * 0.04} \n              markerHeight={rowHeight * 0.024}\n              orient=\"auto\">\n              <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"darkgrey\" />\n            </marker>\n          </defs>\n      </g>\n\n    </g>\n  )\n\n}\n\nexport default TriangleChart;","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Poitou': '#668EDB',\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produits coloniaux': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites les': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indtermin suppos Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-R': '#277262',\n    'Saint-Martin le de R': '#277262',\n    'Tonnay-Charente': '#5AD0F4',\n    'Marans': '#67CBB6',\n    \"Les Sables-d'Olonne\": '#668EDB',\n    \"Sables d'Olonne\": '#668EDB',\n    'Marennes': '#A7E6F9',\n    'Charente': '#A7E6F9',\n    'Alligre': '#349883',\n    \"Tous les bureaux\": \"grey\"\n  },\n  tonnageClasses: {\n    '100%': '#A07BEE',\n    '75% ou plus': '#41BEA3',\n    'moins de 75%': '#FEA43B',\n  },\n  tonnageClassesEn: {\n    '100%': '#A07BEE',\n    '75% or more': '#41BEA3',\n    'less than 75%': '#FEA43B',\n  },\n  franceAlone: {\n    'France': '#41BEA3',\n  },\n  portsTreemaps: {\n    'France (rgion PASA)': '#41BEA3',\n    'Indtermin': 'rgb(240,240,240)',\n    'zone maritime': '#98a9d9',\n    'multi-Etat': '#a42e0d',\n    'France (hors rgion PASA)': '#FED63B',\n\n    'Hambourg': '#F7E0DE',\n    'Duch d\\'Oldenbourg': '#F3D1CE',\n    'Prusse': '#EFC1BD',\n    'Lubeck': '#E7A39C',\n    'Brme': '#EBB2AD',\n    'Mecklenbourg': '#E3938C',\n    'Autriche': '#bd6a62',\n\n    'Grande-Bretagne': '#A07BEE',\n    'Provinces-Unies': '#2759e3',\n    'Danemark': '#8e7bee',\n\n    'Etats-Unis d\\'Amrique': '#EBB2AD',\n    'Pologne': '#804a45',\n    'Russie': '#804a45',\n    'Espagne': '#e35027',\n    'Portugal': '#e35027',\n  },\n  portsTreemapsEn: {\n    'France (PASA region)': '#41BEA3',\n    'France (outside PASA region)': '#FED63B',\n    'Indetermined': 'rgb(240,240,240)',\n    'Open sea': '#98a9d9',\n    'Multi-state': '#a42e0d',\n\n    'Hamburg': '#F7E0DE',\n    'Duchy of Oldenburg': '#F3D1CE',\n    'Prussia': '#EFC1BD',\n    'Lubeck': '#E7A39C',\n    'Bremen': '#EBB2AD',\n    'Mecklenburg': '#E3938C',\n    'Austria': '#bd6a62',\n\n    'Great Britain': '#A07BEE',\n    'United Provinces': '#2759e3',\n    'Denmark': '#8e7bee',\n\n    'United States': '#EBB2AD',\n    'Poland': '#804a45',\n    'Russian Empire': '#804a45',\n    'Spain': '#e35027',\n    'Portugal': '#e35027',\n  }\n}\n\nexport default colorsPalettes;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.285,\"time\":257100,\"words\":857}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`La France du dix-huitime sicle se caractrise par le fort dynamisme des ports et des hinterlands de la faade atlantique, stimuls par le commerce avec les Antilles et une demande europenne en biens de consommation en hausse. La guerre maritime qui commence en 1793 et qui se poursuit pendant plus de vingt ans, entranant la perte dfinitive de Saint-Domingue en 1804 et de lle de France (le Maurice) en 1815, sonne le glas de cette dynamique et dplace le centre de lconomie franaise vers lintrieur. `}</p>\n    <p>{`Ltude de cas prsente ici sintresse  la navigation et au commerce maritime des ctes poitevines et charentaises  la veille de la Rvolution. Cela correspond  la direction des fermes de la Rochelle et  la faade maritime des provinces du Poitou, de lAunis, de la Saintonge et de lAngoumois (rgion PASA). Cette aire possde un dense maillage portuaire, avec une quarantaine de ports en activit. Certains ne font que du cabotage micro-local, dautres intgrent petit et grand cabotage, dautres enfin sadonnent galement  une navigation de long-cours. Cette rgion se prte donc particulirement  une tude portant sur larticulation entre les diffrentes chelles du commerce maritime  laube de la Rvolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Nous reconstituons lhistoire maritime et commerciale de la rgion PASA  partir de deux sources historiques. Dune part, nous disposons de traces administratives de la navigation maritime grce aux redevances qui psent sur celle-ci sous lAncien Rgime. Les registres des congs rpertorient les navires  leur dpart dun port et le montant d, qui varie le plus souvent selon leur tonnage et leur destination. Ces registres, rdigs par les greffiers de lamiraut locale, ont t numriss et structurs dans une base de donnes appele `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`. Elle compte entre autres plus de 32 000 congs pour lanne 1787 pour lensemble des ports franais, et quelque 6 900 congs pour 1789 relatifs aux ctes poitevines et charentaises.`}</p>\n    <p>{`Les registres des congs nous permettent de reprer les dates de dpart des btiments, ainsi que diverses informations relatives  lobjet de leur voyage, leur tonnage, leur capitaine, etc. Ces donnes ne sont cependant pas dnues dincertitude : comme nous le verrons, le tonnage des navires est parfois surestim dans certains ports. Aussi, dans le cadre de la prsente tude, nous avons pris en compte litinraire dclar par les capitaines de navires au moment du dpart, tout en tant conscients que la dclaration ne correspond pas ncessairement au voyage effectif. Les congs permettent toutefois une bonne mesure des trafics de la rgion de La Rochelle, y compris  toute petite chelle, tout en demandant une attention fine  la dimension dincertitude inhrente  la source mobilise.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`Dautre part, nous disposons de traces administratives relatives au commerce de la rgion PASA. La base de donnes `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{` se fonde sur la numrisation des documents du Bureau de la balance du commerce de 1716  1821. Ces documents ont t produits grce aux services des Fermes : chaque bureau des Fermes enregistrait localement les tats de sortie et dentre des marchandises entre la France et ltranger. Plus de 550 000 flux de sortie / entre ont t documents dans la base de donnes Toflit18. La direction des fermes de La Rochelle correspondait  la faade maritime de la rgion PASA.`}</p>\n    <p>{`Grce aux donnes de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les sept diffrents bureaux de ferme de la rgion PASA et les partenaires trangers du royaume de France. Les informations que lon peut extraire de ces flux sont, entre autres, le nom du produit chang, la quantit, la valeur, le partenaire commercial, et lentit administrative ayant enregistr le flux au niveau local. En 1789, elles prcisent en outre, sauf pour le commerce de rexportation des denres coloniales, lorigine du produit commercialis (ville ou province franaise, ou tat tranger). Elles fournissent donc des informations complmentaires  celles donnes par les sources relatives  la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congs de navigation et donnes du Bureau de la balance du commerce rendu possible par les bases de donnes Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de prciser les flux et leur valeur pour ce qui est du commerce international, et dexplorer les relations et larticulation entre les diffrents trafics de cette rgion.`}</p>\n        <p>{`La prsente tude de cas dcrit en trois temps lhistoire de la rgion PASA  laube de la Rvolution franaise. Dabord, nous constatons la relative perte dimportance et de diversit commerciale de la rgion  la suite de la perte du Canada par le royaume de France durant la guerre de Sept Ans. Nous proposons ensuite une analyse dtaille de la restructuration de la rgion en relation avec cet vnement, selon des filires spcialises qui associent des ports particuliers avec le commerce de produits spcifiques. Nous dmontrons enfin que, bien que dominant dans sa rgion, le port de la Rochelle ne structure pas en 1789 la rgion au profit dun rseau dchange plus diversifi.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.045,\"time\":242700,\"words\":809}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`Eighteenth-century France was known for its vibrant Atlantic coast ports and their hinterlands, thriving on West Indian trade as well as the increasing European demand for consumer goods. As a result of the French Revolutionary wars - beginning in 1793 and lasting over twenty years  Saint-Domingue was lost in 1804, followed by Isle de France (Mauritius) in 1815, marking the end of this dynamic period and moving the center of gravity of the French economy to the interior. `}</p>\n    <p>{`This case study focuses on seafaring and maritime trade along the Poitou and Charente coasts on the eve of the Revolution. The area encompassed the La Rochelle customs region, corresponding to the Poitou, Aunis, and Saintonge maritime provinces and their hinterland, the Angoumois (hereafter PASA region), representing a dense network of ports, numbering around forty active ports. Some ports were limited to micro-local coastal trade, others were open to more distant cabotage, while yet others also engaged in long-distance navigation. The region therefore is particularly suited to a study of the connections between the various kinds of maritime trade practiced on the eve of the Revolution. `}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Our reconstruction of the maritime and trade history of the PASA region is based on two historical sources. Firstly, we have relied on the administrative records listing departure fees imposed on maritime shipping during the Old Regime. Clearance (i.e. permission to leave) records provide lists of vessels departing from a port and the amount of duty they owed, usually reflecting the ships tonnage and destination. These records compiled by officials of the local Amiraut were digitized and organized in a database called `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`. The records for 1787 include more than 32,000 clearances for all French ports, and a further 6,900 in 1789 for the Poitou and Charente coast.`}</p>\n    <p>{`These records allow us to identify vessel departure dates and reveal other information regarding the purpose of its voyage, its tonnage, its captain, etc. However, these data are not entirely trustworthy as a ships tonnage was sometimes overestimated in some ports, as will be explained below. In the context of this study, we also took into account the itinerary declared by vessel captains at the time of departure, albeit that the declaration was not necessarily reflective of the actual trip. Clearance documents present a good overview of traffic in the La Rochelle region, including on a very small scale, but must nevertheless by used with caution given the uncertainty of tonnages and declared destinations.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`The second source-base is the PASA region trade records. The `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{` database contains the digitized documents of the Balance of Trade Department (Bureau de la Balance du Commerce) from 1716 to 1821. These documents were produced by local customs offices which recorded the export and import figures of international and colonial trade goods. Over 550,000 import or export flows (a flow being defined in this context as the record of the import or export of one item from/to a given country in a given year) were documented in the Toflit18 database. The La Rochelle customs region (direction de La Rochelle) represented the PASA regions maritime activities.`}</p>\n    <p>{`The Toflit18 data enabled us to list exports and imports between the seven different customs offices (bureaux) of the PASA region and their foreign trade partners. The information extracted from this dataset includes, for example, the name of the product exchanged, its quantity and value, the trade partner, and the administrative entity that recorded the transaction at the local level. In 1789, these lists also specified the origin of the traded product (French city or province, or foreign state), except in the case of re-exported colonial commodities. This information therefore complements the information provided by the navigation sources.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`The combination of data from navigation clearance taxes and from the Balance of Trade Department provided by the Toflit18 and Navigocorpus databases allows us to better understand local, national, and international trade, to more precisely define the transactions and their value in terms of international trade, and to explore the relations and links between the various trade activities of this region.`}</p>\n        <p>{`This case study presents the history of the PASA region on the eve of the French Revolution in three stages. First, we note how the loss of Canada during the Seven Years War led subsequently to a reduction in importance and commercial diversity in the region. Next, we offer a detailed analysis of the regions restructuring following that loss as we examine specialized sectors linking particular ports with the trade of specific products. Finally, we demonstrate that by 1789 the port of La Rochelle, although still dominant in the region, no longer served as a trade hub in the region, which had by then greatly diversified its networks.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"7 min read\",\"minutes\":6.35,\"time\":381000,\"words\":1270}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-dclin-de-la-rgion-de-la-rochelle-suite--la-perte-du-canada\"\n    }}>{`Partie 1. Le dclin de la rgion de La Rochelle suite  la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, la France a pleinement profit du dveloppement des relations conomiques entre lAfrique, lAmrique et lEurope. L Atlantique franais reposant sur la traite des Africains et leur exploitation dans les les franaises (Antilles et Mascareignes) a connu son apoge juste avant la rvolte des esclaves de Saint-Domingue en aot 1791 et le dbut de la guerre maritime avec lAngleterre en fvrier 1793. Lancienne rgion Poitou-Charente, correspondant approximativement aux gnralits de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une longue tradition maritime  son actif et tait bien situe pour bnficier de cette phase de prosprit. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`Lexamen du commerce avec les pays trangers et les colonies de la direction des Fermes de La Rochelle, qui tait leur faade maritime, montre toutefois un dynamisme limit. Il y a bien eu croissance du commerce, mais cette croissance a t plus lente que celle des autres grands ports du royaume. Cela sexplique en grande partie par les relations privilgies de la direction de la Rochelle avec le Canada. Dune part, celui-ci se dveloppe beaucoup moins vite que les Antilles, et la rgion souffre de ce manque de dynamisme durant la premire moiti du sicle. Dautre part, le Canada est cd aux Anglais lors du trait de Paris qui clt la guerre de Sept Ans en 1763. Qubec avait dj t pris en 1759. Cette perte est svre pour la rgion dont le commerce entame alors un recul relatif trs net. La trajectoire de la rgion de la Rochelle contraste ainsi avec celles de Bordeaux et de Nantes dans la seconde moiti du sicle. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et sa part du commerce franais ne cesse daugmenter jusquen 1789. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`Aprs une anne exceptionnelle en 1747, qui sexplique par lorganisation de convois transatlantiques au dpart de La Rochelle escorts par la Marine pour chapper aux prdations britanniques, la direction de La Rochelle effectue 4,6% du total du commerce franais en 1750. En 1789 sa part ne reprsente plus que 2,2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`Le recul de La Rochelle nest pas que quantitatif. En 1750, les donnes de la direction des Fermes de La Rochelle, charge de la collecte des droits sur le commerce extrieur et colonial, montrent que cette partie du territoire commerce 21% des types de biens changs par la France (645 sur 3055, aprs `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source\" target=\"blank\" rel=\"noopener noreferrer\">{`uniformisation des variations orthographiques`}</a>{`). En 1789, elle nen commerce plus que 7% (248/3565). Cette forte rduction de la typologie des biens commercialiss sobserve  la fois pour les exportations et pour les importations.  un niveau plus agrg de typologie des produits, parmi les 150 secteurs de la `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\" target=\"blank\" rel=\"noopener noreferrer\">{`classification Rvolution et Empire, utilise dans le cadre du programme ANR Toflit18`}</a>{`, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diversifies en 1750 quen 1789. Lindice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Un bien pour lequel il ny a pas beaucoup de concurrence nationale (les eaux-de-vie) et deux denres coloniales rexportes (le caf et le sucre) dominent en 1789 les exportations. Les toiles de coton, souvent rexportes en direction de lAfrique, viennent en quatrime place, suivies du sel (dont la valeur est faible par rapport au tonnage quil mobilise, car cest une marchandise trs pondreuse). En 1750, la mercerie et les toffes de laine font partie des cinq principales exportations (avec lindigo, les eaux-de-vie et le sucre : le sel est en 14e position). `}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`La direction des Fermes de La Rochelle sest donc spcialise dans les produits agricoles et les rexportations de denres coloniales, aux dpens des biens manufacturs de la rgion. Ce constat ngatif est toutefois nuanc par lintensit capitalistique de la production deaux-de-vie qui la rapproche des biens manufacturs. La spcialisation et limportance de ce produit dexportation ressort avec vidence en comparant la part de la direction des Fermes de La Rochelle  la moyenne nationale.`}</p>\n    <p>{`Nous ne connaissons pas la destination des rexportations coloniales en 1789. En les excluant, on constate que la concentration des marchs de la direction des Fermes de La Rochelle est la mme en 1750 et en 1789 (entre 0,41 et 0,44), mais que lAngleterre a pris la place de lAmrique (terme qui dsigne en 1789 essentiellement les Antilles franaises). Cela est confirm par la distribution des tonnages des navires partant depuis la rgion PASA vers ltranger en 1789 : lAngleterre y a une part trs importante.`}</p>\n    <p>{`Pour aller vite, on pourrait rsumer en disant que la direction des Fermes de La Rochelle nexporte plus des biens diffrencis vers le Canada, mais essentiellement des eaux-de-vie vers lAngleterre. Du point de vue de la navigation, le fort tonnage destin  ce type de commerce est infrieur  celui engag pour lexportation du sel vers les mers du Nord et Baltique.`}</p>\n    <p>{`Les donnes de la navigation collectes ne nous permettent pas de contribuer  lanalyse du dclin de cette rgion: dune part, car nous navons le dtail des sorties que pour la fin de lAncien Rgime, ce qui empche une analyse diachronique. Dautre part, car les donnes collectes pour 1789 napportent que des informations limites pour ce qui est des produits transports : les congs du port de La Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports de la rgion le greffier se limite le plus souvent  noter seulement larticle principal qui compose la cargaison. Les registres des congs indiquent, toutefois, les destinations de chaque navire sorti et cette donne permet de constater un relatif clatement des marchs de cette rgion. `}</p>\n    <Caller id=\"partie-1-ports-destinations\" mdxType=\"Caller\" />\n    <p>{`Sans que lon puisse affirmer quil sagit dune nouveaut, la marginalisation de la rgion vers la fin de lAncien Rgime est confirme par son manque de capacit  assurer ses propres trafics. La navigation avec ltranger est assure,  90%, par des pavillons trangers ou extrieurs  la rgion tudie. Il sagit, pour lessentiel, des pavillons britannique et nord-europens. Parmi les ports de la rgion, seul La Rochelle joue un rle, mais comme nous le verrons (partie 2.1), cette navigation est lie aux activits de traite et au commerce colonial. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`Cette incapacit de la rgion  assurer les exportations vers ltranger nest pas lie  une absence dactivit maritime : au contraire, si on additionne le total des sorties de navires depuis les ports de la rgion tudie en 1789, toute destination confondue, on mesure que les btiments rgionaux assurent une partie considrable des trafics, suprieure  celle assure par les navires des autres ports franais, alors que la part de la navigation trangre est trs minoritaire. Toutefois, la part de navigation sous pavillon franais assure par les navires de la rgion tudie, est infrieure  celle de la plupart des autres provinces franaises: en 1787, les ports de lAunis-Saintonge-Poitou assurent 51.6% du tonnage quils expdient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne. `}</p>\n    <Caller id=\"partie-1-ports-dattache\" mdxType=\"Caller\" />\n    <p>{`La rgion nest donc pas trs dynamique,  la fin de lAncien Rgime, en matire darmement. Ce constat ne doit pas faire oublier les volutions qui ont eu lieu en son sein au cours de la seconde moiti du XVIIIe sicle, notamment grce au dveloppement ou au maintien de productions locales destines  lexportation depuis dautres ports que celui de La Rochelle. La section suivante tudie la forte diversification des ports de cette rgion.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\n/**\n * Visulization caller to place in contents\n * @param {string} id - visualization id used by visualization context to map caller with a specific vis\n * @param {object} props - visualization parameters passed as payload to visualization context\n * @returns  {React.ReactElement} - React component\n */\nconst Caller = ({id: visualizationId, lang = 'fr', ...props}) => {\n  const ref = useRef(null);\n  // we differentiate caller id and visualization id as their rel can theoretically be n-1\n  const [id] = useState(genId());\n  const {\n    // used to define whether caller is active\n    activeVisualization,\n    onBlockClick,\n    // callbacks used to register/unregister visualization data & HTML ref in upstream state\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  // register vis on caller's mount, unregister it on unmount\n  useEffect(() => {\n    // we wrap callback in a setTimeout in order to have a non-null ref to the HTML element\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        // currently is-hidden and is-devmode are logically symetrical, but this can be useful to differentiate the 2 in dev\n        'is-hidden': process.env.NODE_ENV !== 'development',\n        'is-devmode': process.env.NODE_ENV === 'development',\n      })}\n    >\n      {\n        process.env.NODE_ENV === 'development' ?\n        <>\n          {\n          visualizationId ?\n          <span>caller pour la visualisation <code>{visualizationId}</code> </span>\n          :\n          <span>caller sans id (agit comme un clearfix)</span>\n        }{\n          Object.keys(props).length ? \n            <span>avec les paramtres {JSON.stringify(props)}</span>\n          : null\n        }\n        </>\n        :\n        null\n      }\n      \n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"6 min read\",\"minutes\":5.92,\"time\":355200,\"words\":1184}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-1-the-decline-of-the-la-rochelle-region-following-the-loss-of-canada\"\n    }}>{`Part 1. The decline of the La Rochelle region following the loss of Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`During the eighteenth century, France took full advantage of the expanding economic relations between Africa, America, and Europe. The French Atlantic trade was based on the African slave trade and slave exploitation in the French Islands (West Indies and Mascarenes), which peaked before the Saint-Domingue slave revolt in August 1791 and sharply declined following the outbreak of a maritime war with Great Britain in February 1793. The former Poitou-Charente region, roughly comprising the provinces of Poitou, Aunis, Saintonge and Angoumois (PASA) under the Old Regime, had a long-established history of maritime activity and was ideally situated to benefit from this phase of prosperity. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`However, upon examination, the international and colonial sea trade of the La Rochelle customs region presents a somewhat limited growth. The slight increase in trade occurred at a slower pace than at other major ports of the kingdom. This is largely explained by La Rochelle and its regions preference for trading with Canada, which simply could not match the success of West Indian trade.`}</p>\n    <p>{`This factor negatively impacted on the regions growth in the first half of the eighteenth century. Further, following British victory in the Battle of Quebec in 1759 the Seven Years War came to an end in 1763 when Frances Canadian territories were ceded to Great Britain.`}</p>\n    <p>{`This severe loss led to a very clear trade decline in the regions colonial trade. The contrast between trade developments in the La Rochelle region with those in Bordeaux and Nantes in the second half of the century are notable. Bordeaux, for example, was much more dynamic than La Rochelle and its share in French trade continued to increase until 1789. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`After an exceptional year in 1747, due largely to the organization of transatlantic convoys departing from La Rochelle and escorted by the French Navy, in an effort to avoid merchant ships being plundered by the British, the La Rochelle region was responsible for 4.6% of total French trade in 1750. In 1789, its share dropped to 2.2%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`La Rochelles decline was not solely due to the quantity of trade. Data on foreign and colonial trade duties collected by the La Rochelle customs office, reveals that in 1750 this part of the territory handled 21% of the commodities traded by France (645 out of 3,055 after `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source\" target=\"blank\" rel=\"noopener noreferrer\">{`standardizing product spelling variations`}</a>{`). In 1789, it only traded 7% (248 out of 3,565). This sharp reduction in commodity types applies both to exports and imports. If these commodities are further combined in the 150 fields used in the `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification\" target=\"blank\" rel=\"noopener noreferrer\">{`Revolution and Empire classification used by the ANR Toflit18`}</a>{` program, the La Rochelle region traded in 121 of these fields in 1750, but in only 88 in 1789.`}</p>\n    <p>{`Exports took a much more diversified form in 1750 than in 1789 with a concentration index (Herfindhal) of 0.1 in 1750 and 0.24 in 1789. Exports were dominated in 1789 by a product for which there was not much national competition (brandy) and two re-exported colonial goods (coffee and sugar). Cotton cloth, often re-exported to Africa, came in fourth place, followed by salt (the value of salt was low compared to its tonnage, as it is a bulky, cheap product). In 1750, haberdashery and woollen fabrics were among the five main exports (along with indigo, brandy and sugar; salt was in 14th position). `}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`The La Rochelle customs region thus specialized in agricultural products and the re-export of colonial goods, at the expense of goods manufactured in the region. However, this seemingly negative consequence is balanced out by the capital intensity of brandy production, which approximated that of manufactured goods. When comparing the La Rochelle customs region with the national average, the importance and specialization of this export product clearly stands out.`}</p>\n    <p>{`We do not know where colonial re-exports ended up in 1789. By excluding them, we can see that market concentration in the La Rochelle customs region was the same in 1750 and in 1789 (between 0.41 and 0.44), but that England (a category designating Great Britain in French trade statistics) had replaced America (a term that in 1789 essentially referred to the French West Indies). This is confirmed by the tonnage distribution of vessels departing from the PASA region to foreign countries in 1789, which shows that a very large share went to Great Britain.`}</p>\n    <p>{`In brief, the La Rochelle customs region largely ceased exporting differentiated goods to Canada and mainly sent brandy to British ports. From a navigation perspective, the tonnage devoted to this type of trade was smaller than the tonnage mobilized for exporting salt to the North and Baltic seas.`}</p>\n    <p>{`The collected navigation data does not allow for further analysis of the trade decline in the region. First, we only have details of departures for the end of the Old Regime and this makes diachronic analysis impossible. Second, the data collected for 1789 only provide limited information regarding the products transported: the La Rochelle clearance tax records, for example, do not mention the nature of the cargo and customs agents in the regions other ports often only recorded the cargos main product. However, the clearance tax records indicate the destination of each departed ship and this shows a relative fragmentation of the markets in the region. `}</p>\n    <Caller id=\"partie-1-ports-destinations\" mdxType=\"Caller\" />\n    <p>{`Although we cannot substantiate that it was a new development, the regions incapacity to handle its own flows towards the end of the Old Regime confirms that it became marginalized. Vessels under foreign flag or vessels from outside the region accounted for 90% of international maritime trade. They were mostly British and North European. La Rochelle was the only port in the region to maintain its position, but as explained further (part 2.1), this was related to the slave and colonial trade. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`The regions inability to supply international exports was not due to a lack of maritime activity: on the contrary, the total number of ship departures from ports within the region in 1789, all destinations included, reveals that regional vessels accounted for a considerable share of the flows, higher than the share of ships from other French ports, while foreign vessels made up a very small share. However, the share of regional vessels navigating under French flag was lower than in most of the other French provinces: in 1787, the ports of Aunis-Saintonge-Poitou supplied 51.6% of the tonnage shipped, compared to 84.3% for Brittany or 58.7% for Guyenne. `}</p>\n    <Caller id=\"partie-1-ports-dattache-vers-etranger\" mdxType=\"Caller\" />\n    <p>{`This shows that by the end of the Old Regime, the region was not very active in terms of equipping ships. This fact must not over-ride the changes that took place in the region during the second half of the 18th century, notably as a result of the development or extension of local production intended for export from ports other than La Rochelle. The next section examines the high diversification of ports in the region.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"17 min read\",\"minutes\":16.015,\"time\":960900,\"words\":3203}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spcialisation-portuaire--le-cas-de-la-traite-ngrire-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spcialisation portuaire : le cas de la traite ngrire, du commerce du sel et de leau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" bureaux=\"tous,La Rochelle,Rochefort,Saint-Martin-de-R,Les Sables-d'Olonne,Marennes,Charente,Marans,Tonnay-Charente\" mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La rgion PASA se caractrise par une densit importante de ports qui entretiennent des relations plus ou moins tendues et plus ou moins intenses avec le reste de la France et du monde. Limportance de leurs mouvements maritimes et des tonnages nest pas directement corrle  la valeur des marchandises transportes. Ainsi, les deux bureaux des Fermes qui dominent en valeur des exportations sont ceux de La Rochelle, trs li au commerce colonial et ngrier, et de Tonnay-Charente, exportateur deau-de-vie essentiellement vers la Grande-Bretagne. Par contre, lactivit portuaire de Marennes (exportateur du sel vers les ports de la mer du Nord et de la Baltique) est en tonnage la plus importante de la rgion mais ses exportations sont de faible valeur. Les importations sont domines par les ports du bureau des fermes de La Rochelle (cest  dire, essentiellement, La Rochelle), en raison de la forte valeur des produits coloniaux. La balance du commerce de Rochefort, qui importe des matires premires navales, est trs dficitaire.`}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Nos analyses ont certes montr que`}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{` les tonnages enregistrs  Marennes semblent `}</a><a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{`surestims de 20%`}</a>{`, et mme de 50% dans 10% des pires cas, mais cela ne remet pas en cause la primaut de ce port. La carte, qui reprsente le tonnage expdi en 1789,  partir des congs dlivrs aux navires, toutes destinations confondues, met en outre en vidence le caractre trs internationalis des transporteurs dans les ports exportateurs de sel vers ltranger (Noirmoutier et lle de R) et deau-de-vie (Tonnay-Charente), ainsi qu Rochefort, largement approvisionn par les marines du Nord qui y apportent les matriaux ncessaires  larsenal. Ce sont ces transporteurs qui assurent la presque totalit du commerce avec ltranger (hors traite) de la rgion PASA. Comme nous le verrons `}<a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{`dans la partie 3`}</a>{`, La Rochelle na plus un rle structurant pour les ports de cette rgion: dautres ports entretiennent des relations avec ltranger et avec les marchs franais, en commercialisant les productions locales, sans que la chane logistique ne passe par La Rochelle.`}</p>\n    <p>{`Cette section propose une tude de trois ports de la rgion  la fin de lAncien Rgime afin de montrer la diversit des produits quils commercialisent et de leurs marchs. De par ses relations exclusives avec les colonies et surtout son investissement dans la traite ngrire, La Rochelle mrite une tude  part. Limportation de quantits considrables de denres coloniales, majoritairement r-exportes vers lEurope du Nord, met ce port dans une situation unique. Pour le commerce des eaux-de-vie, nous tudierons le cas de Tonnay-Charente. La mention de leau-de-vie parmi les cargaisons indiques par les congs tant rare, il faudra se tourner dabord vers les sources de la Balance du commerce, pour affiner ensuite les donnes par lanalyse de la navigation. `}</p>\n    <Caller id=\"sorties-de-sel\" mdxType=\"Caller\" />\n    <p>{`Plusieurs autres ports de la rgion, enfin, se consacrent prioritairement  lexportation du sel, comme on peut le constater sur le diagramme : Ars-en-R, Noirmoutier et surtout Marennes mobilisent de flottes dpassant en 1789 les 10000 tonneaux pour sa commercialisation. Nous dvelopperons ici en dtail le cas de Marennes, principal port exportateur de sel, dont la particularit est de miser largement sur lapprovisionnement du march national.`}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" bureaux=\"tous,La Rochelle\" mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, les colonies antillaises augmentent trs considrablement leur production de sucre, caf, indigo et produits tinctoriaux, pour rpondre  la hausse de la demande europenne. La croissance de la production passe par un nombre de plus en plus lev de plantations, qui ont un recours massif  une main-duvre desclaves, que les Europens dportent par centaines de milliers depuis lAfrique dans le cadre de la traite ngrire. Ce commerce transatlantique dtres humains, achets sur les ctes dAfrique par les ngriers europens, a commenc au XVe sicle, mais il atteint son apoge au dix-huitime sicle, lorsque 6 millions dAfricains sont dports aux Amriques. La moiti dentre eux est vendue aux Antilles. On estime  un million le nombre dAfricains introduits dans les colonies franaises au dix-huitime sicle. La principale destination est la colonie de Saint-Domingue (aujourdhui Hati) qui compte,  la veille de la grande rvolte de 1791, un demi-million desclaves, dont plus de la moiti sont ns en Afrique. Alors que dans la plupart des ports ngriers franais, la part des armements ngriers est nettement infrieure  celle des armements en droiture vers les Antilles, cela nest pas le cas  La Rochelle: sur les 15 dparts de 1789 depuis ce port destins  approvisionner les Antilles en hommes ou en produits, 12 sont des ngriers qui font voile tout dabord vers les ctes africaines dans le cadre dun circuit triangulaire.. Comme  Honfleur, il y a donc clairement, en matire de trafics transatlantiques, une spcialisation ngrire rochelaise. En 1789, les 12 ngriers partis de La Rochelle sont tous arms par des ngociants rochelais. Trois autres ngriers partent depuis Rochefort.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" bureaux=\"tous,La Rochelle\" minTonnage=\"100\" mdxType=\"Caller\" />\n    <p>{`Lactivit ngrire est aux mains darmateurs privs qui esprent raliser un profit lors de la revente des captifs aux Antilles. Si Nantes est le principal port ngrier franais, La Rochelle a jou un rle significatif, tout particulirement dans les annes 17301740 : entre 1713 et 1744, La Rochelle arme 15% des expditions ngrires franaises; sa part tombe  11% aprs la perte du Canada. Alors que La Rochelle est le deuxime port ngrier le plus important en France avant 1763, il passe au quatrime rang par la suite.`}</p>\n    <p>{`Malgr un dclin relatif, lactivit ngrire rochelaise augmente en termes absolus : les armateurs rochelais passent de 4,3 armements ngriers par an pour la priode 17131744  12,5 armements par an dans la dcennie 17831793. Pendant cette dernire dcennie, la traite est vritablement lactivit principale, voire presque exclusive, des armateurs rochelais : en 1789, sur un total de 200 dparts depuis le port de La Rochelle de navires arms par des Rochelais, un peu plus de la moiti des tonnages se dirigent vers lAfrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se rpartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers ltranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dpasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dpassant le 50 tonneaux (le plus grand faisant 827 tonneaux) sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et ngrier. `}</p>\n    <p>{`Ds lors quon carte la poussire des caboteurs, limportance des destinations africaines et des colonies est lisible sur ce schma, qui reprsente les destinations des navires sortis du port de La Rochelle en 1789, tout port dattache confondu. Tous les navires qui se dirigent vers les Amriques, les Antilles ou locan Indien sauf un sont par ailleurs arms par des armateurs de La Rochelle. `}</p>\n    <p>{`Au total, dans les dernires annes de lAncien Rgime, une douzaine de navires reviennent chaque anne  La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour dune expdition ngrire aprs une tape aux Antilles. Les donnes de la Balance du commerce confirment la centralit du commerce colonial et ngrier : en 1789, les exportations vers lAfrique reprsentent 23% du total des exportations du bureau des Fermes de La Rochelle, alors que 73% est constitu par les r-exportations des denres coloniales. La valeur des produits ramens est estime, en 1789,  7,1 millions de livres tournois, dont 5,1 sont rexports  ltranger. Les ngociants rochelais semblent stre taills une position forte dans le march du caf, ce qui peut sexpliquer par leurs liens quasi-exclusifs avec Saint-Domingue o plusieurs grandes familles de la ville (Belin, Garesch, Poupet Rasteau) sont trs bien implantes. Saint-Domingue fournit en effet la presque totalit du caf import en France depuis les Antilles.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Si les donnes collectes par la Balance du commerce ne permettent pas de connatre les destinations des rexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative. Les Pays-Bas autrichiens (actuelle Belgique), les Provinces-Unies, Brme, Hambourg, les ports de la Baltique reoivent chacun des navires totalisant entre 500 et 550 tonneaux. Parmi les autres destinations europennes des navires partis de La Rochelle, seule la Grande-Bretagne (1 048 tonneaux) nest vraisemblablement pas destinataire des produits coloniaux, car elle sapprovisionne dans ses propres colonies. `}</p>\n    <p>{`Ds lors, il nest pas surprenant que le ngoce rochelais porte toute son attention aux questions lies au commerce colonial et ngrier. Cela apparat clairement parmi les sujets discuts par la chambre de commerce de La Rochelle. Lindexation faite  la main,  lpoque, sur la marge des registres de dlibrations de la Chambre de Commerce de La Rochelle permet de constater que dans la seule anne 1789, le commerce dAfrique est discut  une trentaine de reprises, et les colonies  une cinquantaine de reprises, le commerce de lInde  9 reprises;  titre de comparaison, le commerce avec ltranger est abord 11 fois en tout, et la pche (avec notamment la question de la concurrence et de ladmission de la pche tats-unienne, trs dbattue cette anne l en France), 17 fois. Parmi les produits indexs en marge des registres de dlibrations, les comestibles sont mentionns 16 fois - ce qui dans la conjoncture cralire particulire de lpoque nest gure tonnant-, leau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure, en dpit dun critre sans doute grossier, que le regard des membres de la Chambre de commerce est clairement riv sur les colonies et la traite. `}</p>\n    <p>{`Si la question de la traite semble absente des cahiers de dolances de la rgion (lanalyse porte sur un chantillon de 163 cahiers sur les 522 rdigs dans lensemble de la rgion PASA), la dfense des intrts coloniaux apparat, significativement, uniquement dans le cahier de dolances du tiers tat de la ville de La Rochelle, dont les reprsentants envoys  Versailles demanderont la rvocation de larrt rendu au conseil du roi, le 30 aot 1784, concernant le commerce tranger dans les colonies, et le rtablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrs quont faits la navigation franoise et la culture des isles franoises de lAmrique. Larrt en question est celui qui a largi lexclusif mitig, introduit en 1767, en facilitant lapprovisionnement des colonies par les navires trangers dans des conditions restrictives prcises. Ladmission de navires trangers aux colonies a provoqu les protestations de toutes les chambres du commerce de France concernes par le commerce colonial, car le ngoce franais refuse toute concurrence. Ce qui est intressant cest toutefois que nous ne sommes pas ici dans le cadre dun document qui mane de la Chambre de commerce ou dun groupe darmateurs: le cahier de dolances du tiers tat de La Rochelle se fait donc le porte-parole des intrts du ngoce colonial franais, et demande galement des lois interdisant la rexportation des sucres bruts afin dencourager les raffineries locales. Enfin les dputs demanderont la rvocation de larrt du 14 avril 1785 , qui a cr une nouvelle compagnie des Indes et de celui pour ladmission des trangers dans les isles de France et de Bourbon (cest --dire  lle Maurice et  la Runion), mme si pendant lpoque du commerce libre (17691785), les armements vers locan Indien ou la Chine depuis La Rochelle (26) ont t infrieurs  ceux de Nantes (44), Bordeaux (41), Marseille (42) ou Saint-Malo (32) et bien sr de Lorient (120). `}</p>\n    <p>{`La participation rocheloise  la navigation au-del du cap de Bonne-Esprance  la fin de lAncien Rgime est en effet modeste: ltat des exportations de 1789, nindique que des exportations vers lInde dune valeur de 38 060 livres tournois, et rien vers les Mascareignes. Ces donnes semblent toutefois incompatibles avec le dpart du navire Henri IV pour lle de France et lle Bourbon, le 9 mai 1789, qui arrive  bon port en fvrier 1790, et qui nest pas un ngrier `}{`[`}{`Toussaint, 1967, p. 291`}{`]`}{`  moins que sa cargaison ne vienne entirement dautres directions de Fermes du royaume. En 1787, ce sont trois navires qui partent de La Rochelle vers les Mascareignes : une certaine diversification des armements coloniaux apparat donc, ici comme  Bordeaux, dans les annes 1780, lorsque la baisse des profits du commerce antillais incite  chercher des investissements plus rentables.`}</p>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de leau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} bureaux=\"Charente, Saint-Martin-de-R, Rochefort,Tonnay-Charente\" mdxType=\"Caller\" />\n    <p>{`Les congs de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux deau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin dannoter les cargaisons (il le fait 12 fois sur un total de 601 dparts): nous avons donc un aperu global de la navigation, sans pouvoir distinguer la nature des produits. Lanalyse mene sur les sorties de lanne 1787 permet toutefois didentifier les rseaux commerciaux. 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent  ltranger (en Angleterre pour les deux tiers, le reste vers les les anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent  Dunkerque. On identifie ici la flotte europenne de leau-de-vie, qui reprsente 22% du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, compos dune poussire de petits caboteurs (tonnage moyen 35 tx) et qui reprsente tout de mme 30% du tonnage sortant. Ces navires sont aligns sur une destination unique: La Rochelle. Ils sont pour partie occups  lapprovisionnement de la ville et peut-tre  un commerce rgional ou national: en revanche, La Rochelle a perdu le rle dentrept pour le commerce international de leau-de-vie quelle avait dans les annes 1730. Les principales maisons de ngoce deau-de-vie, en particulier Martell, nont plus de bureaux  La Rochelle en 1789: leurs bureaux principaux ont t rapatris  Tonnay-Charente et/ou dplacs  Paris. Enfin, des units plus modestes (25 tx en moyenne) voluent au sein de la mer des Pertuis (depuis la Seudre sud jusquaux Sables dOlonne) : elles reprsentent 23% du tonnage  la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congs dlivrs en 1787 dans ce port concernent les navires avalant et attachs  des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrire et les produits manufacturs de larrire-pays  Tonnay-Charente, leurs matres quittent ce port soit  vide, soit avec une cargaison destine  Rochefort, La Rochelle ou bien aux ports de la mer des Pertuis, qui leur fournissent un fret de retour pour leur navigation vers lamont du fleuve Charente. `}{`]`}</p>\n    <Caller id=\"exports-eau-de-vie-la-rochelle-longitudinal\" mdxType=\"Caller\" />\n    <p>{`Les exportations deau-de-vie charentaise en 1789 sont trs suprieures  la moyenne sculaire. Lexplication rside en partie dans les modifications induites par le Trait dEden de 1786, qui entrane une augmentation extrmement importante des exportations deau-de-vie vers lAngleterre, notamment des eaux-de-vie de qualit produites dans la rgion de Cognac, au dtriment de celles de moindre qualit. Le total des exportations deaux-de-vie franaises vers la Grande-Bretagne passe de 10  15 millions de livres tournois dans les annes 176070,  40 millions en 178789.`}</p>\n    <Caller id=\"exports-eau-de-vie-comparaison-directions-des-fermes\" mdxType=\"Caller\" />\n    <p>{`La Rochelle domine les exportations deaux-de-vie franaises en 1750, mais est dpasse par Bordeaux en 1770, qui exporte, en concurrence avec la Direction des fermes de la Rochelle, des eaux-de-vie de lAngoumois. Par contre, lexplosion des exportations vers lAngleterre permise par le trait Eden-Reynald de 1787 bnficie beaucoup plus  La Rochelle qu Bordeaux. Nantes stagne alors que les exportations depuis Bayonne et Montpellier croissent.`}</p>\n    <Caller id=\"origines-exports-eau-de-vie-1789-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Parmis les zones de production, lAngoumois domine, suivi par lAunis. Les valeurs exportes en eaux-de-vie double (ie  teneur dalcool plus lev) sont comparables  celles de eaux-de-vie simples. La dnomination eaux-de-vie double nexiste que dans les chiffres de 1788 et 1789 et que dans les donnes issues de la rgion PASA, indiquant peut-tre les progrs des techniques de distillation dans la rgion.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} bureaux=\"Saint-Martin-de-R, Marennes\" mdxType=\"Caller\" />\n    <p>{`Denre pondreuse de faible valeur, le sel voyage ds que cela est possible par voie maritime. Les ctes de la rgion PASA sont, comme celles du sud de la Bretagne, de trs grands producteurs de sel. Marennes est un port dsign comme fournisseur par ladministration des gabelle il approvisionne entre autres les greniers  sel de Libourne, de Honfleur, et de Saint-Valry-sur-Somme. Ses marchs sont donc avant tout nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment  la grande pche. Ltranger (pays de la mer du Nord et du pourtour de la Baltique) y est un partenaire moins important que pour Saint-Martin-de-R ou Noirmoutier. `}</p>\n    <Caller id=\"sorties-de-marennes\" mdxType=\"Caller\" />\n    <p>{`Cest pourquoi, en quantit, le bureau des fermes de Marennes est le principal exportateur de sel en France, si lon inclut aussi les livraisons vers les ports francs franais. Il vient en troisime position, derrire les bureaux du Croisic et de Saint-Martin-de-R, si on se limite aux marchs extrieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas leves compares  celles des flux commerciaux dont il a t question pour La Rochelle et Tonnay-Charente: le sel export depuis Marennes, y compris  destination des ports francs franais, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers ltranger). En revanche, son commerce alimente un mouvement portuaire extrmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la rgion tudie. Son commerce maritime est donc une activit importante, tant pour la production locale quil soutient, que pour lactivit induite lie  son transport (construction navale, emploi maritime). Comme on la vu plus haut (partie 1), les transporteurs ne sont pas de Marennes mme, et les retombes concernent donc aussi bien les ports de cabotage de la rgion que ceux du littoral atlantique franais.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" bureaux=\"Saint-Martin-de-R, Marennes\" mdxType=\"Caller\" />\n    <p>{`Les donnes sur la navigation aident  prciser la gographie commerciale du sel export, mme si elles nindiquent pas les quantits exportes.  compter du rgne de Louis XIV, la lgislation relative aux gabelles fait obligation au chargeur de naviguer avec une cargaison complte. Le tonnage des navires chargs de sel est donc un assez bon indicateur des quantits exportes. Les congs confirment que, parmi les ports exportateurs de la rgion tudie, la primaut revient incontestablement  Marennes: en 1787, le tonnage additionn de navires sortis avec du sel y est de plus du double qu Ars-en-R, le deuxime grand exportateur de la rgion. Mme en prenant en compte la survaluation des tonnages de navires  Marennes, que nous avons constate en comparant le tonnage dun mme navire relev en plusieurs ports, Marennes demeure le principal fournisseur de sel en France. `}</p>\n    <p>{`Lexportation de sel est en outre une activit quasi exclusive  Marennes : sur 1174 dparts en 1787, 990 ont charg du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de leau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":15.5,\"time\":930000,\"words\":3100}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-2-highly-specialized-ports-the-trade-in-slaves-salt-and-brandy\"\n    }}>{`Part 2 Highly specialized ports: the trade in slaves, salt, and brandy`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} highlight=\"toflit18\" filter=\"aucun\" bureaux=\"tous,La Rochelle,Rochefort,Saint-Martin-de-R,Les Sables-dOlonne,Marennes,Charente,Marans,Tonnay-Charente\" mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`The PASA region contained a high density of ports that maintained fairly extensive and rather frequent trade relations with the rest of France and the world. The number and the aggregated tonnage of ships departing from these ports did not directly correlate with the value of the goods transported. The two dominant custom offices, in terms of export value, were those of La Rochelle, with its strong ties to the colonial and slave trades, and of Tonnay-Charente, which specialized in the export of brandy, mainly to Great Britain. The port of Marennes (a salt exporter to the North Sea and the Baltic), in contrast, represented the regions highest tonnage levels albeit at low export value. Imports to the region were dominated by the customs region of La Rochelle (namely, La Rochelle itself) due to the high value of colonial products. The deficit of exports versus imports at Rochefort, which imported naval raw materials, was severe and exports were negligible at this port `}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Even though our analyses have shown that`}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{` the tonnages recorded at Marennes were probably`}</a>{` `}<a href=\"https://drive.google.com/file/d/1Lr_7vo2oUHvWWWxNPknVtioLepYmIxLn/view\" target=\"blank\" rel=\"noopener noreferrer\">{`overestimated by 20%`}</a>{`, sometimes even by 50% in 10% of the worst cases, the ports supremacy remained undisputed. The map, which shows the tonnage shipped in 1789 based on the ports clearance records, all destinations combined, also highlights the high part of foreign shipping in ports engaged in the international salt (Noirmoutier and the island de R) and brandy (Tonnay-Charente) trades. Additionally, there was a high proportion of foreign ships in Rochefort, transporting naval stores from the North to the French royal shipyard. These vessels handled almost all foreign trade (excluding the slave trade) in the PASA region. As we will see`}<a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{` `}</a><a href=\"https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3\" target=\"blank\" rel=\"noopener noreferrer\">{`in part 3`}</a>{`, La Rochelle no longer played a central role among the regions ports as other ports engaged in foreign trade as well as with French markets, selling local products without going through La Rochelle.`}</p>\n    <p>{`This section provides a comparative study of three ports in the region at the end of the Old Regime, showing the variety of products they traded and of their markets. Due to its exclusive relationship with the colonies, and especially its participation in the slave trade, La Rochelle deserves a separate study. Its considerable imports of colonial goods, most of which were re-exported to Northern Europe, gave the port a unique role. As for the brandy trade, the port of Tonnay-Charente serves as a case study. Since brandy was rarely mentioned as a cargo in the clearance records, we first examined the Balance of Trade sources and then refined the data by analyzing ship clearances. `}</p>\n    <Caller id=\"sorties-de-sel\" mdxType=\"Caller\" />\n    <p>{`Finally, several other ports in the region dedicated themselves primarily to the export of salt, as can be seen in the diagram. In 1789, the salt trade fleets at Ars-en-R, Noirmoutier, and especially Marennes, exceeded 10,000 French tonneaux (1 French tonneau = 1.44 cubic meters). Here we will focus in detail on Marennes, the chief salt-exporting port, which mainly concentrated on supplying the national market.`}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-and-the-triangular-trade\"\n    }}>{`2.1. La Rochelle and the triangular trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"toflit18\" bureaux=\"tous,La Rochelle\" mdxType=\"Caller\" />\n    <p>{`In the eighteenth century, the West Indian colonies considerably expanded their production of sugar, coffee, indigo, and dye products to meet the increased European demand. Production growth required ever more plantations, in turn massively reliant on slave labor sourced by the hundreds of thousands from Africa. The transatlantic trade of human beings purchased on the coasts of Africa by European slave traders began in the fifteenth century, and reached its peak in the eighteenth century, when six million Africans were forcibly transported to the Americas. Half of them were sold in the West Indies. It is estimated that one million Africans were shipped to the French colonies in the eighteenth century. Their main destination was the colony of Saint Domingue (now Haiti) which, on the eve of the great revolt of 1791, had a slave population of half a million, more than half of them African-born. Although the share of slave shipping in most French slave-trade ports was significantly lower than direct shipping to the West Indies, this was not the case for La Rochelle: out of 15 departures from its port in 1789 supplying slaves or products to the West Indies, 12 were slave ships headed initially for the African coast in a triangular circuit. The transatlantic traffic of La Rochelle, like that of Honfleur, was clearly specialized in the slave trade. In 1789, all 12 slave ships that departed from La Rochelle were outfitted by La Rochelle merchants. Three additional slave ships left from Rochefort. `}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"colonial\"} highlight=\"navigo\" bureaux=\"tous,La Rochelle\" minTonnage=\"100\" mdxType=\"Caller\" />\n    <p>{`The slave trade was handled by private shipowners who expected to make a profit by reselling the captives in the West Indies. Even though Nantes was the main French slave port, La Rochelle still played a significant role, especially during the 1730s and the 1740s. Between 1713 and 1744, La Rochelle supplied 15% of French slaving expeditions. Its share decreased to 11% after Canada was lost. While La Rochelle was the second most important slave port in France before 1763, it later dropped to fourth position.`}</p>\n    <p>{`Despite a relative decline, La Rochelles slave trade increased in absolute terms: 4.3 slave ships per year were outfitted by La Rochelle shipowners in the 1713 to 1744 period, and this number increased to 12.5 ships per year in the decade from 1783 to 1793. During the latter decade, slave trade truly became the main, if not almost exclusive, activity of La Rochelle shipowners: in 1789, out of a total of 200 ship departures from La Rochelle outfitted by local merchants, over half of the tonnage went to Africa, to the West Indian colonies or the Mascarene islands, with Africa accounting for 42% of the total. The rest was divided between Newfoundland and Saint-Pierre-et-Miquelon (9.2%). The share of shipping to foreign countries was insignificant (0.2%), and shipping beyond neighboring ports (Aunis, Poitou, and Saintonge) did not exceed 5%. Three-quarters of the roughly 30 La Rochelle ships with a capacity exceeding 50 tonneaux (the largest holding 827 tonneaux) that left the port of La Rochelle in 1789 were engaged in the transatlantic and slave trade. `}</p>\n    <p>{`If we ignore the scattered coastal traffic, the importance of African destinations and colonies becomes clear in this diagram, which shows the destinations of ships departing La Rochelle in 1789, all home ports combined. Further, all the ships heading for the Americas, the West Indies, or the Indian Ocean except one were outfitted by shipowners from La Rochelle. `}</p>\n    <p>{`In total, during the final years of the Old Regime, each year a dozen ships returned to La Rochelle from the colonies, either in direct line or (most often) returning from a slaving expedition after a stopover in the West Indies. The Balance of Trade data confirm the centrality of the colonial and slave trade: in 1789, exports to Africa represented 23% of the total exports of the La Rochelle customs office, while 73% were re-exports of colonial goods. The value of the products shipped back to La Rochelle was estimated in 1789 at 7.1 million French livres, of which 5.1 million were re-exported abroad. La Rochelle merchants seem to have carved out a strong position in the coffee market, due to their almost exclusive ties with Saint Domingue where several prominent families of La Rochelle (Belin, Garesch, and Poupet Rasteau) were very well established. Saint Domingue supplied almost all the coffee imported into France from the West Indies.`}</p>\n    <Caller id=\"partie-2-carte-direction-bateaux-de-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Although the Balance of Trade data does not allow us to determine the destinations of La Rochelle colonial re-exports, the destinations of the ships that departed from the port in 1789 do give us an approximate indication. The Austrian Low Countries (now Belgium), the United Provinces (now the Netherlands), Bremen, Hamburg, and the Baltic ports each received ships with a total capacity of 500 to 550 tonneaux from La Rochelle. Of the other European destinations of ships leaving from La Rochelle, it was probably only Great Britain (1,048 tonneaux) that did not take in colonial products, because it was supplied by its own colonies. `}</p>\n    <p>{`Unsurprisingly, issues relating to colonial and slave trade were a predominant concern of La Rochelle merchants, as is clearly evident in the topics raised in the La Rochelle Chamber of Commerce. A contemporary hand-written index to these deliberations of the Chamber of Commerce was written in the margins of the registers, revealing that in the year 1789 alone, trade with Africa was discussed some 30 times, the topic of the colonies was raised close to 50 times, and trade with India 9 times. By way of comparison, trade with foreign countries was discussed just 11 times, and fishing (more specifically the question of authorizing American competition, much debated that year in France) 17 times. Among the products indexed in the margins of the registers of deliberations, foodstuffs were mentioned 16 times  which is hardly surprising considering the importance of cereal crops in these crisis years  while brandy and wine appear 6 times, sugars and refineries 8, and coal 3 times. Just this rough tabulation is enough to show that the members of the Chamber of Commerce clearly had their eyes glued to the colonies and the slave trade. `}</p>\n    <p>{`The issue of the slave trade may be largely absent from the 1789 lists of grievances (cahiers de dolances) prepared for the General Estates of the region (we analyzed a sample of 163 cahiers out of the 522 drafted in the entire PASA region), but the defense of colonial interests appears significantly in the lists of grievances of the third estate of the city of La Rochelle only. Its representatives sent to Versailles were asked to seek the revocation of the Act issued at the kings council of August 30, 1784 which concerned foreign trade in the colonies, and the reestablishment of the provisions of the letters patent of 1717 and 1727 which the third estate of La Rochelle considered as an essential element to the progress made by French navigation and the culture of the French islands of America. The 1784 Act expanded the softened Exclusif mitig system introduced in 1767, allowing more foreign ships under specific restrictive conditions to supply the colonies. This authorization of foreign ships in the colonies was met with protest by all the Chambers of Commerce in France involved in colonial trade, because French merchants were opposed to any foreign competition. What is interesting however is that even though this was not a document originating from the Chamber of Commerce or from a group of shipowners, the list of grievances of the third estate of La Rochelle defended French colonial trading interests and also called for laws to prohibit the re-export of raw sugars in order to protect local refineries. Finally, the deputies were to request the revocation of the decree of April 14, 1785, which created a new East India company, and of the decree that allowed foreigners into the Isles of France and Bourbon (i.e., Mauritius and Reunion), even if during the era of free trade (17691785), ship outfitting to the Indian Ocean or China from La Rochelle (26) was lower than from Nantes (44), Bordeaux (41), Marseille (42) or Saint-Malo (32) and of course Lorient (120). `}</p>\n    <p>{`La Rochelle was only modestly involved in navigation beyond the Cape of Good Hope at the end of the Old Regime. Records in 1789 only mention exports to India of a value of 38,060 French livres, and none to the Mascarene Islands. However, on May 9 that year the non-slaving ship Henri IV was recorded as departing for the Isle of France and the Isle of Bourbon, arriving safely in February 1790 `}{`[`}{`Toussaint, 1967, p. 291`}{`]`}{`. Perhaps its cargo originated entirely from other customs regions. In 1787, three ships left La Rochelle for the Mascarenes, which shows a certain diversification of colonial outfitting here as in Bordeaux in the 1780s when the decline in profits from the West Indian trade encouraged the search for more profitable investments.`}</p>\n    <h2 {...{\n      \"id\": \"22-the-brandy-trade\"\n    }}>{`2.2. The brandy trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"eau-de-vie\"} bureaux=\"Charente, Saint-Martin-de-R, Rochefort,Tonnay-Charente\" mdxType=\"Caller\" />\n    <p>{`The ships records we can access are unfortunately of little help in identifying trade flows in brandy. The customs agent of the port of Tonnay-Charente, for example, did not usually bother to identify the cargoes (he did so only 12 times out of a total of 601 departures), which means that we have an overview of navigation but not of the type of products exported. An analysis of departures for the year 1787 nevertheless allowed us to identify the commercial flows. Out of 67 ships of an average tonnage close to 100 tonneaux departing from Tonnay-Charente, 42 went overseas (two-thirds to English ports, the rest to the Channel Islands, Ostend, and the Baltic); the remaining 25 large coasters sailed to Dunkirk. We were able to identify the European brandy fleet, which represented 22% of the outgoing tonnage in 1787. We also identified a second group, composed of a scattering of small coasters (with an average tonnage of 35 tonneaux) which nevertheless represented 30% of the total outgoing tonnage. These ships were all headed to a single destination: La Rochelle. They partly supplied the city and perhaps also the regional or national trade, but it is clear that La Rochelle had lost the role of warehouse for the international trade of brandy that it held in the 1730s. The main brandy trading houses, such as Martell, no longer had offices in La Rochelle in 1789. Their headquarters had been repatriated to Tonnay-Charente or moved to Paris. Finally, more modest vessels (25 tonneaux on average) navigating within the sea of Pertuis (from La Seudre down to Les Sables-dOlonne) represented 23% of the tonnage shipped out of Tonnay-Charente. It should be noted that 479 of the 743 clearances issued in 1787 in that port concerned ships based in river ports navigating downstream. These ships carried brandy along with quarry stones and manufactured products from the hinterland to Tonnay-Charente, and left the port either empty or with a cargo for Rochefort, La Rochelle or the seaports of Pertuis, which provided them with return freight for their navigation up the Charente river. `}</p>\n    <Caller id=\"exports-eau-de-vie-la-rochelle-longitudinal\" mdxType=\"Caller\" />\n    <p>{`Exports of Charente brandy in 1789 were much higher than the average during that century. This was in part due to the changes brought about by the Treaty of Eden of 1786, which led to an extremely large increase in brandy exports to Great Britain, notably quality brandy produced in the Cognac region, and a decrease in lower quality ones. The total exports of French brandy to Great Britain rose from 1015 million French livres in the years 17601770 to 40 million in 178789.`}</p>\n    <Caller id=\"exports-eau-de-vie-comparaison-directions-des-fermes\" mdxType=\"Caller\" />\n    <p>{`La Rochelle dominated exports of French brandy in 1750, but was overtaken by Bordeaux in 1770, which competed with the La Rochelle customs region by exporting brandy from the Angoumois region. However, the aforenoted Eden-Reynald Treaty of 1787 that led to an explosion of exports to Great Britain benefited La Rochelle region much more than Bordeaux. Brandy export from Nantes was stagnating, while exports from Bayonne and Montpellier were growing.`}</p>\n    <Caller id=\"origines-exports-eau-de-vie-1789-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`The dominant production area was the Angoumois region, followed by the Aunis. The value of exported double brandy (i.e. with a higher alcohol content) was comparable to that of simple brandy. The double brandy designation first appeared in the 1788 and 1789 figures and only in data from the PASA region, perhaps indicating advanced distillation techniques in the region.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-and-the-salt-trade\"\n    }}>{`2.3. Marennes and the salt trade`}</h2>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} bureaux=\"Saint-Martin-de-R, Marennes\" mdxType=\"Caller\" />\n    <p>{`Salt, a heavy commodity of low value, travelled mostly by sea. The coasts of the PASA region were major salt producers, as were those of southern Brittany. And the port of Marennes was designated as a supplier by the salt tax administration (gabelle). It supplied the salt granaries of Libourne, Honfleur, and Saint-Valry-sur-Somme, among others. Its markets were therefore mostly national, and its demand was sustained, particularly in the Channel ports specialized in outfitting deep-sea fishing. Foreign countries (on the North Sea and around the Baltic) were less important partners in this case than for Saint-Martin-de-R or Noirmoutier. `}</p>\n    <Caller id=\"sorties-de-marennes\" mdxType=\"Caller\" />\n    <p>{`The Marennes customs region was then, in terms of quantity, the main French salt exporter, if we also include shipments to French free ports. It comes in third position, behind the regions of Croisic and Saint-Martin-de-R, if we only consider markets outside the kingdom.`}</p>\n    <p>{`The values involved were not high compared to the trade flows of La Rochelle and Tonnay-Charente mentioned above. The salt exported from Marennes, including to French free ports, amounted to around 360,000 French livres in 1789 (including 141,000 to foreign countries). Nevertheless, the salt trade contributed to extremely intense port activity, making Marennes the main port in our region of interest in terms of the number of departing ships and their tonnage. Its maritime trade represented an important activity, both because of the local production that it supported, and because of the activity induced by its transportation (shipbuilding and maritime employment). As seen above (part 1), the vessels did not originate from Marennes itself, and the trade therefore benefitted both the coastal ports in the region and those on the French Atlantic coast.`}</p>\n    <Caller id=\"viz-principale-partie-2\" filter={\"sel\"} highlight=\"navigo\" bureaux=\"Saint-Martin-de-R, Marennes\" mdxType=\"Caller\" />\n    <p>{`Shipping data can be used to understand the commercial geography of exported salt, but it does not reveal the quantities exported. Starting from the reign of Louis XIV, however, salt tax laws required the captain to sail with a full cargo. The tonnage of vessels loaded with salt is therefore a fairly good indication of the quantities exported. The clearance documents confirm that, among the exporting ports of our region of interest, Marennes unquestionably comes in first place. In 1787, the cumulative tonnage of ships transporting salt departing from Marennes was more than twice the tonnage shipped from Ars-en-R, the second largest exporter in the region. Even after noting the ship tonnage overvaluation in Marennes, which we observed by comparing it with the tonnage of the same ships recorded in other ports, Marennes remains the main salt supplier of France. `}</p>\n    <p>{`Salt export is almost the exclusive activity of Marennes: out of 1,174 ship departures in 1787, 990 had a salt load. In 1789, it rose to 1,301 out of 1,481 ships. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-and-the-triangular-trade\",\n    level: 2,\n    title: \"2.1. La Rochelle and the triangular trade\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-the-brandy-trade\",\n    level: 2,\n    title: \"2.2. The brandy trade\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-and-the-salt-trade\",\n    level: 2,\n    title: \"2.3. Marennes and the salt trade\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"9 min read\",\"minutes\":8.25,\"time\":495000,\"words\":1650}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`En 1789, les navires qui sortent des ports exportateurs de sels (Marennes, Ars-en-R) et de Rochefort ont un tonnage moyen plus important que ceux sortant de La Rochelle. De manire plus surprenante, la quantit de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de R, voire mme Rochefort - tmoigne dun dynamisme qui chappe largement au port dominant, La Rochelle. Cette particularit sinscrit dans une histoire maritime longue de la rgion PASA.`}</p>\n    <p>{`Jusqu la perte des colonies nord-amricaines, le port de La Rochelle a cultiv une certaine spcificit gographique. Quoique le port de La Rochelle pratiquait, comme la presque totalit des ports atlantiques, le commerce antillais et ngrier, une part importante et qui a progressivement augment jusqu reprsenter plus de la moiti de ses armements pour les colonies dans les annes 1750 tait constitue par le commerce nord-amricain - Canada, Louisiane et pcheries de Terre-Neuve. Cette spcificit gographique a galement influ sur sa spcialisation par produits. Le commerce des fourrures est ainsi une spcialit rochelaise jusquau dbut des annes 1760. Les fourrures taient importes non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de lOhio. Ces fourrures taient pour partie r-exportes en France et en Europe (principalement vers lespace allemand et en Suisse). Une part importante, les peaux de castors en particulier, ntait pas rexporte, mais alimentait lindustrie de chamoiserie niortaise et dautres localits franaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matires premires et en produits manufacturs. LAmrique du Nord tait donc un dbouch important et facile pour les crales de la rgion, les toffes locales de basse qualit et, dans une moindre mesure, le sel ncessaire aux pcheries de Terre-Neuve. Ce commerce quoique modeste avant les annes 1740 fournissait des volumes importants demploi dans ces trois secteurs de lconomie rgionale et contribuait  faire du port de La Rochelle le centre de gravit du complexe portuaire rgional. Cette domination tait renforce par la prpondrance des capitaux rochelais, investis de manire prioritaire dans le commerce Atlantique - nord-amricain et antillais. La domination rochelaise se mesurait notamment au dbut du sicle par la prsence des bureaux principaux des maisons de Cognac  La Rochelle. Mais, ds la crise qui suivit la chute du systme de Law, La Rochelle commena  perdre sa place et Tonnay-Charente  saffirmer comme le principal port dexportation de leau-de-vie produite dans la rgion, et du Cognac en particulier. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Ainsi, mme si le port de la Rochelle a lascendant sur les autres ports de la rgion par la diversit des produits quil importe et exporte et, surtout, par son activit dans le commerce atlantique, les changes des ports de la rgion sont largement autonomes comme le montre le rseau des voyages de la rgion PASA de 1787 compar  ceux des deux autres rgions situes au nord (la Loire-Atlantique) et au sud (lAquitaine). Les indices de centralit (la betweeness centrality ou centralit dintermdiarit compte le nombre de plus courts chemins entre deux ports passant par le port donn ; le pagerank mesure la connexion relative  des ports eux-mmes bien connects. Voir `}<a href=\"https://fr.wikipedia.org/wiki/Centralit%25C3%25A9\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://fr.wikipedia.org/wiki/Centralit%C3%A9\"\n        }}>{`https://fr.wikipedia.org/wiki/Centralit%C3%A9`}</a></a>{`) compares  ceux dautres rgions domines par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacit  structurer les trafics maritimes locaux comme nous lavons illustr dans la partie 2 avec les exemples de la traite, du commerce des eaux-de-vie et du commerce du sel.`}</p>\n    <p>{`Ce constat peut tre li historiquement  la perte des colonies nord-amricaines (Canada et Louisiane) qui a bris une dynamique vertueuse qui stait tablie dans les annes suivant la guerre de succession dAutriche. En effet, avant 1748, le commerce des Antilles en droiture et la traite ngrire continuaient  dominer le commerce de la Direction de la Rochelle en valeur, tant donn le dynamisme limit de la demande manant de lAmrique du Nord. Mais, ds la fin de la guerre de Succession dAutriche, souvre une priode de croissance exceptionnelle pour le commerce avec lAmrique du Nord. Sur la priode 17481758, La Rochelle reoit annuellement plus de 1 300 000 livres de peaux dAmrique du Nord, soit presque autant en valeur que de sucre des Antilles (1 450 000 livres). Le nombre darmements  destination du Canada est multipli par deux alors que celui pour la Louisiane augmente de moiti. Par rapport aux annes prcdant la guerre, le trafic li au commerce colonial triangulaire baisse en moyenne dun quart pour les Antilles et de plus de la moiti pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et mme Dunkerque et Marseille. A linverse, les Rochelais ont un monopole de fait pour la Louisiane qui nintresse gure les ports plus importants et seul Bordeaux les concurrence pour lapprovisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilits complmentaires. Dun ct, le commerce  destination du Canada pouvait se transformer en commerce triangulaire invers - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les les  sucre en morue sale et, plus rarement, en crales. La Louisiane permettait galement de raliser des oprations de contrebande avec les colons espagnols, offrant la possibilit de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1991).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limit en volume, mais crateur demplois locaux et, au milieu du sicle, facteur dun dynamisme certain, scroule avec la perte des colonies franaises nord-amricaines  la fin de la guerre de Sept Ans. Cette perte dstructure durablement le commerce rochelais qui perd ses marchs privilgis et sa position dominante au sein du rseau portuaire rgional. En 1789, le commerce extrieur du port de la Rochelle est quasi exclusivement colonial : prs de 90% de ses exportations en valeur sont destines  la traite africaine et aux Antilles. Son impact dans la structuration de la rgion tudie apparat faible, alors que les autres bureaux de Fermes de la rgion exportent essentiellement des produits rgionaux, cela nest pas le cas dans le bureau de La Rochelle. Dautres ports, par ailleurs, sont nettement plus extravertis en termes de navigation. Le profil de La Rochelle sapparente  celui des autres grands ports coloniaux,  cela prs que Bordeaux exporte une partie consistante de produits rgionaux de son arrire-pays, quil contribue  structurer. Le Havre et Nantes, comme La Rochelle, nexportent pas, eux, essentiellement des produits de leur rgion. La part des voyages internes  la rgion est en revanche importante pour La Rochelle, mais cela reflte plus les ncessits de lapprovisionnement de la ville et de la rgion quun rle dentrept pour lexportation. Ainsi,  titre dexemple, le total du tonnage expdi du seul port de Ribrou-Saujon en 1789 vers La Rochelle avec de la chaux est de 1640 tonneaux. Quant  la quarantaine de navires qui sy rendent depuis Marennes, ils ont  bord du vin, des eaux-de-vie, du bois, des fves, des hutres, des meubles, des passagers, ou naviguent  vide.`}</p>\n    <p>{`Les graphiques que nous proposons illustrent fidlement nos propos. Ce dclin se donne  voir,  la veille de la Rvolution, sur le graphique en dbut de section, o linfrastructure de la rgion PASA apparat originale par le faible poids relatif de son port principal - La Rochelle - incapable de freiner le dveloppement des ports quil maintenait dans sa dpendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-R. Dans la priode pr-rvolutionnaire (17871789), les flux de navires comme de marchandises tmoignent ainsi de la recomposition de lconomie de la faade maritime. Dsormais, la valeur des flux de marchandises au dpart de Tonnay-Charente et  larrive de Rochefort, qui entretient directement les productions locales, se rapproche de ceux de La Rochelle.`}</p>\n    <p>{`Cette volution est la consquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des ngociants rochelais, consquence directe de la vague de faillites qui secouent le milieu  la fin de la guerre de Sept Ans; la fermeture des marchs nord-amricains subventionns qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite ngrire. Pour lanimer, les ngociants rochelais se procurent les marchandises ncessaires  ce commerce dans toute la France et lEurope et ne se fournissent que trs peu dans larrire-pays rochelais. Le port nest donc pas le point de passage oblig de son arrire-pays dans les relations avec le grand large, et ce, dautant plus, que la faiblesse capitalistique de la place loigne les maisons de commerce spcialises dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux  Tonnay-Charente ou  Paris. Mme dans le commerce colonial, La Rochelle doit faire une place aux autres ports de la rgion puisque Rochefort se voit accorder lautorisation de faire le commerce colonial, tmoignant du dclin conomique et politique du port.`}</p>\n    <p>{`Pour conclure, La Rochelle reste en 1789 un port relativement dominant dans la rgion, notamment en ce qui concerne le commerce atlantique, mais cette domination a largement diminu au cours du sicle. De plus, la spcialisation des ports de la rgion dans le sel pour les uns (Marennes, Ars-en-R), dans leau-de-vie pour les autres (Tonnay-Charente et, dans une moindre mesure, les ports de lle de R), nest plus articule par la place de La Rochelle. Le commerce colonial ne sappuie plus sur le rseau des ports et des places manufacturires locales, mais survit grce aux capitaux et aux marchandises venus dailleurs.`}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`Les guerres de la Rvolution et napoloniennes ont par la suite dmontr la fragilit et lartificialit dun tel dispositif. Le blocus anglais et linterdiction de la traite transatlantique sonnent pour le port de la Rochelle le glas de son destin de grand port commercial. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.575,\"time\":454500,\"words\":1515}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"part-3-la-rochelle-a-dominant-port-but-not-a-regional-hub\"\n    }}>{`Part 3. La Rochelle, a dominant port but not a regional hub`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`In 1789, ships departing from salt exporting ports (Marennes and Ars-en-R) or from Rochefort had a higher average tonnage than those departing from La Rochelle. Surprisingly, an analysis of the number of ships departing from secondary ports (Aligre, Charente, Marennes, Saint-Martin de R, and even Rochefort) shows that the dynamic activities at these ports were mostly unrelated to those of the dominant port, La Rochelle. This characteristic is a result of the long historical evolution of maritime trade in the PASA region.`}</p>\n    <p>{`The port of La Rochelle had cultivated a certain geographic distinctiveness until France lost its North American colonies. Like most Atlantic ports La Rochelle was involved in the West Indian and slave trade, but a considerable share of its shipments to the colonies was devoted to trade with North America (Canada, Louisiana, and Newfoundland fisheries), increasingly progressively to represent more than half of its colonial outfitting in the 1750s. This focus also influenced the nature of the products the port specialized in.`}</p>\n    <p>{`Fur trade was a La Rochelle specialty up to the early 1760s, with furs not only imported from Canada, but also from Louisiana, the main seaport for Ohio animal skins. These were for the most part re-exported in France and in Europe (mainly to the German territories and Switzerland). An important share  beaver furs notably  was not re-exported but went to the leather industry of Niort and other French towns. In return, La Rochelle supplied food, raw materials, and manufactured products to Canada and Louisiana. North America was an important and easy market for the regions grain, low-quality local cloth, and to a lesser extent for the salt used by Newfoundland fisheries. While still modest in the 1740s, this trade provided high levels of employment in all three sectors of the regional economy and turned La Rochelle into the focal point of the regional port complex. This dominant position was compounded by the large share of La Rochelle capital invested in the Atlantic trade with North America and the West Indies. At the turn of the century La Rochelles superiority was reflected in the fact that Cognac companies established their headquarters in the town. However, following the crisis brought on by the end of the Law financial system in 1720, La Rochelle progressively lost its leading position and Tonnay-Charentes grew as the main port for the export of brandy produced in the region, and of Cognac more particularly. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`La Rochelle overshadowed other ports in the region in the diversity of exported and imported products, and especially in its involvement in the Atlantic trade. The other regional ports largely developed their own economic activities independently, as shown by a comparison of the network of ship routes in the PASA region in 1787 with two other regions in the North (Loire-Atlantique) and South (Aquitaine). The indicators of centrality (ie the betweenness centrality, which is the number of shortest routes between two ports that pass through a given port, or PageRank centrality measuring the connection with other well-connected ports  see https:// en.wikipedia/wiki/Centrality) confirm La Rochelles comparative weakness and inability to centralize local maritime traffic when contrasted against other regions dominated by a central port (such as South-West France, the Loire-Atlantique, or Normandy). This was illustrated in part 2 above in examples relating to the slave trade and the brandy and salt trades.`}</p>\n    <p>{`La Rochelles weaker position within its region is probably a consequence of the loss of the North American colonies (Canada and Louisiana), which broke a positive cycle that had been established in the period after the War of the Austrian Succession. Before 1748, direct trade with the West Indies and the slave trade remained dominant within the La Rochelle customs region in terms of value, because of the limited demand from North America. But, immediately after the War of the Austrian Succession, a period of exceptional growth began in trade with North America. From 1748 to 1758, La Rochelle annually imported more than 1,300,000 French livres of North American skins, almost equal in value to West Indian sugar (1,450,000 French livres). The number of ships outfitted to sail to Canada had doubled, while the number travelling to Louisiana increased by half. Compared to the pre-war years, traffic to the West Indies fell on average by a quarter and slave trade traffic decreased by more than half now that La Rochelle was in direct competition with ports such as Bordeaux, Nantes, Rouen, and even Dunkirk and Marseille. Conversely, La Rochelle had a de facto monopoly over Louisiana, which was of little interest to larger ports, and only competed with Bordeaux in supplying Canada. These two destinations offered complementary possibilities, allowing for other types of triangular trade between La Rochelle, Canada, and West Indies to arise, based on Canadian salted cod and, more rarely, grain that could supply the sugar islands. Trade with Louisiana also provided smuggling possibilities with Spanish settlers, and this could offer rich returns in the form of Spanish silver dollars (Augeron: 2004; Mathieu: 1991).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Although this niche trade was limited in volume, it created local jobs and, in the middle of the century, gave rise to a certain dynamism which collapsed with the loss of the French North American colonies at the end of the Seven Years War. This loss permanently disrupted La Rochelle trade, depriving it of its distinctive markets and forcing it to relinquish its dominant position within the regional port network. By 1789, La Rochelle export trade was almost exclusively colonial: the slave trade and trade with the West Indies represented nearly 90% of its export value and the ports activities no longer no longer framed the regional export economy which fell to neighboring customs offices. La Rochelles profile was similar to that of other large colonial ports, except for Bordeaux which consistently exported a share of products originating from its hinterland and became a regional hub for that trade. Le Havre and Nantes, like La Rochelle, did not mainly export products from their region. While the share of maritime traffic between La Rochelle and its region was important, its purpose was mainly to supply the city and the region rather than to serve as a warehouse for export. Thus, for example, in 1789, the port of Ribrou-Saujon alone shipped lime to La Rochelle on ships totaling 1,640 tonneaux, and the forty or so ships that sailed to La Rochelle from Marennes carried wine, brandy, wood, beans, oysters, furniture, and passengers, or sailed empty.`}</p>\n    <p>{`This information is accurately illustrated in our charts. La Rochelles decline, which set in on the eve of the Revolution, is displayed in the opening chart in this section. La Rochelle  despite being the PASA regions main port  saw comparatively low traffic post-1763, resulting in other regional ports expanding their own trade activities, such as Tonnay-Charente, Marennes, Rochefort, and Ars-en-R. In the pre-revolutionary period (17871789), the flow of ships and goods thus reflected this reconfigured seafront trade. The value of the flow of goods leaving Tonnay-Charente or those entering Rochefort, which directly supported local production, now rivaled those from La Rochelle.`}</p>\n    <p>{`This trend evolved out of several adverse circumstances that compounded each other: the decline in capitalization by La Rochelle merchants, a direct consequence of the wave of bankruptcies that shook the town from the middle to the end of the Seven Years War; the loss of subsidized North American markets that would have allowed La Rochelle to rapidly rebound; and strong competition from other ports on West Indian markets. All that remained for La Rochelle was the slave trade. To maintain it, merchants purchased the goods needed from all over France and Europe and were only rarely supplied by their own hinterland. The port no longer served as the hinterlands main route towards the open sea, particularly after the towns capital weakness had driven away the trading companies specialized in Cognac: for example, Martell moved its headquarters to Tonnay-Charente and Paris. La Rochelle even faced competition in the colonial trade from other ports in the region. Rochefort gained permission to engage in the colonial trade, confirming the economic and political decline of the port of La Rochelle.`}</p>\n    <p>{`In conclusion, in 1789, La Rochelle was still a relatively dominant port in the region, particularly as regards the Atlantic trade, but this dominance declined considerably over the course of the century. In addition, the specialization of regional ports in salt (Marennes and Ars-en-R) and in brandy (Tonnay-Charente and, to a lesser extent, the ports of the island of R) meant that trade no longer revolved around La Rochelle. Colonial trade no longer relied on local networks of ports and manufacturing centers but survived on capital and goods from elsewhere.`}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`The Revolutionary and Napoleonic wars subsequently demonstrated the fragility and artificiality of this situation. The British blockade and the ban on transatlantic trade put an end to the port of La Rochelles status as a major commercial port. `}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"17 min read\",\"minutes\":16.105,\"time\":966300,\"words\":3221}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"-propos\"\n    }}>{` propos`}</h1>\n    <p>{`Le prsent site a t ralis dans le cadre du `}<a href=\"https://anr.portic.fr/\" target=\"blank\" rel=\"noopener noreferrer\">{`programme de recherche ANR PORTIC`}</a>{`. Ce programme porte sur les dynamiques de navigation et du commerce extrieur au dix-huitime sicle, un commerce qui seffectue largement par voie maritime. Outre la meilleure comprhension de ces dynamiques par le croisement de deux jeux de donnes, un enjeu fondamental du programme est de chercher des mthodes de qualification et dapprhension de lincertitude des donnes historiques, en exprimentant des modes de visualisation et dcriture appropris.`}</p>\n    <p>{`Dans ce cadre, le Working Package n5 de ce programme de recherche consiste  effectuer une srie dtudes de cas tirant parti de deux corpus existants de sources historiques numrises : `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`, une base de donnes portant sur lhistoire de la navigation pilote par Silvia Marzagalli et Christine Plumejeaud ; et `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{`, une base de donnes portant sur le commerce extrieur de la France, pilote par Loc Charles et Guillaume Daudin.`}</p>\n    <p>{`Ce site web sinscrit dans un mouvement second faisant suite aux premires entreprises de numrisation pour chacune des deux bases, en tentant de valoriser le travail dj accompli via ltude approfondie de sous-ensembles signifiants dans les donnes. Ces tudes clairent des questions disciplinaires existantes sous un nouveau jour grce aux nouveaux matriaux et mthodes offerts par les bases de donnes mobilises par le programme. Les questions souleves par une telle initiative sont multiples :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Comment mobiliser ensemble deux sources dont certaines dimensions sont incommensurables ou difficiles  mettre en quivalence ? Comment croiser les donnes numrises des deux bases avec des connaissances plus denses et qualitatives sur les phnomnes tudis, apportes par des historiens spcialistes de la rgion tudie ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte, au moment de lenqute et du raisonnement, limportante stratification de transformations, de rductions et de dcisions interprtatives constituant la chane qui relie les sources initiales avec les donnes qui en ont t tires ? `}</li>\n      <li parentName=\"ul\">{`Comment prendre en compte lincertitude ou lincompltude des donnes tout en proposant une analyse scientifiquement solide des phnomnes tudis ? `}</li>\n      <li parentName=\"ul\">{`Comment faire dialoguer les formes classiques de lcriture historique - le rcit dploy phrase aprs phrase, largument droul paragraphe par paragraphe - avec les formes dcriture diagrammatique et computationnelle quimplique la ralisation dun site web ? `}</li>\n      <li parentName=\"ul\">{`Comment grer la collaboration interdisciplinaire et la partition dexpertises quimplique une telle criture multimodale ?`}</li>\n    </ul>\n    <p>{`Toutes ces questions ont t travailles lors des six mois de collaboration qui ont men  llaboration de ce site, dont voici un bref rcit.`}</p>\n    <h2 {...{\n      \"id\": \"dune-srie-de-questionnements--une-semaine-denqute\"\n    }}>{`Dune srie de questionnements  une semaine denqute`}</h2>\n    <p>{`Ltude de cas dont ce site est laboutissement a t articule autour dun format de collaboration intensive que nous appelons datasprint et qui consiste  faire travailler ensemble des expert.e.s de plusieurs disciplines sur un temps court et avec des questions de recherche dtermines  lavance, sur la base dun ou plusieurs jeux de donnes prpars pour loccasion.`}</p>\n    <p>{`En amont du datasprint, nous avons conduit pendant plusieurs mois un double travail de prparation des donnes, et de prparation des questions de recherche. Sur le plan des donnes, les quipes de Navigocorpus et de Toflit18 donnes ont d effectuer un important travail de nettoyage et daffinement concernant les rgions et les priodes tudies : le fait de projeter une tude de cas prcise a fait merger des problmes qui taient rests dans lombre faute de besoin dun rexamen approfondi. Un travail trs important a galement t effectu pour aligner les deux bases, cest--dire pour mettre en correspondance les lieux et les types de produits commercs ou transports tels quils sont dcrits dans chacune des bases.`}</p>\n    <p>{`Sur le plan de la prparation des questions de recherche de dpart, nous avons conduit une srie de runions prliminaires relies par des documents en ligne rdigs collaborativement, qui nous ont aid  identifier des questions  la fois pertinentes en regard de lhistoire de la rgion et de la littrature existante, mais aussi de ce que les donnes nous permettaient - ou pas - dexplorer et de visualiser. Ce travail dajustement et de mise en correspondance entre les questions et les donnes a ainsi couru doctobre 2020  avril 2021, et nous a permis  la fois didentifier les activits dexploration les plus pertinentes  proposer aux participants durant latelier, et dviter les chausses-trappes qui nous auraient conduit dans des questionnements impossibles  rsoudre.`}</p>\n    <p>{`De ce travail de prparation est n un document de questionnement scientifique destin  expliciter les questions de recherche  explorer partag  tous les participant.e.s de la semaine de datasprint. Ainsi, au dbut du datasprint, ltude de cas tait structure en deux groupes, correspondant  deux lignes denqute complmentaires mais aussi  la constitution de deux quipes quilibres pour la collaboration :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`la premire quipe devait se consacrer  tudier le dynamisme de la rgion du Poitou par rapport  la France et au monde en gnral (avec lhypothse dun dclin par rapport au reste de la France au cours du dix-huitime sicle)`}</li>\n      <li parentName=\"ul\">{`la seconde quipe devait se consacrer  tudier les relations de complmentarit et de domination entre ports de la rgion, de manire notamment  distinguer les flux et circuits commerciaux qui y sont associs`}</li>\n    </ul>\n    <p>{`Sur cette base, un kit de bienvenue a t conu pour permettre  tou.te.s les expert.e.s de rapidement saisir les multiples dimensions de latelier, et nous avons conduit quelques enqutes prliminaires permettant de rsoudre les questions les plus videntes pour tirer le meilleur parti possible de la concentration dexpertises multiples sur le temps court et trs dense du datasprint.`}</p>\n    <h3 {...{\n      \"id\": \"faire-avec-les-conditions-de-recherche\"\n    }}>{`Faire avec les conditions de recherche`}</h3>\n    <p>{`La semaine du datasprint, qui a eu lieu dbut avril 2021, sest avre concider avec un moment de forte reprise de lpidmie de covid-19 en France en gnral et  Paris en particulier. Cela nous a contraint  effectuer latelier en ligne. Conduire un datasprint en ligne revenait  se priver de lincommensurable apport des changes informels et autres possibilits daffichage, de circulation et de spatialisation offerts par le travail dans un mme lieu physique.  cette contrainte sest ajoute la subite fermeture des coles maternelles et primaires ladite semaine, qui a occasionn une srieuse charge extra-professionnelle pour une part substantielle des participant.e.s.`}</p>\n    <p>{`Le datasprint a nanmoins eu lieu, et nous avons dcid de considrer les conditions particulires dans lesquelles il sest conduit non seulement comme des contraintes demandant de recalibrer drastiquement nos attentes, mais aussi comme des occasions dinvention et dexprimentation appelant  adapter nos manires de procder par rapport aux modalits initialement planifies.`}</p>\n    <h3 {...{\n      \"id\": \"improvisations-et-adaptations\"\n    }}>{`Improvisations et adaptations`}</h3>\n    <p>{`Durant le datasprint, la diversit des comptences des participant.e.s a impliqu de remettre  plat la rpartition des tches. Ainsi, chacun a pu tre amen  suggrer des pistes de recherche, manipuler les donnes, et se pencher sur lanalyse et la mise en forme des rsultats. Cette semaine a notamment t loccasion dexprimenter avec un grand nombre de technologies utilises durant les activits denqute, notamment `}<a href=\"https://jupyter.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`jupyter notebook`}</a>{`, `}<a href=\"https://kepler.gl/\" target=\"blank\" rel=\"noopener noreferrer\">{`kepler.gl`}</a>{`, `}<a href=\"https://vega.github.io/vega/\" target=\"blank\" rel=\"noopener noreferrer\">{`vega`}</a>{`, ou encore `}<a href=\"https://matplotlib.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`matplotlib`}</a>{`. Nous avons nanmoins galement parfois touch aux limites de ce principe en condition zoomifie, certaines discussions spcialises (sur le plan technique ou sur le plan historique par exemple) ncessitant parfois de rformer les corps disciplinaires et de prvoir des moments dapart transversaux.`}</p>\n    <p>{`Le format datasprint implique par ailleurs une dimension exprimentale, parfois chaotique, et les difficults de communications impliques par la conduite en ligne ont amplifi cette dimension. Nous avons donc construit nos journes de travail sur un canevas allg en terme damplitude horaire, et sous une forme tentant de varier les rythmes et les chelles dinteraction : un point de plnire en matine, suivi de travail en deux groupes, eux-mmes rapidement re-diviss en binmes ou en moments de travail individuel. `}</p>\n    <p>{`Sur le plan technique, nous avons opt pour une salle zoom permanente ouverte durant toute la semaine et divise en breakout rooms (salles de travail) permettant de travailler en plus petits ensembles ; nous avons galement soutenu la semaine avec un dossier google drive trs organis dans lequel lensemble des activits ont t archives et consignes.`}</p>\n    <p>{`Pour faciliter le processus dintercomprhension, des procdures mthodologiques ont galement t proposes aux participants. Ainsi, des personnes jouant le rle de facilitateurs ont fait le lien entre les diffrents groupes en circulant continuellement entre les diffrentes salles zoom de travail. Nous avons par ailleurs insist sur limportance de la documentation en structurant les activits de chaque jour autour de lcriture de rapports remplis au fur et  mesure de la journe, dont une personne scribe tait charge de prendre soin afin de garder un maximum de traces et de permettre les changes dinformation asynchrones. Ces rapports ont finalement t progressivement abandonns, car trop lourds tant donn le poids des autres activits. Nous avons galement progressivement rduit les temps de visioconfrence pour minimiser la fatigue lie aux changes en ligne.`}</p>\n    <p>{`Les sances de travail dun datasprint provoquent parfois un effet bulle dans lequel chaque quipe peut rapidement se dconnecter du travail effectu par les autres, entranant des blocages, des tches effectues en doublon ou des angles morts. Ce problme est amplifi par la conduite en ligne. Pour faire face  ce dfi, nous avons rythm les journes de points dtapes effectues  plusieurs chelles - par petits groupes, par quipes, ou en plnire - afin de partager les avances. Par ailleurs, des visites informelles et autres zoom surfing ont permis de favoriser certaines circulations dides et de mthodes.`}</p>\n    <p>{`Lun des intrts du format datasprint est enfin de favoriser une unit de temps pour le travail interdisciplinaire. Lintensit quimplique cette unit de temps appelle cependant une valorisation  la hauteur des efforts fournis sur le temps court. Le temps du datasprint est, en temps normal,  la fois un temps dexploration et denqute, et un temps de production de rsultats. Cependant, ce principe a t confront  deux spcificits dans notre cas : les conditions de travail en ligne ont demand de revoir les attentes plus modestement, mais aussi le principe et les objectifs mmes des datasprint de PORTIC qui, parce quils visent la publication de sites web finaliss et contribuant de manire relativement prcise  des tudes de cas trs serres (et non de rapports dexploration des donnes comme cest souvent le cas pour les autres datasprints). Face  ces spcificits, il nous a fallu articuler latelier avec un travail postrieur cadr par dautres temporalits pour arriver  un rsultat publiable.`}</p>\n    <h2 {...{\n      \"id\": \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\"\n    }}>{`La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique`}</h2>\n    <p>{` partir du travail effectu lors du datasprint, nous avons engag une seconde phase dapprofondissement. Sur le fond, les axes de recherche initialement envisags ont t progressivement remanis. Cela a t fait ds la fin de la semaine de datasprint, au moment de la rdaction dun document de synthse mettant en regard les visualisations produites durant la semaine. Ce travail a t ensuite continu par Ccile Asselin qui a effectu un travail de synthse et de nettoyage sur les productions de la semaine.`}</p>\n    <h3 {...{\n      \"id\": \"une-criture-multimodale\"\n    }}>{`Une criture multimodale`}</h3>\n    <p>{`Afin de construire progressivement,  partir des explorations du datasprint, un document propre  tre publi et  transmettre un rcit et des arguments  partir des donnes des deux bases, nous avons tent dutiliser la perspective de la fabrication dun site pour articuler trois types dcriture : la confection de nouveaux fichiers de donnes correspondant aux enqutes souleves par les activits de la semaine (criture computationnelle) ; la confection de visualisations dinformations (criture diagrammatique) ; enfin, bien sr, la mise en rcit et en argument historique de ltude de cas (criture en prose).`}</p>\n    <p>{`Pour ce faire, nous avons dcid de structurer le site en une srie de trois parties  la structure identique : une visualisation principale constituant largument principal de la partie, accompagn dun texte se fondant dabord sur elle puis suivant ses propres dveloppements, accompagn de visualisations secondaires. Cette organisation visuelle et rhtorique a induit un mode de travail itratif sur le registre du ping pong qui sest dploy en trois temps : `}</p>\n    <ul>\n      <li parentName=\"ul\">{`dans la foule du datasprint, les historien.ne.s ont dabord travaill  prciser les arguments de chacune des trois parties (avril-mai 2021)`}</li>\n      <li parentName=\"ul\">{`nous avons ensuite organis deux jours intensifs de conception avec une quipe rduite dingnieur.e.s et de designers (Ccile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, Maxime Zoffoli) durant lesquels nous avons conu des propositions de visualisations principales (fin mai 2021)`}</li>\n      <li parentName=\"ul\">{`les historien.es ont,  la suite de ces deux jours, repris la main sur lcriture, enrichie et structure par les propositions constitues par les visualisations, en prcisant leurs textes comme leurs besoins pour des visualisations complmentaires, qui ont t progressivement produites en fonction du texte (juin-septembre 2021)`}</li>\n    </ul>\n    <p>{`Dans ce cadre, nous avons progressivement ngoci une infrastructure de travail oriente vers le dveloppement progressif du prsent site web. Ce dernier a tout autant servi dobjectif que de moyen de rencontre entre les diffrentes activits qui ont suivi la semaine datelier datasprint.`}</p>\n    <p>{`La fabrication du site prsent au public a t articule autour dun protocole automatis qui a permis de mettre le site  jour quotidiennement pendant sa phase dcriture et de dveloppement, et ainsi de faire progresser conjointement sa structure, son aspect graphique et les divers contenus qui le peuplent (voir son `}<a href=\"https://github.com/medialab/portic-storymaps-2021\" target=\"blank\" rel=\"noopener noreferrer\">{`rpertoire github`}</a>{` pour plus dinformations). Plus prcisment, ce protocole automatis consistait  rcuprer les contenus crits dans un google documents crit par les historien.ne.s, les donnes des bases Navigocorpus et Toflit18 sur leurs espaces numriques respectifs, et enfin  produire un ensemble de donnes optimises pour le web avant de refabriquer le site.`}</p>\n    <p>{`Cette mthode de travail sur mesure, alternative  lutilisation dun CMS (type wordpress) ou dune intgration des contenus entirement artisanale, nous a permis de multiplier les itrations sur les donnes, les visualisations et les textes, afin de dvelopper itrativement un document ajust et cohrent pour la lecture. Elle nous a galement permis dchapper  une approche qui voudrait formater la production du site de manire trop squentielle, cest--dire faisant suivre un premier temps de conception puis un deuxime temps dexcution, pour plutt faire place  la dcouverte et au dialogue avec les diffrents matriaux en train de se dvelopper. `}</p>\n    <p>{`Ainsi, la mthode de travail et de montage du site adopte ici, outre la dimension doptimisation quimplique lautomatisation de certaines tches, a t le moyen de favoriser un dialogue plus organique entre les diffrentes critures en jeu dans ce document : en ralisant simultanment le design du site, celui des visualisations, et les textes qui les accompagnent, nous avons tent de faire profiter chacune de ces activits lune de lautre, comme des sources dinvention ou de solidification mutuelle, plutt que de les considrer comme des tches spcialises et/ou articules selon un rgime de subordination (de lhistoire  la technique, ou du visuel au textuel, ou de largument  son illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\"\n    }}>{`Un site destin  tisser des liens avec dautres activits et dautres publics`}</h3>\n    <p>{`Ce site est pens  la fois comme un objet autonome droulant le rcit scientifique de lhistoire de la rgion de La Rochelle au dix-huitime sicle, et comme la premire pice dassemblages scientifiques et didactiques encore  venir. Nous lavons conu avec le projet de ladresser  un public constitu dtudiant.e.s en histoire, de professeur.e.s dhistoire du secondaire, ou damateur.ice.s avancs passionns par le Poitou et les Charentes. Cependant, le site est galement pens pour pouvoir sarticuler avec deux publics complmentaires :`}</p>\n    <ul>\n      <li parentName=\"ul\">{`les personnes spcialises dans la mdiation et/ou la vulgarisation pourront utiliser certaines des visualisations pour des initiatives destines  un plus grand public`}</li>\n      <li parentName=\"ul\">{`les historien.ne.s spcialiss pourront citer ces visualisations dans des publications conventionnelles en revues ou monographies et ainsi sappuyer sur ces dernires pour continuer nos enqutes`}</li>\n    </ul>\n    <p>{`Pour ce faire, nous avons notamment rendu chacune des visualisations dtachable du rcit propos via la page atlas - et plus techniquement en dotant chacune des visualisations dune adresse URL propre.`}</p>\n    <p>{`Par ailleurs, le `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`code source du site`}</a>{`, partag sous licence libre, a t construit et document de manire  pouvoir tre driv - en tout ou partie - pour dautres projets  venir : il pourra apporter des lments utiles pour les prochaines tudes de cas du programme PORTIC mais aussi pour dautres projets similaires. Il est enfin  noter que toutes les donnes utilises - et les scripts qui les gnrent  partir des donnes compltes de Toflit18 et Navigocorpus, accessibles toutes les deux librement - sont galement inclus dans le code source du site, rendant nos visualisations et rsultats entirement reproductibles.`}</p>\n    <h2 {...{\n      \"id\": \"une-criture-collective\"\n    }}>{`Une criture collective`}</h2>\n    <p>{`Ce site est le rsultat dun processus denqute et dcriture collective qui a mobilis des personnes issues de plusieurs disciplines : histoire, conomie, informatique, gomatique, design. `}</p>\n    <p>{`Les textes de cette publication ont t crits par `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{` (professeur dhistoire moderne, Universit Cte dAzur - CMMC, coordinatrice et co-responsable scientifique du programme PORTIC), `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loc Charles`}</a>{` (professeur dconomie, INED, Universit Paris 8 Vincennes - LED), `}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{` (professeur dconomie, Universit Paris-Dauphine - LEDa-DIAL), et `}<a href=\"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/\" target=\"blank\" rel=\"noopener noreferrer\">{`Thierry Sauzeau`}</a>{` (professeur dhistoire moderne, Universit de Poitiers - Criham).`}</p>\n    <p>{`Lensemble du processus de mdiation et darticulation de la collaboration a t men par lingnieure stagiaire `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, qui sest consacre  plein temps pendant six mois  la conduite mthodologique et technique de lensemble de ltude de cas, accompagne par `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{` (designer de recherche, mdialab Sciences Po - co-responsable scientifique du programme PORTIC en charge des tudes de cas).`}</p>\n    <p>{`Les visualisations ont t conues et dveloppes par `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`, `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{` (gomaticienne, laboratoire LIENSs - co-responsable scientifique du programme PORTIC), `}<a href=\"https://fr.linkedin.com/in/paul-girard-57822118\" target=\"blank\" rel=\"noopener noreferrer\">{`Paul Girard`}</a>{` (ingnieur expert en humanits numriques - entreprise `}<a href=\"https://www.ouestware.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Ouestware`}</a>{`), `}<a href=\"https://www.maximezoffoli.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Maxime Zoffoli`}</a>{` (designer expert en visualisation dinformation), `}<a href=\"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b\" target=\"blank\" rel=\"noopener noreferrer\">{`Graldine Geoffroy`}</a>{` (data librarian, Universit Cte dAzur).`}</p>\n    <p>{`Les fonds de carte dpoque ont t constitus par `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`.`}</p>\n    <p>{`La prparation et la vrification des donnes ont t effectue par les quipes de Navigocorpus (`}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`, `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{`), de Toflit18 (`}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{`, `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loc Charles`}</a>{`) et du mdialab (`}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{` et `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`).`}</p>\n    <p>{`Le site a t dvelopp par `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{` et `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`.`}</p>\n    <p>{` ces personnes sajoutent celles ayant particip au datasprint qui a conduit  cette publication : les ingnieurs en mthodes numriques et designers du laboratoire mdialab de Sciences Po `}<a href=\"https://bmaz.github.io/\" target=\"blank\" rel=\"noopener noreferrer\">{`Batrice Mazoyer`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/\" target=\"blank\" rel=\"noopener noreferrer\">{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/guillaume-plique/\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Plique`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/heloise-thero/\" target=\"blank\" rel=\"noopener noreferrer\">{`Hlose Thro`}</a>{`, et `}<a href=\"https://paulinegourlet.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Pauline Gourlet`}</a>{` ; les chercheurs `}<a href=\"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\" target=\"blank\" rel=\"noopener noreferrer\">{`Pierrick Pourchasse`}</a>{` (professeur mrite dhistoire moderne, Universit de Bretagne Occidentale), et `}<a href=\"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\" target=\"blank\" rel=\"noopener noreferrer\">{`Alain Bouju`}</a>{` (matre de confrence HDR en informatique, Universit de La Rochelle).`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"dune-srie-de-questionnements--une-semaine-denqute\",\n    level: 2,\n    title: \"Dune srie de questionnements  une semaine denqute\",\n    children: [\n        {\n              id: \"faire-avec-les-conditions-de-recherche\",\n              level: 3,\n              title: \"Faire avec les conditions de recherche\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisations-et-adaptations\",\n              level: 3,\n              title: \"Improvisations et adaptations\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"la-fabrication-dun-site-web-comme-pivot-pour-lcriture-multimodale--entretenir-une-infrastructure-technique-et-mthodologique\",\n    level: 2,\n    title: \"La fabrication dun site web comme pivot pour lcriture multimodale : entretenir une infrastructure technique et mthodologique\",\n    children: [\n        {\n              id: \"une-criture-multimodale\",\n              level: 3,\n              title: \"Une criture multimodale\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"un-site-destin--tisser-des-liens-avec-dautres-activits-et-dautres-publics\",\n              level: 3,\n              title: \"Un site destin  tisser des liens avec dautres activits et dautres publics\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"une-criture-collective\",\n    level: 2,\n    title: \"Une criture collective\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"15 min read\",\"minutes\":14.74,\"time\":884400,\"words\":2948}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"about\"\n    }}>{`About`}</h1>\n    <p>{`This website was designed as part of the `}<a href=\"https://anr.portic.fr/\" target=\"blank\" rel=\"noopener noreferrer\">{`ANR PORTIC research program`}</a>{`. This program studies the navigation and foreign trade flows in the eighteenth century when trade was largely carried out at sea. In addition to gaining a better understanding of these dynamics by cross-referencing two sets of data, a fundamental objective of the program was to find methods to qualify and deal with the uncertainty of the historical data by experimenting with suitable methods of displaying and writing the information.`}</p>\n    <p>{`In this framework, Working Package 5 of the research program involved a series of case studies based on two existing corpora of digitized historical sources: `}<a href=\"http://navigocorpus.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`Navigocorpus`}</a>{`, a database covering the history of navigation, supervised by Silvia Marzagalli and Christine Plumejeaud; and `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/home\" target=\"blank\" rel=\"noopener noreferrer\">{`Toflit18`}</a>{`, a database covering Frances foreign trade, supervised by Loc Charles and Guillaume Daudin.`}</p>\n    <p>{`This website was designed as part of the second phase of the project, following a first phase of digitization to constitute the two databases, intending to take advantage of the work already accomplished and carrying out an in-depth study of significant data subsets. These studies shed new light on themes already studied within the discipline by providing new material and methods by means of the databases developed as part of the program. This initiative raised a number of questions:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`How can two sources be used together when some of their dimensions cannot be measured or are difficult to compare? How can the digitized data from the two databases be cross-referenced to acquire a deeper and more qualitative knowledge about the phenomena provided by historians specialized in the region studied? `}</li>\n      <li parentName=\"ul\">{`How can the survey and analysis take into account the considerable stratification of transformations, reductions and interpretative decisions that form the chain that connects the initial sources with the data drawn from them? `}</li>\n      <li parentName=\"ul\">{`How can the uncertainty or incompleteness of the data be taken into account, while proposing a scientifically sound analysis of the phenomena studied? `}</li>\n      <li parentName=\"ul\">{`How can the standard forms of historical writing the narrative formed by consecutive sentences, the argument developed paragraph by paragraph effectively serve the forms of diagrammatic and computational writing involved when creating a website? `}</li>\n      <li parentName=\"ul\">{`How is it possible to manage interdisciplinary collaboration and the division of expertise involved in this kind of multimodal writing?`}</li>\n    </ul>\n    <p>{`These questions were worked out across a six-month period of collaboration that led to the development of the website and will be briefly recounted below.`}</p>\n    <h2 {...{\n      \"id\": \"from-a-series-of-questions-to-a-week-of-investigation\"\n    }}>{`From a series of questions to a week of investigation`}</h2>\n    <p>{`The case study which led to this website was the outcome of intensive collaboration which we call a data sprint and which consists in gathering experts from several disciplines to work together over a short period of time on pre-determined research questions, based on one or more datasets prepared for the occasion.`}</p>\n    <p>{`Ahead of the data sprint, several months were devoted to preparing the data and the research questions. As regards data, the major task for the Navigocorpus and Toflit18 data teams was to clean and refine the data for the regions and periods studied, as the simple fact of planning a specific case study revealed new problems that had remained hidden until an in-depth study was implemented. Another major challenge was to align the two databases, i.e. to match the places and types of products traded or transported as described in each of the databases.`}</p>\n    <p>{`To prepare the initial research questions, we held a series of preliminary meetings based on collaboratively produced online documents that helped us identify pertinent questions with respect to the history of the region and the existing literature, but also with respect to what could or could not be explored and displayed with the data available. This work of adjustment and matching up questions and data ran from October 2020 to April 2021, allowing us to identify the most relevant exploration activities for submission to the workshop participants, and to avoid the pitfalls that would have led us to unsolvable questions`}</p>\n    <p>{`Following the preparation work we drafted a scientific questioning document that described the research questions to be examined and was shared with all the participants during a week-long data sprint. At the beginning of the data sprint, the case study was divided into two complementary lines of inquiry and two teams were formed with a balanced composition to allow interdisciplinary collaboration:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The first team was appointed to study the dynamism of the Poitou region compared to France and the world in general (with the hypothesis of a decline compared to the rest of France during the eighteenth century).`}</li>\n      <li parentName=\"ul\">{`The second team was in charge of studying the relationships of complementarity and domination between ports in the region, with the aim, notably, of distinguishing the trade flows and commercial networks associated with them.`}</li>\n    </ul>\n    <p>{`Background material was then prepared to help the experts quickly grasp the multiple dimensions of the workshop, and preliminary surveys were conducted to solve the most obvious questions and make the most of the wide panel of expertise available during the short and very dense data sprint.`}</p>\n    <h3 {...{\n      \"id\": \"unusual-research-conditions\"\n    }}>{`Unusual research conditions`}</h3>\n    <p>{`The data sprint was scheduled for early April 2021, and this coincided with a strong upsurge in the COVID-19 epidemic in France in general and in Paris in particular, which forced us to hold the workshop online. An online data sprint meant that we were deprived of the invaluable contribution of informal discussions and other possibilities for displaying and circulating information and occupying different spaces when working in the same physical environment. The situation was compounded by the French governments sudden decision to close kindergartens and primary schools that week, adding a heavy extra-professional burden on a substantial number of participants.`}</p>\n    <p>{`The data sprint nevertheless took place, and we decided to consider the unusual circumstances not only as constraints requiring a drastic readjustment of our expectations, but also as opportunities for invention and experimentation in finding new ways of proceeding that departed from the methods initially planned.`}</p>\n    <h3 {...{\n      \"id\": \"improvisation-and-adaptation\"\n    }}>{`Improvisation and adaptation`}</h3>\n    <p>{`During the data sprint, the diversity of the participants competencies led us to reexamine the division of tasks. As a result, each person was given the opportunity to suggest research topics, manipulate the data, and examine the treatment and formatting of the results. The workshop also provided an opportunity to experiment with a large number of technologies used during the investigation, including `}<a href=\"https://jupyter.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`the Jupyter notebook`}</a>{`, `}<a href=\"https://kepler.gl/\" target=\"blank\" rel=\"noopener noreferrer\">{`kepler.gl`}</a>{`, `}<a href=\"https://vega.github.io/vega/\" target=\"blank\" rel=\"noopener noreferrer\">{`vega`}</a>{`, and `}<a href=\"https://matplotlib.org/\" target=\"blank\" rel=\"noopener noreferrer\">{`matplotlib`}</a>{`. However, we were occasionally hindered by Zoom conditions, and specialized discussions (from a technical or historical perspective, for example) sometimes required groups to form once again along disciplinary lines with moments of transversal collaboration.`}</p>\n    <p>{`The data sprint format also implied an experimental, sometimes chaotic dimension, amplified by online communication problems. Our working days were therefore organized around a lighter schedule and in a format that sought to vary the rhythms and scales of interaction: a plenary update in the morning was followed by work in two groups that quickly divided into pairs or even individual work. `}</p>\n    <p>{`From a technical point of view, we opted for a permanent Zoom room open throughout the week divided into breakout rooms for work in smaller groups. We also filled a well-organized google drive folder throughout the week, in which all the activities were archived and recorded.`}</p>\n    <p>{`Methodological procedures were also implemented to facilitate the process of mutual understanding. Some of the participants, for example, acted as facilitators and were in charge of maintaining communication between the different groups by constantly circulating between the different work Zoom rooms. We also stressed the importance of documentation by including daily writing of reports completed as the day progressed, and by appointing scribes who were in charge of these reports and responsible for keeping as many traces as possible to allow asynchronous exchanges of information. These reports were eventually phased out, as they were too burdensome given the weight of the other activities. We also gradually cut down video conferencing time to reduce the fatigue associated with online communication.`}</p>\n    <p>{`Data sprint work sessions can sometimes cause a bubble effect in which each team can quickly become disconnected from the work accomplished by the others, leading to dead ends, duplicated tasks, and blind spots. This problem is amplified when working online. To meet this challenge, we scheduled progress update meetings at regular times during the day to share information on different scales: in small groups, in teams, and all together. In addition, informal visits and Zoom surfing made it possible to circulate ideas and methods to a certain extent.`}</p>\n    <p>{`One of the advantages of the data sprint format is that it assigns a specific time for interdisciplinary work. However, because work during this short time is intense, the expectation is that results equal to the efforts invested will be produced. In normal times, the data sprint is a time for exploration and investigation but also a time for generating results. However, in our case this principle was challenged in two ways: by online working conditions, which made us lower our expectations, but also by the very principle and objectives of the PORTIC data sprint which aimed at publication of finalized websites contributing in a relatively precise way to very specific case studies (and not data mining reports as is often the case with other data sprints). Faced with these challenges, we had to prolong our work after the workshop and change the time frame to achieve a publishable result.`}</p>\n    <h2 {...{\n      \"id\": \"the-website-a-pivotal-tool-for-multimodal-writing-and-defining-a-technical-and-methodological-infrastructure\"\n    }}>{`The website, a pivotal tool for multimodal writing and defining a technical and methodological infrastructure`}</h2>\n    <p>{`Based on the work completed during the data sprint, we began a second deeper phase of the project. In terms of content, the research topics initially selected were gradually reformulated. This work started at the end of the data sprint week, following the completion of a summary document based on the visuals produced during the week. Ccile Asselin then carried on summarizing and tidyng up the productions of the week.`}</p>\n    <h3 {...{\n      \"id\": \"multimodal-writing\"\n    }}>{`Multimodal writing`}</h3>\n    <p>{`In order to progressively draft a publishable document from the data sprint explorations, creating a story and arguments based on the two databases, we combined the three types of writing needed to develop the future website: computational writing for the new data files that grew out of data sprint investigations, diagrammatic writing for the visuals, and finally, of course, prose for the narrative and historical argument based on the case study.`}</p>\n    <p>{`We decided to divide the website into three similarly-structured sections: a main visual presenting the sections main argument together with text based on the visual and expanding outwards, combined with secondary visuals. This visual and rhetorical organization induced an iterative work method similar to ping pong which was conducted in three stages: `}</p>\n    <ul>\n      <li parentName=\"ul\">{`Immediately after the data sprint, historians first worked on clarifying the arguments of each of the three sections (April-May 2021).`}</li>\n      <li parentName=\"ul\">{`We then organized two intensive days to design the main visual proposals (at the end of May 2021) with a small team of engineers and designers (Ccile Asselin, Robin de Mourat, Christine Plumejeaud, Paul Girard, and Maxime Zoffoli).`}</li>\n      <li parentName=\"ul\">{`Finally, the historians returned to the text which had been enriched and framed by the information proposed in the visuals. As they clarified the text, the need for additional visuals arose and these were gradually produced to fit the text (June to September 2021).`}</li>\n    </ul>\n    <p>{`This framework allowed us to progressively develop a work infrastructure adapted to the continuous development of the website. The website thus not only served as the goal but also as the point of contact between the different activities that arose after the data sprint workshop.`}</p>\n    <p>{`The website presented to the public was created using an automated protocol enabling daily updates as written content and further website developements emerged, which meant that progress was made jointly on its structure, graphics and the various contents (see its `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`github`}</a>{` directory for more information). The automated protocol consisted more specifically in retrieving content written by the historians and stored in a Google document, and data from the Navigocorpus and Toflit 18 databases in their respective digital spaces, and finally producing web-optimized data before updating the website.`}</p>\n    <p>{`This customized method, instead of using a CMS (such as Wordpress) or totally DIY content integration, allowed us to multiply iterations on the data, visuals, and text and develop a website by iteration with consistent and readable content. It also allowed us to avoid a website production approach that would have been too sequential with a first phase of design followed by a second phase of development, and instead left room for discovery and dialogue with the different materials as they were being developed. `}</p>\n    <p>{`Thus, the method of preparing and assembling the website, which nevertheless required some optimization with the automation of certain tasks, enabled a more organic dialogue to develop between the different types of writing in this document: by simultaneously producing the website, the visuals, and the textual content to go with them, we tried to make each of these activities benefit from the others and be the source of mutual invention or confirmation, rather than consider them as specialized or coordinated tasks in a process of subordination (from history to technique, or from visual to text, or from argument to illustration, etc.).`}</p>\n    <h3 {...{\n      \"id\": \"a-website-designed-to-connect-with-other-activities-and-audiences\"\n    }}>{`A website designed to connect with other activities and audiences`}</h3>\n    <p>{`This website is intended to be both a stand-alone product that presents a scientific narrative of the history of the La Rochelle region in the eighteenth century, and a building stone for a scientific and didactic construction yet to come. Its target audiences include history students, secondary history teachers, and advanced amateurs passionate about the Poitou and Charentes regions. However, the website can also be of interest to two further complementary audiences:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Professionals working in historical outreach (for either an expert or general audience) who can use some of the visuals for initiatives aimed at a wider audience.`}</li>\n      <li parentName=\"ul\">{`Specialized historians who can cite these visuals in conventional publications in journals or monographs and use them for future investigations.`}</li>\n    </ul>\n    <p>{`To this end, we have ensured that each visual can be separated from the narrative and can be accessed via the atlas page, and more technically we have provided each visual with its own URL.`}</p>\n    <p>{`Furthermore, the `}<a href=\"https://github.com/medialab/portic-storymaps-2021/\" target=\"blank\" rel=\"noopener noreferrer\">{`website source code`}</a>{`, shared under a free license, was developed and documented to allow it to be used in whole or in part for future projects. Useful elements can serve for the next case studies of the PORTIC program but also for other similar projects. Finally, it should be noted that all the data used and the scripts that generated them from the entire Toflit18 and Navigocorpus databases (both freely accessible) are also included in the website source code, which means that our visuals and results can be fully reproduced.`}</p>\n    <h2 {...{\n      \"id\": \"collective-writing\"\n    }}>{`Collective writing`}</h2>\n    <p>{`This website is the result of a process of collective investigation and writing that brought together people from several disciplines: history, economics, computer science, geomatics, and graphic design. `}</p>\n    <p>{`The website texts were written by `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{` (Professor of Modern History, Universit Cte dAzur - CMMC, Principal Investigator of the PORTIC program), `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loc Charles`}</a>{` (Professor of Economics, INED, Universit Paris 8 Vincennes - LED), `}<a href=\"https://leda.dauphine.fr/en/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{` (Professor of Economics, Universit Paris-Dauphine - LEDa-DIAL), and `}<a href=\"https://criham.labo.univ-poitiers.fr/membres/thierry-sauzeau/\" target=\"blank\" rel=\"noopener noreferrer\">{`Thierry Sauzeau`}</a>{` (Professor of Modern History, Universit de Poitiers - Criham).`}</p>\n    <p>{`The entire process of collaboration was led and managed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, an engineer intern who worked full-time for six months on the methodological and technical supervision of the entire case study, with the assistance of `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{` (research designer, Sciences Po medialab - scientific co-leader of the PORTIC program in charge of case studies).`}</p>\n    <p>{`The visuals were designed and developed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`, `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{` (geomatician, LIENSs laboratory - scientific co-leader of the PORTIC program), `}<a href=\"https://fr.linkedin.com/in/paul-girard-57822118\" target=\"blank\" rel=\"noopener noreferrer\">{`Paul Girard`}</a>{` (engineer specialized in digital humanities - `}<a href=\"https://www.ouestware.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Ouestware`}</a>{`), `}<a href=\"https://www.maximezoffoli.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Maxime Zoffoli`}</a>{` (graphic designer specialized in infographics), `}<a href=\"https://fr.linkedin.com/in/geraldine-geoffroy-4653ab19b\" target=\"blank\" rel=\"noopener noreferrer\">{`Graldine Geoffroy`}</a>{` (data librarian, Universit Cte dAzur).`}</p>\n    <p>{`The basemaps were designed by `}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`.`}</p>\n    <p>{`The data were prepared and checked by the Navigocorpus team (`}<a href=\"https://lienss.univ-larochelle.fr/Plumejeaud-Christine-954\" target=\"blank\" rel=\"noopener noreferrer\">{`Christine Plumejeaud`}</a>{`, `}<a href=\"https://cmmc-nice.fr/membres-du-cmmc/silvia-marzagalli/\" target=\"blank\" rel=\"noopener noreferrer\">{`Silvia Marzagalli`}</a>{`), the Toflit18 team (`}<a href=\"https://leda.dauphine.fr/fr/membre/detail-cv/profile/guillaume-daudin.html\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Daudin`}</a>{`, `}<a href=\"https://www.ined.fr/fr/recherche/chercheurs/Charles%2BLo%25C3%25AFc\" target=\"blank\" rel=\"noopener noreferrer\">{`Loc Charles`}</a>{`) and the medialab team (`}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{`, and `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`).`}</p>\n    <p>{`The website was developed by `}<a href=\"https://fr.linkedin.com/in/c%25C3%25A9cile-asselin-3659541b7\" target=\"blank\" rel=\"noopener noreferrer\">{`Ccile Asselin`}</a>{` and `}<a href=\"https://medialab.sciencespo.fr/equipe/robin-de-mourat/\" target=\"blank\" rel=\"noopener noreferrer\">{`Robin de Mourat`}</a>{`.`}</p>\n    <p>{`The website is also the work of those who took part in the data sprint: the engineers in digital methods and designers of the medialab laboratory of Sciences Po `}<a href=\"https://bmaz.github.io/\" target=\"blank\" rel=\"noopener noreferrer\">{`Batrice Mazoyer`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/benjamin-ooghe-tabanou/\" target=\"blank\" rel=\"noopener noreferrer\">{`Benjamin Ooghe-Tabanou`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/guillaume-plique/\" target=\"blank\" rel=\"noopener noreferrer\">{`Guillaume Plique`}</a>{`, `}<a href=\"https://medialab.sciencespo.fr/equipe/heloise-thero/\" target=\"blank\" rel=\"noopener noreferrer\">{`Hlose Thro`}</a>{`, and `}<a href=\"https://paulinegourlet.com/\" target=\"blank\" rel=\"noopener noreferrer\">{`Pauline Gourlet`}</a>{`; the researchers `}<a href=\"https://www.univ-brest.fr/crbc/menu/Membres%2Bdu%2Blaboratoire/Enseignants-chercheurs/Pierrick_Pourchasse\" target=\"blank\" rel=\"noopener noreferrer\">{`Pierrick Pourchasse`}</a>{` (Professor Emeritus of Modern History, Universit de Bretagne Occidentale, Brest), and `}<a href=\"https://l3i.univ-larochelle.fr/Bouju-Alain-MCF-HDR\" target=\"blank\" rel=\"noopener noreferrer\">{`Alain Bouju`}</a>{` (HDR Associate Professor in computer science, Universit de La Rochelle).`}</p>\n    <p>{`A special thank to Yvonne van der Does and to Alexia Grosjean for their professionalism and their efficacy in assisting us with the English translation.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"from-a-series-of-questions-to-a-week-of-investigation\",\n    level: 2,\n    title: \"From a series of questions to a week of investigation\",\n    children: [\n        {\n              id: \"unusual-research-conditions\",\n              level: 3,\n              title: \"Unusual research conditions\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"improvisation-and-adaptation\",\n              level: 3,\n              title: \"Improvisation and adaptation\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"the-website-a-pivotal-tool-for-multimodal-writing-and-defining-a-technical-and-methodological-infrastructure\",\n    level: 2,\n    title: \"The website, a pivotal tool for multimodal writing and defining a technical and methodological infrastructure\",\n    children: [\n        {\n              id: \"multimodal-writing\",\n              level: 3,\n              title: \"Multimodal writing\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"a-website-designed-to-connect-with-other-activities-and-audiences\",\n              level: 3,\n              title: \"A website designed to connect with other activities and audiences\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"collective-writing\",\n    level: 2,\n    title: \"Collective writing\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.115,\"time\":186900,\"words\":623}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"rfrences\"\n    }}>{`Rfrences`}</h1>\n    <h3 {...{\n      \"id\": \"sources-archivistiques\"\n    }}>{`Sources archivistiques`}</h3>\n    <p>{`Les donnes sur la navigation proviennent de la base de donnes Navigocorpus. Pour cette enqute, il sagit plus particulirement des:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`congs issus de la sous-srie G5 conservs aux Archives Nationales de France`}</li>\n      <li parentName=\"ul\">{`congs de Lorient, Archives dpartementales du Morbihan, 10B-19`}</li>\n      <li parentName=\"ul\">{`congs de Saint-Tropez, Archives dpartementales du Var, 7 B 10`}</li>\n      <li parentName=\"ul\">{`Registres du Bureau de Sant de Marseille, 200 E 543 et 545`}</li>\n    </ul>\n    <p>{`Les donnes relatives aux expditions ngrires ont t compltes avec la base de donnes `}<a href=\"https://www.slavevoyages.org/voyage/database\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://www.slavevoyages.org/voyage/database\"\n        }}>{`https://www.slavevoyages.org/voyage/database`}</a></a></p>\n    <p>{`Les donnes relatives au commerce extrieur proviennent de la base de donnes Toflit18 (voir `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/exploration/sources\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"http://toflit18.medialab.sciences-po.fr/#/exploration/sources\"\n        }}>{`http://toflit18.medialab.sciences-po.fr/#/exploration/sources`}</a></a>{`).`}</p>\n    <p>{`Pour cette enqute, il sagit plus particulirement des : `}</p>\n    <p>{`Archives Nationales dOutre-Mer (pour 1789) : Col. F2 B 14 (prsent aussi en AN Marine B 7 514)`}</p>\n    <p>{`Archives Nationales de France (pour 1789) : AN F12 1665 et 1666 AN Marine B 7 514 (prsent aussi en ANOM Col F2 B 14)`}</p>\n    <p>{`Archives dpartementales de la Charente-Maritime : 41 ETP 270 (pour lhistorique des exportations de La Rochelle) `}</p>\n    <p>{`Bibliothque municipale de Saint-Brieuc : Fonds Gournay, M8487 (pour 1750)`}</p>\n    <p>{`La majeure partie des cahiers de dolances tudis sont tirs des Archives dpartementales de Charente-Maritime (AD17). En effet, les Archives dpartementales de la Vende (AD85) ne conservent que de rares cahiers pour littoral du Poitou (Bouin, Noirmoutier, lIle dElle dans le marais poitevin). La collecte et/ou la transcription ont t ralises selon deux modalits. Nous avons tout dabord rcupr un ensemble de cahiers charentais transcrits sur le site `}<a href=\"http://www.histoirepassion.eu/?-1789-Cahiers-de-doleances-et-Etats-generaux-\" target=\"blank\" rel=\"noopener noreferrer\">{`Histoire Passion - Saintonge Aunis Angoumois`}</a>{`. Nous avons ensuite complt ce corpus grce  la collaboration des AD17 et des AD85. Ainsi, de nouveaux cahiers ont t rcuprs et transcrits par Thierry Sauzeau et Silvia Marzagalli, le tout permettant dvaluer lexhaustivit et la teneur de lchantillon utilis. Le corpus de 163 cahiers recle 14 cahiers de paroisses que compltent 5 cahiers de districts (groupes de paroisses) du littoral. Lensemble de ce travail de consolidation et de mise en donnes est disponible et rutilisable `}<a href=\"https://docs.google.com/spreadsheets/d/1A8-OiTSYv7opCcWvF8tsJ0dmEXkHZMgN-7lhj-4hqFw/edit?usp%3Dsharing\" target=\"blank\" rel=\"noopener noreferrer\">{` cette adresse`}</a>{`.`}</p>\n    <p>{`Les registres de dlibration de la Chambre de Commerce de La Rochelle sont conservs aux Archives dpartementales de la Charente-Maritime, 41 ETP 8 (accessibles en ligne: `}<a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir%5C_ead%5C_visu%5C_lien.html?ir=11431&id=490014227\"\n        }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir\\\\_ead\\\\_visu\\\\_lien.html?ir=11431`}{`&`}{`id=490014227`}</a></a>{`) `}</p>\n    <h3 {...{\n      \"id\": \"bibliographie\"\n    }}>{`Bibliographie`}</h3>\n    <p>{`Augeron, Mickal et Guillemet, Dominique (dir.), Champlain ou les portes du Nouveau Monde. Cinq sicles dchanges entre le Centre-Ouest franais et lAmrique du Nord, La Crche, Geste ditions, 2004.`}</p>\n    <p>{`Clark, John G., La Rochelle and the Atlantic Economy during the Eighteenth Century, Baltimore, Johns Hopkins University Press, 1981.`}</p>\n    <p>{`Delafosse, Marcel (dir.), Histoire de La Rochelle, Toulouse, Privat, 2002.`}</p>\n    <p>{`Deveau, Jean-Michel, La traite rochelaise, Paris, Karthala, 1990.`}</p>\n    <p>{`Hocquet, Jean-Claude, Navigation et transport du sel atlantique, dans Mnanteau, Loc (dir.), Sel et salines de lEurope atlantique, Rennes, PUR, 2018, p. 223234.`}</p>\n    <p>{`Martinetti, Brice, Les ngociants de La Rochelle au XVIIIe sicle, Rennes, PUR, 2013.`}</p>\n    <p>{`Mathieu, Jacques, La Nouvelle-France. Les Franais en Amrique du Nord, XVIe-XVIIIe sicles, Paris, Belin, 1991.`}</p>\n    <p>{`Robert, Henri, Les trafics coloniaux du port de la Rochelle au XVIIIe sicle, Poitiers, Mmoire de la Socit des Antiquaires de lOuest, 4e srie, tome IV, 1960.`}</p>\n    <p>{`Sauzeau, Thierry et Normand, Eric (dir.), De Tonnay  Charente : histoire dune porte maritime des pays charentais, La Crche, Geste ditions, 2013, 203 p.`}</p>\n    <p>{`Sauzeau, Thierry,  Rochefort/Tonnay-Charente (XVIIe-XIXe sicles) entre concurrence et complmentarit , dans Fernandez, Alexandre et Marnot, Bruno (dir.), Les ports du golfe de Gascogne. De Concarneau  La Corogne (xve-xxie sicles), Paris, PUPS, 2013, p.109122.`}</p>\n    <p>{`Sauzeau, Thierry, Les marins de la Seudre (XVIIIe-XIXe sicle), Pays dhistoire, La Crche, Geste Editions, 2005, 342 p.`}</p>\n    <p>{`Toussaint, Auguste, La route des Iles. Contribution  lhistoire maritime des Mascareignes, Paris, SEVPEN, 1967.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"sources-archivistiques\",\n    level: 3,\n    title: \"Sources archivistiques\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliographie\",\n    level: 3,\n    title: \"Bibliographie\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.045,\"time\":182700,\"words\":609}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"references\"\n    }}>{`References`}</h1>\n    <h3 {...{\n      \"id\": \"archival-sources\"\n    }}>{`Archival sources`}</h3>\n    <p>{`Navigation data was drawn from the Navigocorpus database and for this investigation more particularly from:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Clearances from the G5 sub-series kept at the Archives Nationales de France.`}</li>\n      <li parentName=\"ul\">{`Clearances of Lorient, Archives dpartementales du Morbihan (Lorient), 10B-19.`}</li>\n      <li parentName=\"ul\">{`Clearances of Saint-Tropez, Archives dpartementales du Var (Draguignan), 7 B 10.`}</li>\n      <li parentName=\"ul\">{`Records of the Marseille Health Office, Archives dpartementales des Bouches-du-Rhne (Marseille), 200 E 543 and 545.`}</li>\n    </ul>\n    <p>{`Additional data relating to slave shipments were provided by the database `}<a href=\"https://www.slavevoyages.org/voyage/database\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://www.slavevoyages.org/voyage/database\"\n        }}>{`https://www.slavevoyages.org/voyage/database`}</a></a></p>\n    <p>{`Data on foreign trade were provided by the Toflit18 database (see `}<a href=\"http://toflit18.medialab.sciences-po.fr/%23/exploration/sources\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"http://toflit18.medialab.sciences-po.fr/#/exploration/sources\"\n        }}>{`http://toflit18.medialab.sciences-po.fr/#/exploration/sources`}</a></a>{`), and for this investigation more particularly from: `}</p>\n    <p>{`Archives nationales dOutre-Mer (ANOM) (Aix-en-Provence), for 1789: Col. F2 B 14 (also available in AN Marine B 7 514).`}</p>\n    <p>{`Archives nationales de France, for 1789: AN F12 1665 and 1666 AN Marine B 7 514 (also available in ANOM Col F2 B 14).`}</p>\n    <p>{`Archives dpartementales de Charente-Maritime (La Rochelle): 41 FTE 270 (for the history of La Rochelle exports).`}</p>\n    <p>{`Bibliothque Municipale de Saint-Brieuc: Gournay Archives, M8487 (for 1750).`}</p>\n    <p>{`Most of the grievance registers studied were provided by the Archives dpartementales de la Charente-Maritime (AD17) as the Archives dpartementales de Vende (AD85) only hold a few registers for the coastal region of Poitou (Bouin, Noirmoutier, and the island of Elle in the Poitevin marsh). Collection and transcription when necessary were carried out in two ways. We first retrieved a set of Charentais registers transcribed on the website `}<a href=\"http://www.histoirepassion.eu/?-1789-Cahiers-de-doleances-et-Etats-generaux-\" target=\"blank\" rel=\"noopener noreferrer\">{`Histoire Passion - Saintonge Aunis Angoumois`}</a>{`. AD17 and AD85 provided additional data for this corpus: these registers were retrieved and transcribed by Thierry Sauzeau and Silvia Marzagalli, and they served to assess the comprehensiveness and content of the sample used. The corpus of 163 registers includes 14 parish registers and an additional 5 coastal district registers (groups of parishes). The entire process of data preparation and consolidation is available `}<a href=\"https://docs.google.com/spreadsheets/d/1A8-OiTSYv7opCcWvF8tsJ0dmEXkHZMgN-7lhj-4hqFw/edit?usp%3Dsharing\" target=\"blank\" rel=\"noopener noreferrer\">{`here`}</a>{`.`}</p>\n    <p>{`The records of the deliberations of the Chamber of Commerce of La Rochelle are archived at the Archives dpartementales de la Charente-Maritime, 41 FTE 8 (available online: `}<a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\"><a parentName=\"p\" {...{\n          \"href\": \"https://archinoe.fr/v2/ad17/visualiseur/ir%5C_ead%5C_visu%5C_lien.html?ir=11431&id=490014227\"\n        }}>{`https://archinoe.fr/v2/ad17/visualiseur/ir\\\\_ead\\\\_visu\\\\_lien.html?ir=11431`}{`&`}{`id=490014227`}</a></a><a href=\"https://archinoe.fr/v2/ad17/visualiseur/ir_ead_visu_lien.html?ir%3D11431%26id%3D490014227\" target=\"blank\" rel=\"noopener noreferrer\">{` `}</a>{` ) `}</p>\n    <h3 {...{\n      \"id\": \"bibliography\"\n    }}>{`Bibliography`}</h3>\n    <p>{`Augeron, Mickal et Guillemet, Dominique (ed.), Champlain ou les portes du Nouveau Monde. Cinq sicles dchanges entre le Centre-Ouest franais et lAmrique du Nord, La Crche, Geste ditions, 2004.`}</p>\n    <p>{`Clark, John G., La Rochelle and the Atlantic Economy during the Eighteenth Century, Baltimore, Johns Hopkins University Press, 1981.`}</p>\n    <p>{`Delafosse, Marcel (ed.), Histoire de La Rochelle, Toulouse, Privat, 2002.`}</p>\n    <p>{`Deveau, Jean-Michel, La traite rochelaise, Paris, Karthala, 1990.`}</p>\n    <p>{`Hocquet, Jean-Claude,  Navigation et transport du sel atlantique , in Mnanteau, Loc (ed.), Sel et salines de lEurope atlantique, Rennes, PUR, 2018, p. 223234.`}</p>\n    <p>{`Martinetti, Brice, Les ngociants de La Rochelle au XVIIIe sicle, Rennes, PUR, 2013.`}</p>\n    <p>{`Mathieu, Jacques, La Nouvelle-France. Les Franais en Amrique du Nord, XVIe-XVIIIe sicles, Paris, Belin, 1991.`}</p>\n    <p>{`Robert, Henri, Les trafics coloniaux du port de la Rochelle au XVIIIe sicle, Poitiers, Mmoire de la Socit des Antiquaires de lOuest, 4th serie, tome IV, 1960.`}</p>\n    <p>{`Sauzeau, Thierry and Normand, Eric (eds.), De Tonnay  Charente : histoire dune porte maritime des pays charentais, La Crche, Geste ditions, 2013, 203 p.`}</p>\n    <p>{`Sauzeau, Thierry,  Rochefort/Tonnay-Charente (XVIIe-XIXe sicles) entre concurrence et complmentarit , in Fernandez, Alexandre and Marnot, Bruno (eds.), Les ports du golfe de Gascogne. De Concarneau  La Corogne (xve-xxie sicles), Paris, PUPS, 2013, p.109122.`}</p>\n    <p>{`Sauzeau, Thierry, Les marins de la Seudre (XVIIIe-XIXe sicle),  Pays dhistoire , La Crche, Geste Editions, 2005, 342 p.`}</p>\n    <p>{`Toussaint, Auguste, La route des Iles. Contribution  lhistoire maritime des Mascareignes, Paris, SEVPEN,1967.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"archival-sources\",\n    level: 3,\n    title: \"Archival sources\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"bibliography\",\n    level: 3,\n    title: \"Bibliography\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.55,\"time\":33000,\"words\":110}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme de recherche PORTIC (ANR-18-CE380010) se propose de croiser les donnes sur la navigation et sur la valeur du commerce tranger de la France  la veille de la Rvolution franaise pour mieux saisir les dynamiques commerciales  luvre. Pour ce faire, il offre des interfaces dinterrogation et de visualisation des donnes adaptes  des publics et des intrts varis.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placs sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est plac sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.45,\"time\":27000,\"words\":90}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"the-portic-program\"\n      }}>{`The PORTIC Program`}</h2>\n      <p>{`The PORTIC research program (ANR-18-CE380010) aims at crossing french navigation and foreign trade data at the eve of the French Revolution, in order to understand ongoing commercial dynamics. To do so, it offers data visualization and querying interfaces adapted to various audiences and interests.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`Learn more about the PORTIC program`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`The contents of this website are published under `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`creative commons license CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`The source code of this website is published under `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0 license`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Access the source code of this website`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"the-portic-program\",\n    level: 2,\n    title: \"The PORTIC Program\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\n\n/**\n * Displays an svg image\n * @param {string} {path}\n * @returns {React.ReactElement} - React component\n */\nfunction SvgChart ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgChart;","import GeographicMapChart from './GeographicMapChart';\n\nexport default GeographicMapChart;","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import TriangleChart from './TriangleChart';\n\nexport default TriangleChart;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\n/**\n * Fetches data and provides it to children (used for tests)\n * @param {string} data\n * @param {function} children\n * @returns {React.ReactElement} - React component\n */\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: str }) => {\n          const extension = dataFilename.split('.').pop();\n          let newData;\n          if (extension === 'csv') {\n            newData = csvParse(str);\n          } else if (extension === 'geojson' || extension === 'json') {\n            newData = str;\n          }\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.975,\"time\":478500,\"words\":1595}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgChart from '../../components/SvgChart';\nimport VegaChart from '../../components/VegaChart';\nimport NetworkGraphChart from '../../components/NetworkGraphChart';\nimport GeographicMapChart from '../../components/GeographicMapChart';\nimport TriangleChart from '../../components/TriangleChart';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\nimport { Step3Objects } from '../../visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <p>{`Test en prod`}</p>\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + donnes avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h3 {...{\n      \"id\": \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\"\n    }}>{`Fond de carte - test custom layer avec config coast from Nantes to Bordeaux`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step3_viz_customs_offices_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname'\n          }\n        }, {\n          type: 'custom',\n          data: visData,\n          renderObjects: Step3Objects\n        }]} projectionTemplate='coast from Nantes to Bordeaux' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider> \n    <h3 {...{\n      \"id\": \"fond-de-carte---test-flows-avec-config-world\"\n    }}>{`Fond de carte - test flows avec config World`}</h3>\n    <DataProvider data={'world_1789_23mars2021_level0.json'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'aggregated_flows.json'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'flows',\n          data: visData,\n          size: {\n            field: 'tonnages_cumuls'\n          }\n        }]} projectionTemplate='World' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-france\"\n    }}>{`Fond de carte - config France`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'ports_locations_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'admiralty',\n            palette: colorPalettes.admiralties\n          },\n          size: {\n            field: 'customs_region'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='France' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-rotated-poitou\"\n    }}>{`Fond de carte - config rotated Poitou`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step1_viz_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeographicMapChart layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'customs_office',\n            palette: colorPalettes.customs_office\n          },\n          size: {\n            field: 'mean_tonnage'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='rotated Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-poitou\"\n    }}>{`Fond de carte - config Poitou`}</h3>\n    <p>{`Cartographie des destination des bateaux aillant un port dattache dans la rgion, par tonnage cumul (couleur = amiraut) :`}</p>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels projectionTemplate='Poitou' height={800} width={1200} mdxType=\"GeographicMapChart\" />\n    <h2 {...{\n      \"id\": \"fond-de-carte-sans-template-pour-la-config\"\n    }}>{`Fond de carte sans template pour la config`}</h2>\n    <GeographicMapChart backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeographicMapChart\" />\n    {\n      /* # Tests composant LineChart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data.filter(d => d.region === 'France')}\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 5,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n             annotations={[\n                   {\n                     type: 'span',\n                     start: 1756,\n                     end: 1763,\n                     axis: 'x',\n                     label: 'guerre de sept ans'\n                   },\n                   {\n                     type: 'span',\n                     start: 400000000,\n                     end: 500000000,\n                     axis: 'y',\n                     label: 'priode de faste'\n                   }\n                 ]}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de titre\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de line chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`,\n               fillGaps: true\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de linechart (minimum de props)\"\n             // width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               // title: 'anne',\n             }}\n             y={{\n               field: 'Imports',\n               // title: 'imports',\n               // tickSpan: 100000000,\n               // tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               // title: 'Rgion'\n             }}\n             // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      # Tests composant BarChart\n      ## Horizontal bar chart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (sans fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             annotations={[\n               {\n                 type: 'span',\n                 start: 1756,\n                 end: 1763,\n                 axis: 'x',\n                 label: 'guerre de sept ans'\n               },\n               {\n                 type: 'span',\n                 start: 400000000,\n                 end: 500000000,\n                 axis: 'y',\n                 label: 'priode de faste'\n               }\n             ]}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (grouped, fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped, no fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      ## Vertical bar charts\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               // tickSpan: 1000000,\n               //tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             height={200}\n             y={{\n               field: 'year',\n               title: 'anne',\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               rowHeight: 30,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               rowHeight: 50\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      ## Test triangle \n      <TriangleChart \n       dataFilename=\"part_3_step1_viz_data.csv\" \n       rowHeight={300}\n       totalWidth = {1600}\n       />\n      ## Test courbes de bzier\n      <BezierComponent\n       dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n       cx={300}\n       cy={250}\n       r={210}\n       inPercentage={10}\n       // start={Math.PI / 2}\n       // end={Math.PI * 3 / 2}\n       />\n      # Test bateaux\n      <BoatsIllustration />\n      \n      # Commerce multi-chelle dans la rgion de La Rochelle\n      \n      Voici un tour d'horizon des modules react prpars pour faciliter le dveloppement :\n      ## Image SVG (avec webpack)\n      On intgre une image  SVG depuis le local (elle sera donc packe par webpack) :\n      \n      ## Image SVG (sans webpack)\n      On intgre ici directement une image  partir de son URL en ligne (depuis le dossier `public`)\n      ##### ! cass pour le moment\n      // <SvgChart path =\"/svg/ports-region-1789.svg\" />\n      ## Visualisation vega\n      Les visualisations vega ont besoin d'un fichier csv stock dans le dossier `public/data` et d'une spec vega.\n      <VegaChart \n       data=\"sorties_navires_vers_colonies.csv\" \n       spec={{\n         \"mark\": \"rect\",\n         \"encoding\": {\n           \"x\": {\n             \"field\": \"port_depart\",\n             \"type\": \"nominal\"\n           },\n           \"y\": {\n             \"field\": \"port_destination\",\n             \"type\": \"nominal\"\n           },\n           \"color\": {\n             \"type\": \"quantitative\",\n             \"field\": \"tonnage\",\n             \"aggregate\": \"sum\"\n           }\n           \n         }\n       }}\n      />\n      ## Rseau avec sigma\n      Les visualisations sigma ont besoin d'un fichier gexf stock dans le dossier `public/data`.\n      Paramtres :\n      * `nodeColor` : attribut pour couleur\n      * `nodeSize` : attribut pour taille\n      * `labelDensity` : densit des labels (float dans [0, 1])\n      \n      <NetworkGraphChart \n       data=\"toflit_aggregate_1789_only_out.gexf\" \n       nodeColor={`admiralty`}\n       nodeSize={`inside_degree`}\n       labelDensity={0.5}\n      />\n      */\n    }\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        {\n              id: \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\",\n              level: 3,\n              title: \"Fond de carte - test custom layer avec config coast from Nantes to Bordeaux\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---test-flows-avec-config-world\",\n              level: 3,\n              title: \"Fond de carte - test flows avec config World\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-france\",\n              level: 3,\n              title: \"Fond de carte - config France\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-rotated-poitou\",\n              level: 3,\n              title: \"Fond de carte - config rotated Poitou\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-poitou\",\n              level: 3,\n              title: \"Fond de carte - config Poitou\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"fond-de-carte-sans-template-pour-la-config\",\n    level: 2,\n    title: \"Fond de carte sans template pour la config\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\n\nimport './LineChart.scss';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {React.ReactElement} - React component \n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Lgende' : 'Legend';\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","import LineChart from './LineChart';\n\nexport default LineChart;","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\n/**\n * Returns a boat hull shape\n * @param {number} width\n * @param {number} height\n * @returns  {React.ReactElement} - React component\n */\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\n/**\n * Returns a boat sail shape\n * @param {number} width\n * @param {number} height\n * @param {number} sailSpeed - period in miliseconds\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\n/**\n * Returns a boat matt shape\n * @param {number} width\n * @param {number} height\n * @param {number} sailSpeed - period in miliseconds\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\n/**\n * Returns a boat shape\n * @param {number} x\n * @param {number} height\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\n/**\n * Returns a bird shape\n * @param {number} boatHeight\n * @param {number} containerHeight\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\n/**\n * Returns a moving boat + optional birds\n * @param {number} containerHeight\n * @param {number} containerWidth\n * @param {boolean} rightToLeft\n * @param {number} startAt - starting point in pixels\n * @param {number} size - factor for defining height relative to container height\n * @param {number} distance - factor in [0,1]\n * @returns  {React.ReactElement} - React component\n */\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\n/**\n * Returns moving boats\n * @param {number} width\n * @param {number} height\n * @returns  {React.ReactElement} - React component\n */\nconst BoatsIllustration = ({\n  width: inputWidth = 1200,\n  height: inputHeight = 100,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","/**\n * Context providers for the app\n */\nimport React from 'react';\n\n/**\n * Context used for communicating currently displayed visualization\n */\nexport const VisualizationControlContext = React.createContext({\n\n})\n\n/**\n * Context used for datasets values passing\n */\nexport const DatasetsContext = React.createContext({\n\n})\n\nexport const SettingsContext = React.createContext({\n\n})","import { geoPath } from \"d3-geo\";\nimport { generatePalette } from '../../helpers/misc';\nimport { uniq } from 'lodash';\nimport cx from 'classnames';\nimport { useSpring, animated } from 'react-spring'\nimport { useEffect, useState } from \"react\";\nimport ReactTooltip from \"react-tooltip\";\n\n/**\n * Description\n * @param {string} d\n * @param {function} projection\n * @param {function} project\n * @param {object} palette\n * @param {object} layer\n * @param {number} width\n * @param {number} height\n * @returns {React.ReactElement} - React component\n */\nconst GeoPart = ({ \n  d: initialD, \n  projection, \n  project, \n  palette, \n  layer, \n  width, \n  height,\n  animated: isAnimated\n}) => {\n\n  // @todo do this cleanly (removing out of bound objects to improve performance)\n  const boundsAbs = geoPath().bounds(initialD);\n  const [[x1, y1], [x2, y2]] = [projection(boundsAbs[0]), projection(boundsAbs[1])];\n  const [xMin, xMax] = [x1, x2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const [yMin, yMax] = [y1, y2].sort((a, b) => {\n    if (a > b) return 1;\n    return -1;\n  });\n  const outOfBounds = (isNaN(xMin) || isNaN(xMax) || isNaN(yMin) || isNaN(yMax)) ? false : xMin > width || yMin > height || xMax < 0 || yMax < 0;\n\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const currentD = project(initialD);\n\n  const animationProps = useSpring({\n    to: {\n      d: currentD\n    },\n    immediate: !isInited\n  });\n\n  \n  useEffect(() => {\n    ReactTooltip.rebuild();\n  });\n  if (outOfBounds) {\n    return null;\n  }\n  if (!isAnimated) {\n    return (\n      <path\n        title={initialD.properties.shortname}\n        d={currentD}\n        className=\"geopart\"\n        data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n        data-for=\"geo-tooltip\"\n        style={{\n          fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n        }}\n      />\n    )\n  }\n  return (\n    <animated.path\n      title={initialD.properties.shortname}\n      d={animationProps.d}\n      className=\"geopart\"\n      data-tip={layer.tooltip ? layer.tooltip(initialD) : undefined}\n      data-for=\"geo-tooltip\"\n      style={{\n        fill: layer.color !== undefined && palette !== undefined ? palette[initialD.properties[layer.color.field]] : 'transparent'\n      }}\n    />\n  )\n  \n}\n\n\n// @TODO : mettre en place une palette de couleurs quantitative \n\nconst ChoroplethLayer = ({ \n  layer, \n  projection, \n  width, \n  height, \n  reverseColors,\n}) => {\n\n  let palette;\n  const project = geoPath().projection(projection);\n\n  if (!layer.data) {\n    console.info(layer);\n    return null;\n  }\n\n  if (layer.data.features && layer.color && layer.color.field) {\n    // colors palette building\n    const colorValues = uniq(layer.data.features.map(datum => datum.properties[layer.color.field]));\n    if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n      palette = layer.color.palette;\n    } else if (layer.color.generatedPalette) {\n      const colors = generatePalette('map', layer.data.features.length);\n      palette = colorValues.reduce((res, key, index) => ({\n        ...res,\n        [key]: colors[index]\n      }), {});\n    }\n  }\n\n  return (\n    <>\n      <g className={cx(\"ChoroplethLayer\", { 'reverse-colors': reverseColors })}>\n        {\n          layer.data.features\n          .filter(d => d.geometry)\n          .map((d, i) => {\n            return (\n              <GeoPart \n                key={d.properties.id ||d.properties.name ||i} \n                {...{\n                  projection, \n                  project, \n                  palette, \n                  layer, \n                  d, \n                  width, \n                  height, \n                  animated: layer.animated\n                }}\n              />\n            )\n          })\n        }\n      </g>  \n    </>\n  );\n\n}\n\nexport default ChoroplethLayer;","\nimport { useMemo } from 'react';\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\nimport { useSpring, animated, Transition } from 'react-spring'\nimport { useEffect, useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\n\n\n/**\n * Returns a point and its label\n * @param {function} projection\n * @param {object} datum\n * @param {object} layer\n * @param {number} opacity\n * @param {function} onGroupMouseEnter\n * @param {function} onGroupMouseLeave\n * @param {boolean} displayLabel\n * @returns {React.ReactElement} - React component \n */\nconst PointGroup = ({\n  projection,\n  datum,\n  layer,\n  opacity,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  displayLabel\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, color, label, rawSize, labelPosition = 'right', labelSize, index } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { transform } = useSpring({\n    to: {\n      transform: `translate(${x},${y})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <>\n      <animated.g\n        className=\"point-group\"\n        transform={transform}\n        style={{\n          zIndex: labelSize,\n          opacity: opacity\n        }}\n        onMouseEnter={() => onGroupMouseEnter(index)}\n        onMouseMove={() => onGroupMouseEnter(index)}\n        onMouseLeave={() => onGroupMouseLeave()}\n        data-for=\"geo-tooltip\"\n        data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n      >\n        <circle\n          cx={0}\n          cy={0}\n          r={size}\n          style={{ fill: color }}\n          className=\"marker\"\n        />\n        {\n          layer.size && layer.size.displayMetric && labelSize > 9 ?\n            <text\n              x={0}\n              y={labelSize * .8 * .33}\n              textAnchor=\"middle\"\n              fontSize={labelSize * .8}\n              fill=\"white\"\n            >\n              {rawSize}\n            </text>\n            : null\n        }\n\n        {\n          label && displayLabel ?\n            <text\n              x={labelPosition === 'right' ? size + 5 : -size - 5}\n              y={size / 2}\n              fill={layer.color && layer.color.labelsColor}\n              textAnchor={labelPosition === 'right' ? 'start' : 'end'}\n              fontSize={labelSize}\n            >\n              {label}\n            </text>\n            : null\n        }\n      </animated.g>\n    </>\n\n  );\n}\n\n/**\n * Returns label group in a stacked layout\n * @param {object} layer\n * @param {object} datum\n * @param {number} thatIndex\n * @param {number} opacity\n * @param {number} stackedRowHeight\n * @param {function} onGroupMouseEnter\n * @param {function} onGroupMouseLeave\n * @param {number} labelFontSize\n * @param {function} projection\n * @returns {React.ReactElement} - React component \n */\nconst StackedLabelGroup = ({\n  layer,\n  datum,\n  thatIndex,\n  opacity,\n  stackedRowHeight,\n  onGroupMouseEnter,\n  onGroupMouseLeave,\n  labelFontSize,\n  projection\n}) => {\n  const { tooltip } = layer;\n  const { latitude, longitude, size: area, label, /*labelPosition = 'right', labelSize, index*/ } = datum;\n  const size = Math.sqrt(area / Math.PI)\n  const [x, y] = projection([+longitude, +latitude]);\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n  const { x2, y2, transformLabel } = useSpring({\n    to: {\n      x2: x - size,\n      y2: y,\n      transformLabel: `translate(${window.innerWidth * 0.01}, ${datum.labelY})`\n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g\n      style={{\n        // zIndex: labelSize,\n        opacity: opacity\n      }}\n      onMouseEnter={() => onGroupMouseEnter(thatIndex)}\n      onMouseMove={() => onGroupMouseEnter(thatIndex)}\n      onMouseLeave={() => onGroupMouseLeave()}\n      data-for=\"geo-tooltip\"\n      data-tip={typeof tooltip === 'function' ? tooltip(datum) : undefined}\n    >\n      <animated.g className=\"label-container\" transform={transformLabel}>\n        <text style={{ fontSize: labelFontSize }}>\n          {\n            label\n          }\n        </text>\n      </animated.g>\n      <animated.line\n        x1={labelFontSize * label.length * .5 + window.innerWidth * 0.01}\n        y1={datum.labelY - stackedRowHeight * .2}\n        x2={x2}\n        y2={y2}\n      />\n    </animated.g>\n  )\n}\n\nconst PointsLayer = ({ layer, projection, width, height }) => {\n\n  const [hoveredIndex, setHoveredIndex] = useState(null);\n\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // regroup data by coordinates\n      const coordsMap = {};\n      layer.data.forEach(datum => {\n        // id\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: layer.label ? datum[layer.label.field] : undefined,\n            labelPosition: layer.label ? layer.label.position : undefined,\n            latitude: +datum.latitude,\n            longitude: +datum.longitude,\n            color: layer.color !== undefined ? datum[layer.color.field] : 'default',\n            size: (layer.size !== undefined && layer.size.field !== undefined) ? isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field] : 0\n          }\n        } else if (layer.size !== undefined) {\n          coordsMap[mark].size += (isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field])\n        }\n      })\n\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g.color));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n      }\n\n      // size building\n\n      // compute size (would have been more elegand with a ternary but I did not manage to write it properly)\n      let sizeCoef = width / 300; // default size\n      if (layer.size !== undefined && layer.size.custom !== undefined) {\n        sizeCoef = parseInt(layer.size.custom * width / 100);\n      }\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      // basing the scale on area rather than radius\n      const radiusRange = [3, width * height / 20000];\n      const areaRange = radiusRange.map(r => Math.PI * r * r);\n      const sizeScale = scaleLinear().domain(sizeExtent).range(areaRange) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      const labelSizeScale = scaleLinear().domain(sizeExtent).range([8, width / 30]) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: layer.color !== undefined ? palette[datum.color] : 'grey',\n        size: layer.size !== undefined ? layer.size.custom !== undefined ? sizeCoef : sizeScale(datum.size) : width / 100,\n        rawSize: datum.size,\n        labelSize: layer.size !== undefined ? labelSizeScale(datum.size) : width * height / 30000\n      }))\n      return grouped;\n    }\n  }, [projection, width, layer])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  let visibleMarkers = markerData\n    .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n    .sort((a, b) => {\n      if (a.latitude > b.latitude) {\n        return 1;\n      }\n      return -1;\n    })\n\n  const onGroupMouseEnter = index => {\n    if (hoveredIndex !== index)\n      setHoveredIndex(index);\n  }\n  const onGroupMouseLeave = () => {\n    setTimeout(() => {\n      if (hoveredIndex !== null)\n        setHoveredIndex(null);\n    })\n  }\n  const stackedLabelsTop = height * .1;\n  const stackedLabelsHeight = height * .9;\n  const stackedRowHeight = stackedLabelsHeight / visibleMarkers.length;\n  const maxLabelFontSize = window.innerHeight * 0.02;\n  const labelFontSize = stackedRowHeight < maxLabelFontSize ? stackedRowHeight : maxLabelFontSize;\n  if (layer.stackLabels) {\n    visibleMarkers = visibleMarkers\n      .sort((a, b) => {\n        if (a.latitude > b.latitude) {\n          return -1;\n        }\n        return 1;\n      })\n      .map((d, i) => ({\n        ...d,\n        labelY: stackedRowHeight * i + stackedLabelsTop\n      }))\n  }\n  visibleMarkers = visibleMarkers.map((d, index) => ({ ...d, index }));\n  return (\n    <g className=\"PointsLayer\">\n      {\n        layer.stackLabels ?\n          <g className=\"stacked-labels-container\">\n            <Transition\n              // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n              items={visibleMarkers}\n              from={{ opacity: 0 }}\n              enter={{ opacity: 1 }}\n              leave={{ opacity: 0 }}\n            >\n              {({ opacity }, datum, thatIndex) => (\n                <StackedLabelGroup\n                  key={datum.label}\n                  {...{\n                    projection,\n                    datum,\n                    layer,\n                    opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n                    thatIndex: datum.index,\n                    onGroupMouseEnter,\n                    onGroupMouseLeave,\n                    stackedRowHeight,\n                    labelFontSize,\n                  }}\n                />\n              )\n\n              }\n            </Transition>\n          </g>\n          : null\n      }\n      <Transition\n        // items={visibleMarkers.map((d, i) => ({...d, labelPosition: i%2 === 0 ? 'left' : 'right', index: i}))}\n        items={visibleMarkers}\n        from={{ opacity: 0 }}\n        enter={{ opacity: 1 }}\n        leave={{ opacity: 0 }}\n      >\n        {({ opacity }, datum, index) => (\n          <PointGroup\n            key={datum.label}\n            {...{\n              projection,\n              datum,\n              layer,\n              opacity: hoveredIndex !== null ? hoveredIndex === datum.index ? 1 : .1 : opacity,\n              index: datum.index,\n              onGroupMouseEnter,\n              onGroupMouseLeave,\n              displayLabel: !layer.stackLabels\n            }}\n          />\n        )\n\n        }\n      </Transition>\n      {/* {\n        visibleMarkers\n          .map((datum, index) => {\n            return (\n              <PointGroup\n                key={datum.label}\n                {...{ projection, datum, layer }}\n              />\n            )\n          })\n      } */}\n    </g>\n  );\n}\n\nexport default PointsLayer;","\nimport { useMemo, useState, useEffect } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport cx from 'classnames';\nimport { max } from 'd3-array';\nimport { uniq } from 'lodash';\nimport { cartesian2Polar, fixSvgDimension, generatePalette, polarToCartesian } from '../../helpers/misc';\n\nimport { useSpring, animated } from 'react-spring'\n\n/*\nPrincipe : path entre deux point gographiques, dont le stroke peut varier, et on peut avoir la direction avec une fleche \n\nformat des donnes attendu (json) : \n\nExemple :\n\"flow_id\": \"45.95_-0.9_46.166667_-1.15\", \n\"port_dep\": \"Charente\", \n\"port_dest\": \"La Rochelle\", \n\"latitude_dep\": 45.95, \n\"longitude_dep\": -0.9, \n\"latitude_dest\": 46.166667, \n\"longitude_dest\": -1.15, \n\"nb_flows\": 22, \n\"tonnages_cumuls\": 730}\n\n*/\n\n/**\n * Displays a particular flow\n * @param {string} id\n * @param {boolean} hovered\n * @param {number} xDep\n * @param {number} yDep\n * @param {number} xDest\n * @param {number} yDest\n * @param {number} strokeWidth\n * @param {string} color\n * @param {string} path\n * @param {number} actualXDep\n * @param {number} actualYDep\n * @param {number} actualXDest\n * @param {number} actualYDest\n * @param {number} arrowLength\n * @param {function} onMouseEnter\n * @param {function} onMouseLeave\n * @returns {React.ReactElement} - React component \n */\nconst FlowGroup = ({\n  id,\n  hovered,\n  xDep: inputXDep,\n  yDep: inputYDep,\n  xDest: inputXDest,\n  yDest: inputYDest,\n  strokeWidth: inputStrokeWidth,\n  color = 'black',\n\n  path,\n  actualXDep,\n  actualYDep,\n  actualXDest,\n  actualYDest,\n  arrowLength,\n  onMouseEnter,\n  onMouseLeave,\n  // datum,\n  // layer,\n  // depLabelTextAnchor,\n  // depLabelX,\n  // depLabelY,\n  // destLabelTextAnchor,\n  // destLabelX,\n  // destLabelY,\n  // fontSize,\n}) => {\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, []);\n\n  const { d, strokeWidth } = useSpring({\n    to: {\n      xDep: inputXDep,\n      yDep: inputYDep,\n      xDest: inputXDest,\n      yDest: inputYDest,\n      d: path,\n      strokeWidth: fixSvgDimension(inputStrokeWidth),\n      arrowPath: `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`\n    },\n    immediate: !isInited\n  });\n\n  return (\n    <g onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} className={cx(\"flow-group\", { hovered })}>\n      <defs>\n        <marker\n          id={`triangle-${id}`}\n          viewBox={`0 0 ${arrowLength} ${arrowLength}`}\n          refY={arrowLength / 2}\n          orient=\"auto\">\n          <path d={`M 0 0 L ${arrowLength} ${arrowLength / 2} L 0 ${arrowLength} Z`} fill={color} />\n        </marker>\n      </defs>\n      {/* hover placeholder */}\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth * 3}\n        fill=\"none\"\n        stroke={color}\n        opacity={0}\n      />\n      <animated.path\n        d={d}\n        strokeWidth={strokeWidth}\n        markerEnd={`url(#triangle-${id})`}\n        fill=\"none\"\n        stroke={color}\n      />\n    </g>\n  )\n}\n\n/**\n * Displays a series of flow and their labels\n * @param {array} layer\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst FlowsLayer = ({\n  layer,\n  projection,\n  width,\n  height,\n  projectionTemplate,\n}) => {\n\n  /**\n    * Data aggregation for viz\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // size building\n      const strokeWidthScale = scaleLinear().domain([\n        0,\n        max(\n          layer.data.map((flow) => {\n            return +flow[layer.size.field];\n          })\n        )\n      ]).range([1, width * height / 20000]);\n\n      const arrowSizeScale = strokeWidthScale.copy().range([0, width * height / 100000]);\n\n      let grouped = layer.data.map(flow => ({ // je ne sais pas si grouped reste le plus adapt\n        ...flow,\n        // color: palette[datum.color],\n        strokeWidth: strokeWidthScale(+flow[layer.size.field]),\n        arrowSize: arrowSizeScale(layer.data.strokeWidth)\n      }))\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g[layer.color.field]));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n        grouped = grouped.map(datum => ({\n          ...datum,\n          color: layer.color !== undefined ? palette[datum[layer.color.field]] : 'grey',\n        }))\n      }\n      // console.log(\"grouped : \", grouped)\n      return grouped\n        .filter(({ latitude_dep, longitude_dep, latitude_dest, longitude_dest }) => latitude_dep && longitude_dep && latitude_dest && longitude_dest && !isNaN(latitude_dep) && !isNaN(longitude_dep) && !isNaN(latitude_dest) && !isNaN(longitude_dest))\n        .map((datum, index) => {\n          const { latitude_dep, longitude_dep, latitude_dest, longitude_dest, strokeWidth, arrowSize, color } = datum;\n          const [xDep, yDep] = projection([+longitude_dep, +latitude_dep]);\n          const [xDest, yDest] = projection([+longitude_dest, +latitude_dest]);\n          // console.log(\"[xDep, yDep] / [xDest, yDest] : \", [xDep, yDep], \" / \", [xDest, yDest]);\n          if (layer.hideOverflowingFlows) {\n            if (xDep < 0 || xDep > width || xDest < 0 || xDest > width\n              || yDep < 0 || yDep > height || yDest < 0 || yDest > height\n            ) {\n              return null;\n            }\n          }\n          const id = `${xDep}-${yDep}-${xDest}-${yDest}`;\n\n          const arrowLength = fixSvgDimension(strokeWidth) * 3;\n\n          const { distance, radians } = cartesian2Polar(xDest - xDep, yDest - yDep);\n          const [relativeXDest, relativeYDest] = polarToCartesian(distance - arrowLength, radians);\n          let actualXDest = xDep + relativeXDest;\n          let actualYDest = yDep + relativeYDest;\n          let actualXDep = xDep;\n          let actualYDep = yDep;\n          let path = `M ${actualXDep} ${actualYDep} L ${actualXDest} ${actualYDest}`;\n\n          let depLabelPosition = actualXDest < actualXDep ? 'right' : 'left';\n          let destLabelPosition = actualXDest > actualXDep ? 'right' : 'left';\n          if (actualXDest < width * .26) {\n            destLabelPosition = 'right';\n          }\n          if (actualXDest > width * .75) {\n            destLabelPosition = 'left';\n          }\n\n          const fontSize = width * 0.02;\n\n          const depLabelTextAnchor = depLabelPosition === 'right' ? 'start' : 'end';\n          const depLabelX = depLabelPosition === 'right' ? 10 : -10\n          const depLabelY = fontSize * .3\n\n          const destLabelTextAnchor = destLabelPosition === 'right' ? 'start' : 'end'\n          const destLabelX = destLabelPosition === 'right' ? 10 : -10\n          const destLabelY = fontSize * .3;\n\n          return {\n            id,\n            arrowSize,\n            xDep,\n            yDep,\n            xDest,\n            yDest,\n            strokeWidth,\n            datum,\n            layer,\n            width,\n            color,\n            height,\n            projectionTemplate,\n\n            fontSize,\n            path,\n            actualXDep,\n            actualYDep,\n            actualXDest,\n            actualYDest,\n            arrowLength,\n\n            depLabelTextAnchor,\n            depLabelX,\n            depLabelY,\n\n            destLabelTextAnchor,\n            destLabelX,\n            destLabelY,\n          }\n        })\n        .filter(d => d)\n    }\n    return []\n  }, [projection, width, layer, height])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const labels = useMemo(() => {\n    let newLabels = markerData.reduce((res, flow) => {\n      const {\n        id,\n        xDep,\n        yDep,\n        xDest,\n        yDest,\n        strokeWidth,\n  \n        depLabelX,\n        depLabelY,\n        depLabelTextAnchor,\n  \n        destLabelX,\n        destLabelY,\n        destLabelTextAnchor,\n        fontSize,\n        datum\n      } = flow;\n      const depId = datum[layer.label.fields[0]] // `${actualXDep}-${actualYDep}`;\n      if (res[depId]) {\n        // update position if we find a larger flow for this label\n        if (res[depId].largerStrokeWidth > strokeWidth) {\n          res[depId] = {\n            ...res[depId],\n            largerStrokeWidth: strokeWidth,\n            x: xDep + depLabelX,\n            y: yDep + depLabelY,\n            textAnchor: depLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[depId].flows = [...res[depId].flows, id]\n        // create a new entry for label\n      } else {\n        res[depId] = {\n          label: datum[layer.label.fields[0]],\n          largerStrokeWidth: strokeWidth,\n          x: xDep + depLabelX,\n          y: yDep + depLabelY,\n          textAnchor: depLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n  \n      const destId = datum[layer.label.fields[1]] // `${actualXDest}-${actualYDest}`;\n      if (res[destId]) {\n        // update position if we find a larger flow for this label\n        if (res[destId].largerStrokeWidth > strokeWidth) {\n          res[destId] = {\n            ...res[destId],\n            largerStrokeWidth: strokeWidth,\n            x: xDest + destLabelX,\n            y: yDest + destLabelY,\n            textAnchor: destLabelTextAnchor,\n            fontSize\n          }\n        }\n        res[destId].flows = [...res[destId].flows, id]\n        // create a new entry for label\n      } else {\n        res[destId] = {\n          label: datum[layer.label.fields[1]],\n          largerStrokeWidth: strokeWidth,\n          x: xDest + destLabelX,\n          y: yDest + destLabelY,\n          textAnchor: destLabelTextAnchor,\n          fontSize,\n          flows: [id]\n        }\n      }\n      return res;\n    }, {})\n    newLabels = Object.entries(newLabels).map(([id, label]) => ({\n      id,\n      ...label,\n      width: label.label.length * label.fontSize * 0.5,\n      actualX: label.textAnchor === 'start' ? label.x : label.x - (label.label.length * label.fontSize * 0.5),\n      height: label.fontSize,\n    }))\n    newLabels = newLabels.sort((a, b) => {\n      if (a.y > b.y) {\n        return 1;\n      }\n      return -1;\n    })\n    // resolve labels collisions\n    for (let i = 0 ; i < newLabels.length ; i++) {\n      for (let j = i + 1 ; j < newLabels.length ; j++) {\n        const label1 = newLabels[i];\n        const label2 = newLabels[j];\n\n        const minAx = label1.x;\n        const minAy = label1.y - label1.height;\n        const maxAx = label1.x + label1.width;\n        const maxAy = label1.y;\n\n        const minBx = label2.x;\n        const minBy = label2.y - label2.height;\n        const maxBx = label2.x + label2.width;\n        const maxBy = label2.y;\n\n        const aLeftOfB = maxAx < minBx;\n        const aRightOfB = minAx > maxBx;\n        const aAboveB = minAy > maxBy;\n        const aBelowB = maxAy < minBy;\n\n        if (!( aLeftOfB || aRightOfB || aAboveB || aBelowB )) {\n          if (!aAboveB || aBelowB) {\n            const distanceY = Math.abs(label1.y - (label2.y - label2.height));\n            label1.y -= distanceY / 2 ;\n            label2.y += distanceY / 2 ;\n          }\n          // if (!aLeftOfB || aRightOfB) {\n          //   const distanceX = Math.abs(label1.x - (label2.x + label2.width));\n          //   label1.x -= distanceX / 2 ;\n          //   label2.x += distanceX / 2 ;\n          // }\n        }\n      }\n    }\n    newLabels = newLabels.sort((a, b) => {\n      if (a.largerStrokeWidth > b.largerStrokeWidth) {\n        return -1;\n      }\n      return 1;\n    })\n    return newLabels;\n  }, [markerData])\n  \n\n  const [hoverIds, setHoverIds] = useState(undefined);\n  return (\n    <g className=\"FlowsLayer\" >\n      {\n        markerData\n          .map((data, index) => {\n\n            const {\n              id,\n              arrowSize,\n              xDep,\n              yDep,\n              xDest,\n              yDest,\n              strokeWidth,\n              datum,\n              layer,\n              width,\n              color,\n              height,\n              projectionTemplate,\n\n              fontSize,\n              path,\n              actualXDep,\n              actualYDep,\n              actualXDest,\n              actualYDest,\n              arrowLength,\n              depLabelTextAnchor,\n              depLabelX,\n              depLabelY,\n              destLabelTextAnchor,\n              destLabelX,\n              destLabelY,\n            } = data;\n\n            const onMouseEnter = () => {\n              setHoverIds([id]);\n            }\n            const onMouseLeave = () => {\n              setHoverIds(undefined);\n            }\n            const hovered = hoverIds && hoverIds.includes(id);\n            return (\n              <FlowGroup\n                key={index}\n                {\n                ...{\n                  hovered,\n                  id,\n                  arrowSize,\n                  xDep,\n                  yDep,\n                  xDest,\n                  yDest,\n                  strokeWidth,\n                  datum,\n                  layer,\n                  width,\n                  color,\n                  height,\n                  projectionTemplate,\n\n                  fontSize,\n                  path,\n                  actualXDep,\n                  actualYDep,\n                  actualXDest,\n                  actualYDest,\n                  arrowLength,\n                  depLabelTextAnchor,\n                  depLabelX,\n                  depLabelY,\n                  destLabelTextAnchor,\n                  destLabelX,\n                  destLabelY,\n\n                  onMouseEnter,\n                  onMouseLeave,\n                }\n                }\n              />\n            );\n          })\n      }\n      {\n        labels.map((thatLabel, index) => {\n          const {\n            id,\n            label,\n            textAnchor,\n            x,\n            // actualX,\n            y,\n            fontSize,\n            flows,\n          } = thatLabel;\n          const isVisible = hoverIds ? hoverIds.find(hoveredId => flows.includes(hoveredId)) : true;\n          const onMouseEnter = () => {\n            setHoverIds(flows);\n          }\n          const onMouseLeave = () => {\n            setHoverIds(undefined);\n          }\n          return (\n            <g\n              id={id}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            >\n              {/* <rect\n                x={actualX}\n                y={y - height}\n                width={width}\n                height={height}\n                fill=\"pink\"\n              /> */}\n              <text\n                id={id}\n                className={cx(\"label\", {'is-visible': isVisible})}\n                textAnchor={textAnchor}\n                x={x}\n                y={y}\n                fontSize={fontSize}\n              >\n                {label}\n              </text>\n            </g>\n          )\n        })\n      }\n    </g>\n  );\n}\n\nexport default FlowsLayer;","\n\n\n/**\n * Allows to display custom objects on the map\n * @param {object} layer\n * @param {function} projection\n * @param {number} width\n * @param {number} height\n * @param {string} projectionTemplate\n * @returns {React.ReactElement} - React component\n */\nconst CustomObjectLayer = ({ \n  layer, \n  projection, \n  width, \n  height, \n  projectionTemplate \n}) => {\n    return (\n        <g className=\"CustomObjectsLayer\">\n          {\n            typeof layer.renderObjects === 'function' ?\n                layer.renderObjects({data: layer.data, projection, width, height, projectionTemplate})\n            :\n            layer.data\n              .map((datum, index) => {\n                return <g key={index}>{layer.renderObject({ datum, projection, width, height, projectionTemplate })}</g>\n              })\n          }\n        </g>\n      );\n}\n\nexport default CustomObjectLayer;","import { useEffect, useState } from \"react\"\n\nconst Button = ({\n    children,\n    onMouseDown,\n    ...props\n  }) => {\n    const [isMouseDown, setState] = useState(false)\n  \n    useEffect(() => {\n      let interval\n      if (isMouseDown) {\n        console.log(\"setInterval\")\n        interval = setInterval(onMouseDown, 100)\n      }\n      return () => {\n        console.log(\"clearInterval\")\n        clearInterval(interval)\n      }\n    }, [isMouseDown, onMouseDown])\n  \n    return <button\n      {...props}\n      onMouseDown={() => {\n        setState(true)\n      }}\n      onMouseUp={() => {\n        setState(false)\n      }}\n      style={{ background: isMouseDown ? 'red' : undefined }}\n    >\n      {children}\n    </button>\n  }\n\n  export default Button ;","import { useState, useEffect } from \"react\";\n\n\n/**\n * A plain input for debug mode\n * @param {string} value\n * @param {function} onBlur\n * @param {object} props\n * @returns {React.ReactElement} - React component \n */\nconst Input = ({\n  value: inputValue,\n  onBlur,\n  ...props\n}) => {\n  const [value, setValue] = useState(inputValue)\n  useEffect(() => {\n    setValue(inputValue)\n  }, [inputValue])\n\n  return <input\n    value={value}\n    onChange={(e) => {\n      setValue(e.target.value)\n    }}\n    onBlur={(e) => {\n      onBlur(e.target.value)\n    }}\n  />\n}\n\nexport default Input;","import { useContext } from 'react';\n\nimport { uniq } from \"lodash-es\";\nimport { SettingsContext } from \"../../helpers/contexts\";\nimport { generatePalette } from '../../helpers/misc';\n\n\n/**\n * Centralized map legend\n * @param {array<object>} layers\n * @param {string} position - used as css suffix ('bottom', 'bottom left', ...)\n * @param {function} layerFilter - allows to hide some layers from legend\n * @returns {React.ReactElement} - React component \n */\nconst Legend = ({\n  layers,\n  position,\n  layerFilter\n}) => {\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Lgende' : 'Legend';\n  return (\n    <div className={`Legend ${typeof position === 'string' ? position : ''}`}>\n      <h5 className=\"legend-main-title\">{legendTitle}</h5>\n      {\n        layers\n        .filter(l => {\n          if (typeof layerFilter === 'function') {\n            return layerFilter(l);\n          }\n          return true;\n        })\n        .map((layer, id) => {\n          let hasSize;\n          let hasColors;\n          let colorModalities;\n          if (layer.size && layer.size.field) {\n            hasSize = true;\n          }\n          if (layer.color && layer.color.field) {\n            hasColors = true;\n            const colorValues = uniq(layer.data.map(datum => datum[layer.color.field]))\n            // @todo refactor the following with PointsLayer as an util\n            let palette;\n            // colors palette building\n            if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n              palette = layer.color.palette;\n            } else {\n              const colors = generatePalette('map', colorValues.length);\n              palette = colorValues.reduce((res, key, index) => ({\n                ...res,\n                [key]: colors[index]\n              }), {});\n            }\n            colorModalities = Object.entries(palette);\n          }\n          return (\n            <>\n              {\n                hasSize ?\n                <div key={id} className=\"size-legend-container\">\n                  {/* <h6 className=\"legend-title\">Taille des cercles</h6> */}\n                  <div className=\"size-legend-item\">\n                  <span className=\"size-icon-container\">\n                    <span />\n                    <span />\n                  </span>\n                  <span className=\"label\">\n                  {layer.size.title || layer.size.field}\n                  </span>\n                  </div>\n                </div>\n                : null\n              }\n              {\n                hasColors ?\n                <div key={id + 'b'} className=\"color-legend-container\">\n                  <h6 className=\"legend-title\">{layer.color.title || layer.color.field}</h6>\n                  <ul className=\"modalities-list\">\n                    {\n                      colorModalities.map(([modality, color], modalityIndex) => (\n                        <li key={modalityIndex}>\n                          <span style={{background: color}} className=\"color-marker\" />\n                          <span className=\"label\">{modality}</span>\n                        </li>\n                      ))\n                    }\n                  </ul>\n                </div>\n                : null\n              }\n            </>\n          )\n        })\n      }\n    </div>\n  )\n}\n\nexport default Legend;","/* DOCUMENTATION : API de ce GoComponent\n\n  Principe :\n    Composants rutilisable pour toutes les cartes utiliss sur les sites PORTIC\n    cartographie en SVG\n    -> permet de faire des cartes choroplthes, de reprsenter des ports, des flux de navires, ...\n\n  Paramtres : \n    * width : largeur de la carte (par dfaut  1500 px)\n    * height : hauteur de la carte (par dfaut  1500 px)\n\n    * layers : diffrentes couches de la carte ('choropleth', 'points', 'flows', 'custom'),  chaque layer il faut donner un fichier de donnes (stock dans public/data) pour construire le objets qui le constituent, les couleurs, tailles, labels de ces objets sont paramtrables \n        si layer 'custom' choisi, il faut passer au layer une fonction d'affichage des donnes :\n        - renderObject : donner un objet de donne en paramtre, la fonction s'occupe de construire sa reprsentation SVG et de la positionner individuellement sur la carte\n        - renderObjects : donner un dataset, la fonction s'occupe de construire une reprsentation SVG de l'ensemble des objets, et de grer leurs positionnement sur la carte (souvent adapt quand le positionnement n'est pas gographique, qu'on a besoin de grer les espacements entre objets ...)\n\n    * projectionTemplate : configuration de carte utilise frquemment ('France', 'coast from Nantes to Bordeaux', 'Poitou', 'rotated Poitou')\n    * projectionConfig: configuration de carte customise (ce paramtre prime sur projectionTemplate si les 2 sont donnes en mme temps)\n\n    * debug : permet d'ajuster manuellement la configuration de la carte quand true (les paramtres de zoom, les coordonnes du centre, la rotation et les translations sont ajustables)\n    \n  @TODO : documenter ce component de manire standardise\n  */\n\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport { geoEqualEarth } from \"d3-geo\";\nimport ChoroplethLayer from './ChoroplethLayer';\nimport PointsLayer from './PointsLayer';\nimport FlowsLayer from './FlowsLayer';\nimport CustomObjectLayer from './CustomObjectLayer';\n// import TriangleChart from '../TriangleChart/TriangleChart';\nimport Button from './Button';\nimport Input from './Input';\nimport Legend from './Legend';\n\nimport './GeographicMapChart.scss'\nimport { fixSvgDimension } from '../../helpers/misc';\n\n\n/**\n * Displays a multi-layers map\n * @param {number} width\n * @param {number} height\n * @param {string} title\n * @param {array} layers\n * @param {string} projectionTemplate\n * @param {object} projectionConfig\n * @param {boolean} debug\n * @param {string} withLegend - can directly take legend position\n * @param {function} legendLayerFilter\n * @returns {React.ReactElement} - React component \n */\nconst GeographicMapChart = ({\n  width: inputWidth = 1500,\n  height: inputHeight = 1500,\n  title,\n  layers = [],\n  projectionTemplate: initialProjectionTemplate,\n  projectionConfig: inputProjectionConfig, // customeconfig that will overwrite a template (optional argument) \n  debug = false, // @todo :  rparer\n  withLegend,\n  legendLayerFilter\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur rgion\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n  const [projectionTemplate, setProjectionTemplate] = useState(initialProjectionTemplate)\n\n  // trick for nice animations\n  useEffect(() => {\n    // setTimeout(() => {\n      setProjectionTemplate(initialProjectionTemplate);\n    // })\n  }, [initialProjectionTemplate])\n\n\n  // define a default map Config\n  const defaultProjectionConfig = useMemo(() => {\n    return {\n      rotationDegree: 0,\n      centerX: 2.4486203,\n      centerY: 46.8576176,\n      scale: height * 5\n    };\n  }, [height]) // repsonsive : se fait en fonction de la height de l'cran\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => { // def les bonnes valeurs pour la config de la projection // enregistrer dans le state // les appliquer dans la projection\n\n    let projectionConfig = { ...defaultProjectionConfig } // casser la rfrence  defaultProj pour respecter principe react qu'on ne modifie pas un objet reu en argument\n\n    let projection = geoEqualEarth()\n\n    switch (projectionTemplate) {\n      case 'World':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * .5,\n          centerX: -1,\n          centerY:  15,\n          // translationX: width * 0.4,\n          // translationY: height * 0.28\n        }\n        break;\n      case 'coast from Nantes to Bordeaux':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 24,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.28\n        }\n        break;\n      case 'Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 30,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'Poitou zoomed':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 23,\n          centerX: -1.7475927,\n          // centerY: 46.573872,\n          centerY: 47.4,\n          // translationX: width * 0.4,\n          translationX: width * 0.45,\n          translationY: 0\n        }\n        break;\n      case 'rotated Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          rotationDegree: 58,\n          scale: height * 32,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.29,\n          translationY: height * 0.25\n        }\n        break;\n      case 'France':\n      default: // as France config \n        // console.log('projection config in dry version', projectionConfig);\n        // console.log(`we are taking the config as specified in config parameters ===> if not specified, the view should correspond to France`);\n        break;\n    }\n\n    if (inputProjectionConfig !== undefined) {\n      projectionConfig = {\n        ...projectionConfig,\n        ...inputProjectionConfig\n      }\n    }\n\n    // update the config\n    setScale(projectionConfig.scale)\n\n    setRotation(projectionConfig.rotationDegree)\n\n    setCenterX(projectionConfig.centerX)\n    setCenterY(projectionConfig.centerY)\n\n    if (projectionConfig.translationX !== undefined) {\n      setTranslationX(projectionConfig.translationX)\n      setTranslationY(projectionConfig.translationY)\n    }\n    else {\n      projectionConfig.translationX = width / 2;\n      projectionConfig.translationY = height / 2;\n      setTranslationX(width / 2)\n      setTranslationY(height / 2)\n    }\n\n    projection\n      .scale(projectionConfig.scale)\n\n    projection.center([projectionConfig.centerX, projectionConfig.centerY])\n\n    if (projectionConfig.rotationDegree) {\n      projection.angle(projectionConfig.rotationDegree)\n    }\n\n    projection.translate([projectionConfig.translationX, projectionConfig.translationY])\n\n    return projection;\n  }, [width, height, defaultProjectionConfig, inputProjectionConfig, projectionTemplate]) \n\n\n\n  // const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n  return (\n    <div className=\"GeographicMapChartWrapper\">\n\n      {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div className=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg className=\"GeographicMapChart\" width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n\n        {\n          layers.map((layer, layerIndex) => {\n\n            switch (layer.type) {\n              case 'choropleth':\n                return <ChoroplethLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  reverseColors={layer.reverseColors}\n                />\n\n              case 'points':\n                return <PointsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'flows': \n                return <FlowsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  projectionTemplate={projectionTemplate}\n                />\n\n              case 'custom':\n                return <CustomObjectLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  projectionTemplate={projectionTemplate}\n                  width={width}\n                  height={height}\n                />\n\n              default:\n                return <g key={layerIndex}><text>Unsupported layer type</text></g>\n            }\n          })\n        }\n        {/* <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n        <rect x=\"58%\" y=\"78%\" width={width * 0.4} height={height * 0.2} rx=\"15\" ry=\"15\" fill={'white'} opacity={0.5} /> */}\n      </svg>\n      {\n        withLegend ?\n        <Legend layerFilter={legendLayerFilter} layers={layers} position={withLegend} />\n        : null\n      }\n      <ReactTooltip id=\"geo-tooltip\" />\n    </div>\n  )\n}\n\nexport default GeographicMapChart;","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  // const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      // const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      // setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number',\n    autoSort: yAutoSort = false\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + xExtent[1] % xTickSpan;\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  const xAxisValues = xTickSpan ? range(xDomain[0], xDomain[xDomain.length - 1], xTickSpan) : xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  \n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Lgende' : 'Legend';\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 15} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = fixSvgDimension(height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom);\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={fixSvgDimension(xScale(end) - xScale(start))}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={fixSvgDimension(thatX2 - thatX1)}\n                        y={yScale(start)}\n                        height={fixSvgDimension(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        markerEnd=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          if (!yAutoSort) {\n                            return 0;\n                          }\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={fixSvgDimension(bandWidth)}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={fixSvgDimension(thatHeight)}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect, useMemo, useContext } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns  {React.ReactElement} - React component\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width: initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n\n  const width = fixSvgDimension(initialWidth - legendWidth);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ? headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ? legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort: sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    autoSort = false,\n    ascending: sortYAscending = true,\n    type: sortYType,\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]))\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n    colorModalities = Object.entries(colorPalette).map(([id]) => id)\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixSvgDimension(fixedRowHeight || vizHeight / bandsNb);\n\n  const groups = useMemo(() => \n    Object.entries(groupBy(data, d => d[y.field]))\n    // sort groups\n    .sort((a, b) => {\n      if (!autoSort) {\n        return 0;\n      }\n      const multiplier = sortYAscending ? 1 : -1;\n      if (sortYField === y.field) {\n        const aVal = sortYType === 'number' ? +a[0] : a[0];\n        const bVal = sortYType === 'number' ? +b[0] : b[0];\n        if (aVal < bVal) {\n          return -1 * multiplier;\n        }\n        return 1 * multiplier;\n      }\n      const aVal = sortYType === 'number' ?\n        +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n        : a[1][sortYField];\n      const bVal = sortYType === 'number' ?\n        +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n        : b[1][sortYField];\n      if (aVal < bVal) {\n        return -1 * multiplier;\n      }\n      return 1 * multiplier;\n    })\n    // sort items\n    .map(([yModality, items]) => [\n      yModality,\n      items\n      .sort((a, b) => {\n        if (!autoSort) {\n          // sort in the order of colorpalette\n          if (colorModalities.indexOf(a[color.field]) > colorModalities.indexOf(b[color.field])) {\n            return 1;\n          }\n          return -1;\n        }\n        const multiplier = sortXAscending ? 1 : -1;\n        const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n        const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n        if (aVal > +bVal) {\n          return -1 * multiplier;\n        }\n        return 1 * multiplier;\n      })\n    ])\n  , [data, y, autoSort, sortYAscending, sortYField, sortYType, sortXAscending, sortXField, sortXType, color, colorModalities]);\n\n  const xDomain = initialXDomain || layout === 'stack' ?\n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) =>\n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n    )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n  let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n  const xScale = scaleLinear().domain(xDomain).range([0, width - margins.left - margins.right]).nice();\n  const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + xDomain[1] % xTickSpan;\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = (() => {\n    return lang === 'fr' ? 'Lgende' : 'Legend';\n  })();\n  return (\n    <>\n      <figure style={{ width: initialWidth, height: finalHeight }} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={valueIndex}\n                    transform={`translate(${margins.left + xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                  .map(([yModality, items], groupIndex) => {\n                    let stackDisplaceX = margins.left;\n                    return (\n                      <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                        <foreignObject\n                          x={0}\n                          y={layout === 'stack' ? bandHeight / 4 : (bandHeight * items.length) / 2 /* + bandHeight * (items.length / 2)*/}\n                          width={margins.left}\n                          height={rowHeight * 2}\n                        >\n                          <div className=\"vertical-bar-label\">\n                            <div>{typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}</div>\n                          </div>\n                        </foreignObject>\n                        {/* <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                          {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                        </text> */}\n                        {\n                          items\n                            .map((item, itemIndex) => {\n\n                              const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                              const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) : xScale(item[x.field]);\n                              const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                              if (layout === 'stack') {\n                                stackDisplaceX += thatWidth;\n                              }\n                              const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                              return (\n                                <>\n                                  {\n                                    +item[x.field] > 0 ?\n                                      <rect key={itemIndex}\n                                        fill={thatColor}\n                                        width={fixSvgDimension(thatWidth)}\n                                        x={thatX}\n                                        y={thatY}\n                                        height={fixSvgDimension(bandHeight - 1)}\n                                        data-for=\"bar-tooltip\"\n                                        data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                      />\n                                      : null\n                                  }\n                                </>\n                              )\n                            })\n                        }\n                      </g>\n                    );\n                  })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color], modalityIndex) => (\n                        <li\n                          key={modalityIndex}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\nimport './BarChart.scss';\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {React.ReactElement} - React component\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","var map = {\n\t\"./en/a-propos.mdx\": [\n\t\t226\n\t],\n\t\"./en/footer.mdx\": [\n\t\t231\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t217\n\t],\n\t\"./en/metadata\": [\n\t\t341,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t341,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t220\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t656,\n\t\t5\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t657,\n\t\t6\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t658,\n\t\t7\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t659,\n\t\t8\n\t],\n\t\"./en/part-2.mdx\": [\n\t\t222\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t224\n\t],\n\t\"./en/references.mdx\": [\n\t\t228\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t660,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t229\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t225\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t230\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t216\n\t],\n\t\"./fr/metadata\": [\n\t\t342,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t342,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t219\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t221\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t223\n\t],\n\t\"./fr/references.mdx\": [\n\t\t227\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t661,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t232\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 649;\nmodule.exports = webpackAsyncContext;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.085,\"time\":5100,\"words\":17}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, Silvia, et al. Commerce multi-chelles autour du port de La Rochelle au XVIIIe sicle. 2021, `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a>{`.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.065,\"time\":3900,\"words\":13}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, Silvia, et al. Multiscale trade in eighteenth-century La Rochelle region. 2021, `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a>{`.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.275,\"time\":16500,\"words\":55}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`MARZAGALLI, Silvia, ASSELIN, Ccile, BOUJU, Alain, CHARLES, Loc, DAUDIN, Guillaume, GEOFFROY, Graldine, GIRARD, Paul, GOURLET, Pauline, MAZOYER, Batrice, de MOURAT, Robin, OOGHE-TABANOU, Benjamin, PLIQUE, Guillaume, PLUMEJEAUD, Christine, POURCHASSE, Pierrick, SAUZEAU, Thierry, THRO, Hlose et ZOFFOLI, Maxime, 2021. Commerce multi-chelles autour du port de La Rochelle au XVIIIe sicle. `}{`[enligne]`}{`. Octobre 2021. Disponible  ladresse: `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a></p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.15,\"time\":9000,\"words\":30}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, S., Asselin, C., Bouju, A., Charles, L., Daudin, G., Geoffroy, G.,  Zoffoli, M. (2021). Commerce multi-chelles autour du port de La Rochelle au XVIIIe sicle. Repr  `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a></p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.13,\"time\":7800,\"words\":26}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Marzagalli, S., Asselin, C., Bouju, A., Charles, L., Daudin, G., Geoffroy, G.,  Zoffoli, M. (2021). Multiscale trade in eighteenth-century La Rochelle region. Consulted at `}<a parentName=\"p\" {...{\n        \"href\": \"https://medialab.github.io/portic-storymaps-2021\"\n      }}>{`https://medialab.github.io/portic-storymaps-2021`}</a></p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <a href=\"https://doi.org/10.5281/zenodo.5717883\" target=\"blank\">10.5281/zenodo.5717883</a>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","/* eslint import/no-webpack-loader-syntax: 0 */\nimport { useState, useRef, useEffect } from 'react';\nimport cx from 'classnames';\n// import copy from 'copy-to-clipboard';\n\nimport FrMla from '!babel-loader!mdx-loader!./mla-fr.mdx';\nimport EnMla from '!babel-loader!mdx-loader!./mla-en.mdx';\nimport FrIso690 from '!babel-loader!mdx-loader!./iso-fr.mdx';\nimport FrApa from '!babel-loader!mdx-loader!./apa-fr.mdx';\nimport EnApa from '!babel-loader!mdx-loader!./apa-en.mdx';\nimport Doi from '!babel-loader!mdx-loader!./doi.mdx';\n\nimport './CitationWidget.scss';\n\n\nconst CONTENTS = {\n  fr: {\n    'MLA': FrMla,\n    'ISO 690': FrIso690,\n    'APA': FrApa,\n    'DOI': Doi\n  },\n  en: {\n    'MLA': EnMla,\n    APA: EnApa,\n    'DOI': Doi\n  }\n}\n\n\n/**\n * Description\n * @param {string} lang\n * @returns {React.ReactElement} - React component\n */\nconst CitationWidget = ({\n  lang = 'fr',\n}) => {\n  const blockquoteRef = useRef(null);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  // const [copyClicked, setCopyClicked] = useState(false);\n  const [currentStyle, setCurrentStyle] = useState(null);\n  useEffect(() => {\n    if (lang === 'fr' || lang === 'en') {\n      setCurrentStyle(Object.keys(CONTENTS[lang])[0]);\n    }\n  }, [lang])\n\n  const Contents = currentStyle ? CONTENTS[lang][currentStyle] : undefined;\n\n  const messages = {\n    title: {\n      fr: 'Citer cette publication',\n      en: 'Cite this publication',\n    },\n    copyCitation: {\n      fr: 'copier',\n      en: 'copy'\n    },\n    citationCopied: {\n      fr: 'copi dans le presse-papier !',\n      en: 'copied in the clipboard !'\n    }\n  }\n\n  // const handleCopyClick = (e) => {\n  //   e.stopPropagation();\n  //   setCopyClicked(true);\n  //   const contents = blockquoteRef.current.innerHTML;\n  //   copy(contents, { format: 'text/html' });\n  //   // copy(blockquoteRef.current.innerText);\n  //   setTimeout(() => setCopyClicked(false), 5000);\n  // }\n\n  if (!['fr', 'en'].includes(lang)) {\n    return null;\n  }\n\n  return (\n    <div className={cx(\"CitationWidget\", { 'is-collapsed': isCollapsed })}>\n      <button\n        className={cx(\"collapse-toggler\", { 'is-active': !isCollapsed })}\n        onClick={() => setIsCollapsed(!isCollapsed)}\n      >\n        {messages.title[lang]}\n      </button>\n      <div className={cx('collapsible-contents')}>\n        <blockquote ref={blockquoteRef}>\n          {currentStyle ? <Contents /> : null}\n        </blockquote>\n        <div className=\"widget-footer\">\n          {\n            Object.entries(CONTENTS[lang]).length > 1 ?\n              <ul className=\"styles-list\">\n                {\n                  lang && currentStyle ?\n                    Object.entries(CONTENTS[lang])\n                      .map(([id, Contents]) => (\n                        <li onClick={() => setCurrentStyle(id)} key={id} className={cx('list-item', { 'is-active': currentStyle === id })}>\n                          <span>{id}</span>\n                        </li>\n                      ))\n                    : null\n                }\n              </ul>\n              : null\n          }\n          {/* disabled: copy on click (gadget) */}\n          {/* <div className=\"copy-link-container\">\n            <span onClick={handleCopyClick}>{copyClicked ? messages.citationCopied[lang] : messages.copyCitation[lang]}</span>\n          </div> */}\n        </div>\n\n      </div>\n    </div>\n  )\n}\n\nexport default CitationWidget;","import CitationWidget from './CitationWidget';\n\nexport default CitationWidget;","const Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore t dveloppe</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport { extent, max } from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\n/**\n * Improve the display of numbers\n * @param {string|number} str - the number to prettify\n * @returns {string}\n */\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n\n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ' ' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\n/**\n * Displays a double diagram displaying a histogram and a linechart, with optional additional annotations\n * @param {array} data\n * @param {string} absoluteField\n * @param {string} shareField\n * @param {string} herfindhalField\n * @param {number} width\n * @param {number} height\n * @param {string} axisLeftTitle\n * @param {string} axisRightTitle\n * @param {number} startYear\n * @param {number} endYear\n * @param {boolean} fillGaps - whether to display a line between two datapoints distant by more than one year\n * @param {function} barTooltipFn\n * @param {string} cityName\n * @param {array<number>} highlightYears\n * @param {string} title\n * @param {object} colorScaleMessages\n * @param {array<object>} annotations - in the form of {startYear: [int], endYear: [int], label: [string], row: [int], labelPosition: [string in ['left', 'right']]}\n * @param {object} margins - in the form {'left': [number],'right': [number],'top': [number],'bottom': [number]}\n * @returns {React.ReactElement} - React component\n */\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n\n  }, [wholeHeight])\n\n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n    .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[shareField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n\n  const { values: rightYAxisValues } = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  let { values: leftYAxisValue } = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  if (yShareScale.domain()[1] - yShareScale.domain()[0] <= 5) {\n    leftYAxisValue = axisPropsFromTickScale(yShareScale, 5).values;\n  }\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", { 'has-highlights': highlightYears !== undefined })}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n              <div className=\"color-scale-container\">\n                <div className=\"color-scale-detail\">\n                  <div\n                    className=\"bar\"\n                    style={{\n                      background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                    }}\n                  />\n                  <div className=\"labels\">\n                    <span>{colorScaleMessages.maximum}</span>\n                    {/* <span>{colorScaleMessages.title}</span> */}\n                    <span>{colorScaleMessages.minimum}</span>\n                  </div>\n                </div>\n              </div>\n              : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g key={value} className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value / 1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n              .map((year, i) => {\n                const x = xBand(year) + xBand.bandwidth() / 2;\n                const y = height - margins.bottom;\n                return (\n                  <g\n                    key={i}\n                    className=\"axis-group\"\n                    transform={`translate(${x}, ${y})`}\n                  >\n                    <line\n                      x1={0}\n                      x2={0}\n                      y1={0}\n                      y2={margins.bottom / 6}\n                      stroke=\"grey\"\n                    />\n                    <g\n                      transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                    >\n                      <text fill=\"grey\">\n                        {year}\n                      </text>\n                    </g>\n                  </g>\n                )\n              })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    <rect\n                      x={xBand(startYear)}\n                      width={xBand(endYear) - xBand(startYear)}\n                      height={fixSvgDimension(height - margins.top - margins.bottom)}\n                      y={margins.top}\n                      fill=\"url(#diagonalHatch)\"\n                      opacity={.4}\n                    />\n                    <line\n                      x1={xBand(startYear)}\n                      x2={xBand(startYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <line\n                      x1={xBand(endYear)}\n                      x2={xBand(endYear)}\n                      y1={margins.top}\n                      y2={height - margins.bottom}\n                      stroke=\"grey\"\n                      opacity={.4}\n                      strokeDasharray={'4,2'}\n                    />\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={fixSvgDimension(yShareScale(0) - yShareScale(d[shareField]))}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ?\n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] || 0).toFixed(2))\n                      .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] || 0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', { 'is-highlighted': highlightYears && highlightYears.includes(+d.year) })}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {/* data points circles */\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .filter(datum => +datum[absoluteField])\n              .map((datum, index) => {\n                \n                const x = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const y = yAbsoluteScale(+datum[absoluteField]);\n                return (\n                  <>\n                    <circle\n                      key={index}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: width * 0.005\n                      }\n                      }\n                      fill={'transparent'}\n                      data-tip={`${datum.year} : export de <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois.`}\n                      data-for={cityName}\n                      data-class=\"bar-tooltip\"\n                      data-html={true}\n                    />\n                    <circle\n                      key={index + 'a'}\n                      {\n                      ...{\n                        cx: x,\n                        cy: y,\n                        r: 1.5\n                      }\n                      }\n                      fill={colorsPalettes.generic.accent1}\n                    />\n                  </>\n                )\n              })\n          }\n          {\n            data\n              .sort((a, b) => {\n                if (+a.year > +b.year) {\n                  return 1;\n                }\n                return -1;\n              })\n              .map((datum, index) => {\n                const next = data[index + 1];\n                if (index === data.length - 1 || fillGaps ? false : +next.year !== +datum.year + 1) {\n                  return null;\n                }\n                if (!next) {\n                  return null;\n                }\n                const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n                const x2 = xBand(+next.year) + xBand.bandwidth() / 2;\n                const y1 = yAbsoluteScale(+datum[absoluteField]);\n                const y2 = yAbsoluteScale(+next[absoluteField]);\n                if (!+datum[absoluteField] || !+next[absoluteField]) {\n                  return null;\n                }\n                const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n                return (\n                  <line\n                    key={datum.year}\n                    {\n                    ...{\n                      x1,\n                      x2,\n                      y1,\n                      y2\n                    }\n                    }\n                    stroke={colorsPalettes.generic.accent1}\n                    title={`${datum.year}-${next.year}`}\n                    strokeWidth={2}\n                    data-tip={`${datum.year}  <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year}  <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                  />\n                )\n              })\n          }\n\n        </g>\n\n        <g className=\"annotations-container\">\n          {\n            annotations\n              .filter(({ startYear: aStartYear, endYear: aEndYear }) => aStartYear >= startYear && aEndYear <= endYear)\n              .map((annotation, annotationIndex) => {\n                const { startYear, endYear: initialEndYear, label, row = 0, labelPosition = 'right' } = annotation;\n                const endYear = initialEndYear + 1;\n                return (\n                  <g className=\"annotation\" key={annotationIndex}>\n                    {\n                      labelPosition === 'right' ?\n                        <>\n                          <line\n                            x1={xBand(endYear) + 20}\n                            x2={xBand(endYear) + 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(endYear) + 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                        :\n                        <>\n                          <line\n                            x1={xBand(startYear) - 20}\n                            x2={xBand(startYear) - 10}\n                            y1={margins.top + 7.5 + row * 20}\n                            y2={margins.top + 7.5 + row * 20}\n                            stroke=\"grey\"\n                            markerEnd=\"url(#arrowhead)\"\n                          />\n                          <text\n                            x={xBand(startYear) - 22}\n                            y={margins.top + 10 + row * 20}\n                            fontSize={'.5rem'}\n                            textAnchor={'end'}\n                            fill=\"grey\"\n                          >\n                            {label}\n                          </text>\n                        </>\n                    }\n\n                    <defs>\n                      <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\"\n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                        <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                      </marker>\n                    </defs>\n                    <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\"\n                        style={{ stroke: 'grey', opacity: .5, strokeWidth: 1 }} />\n                    </pattern>\n\n                  </g>\n                )\n              })\n          }\n        </g>\n\n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n\n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\nimport translate from '../../i18n/translate'\n\nimport colorsPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\n\n/**\n * Displays a comparison of exported products totalizing n% of total shares of exports\n * @param {array} data\n * @param {array} tradeData\n * @param {string} field\n * @param {number} partTreshold - limit of the total cumulated share of exports from which to display products - in [0,1]\n * @param {number} height\n * @param {number} barWidth\n * @param {string} herfindhalField\n * @param {array} years - two years to compare\n * @param {number} width\n * @param {string} title\n * @param {object} margins\n * @param {function} productTooltipFn\n * @param {boolean} compareFrom\n * @returns {React.ReactElement} - React component\n */\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  lang,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = fixSvgDimension(wholeHeight);\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        // product: translate('viz-principale-partie-1', 'other_product', lang, { number: thisYearData.length - dataTillTreshold.length }),\n        ['product_' + lang]: translate('viz-principale-partie-1', 'other_product', lang, { number: thisYearData.length - dataTillTreshold.length }),\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3  className=\"visualization-title\" style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg \n        ref={svgRef} \n        className={cx(\"links-container\", {'has-highlights': hoveredProduct})} \n        style={{top: svgOffset}} \n        width={width} \n        height={height}\n      >\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      key={index}\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 10])\n\n          return (\n            <div\n            key={yearIndex}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d['product_' + lang], (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d['product_' + lang]}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineChart from './DeclineChart';\n\nexport default DeclineChart;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineChart.scss';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate'\n\n/**\n * Configurable wrapper for main viz #1\n * @param {number} width\n * @param {number} height\n * @param {string} lang\n * @param {number} startYear\n * @param {number} endYear\n * @param {number} productTradePartThreshold\n * @param {array<string>} rows - list of visualization rows to display at a certain time\n * @param {datasets} object\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst DeclineChart = (props) => {\n  const {\n    width: inputWidth, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const width = fixSvgDimension(inputWidth);\n  const messages = {\n    franceOverviewTitle: (start, end) => translate('viz-principale-partie-1', 'franceOverviewTitle', lang, { start: start, end: end }),\n    tradeEvolutionTitle: (cityName, start, end) => translate('viz-principale-partie-1', 'tradeEvolutionTitle', lang, { cityName: cityName, start: start, end: end }),\n    top90PctTitle: (cityName, start, end) => translate('viz-principale-partie-1', 'top90PctTitle', lang, { cityName: cityName, start: start, end: end }),\n    partInPct: () => translate('viz-principale-partie-1', 'partInPct', lang),\n    absoluteValue: () => translate('viz-principale-partie-1', 'absoluteValue', lang),\n    herfindalLegendTitle: () => translate('viz-principale-partie-1', 'herfindalLegendTitle', lang),\n    herfindal0: () => translate('viz-principale-partie-1', 'herfindal0', lang),\n    herfindal1: () => translate('viz-principale-partie-1', 'herfindal1', lang),\n    barTooltip: (year, pct, city, herfindal) => translate('viz-principale-partie-1', 'barTooltip', lang, { year: year, pct: pct, city: city, herfindal: herfindal }),\n    productTooltip: (year, product, pct) => translate('viz-principale-partie-1', 'productTooltip', lang, { year: year, product: product, pct: pct }),\n    sevenYearsWar: (year, product, pct) => translate('viz-principale-partie-1', 'sevenYearsWar', lang, { year: year, product: product, pct: pct }),\n    austriaWar: () => translate('viz-principale-partie-1', 'austriaWar', lang),\n    usIndependance: () => translate('viz-principale-partie-1', 'usIndependance', lang),\n    laRochelleDiaspora: () => translate('viz-principale-partie-1', 'laRochelleDiaspora', lang)\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle(startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: .5,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance()\n              },\n\n              \n            ]}\n            // fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct()}\n            axisRightTitle={messages.absoluteValue()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 1,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1747,\n                endYear: 1747,\n                row: 2,\n                label: messages.laRochelleDiaspora()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 3,\n                label: messages.usIndependance()\n              },\n              // {\n              //   type: 'span',\n              //   startYear: 1789,\n              //   endYear: 1789,\n              //   row: 4,\n              //   labelPosition: 'left',\n              //   label: messages.absolute1789[lang](datasets['decline_longitudinal_data.csv'].find((d) => d.region === \"La Rochelle\" && d.year === \"1789\"))\n              // },\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle(),\n              minimum: messages.herfindal0(),\n              maximum: messages.herfindal1(),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            data={datasets['decline_longitudinal_data/decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct()}\n            axisRightTitle={messages.absoluteValue()}\n            barTooltipFn={ messages.barTooltip}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                row: 0.5,\n                label: messages.sevenYearsWar()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                row: 0,\n                label: messages.austriaWar()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                labelPosition: 'left',\n                row: 1,\n                label: messages.usIndependance()\n              },\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle(),\n              minimum: messages.herfindal0(),\n              maximum: messages.herfindal1(),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products/decline_LR_products.csv`] || !datasets['decline_longitudinal_data/decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products/decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data/decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={fixSvgDimension(height/totalRows * rowFlex)}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            lang={lang}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineChart\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineChart;\n","import Decline from '../components/DeclineChart';\n\n/**\n * Renders main visualization #1\n * @param {number} width\n * @param {number} height\n * @param {string} step - in [1, 2, 3] - defines the step of storytelling\n * @param {objects} props - additional params to be passed to visualization components\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart1 = ({\n  width, \n  height, \n  step, \n  ...props\n}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useSpring, animated } from 'react-spring'\n\n\nexport const G =({children, className, onClick, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.g className={className} onClick={onClick} {...props}>\n      {children}\n    </animated.g>\n  )\n}\nexport const Text =({children, onClick, className, style, ...inputProps})  => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.text className={className} onClick={onClick} style={style} {...props}>\n      {children}\n    </animated.text>\n  )\n}\nexport const Line = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.line className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Circle = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.circle className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Rect = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.rect className={className} onClick={onClick} style={style} {...props} />\n  )\n}\nexport const Path = ({style, className, onClick, ...inputProps}) => {\n  const props = useSpring(inputProps);\n  return (\n    <animated.path className={className} onClick={onClick} style={style} {...props} />\n  )\n}","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialChart.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, fixSvgDimension, trimText } from '../../helpers/misc';\nimport ReactTooltip from 'react-tooltip';\n\nimport {G, Text, Line, Circle, Rect, Path} from './animatedPrimities';\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3];\n\n/**\n * Renders a circular alluvial diagram (duh)\n * @param {array} data\n * @param {string} sumBy - field in data to use to quantify flows\n * @param {array} steps - arrow of steps in the form: {field: [string], labels: {fr: [string], en: [string]}, filters: [{key: [string], value: [string]}]}\n * @param {number} width\n * @param {number} height\n * @param {array} filters - objects in the form {key, value} to highlight some flows in the vis\n * @param {boolean} debug\n * @param {string} title\n * @param {object} colorsPalettes\n * @param {boolean} centerHorizontalLabels\n * @param {boolean} displaceHorizontalLabels - avoid labels overlap (at the cost of invadint the center of the vis)\n * @param {object} tooltips - tooltips of nested functions in the form {node: {fr: [fn], en: [fn]}, flow: {fr: [fn], en: [fn]}}\n * @param {string} lang - enum ['fr', 'en']\n * @param {string} align - enum ['left', 'center']\n * @returns {React.ReactElement} - React component\n */\nconst CircularAlluvialChart = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width: inputWidth = 1200,\n  height : inputHeight = 800,\n  filters = [],\n  debug = false,\n  title,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true,\n  tooltips,\n  lang,\n  align = 'left'\n}) => {\n  const titleRef = useRef(null);\n  let height = titleRef.current ? inputHeight - titleRef.current.getBoundingClientRect().height : inputHeight;\n  height = fixSvgDimension(height);\n  const width = fixSvgDimension(inputWidth);\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters]);\n\n  let tooltipContent;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }, [filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 50]).domain([0, 1])\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n\n  // const legendX1 = smallestDimension * .36;\n  // const legendX2 = smallestDimension * .64;\n\n  const legendX1 = smallestDimension * .4;\n  const legendX2 = smallestDimension * .6;\n\n  const legendTopYInternal = smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH;\n  const legendTopYExternal = smallestDimension / 2 - HORIZONTAL_MARGIN + BAR_WIDTH;\n  const legendBottomYInternal = smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH;\n  const legendBottomYExternal = smallestDimension / 2 + HORIZONTAL_MARGIN;\n  return (\n    <>\n      <h5 ref={titleRef} className=\"visualization-title\">{title}</h5>\n      <svg \n        data-for=\"alluvial-tooltip\"\n        data-tip={tooltipContent}\n        width={width} \n        height={height} \n        className={cx(\"CircularAlluvialChart\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}\n      >\n        <G  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <G className=\"background-marks\" transform={`translate(${align === 'left' ?  0 : width / 2 - smallestDimension / 2}, 0)`} >\n          <Line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <Circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(1),\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </Text>\n          \n          <Text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(1),\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </Text>\n          <Path\n            d={`M ${legendX1} ${legendTopYInternal} \n            Q ${legendX1} ${legendTopYExternal}, ${smallestDimension/2} ${legendTopYExternal} \n            Q ${legendX2} ${legendTopYExternal}, ${legendX2} ${legendTopYInternal}`}\n            stroke={'grey'} strokeWidth={.5}\n            fill=\"none\"\n            markerEnd=\"url(#arrowhead)\"\n            style={{\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          />\n          <Text\n            x={legendX1 - 5}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'end',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[0].name}\n          </Text>\n          <Text\n            x={smallestDimension / 2}\n            y={legendTopYExternal - 5}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'middle',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[1].name}\n          </Text>\n          <Text\n            x={legendX2 + 5}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'start',\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          >\n            {steps[2].name}\n          </Text>\n          \n          <Path\n            d={`M ${legendX2} ${legendBottomYInternal} \n            Q ${legendX2} ${legendBottomYExternal}, ${smallestDimension/2} ${legendBottomYExternal} \n            Q ${legendX1} ${legendBottomYExternal}, ${legendX1} ${legendBottomYInternal}`}\n            stroke={'grey'} \n            strokeWidth={.5}\n            fill=\"none\"\n            markerEnd=\"url(#arrowhead)\"\n            style={{\n              opacity: (highlightedFilter && highlightedFilter.index <= 2 ) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 1 : .5\n            }}\n          />\n          <Text\n            x={legendX1 - 5}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'end',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[5].name}\n          </Text>\n          <Text\n            x={smallestDimension / 2}\n            y={legendBottomYExternal + 10}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'middle',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[4].name}\n          </Text>\n          <Text\n            x={legendX2 + 5}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .5 + BAR_WIDTH}\n            style={{\n              fontSize: textScale(.5),\n              fontStyle: 'italic',\n              textAnchor: 'start',\n              opacity: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 1 : .5\n            }}\n          >\n            {steps[3].name}\n          </Text>\n          \n\n          <defs>\n            <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"10\"\n            refX=\"0\" refY=\"5\" orient=\"auto\">\n              <polygon stroke=\"grey\" strokeWidth={1} fill=\"grey\" points=\"0 0, 10 5, 0 10\" />\n            </marker>\n          </defs>\n        </G>\n        <G \n          transform={`translate(${align === 'left' ? 0 : width / 2 - smallestDimension / 2}, 0)`}\n        >\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <G\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <Rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <G\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleClick = () => {\n                                      if (highlightedFlow && highlightedFlow._id === flow._id) {\n                                        setHighlightedFilter(undefined);\n                                        setHighlightedFlow(undefined);\n                                      }\n                                      else {\n                                        if (highlightedFilter) {\n                                          setHighlightedFilter(undefined);\n                                        }\n                                        setHighlightedFlow({...flow, stepIndex});\n                                      }\n                                      \n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH * 2;\n                                      y3 += BAR_WIDTH * 2;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH * 2;\n                                      y4 += BAR_WIDTH * 2;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    const {flow_type, customs_office} = flow;\n                                    const value = flow[sumBy];\n                                    const tContent = tooltips.flow[lang]({\n                                      flow_type, \n                                      customs_office, \n                                      product: flow['product_' + lang], \n                                      sumBy, \n                                      partner: flow['partner_' + lang],\n                                      value\n                                    })\n                                    // console.log('tContent : ', tContent);\n                                    return (\n                                      <G\n                                        onClick={handleClick}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                        data-for=\"alluvial-tooltip\"\n                                        data-tip={tContent}\n                                      >\n                                        <Path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <Line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <Line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <Line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <Line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <Circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </G>\n                                    )\n                                  })\n                              }\n                            </G>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH * 2;\n                        }\n                        const handleClick = () => {\n                          if (highlightedFilter && highlightedFilter.value === node.id) {\n                            setHighlightedFlow(undefined);\n                            setHighlightedFilter(undefined);\n                          }\n                          else {\n                            if (highlightedFlow) {\n                              setHighlightedFlow(undefined);\n                            }\n                            setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                          }\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.label || node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        const tContent = tooltips.node(node, stepIndex);\n                        return (\n                          <G\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onClick={handleClick}\n                            data-for=\"alluvial-tooltip\"\n                            data-tip={tContent}\n                          >\n                            <Rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <G\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <Text\n                                style={{\n                                  fontSize: stepIndex === 0 || [2, 3, 5].find(index => index === stepIndex) ? labelFontSize * .75 : labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </Text>\n                            </G>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <Line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 ||stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH * 2;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <Rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </G>\n                        )\n                      })\n                    }\n\n                  </G>\n                )\n              })\n          }\n        </G>\n        </G>\n      </svg>\n      <ReactTooltip id=\"alluvial-tooltip\" />\n    </>\n  )\n}\n\nexport default CircularAlluvialChart;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        label: flows[0][step.labelField],\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import React from 'react';\nimport Slider/*, { SliderTooltip }*/ from 'rc-slider';\nimport 'rc-slider/assets/index.css';\n\nconst { createSliderWithTooltip } = Slider;\nconst Range = createSliderWithTooltip(Slider.Range);\n\n/**\n * Displays an interactive slider\n * @param {string} title\n * @param {number} min\n * @param {number} max\n * @param {number} value\n * @param {function} onChange\n * @returns {React.ReactElement} - React component\n */\nconst SliderRange = ({ \n  title, \n  min, \n  max, \n  value, \n  onChange \n}) => {\n  const style = { width: 300, margin: 50 };\n\n  return (\n    <div style={style}>\n      <p>{title}</p>\n      <Range\n        allowCross={false}\n        min={min}\n        max={max}\n        value={value}\n        onChange={onChange}\n      />\n    </div>\n  )\n}\n\nexport default SliderRange;","import SliderRange from './SliderRange';\n\nexport default SliderRange;","import React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { polarToCartesian } from '../../helpers/misc';\n\n\nconst AxisObject = ({\n  size,\n  MARGIN,\n  axisIndex,\n  axisRankScale,\n  axis,\n  label\n}) => {\n    const [rawX1, rawY1] = [size/2 + MARGIN / 2, size/2 + MARGIN / 2];\n    const [x2Rel, y2Rel] = polarToCartesian(size/2, axisRankScale(axisIndex))\n    const rawX2 = rawX1 + x2Rel;\n    const rawY2 = rawY1 + y2Rel;\n    let labelXDisplace = -MARGIN / 8;\n    let labelYDisplace = 15;\n    if (axisIndex > 0) {\n      labelYDisplace = -10;\n      if (axisIndex === axis.length / 2) {\n        labelYDisplace = -20;\n        labelXDisplace = -MARGIN / 6;\n      } else if (axisIndex < axis.length / 2) {\n        labelXDisplace = -MARGIN / 2;\n      } else {\n        labelXDisplace = 5;\n      }\n      // special cases\n      if (axisIndex === 3 || axisIndex === 5) {\n        labelYDisplace = -30;\n      }\n      if (axisIndex === 7) {\n        labelYDisplace = 5;\n      }\n      if (axisIndex === 1) {\n        labelYDisplace = 5;\n        labelXDisplace = -MARGIN/3;\n      }\n    }\n    const {\n      x1,\n      y1,\n      x2,\n      y2,\n      labelX,\n      labelY\n    } = useSpring({\n      x1: rawX1,\n      y1: rawY1,\n      x2: rawX2,\n      y2: rawY2,\n      labelX: rawX2 + labelXDisplace,\n      labelY: rawY2 + labelYDisplace\n    })\n    return (\n      <g key={axisIndex} className=\"AxisObject\">\n        <animated.line\n          {\n            ...{\n              x1,\n              y1,\n              x2,\n              y2,\n            }\n          }\n        />\n        <animated.foreignObject \n          x={labelX} \n          y={labelY} \n          width={MARGIN * .7} \n          height={MARGIN}\n        >\n          <div className=\"label\">\n            {label}\n          </div>\n        </animated.foreignObject>\n      </g>\n    )\n}\n\nexport default AxisObject;","import { sum } from 'lodash';\nimport React from 'react';\nimport { useSpring, animated } from 'react-spring'\n\nimport { fixSvgDimension, polarToCartesian } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate'\n\n/**\n * A plain animated circle\n * @param {number} cx \n * @param {number}  cy \n * @param {number} r \n * @param {object} props\n * @returns {React.ReactElement} - React component \n */\nconst Circle = ({\n  cx: inputX,\n  cy: inputY,\n  r: inputR,\n  ...props\n}) => {\n  const {\n    cx,\n    cy,\n    r,\n  } = useSpring({\n    cx: fixSvgDimension(inputX),\n    cy: fixSvgDimension(inputY),\n    r: inputR\n  })\n  return (\n    <animated.circle\n      cx={cx}\n      cy={cy}\n      r={r}\n      {...props}\n    />\n  )\n}\n\n\n/**\n * Displays a radarplot object\n * @param {string} color\n * @param {object} data - single data object\n * @param {object} axisIndexMap\n * @param {function} axisRankScale\n * @param {array<number>} center - 2D coordinates of center in pixels\n * @param {string} name\n * @param {function} radiusScale\n * @returns {React.ReactElement} - React component \n */\nconst VisObject = ({\n  lang,\n  color,\n  data,\n  axisIndexMap,\n  axisRankScale,\n  center,\n  name,\n  radiusScale\n}) => {\n  const points = Object.entries(axisIndexMap)\n  .map(([key, index]) => {\n    const val = data[key] || 0;\n    const r = radiusScale(val);\n    const theta = axisRankScale(+index);\n    const [xRaw, yRaw] = polarToCartesian(r, theta);\n    const x = fixSvgDimension(xRaw + center[0]);\n    const y = fixSvgDimension(yRaw + center[1]);\n    return [x, y]\n  })\n  const {joinedPoints} = useSpring({\n    joinedPoints: points.map(([x, y]) => `${x},${y}`).join(' ')\n  });\n\n  let tooltipValues = Object.entries(data);\n  const sumOfParts = sum(tooltipValues.map(v => v[1]));\n  tooltipValues = tooltipValues.map(([key, val]) => [key, val / sumOfParts])\n  return (\n    <g \n      className=\"VisObject\"\n      data-for=\"radar-tooltip\"\n      data-html={true}\n      data-place=\"left\"\n      data-tip={`\n      <p>\n      ${name === 'Tous les bureaux' ? translate('viz-principale-partie-2', 'radar_tip_region', lang) : translate('viz-principale-partie-2', 'radar_tip_office', lang, { name: name })} :\n      </p>\n      <ol>\n        ${\n          tooltipValues\n          .sort(([_key, portionA], [_key2, portionB]) => {\n            if (portionA > portionB) {\n              return -1;\n            }\n            return 1;\n          })\n          .map(([key, portion]) => `\n            <li>\n              <strong>${key}</strong> : <strong>${(portion * 100).toFixed(2)}%</strong>\n            </li>\n          `).join('\\n')\n        }\n      </ol>\n  `}\n    >\n      <animated.polygon\n        points={joinedPoints}\n        fill={color}\n        fillOpacity={.5}\n      />\n      {\n        points\n        .map(([x, y], index) => {\n          return (\n            <Circle\n              key={index}\n              cx={x}\n              cy={y}\n              r={1}\n              fill={color}\n            />\n          )\n        })\n      }\n    </g>\n  )\n}\n\nexport default VisObject;","import RadarPlot from './RadarPlot';\n\nexport default RadarPlot;","import { scaleLinear } from 'd3-scale';\nimport React, { useEffect, useMemo } from 'react';\nimport { useSpring, animated } from 'react-spring'\nimport Tooltip from 'react-tooltip';\n\nimport AxisObject from './AxisObject';\nimport VisObject from './VisObject';\n\nimport './RadarPlot.scss';\n\n/**\n * Displays a radar plot\n * @todo this component should be genericized at some point, it was done in haste\n * @param {array} data\n * @param {number} size\n * @param {array<string>} axis - list of columns names to use as axis\n * @returns {React.ReactElement} - React component\n */\nconst RadarPlot= ({\n  lang,\n  data,\n  size : wholeSize = 100,\n  axis,\n}) => {\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  const axisIndexMap = useMemo(() =>\n    axis.reduce((res, a, aIndex) => ({\n      ...res,\n      [a]: aIndex\n    }), {})\n  , [axis])\n  const MARGIN = 100;\n  const size = wholeSize - MARGIN;\n  const { visCenter, visSize } = useSpring({\n    visCenter: size/2 + MARGIN / 2,\n    visSize: size/2,\n  })\n  const axisRankScale = scaleLinear().domain([0, axis.length]).range([Math.PI / 2, Math.PI * 2.5])\n  const radiusScale = scaleLinear().domain([0, 1]).range([0, size / 2])\n  return (\n    <>\n    <svg className=\"RadarPlot\" width={wholeSize} height={wholeSize}>\n      <animated.circle\n        cx={visCenter}\n        cy={visCenter}\n        r={visSize}\n        strokeWidth={.5}\n        stroke=\"grey\"\n        fill=\"none\"\n      />\n      <g className=\"background-container\">\n        {\n          axis.map((label, axisIndex) => (\n            <AxisObject\n              key={axisIndex}\n              {\n                ...{\n                  size,\n                  MARGIN,\n                  axisIndex,\n                  axisRankScale,\n                  axis,\n                  label\n                }\n              }\n            />\n          ))\n        }\n      </g>\n      <g className=\"objects-container\">\n        {\n          data.map((datum, datumIndex) => (\n            <VisObject\n              lang={lang}\n              key={datum.meta.name}\n              color={datum.meta.color}\n              name={datum.meta.name}\n              data={datum.data}\n              axisIndexMap={axisIndexMap}\n              axisRankScale={axisRankScale}\n              center={[size/2 + MARGIN / 2, size/2 + MARGIN / 2]}\n              radiusScale={radiusScale}\n            />\n          ))\n        }\n      </g>\n    </svg>\n    <Tooltip id=\"radar-tooltip\" />\n    </>\n  )\n}\n\nexport default RadarPlot;\n","/* eslint react-hooks/exhaustive-deps : 0 */\nimport { useEffect, useMemo, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport _, { maxBy, uniqBy, sumBy, values } from 'lodash';\nimport cx from 'classnames';\n\nimport SliderRange from '../../components/SliderRange';\nimport RadarPlot from '../../components/RadarPlot';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Prepares radar data\n * @author Graldine Geoffroy\n * @param {array} datas \n * @returns {array}\n */\nconst prepareTravelData = (datas, lang) => {\n  return _(datas)\n    .groupBy(lang === 'fr' ? \"destination_radar_fr\" : \"destination_radar_en\")\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = dest.length;\n      return rObj;\n    })\n    .value();\n};\n\n/**\n * Prepares radar data\n * @author Graldine Geoffroy\n * @param {array} datas \n * @returns {array}\n */\nconst prepareTonnageData = (datas, lang) => {\n  return _(datas)\n    .groupBy(lang === 'fr' ? \"destination_radar_fr\" : \"destination_radar_en\")\n    .map((dest, id) => {\n      var rObj = {};\n      rObj[id] = sumBy(dest, \"tonnage\");\n      return rObj;\n    })\n    .value();\n};\n\n\n/**\n * Normalizes radar values so that they get comparable\n * @author Graldine Geoffroy\n * @param {array} datas \n * @param {object} destCaptions \n * @returns {array}\n */\nconst normalizeRadarValues = (datas, destCaptions) => {\n  // mapping on max value\n  const maxValue = maxBy(values(datas), function (o) {\n    return o;\n  });\n  // if mapping on sum rather than max\n  // const maxValue = sum(values(datas))\n  var x = scaleLinear()\n    .domain([0, maxValue])\n    .range([0, 1]);\n  for (var key in datas) {\n    if (datas.hasOwnProperty(key)) {\n      datas[key] = x(datas[key]);\n    }\n  }\n  for (var dkey in destCaptions) {\n    if (!datas.hasOwnProperty(dkey)) {\n      datas[dkey] = 0\n    }\n  }\n\n  return datas;\n};\n\n/**\n * Wraps radar vis by controlling interactions and interpreting writers-level instructions\n * @param {array} data\n * @param {number} globalWidth\n * @param {boolean} minified\n * @param {string} title\n * @param {string} bureaux\n * @param {string} navigoAgregation\n * @param {number} minTonnage\n * @param {number} maxTonnage\n * @param {array} axis\n * @param {object} colorPalette\n * @returns {React.ReactElement} - React component\n */\nconst RadarWrapper = ({\n  data: inputData,\n  globalWidth = 500,\n  minified,\n  title,\n  bureaux = \"tous\",\n  navigoAgregation = \"tonnage\",\n  minTonnage,\n  maxTonnage,\n  lang,\n  axis = [],\n  colorPalette\n}) => {\n  const [selectedBureaux, setSelectedBureaux] = useState(new Set(['Tous les bureaux']));\n  const [aggregationMethod, setAggregationMethod] = useState('tonnage');\n  const [tonnageFilterValues, setTonnageFilterValues] = useState([]);\n  const [datasetMaximumTonnage, setDatasetMaximumTonnage] = useState();\n  const datasetMinimumTonnage = 0;\n\n  /**\n   * DATA UPDATE\n   */\n  const data = useMemo(() => {\n    if (inputData) {\n      const newData = inputData.map(d => {\n        // remove csv empty values\n        if ((d.destination_radar !== '') & (d.ferme_bureau !== '')) {\n          return {\n            ferme_bureau: d.ferme_bureau,\n            destination_radar: d.destination_radar.replace(/['\"]+/g, ''),\n            destination_radar_fr: d.destination_radar_fr.replace(/['\"]+/g, ''),\n            destination_radar_en: d.destination_radar_en.replace(/['\"]+/g, ''),\n            tonnage: +d.tonnage\n          };\n        }\n        return undefined;\n      })\n        .filter(d => d)\n      // setDestCaptions(Object.assign({}, ...prepareDestCaptions(newData)))\n      let max = maxBy(newData, 'tonnage').tonnage;\n      setDatasetMaximumTonnage(max);\n      if (maxTonnage) {\n        max = +maxTonnage;\n      }\n      let min = datasetMinimumTonnage;\n      if (minTonnage) {\n        min = +minTonnage;\n      }\n      setTonnageFilterValues([min, max]);\n      return newData;\n    }\n    return inputData;\n  }, [inputData])\n\n  const bureauxList = useMemo(() => {\n    return [\n      'Tous les bureaux',\n      ...uniqBy(data, 'ferme_bureau').map(({ ferme_bureau }) => ferme_bureau)\n    ]\n  }, [data])\n\n  const filteredData = useMemo(() => {\n    const bureauxToKeep = Array.from(selectedBureaux);\n    return data\n      .filter(datum => {\n        if (bureauxToKeep.includes('Tous les bureaux')) {\n          return true;\n        }\n        return bureauxToKeep.includes(datum.ferme_bureau)\n      })\n      .filter(datum => {\n        if (aggregationMethod === 'tonnage' && tonnageFilterValues && tonnageFilterValues.length) {\n          return datum.tonnage >= tonnageFilterValues[0]\n            && datum.tonnage <= tonnageFilterValues[1]\n        }\n        return true;\n      })\n  }, [data, selectedBureaux, tonnageFilterValues])\n\n  /**\n   * UPDATE FROM PROPS\n   */\n  /** update from navigoAgregation prop */\n  useEffect(() => {\n    setAggregationMethod(navigoAgregation);\n  }, [navigoAgregation])\n\n  /** update from bureaux prop */\n  useEffect(() => {\n    if (bureaux) {\n      const cleanBureaux = (bureaux).split(',')\n      .map(b => b.trim())\n      .map(b => b === 'tous' ? 'Tous les bureaux' : b)\n    setSelectedBureaux(new Set(cleanBureaux));\n    }\n    \n  }, [bureaux])\n\n  /** update from maxTonnage prop */\n  useEffect(() => {\n    if (maxTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([tonnageFilterValues[0], +maxTonnage]);\n      } else {\n        setTonnageFilterValues([0, +maxTonnage]);\n      }\n    }\n  }, [maxTonnage])\n\n  /** update from minTonnage prop */\n  useEffect(() => {\n    if (minTonnage) {\n      if (tonnageFilterValues && tonnageFilterValues.length) {\n        setTonnageFilterValues([+minTonnage, tonnageFilterValues[1]]);\n      } else {\n        const max = maxBy(data, 'tonnage').tonnage;\n        setTonnageFilterValues([+minTonnage, max]);\n      }\n    }\n  }, [minTonnage])\n\n\n  const radarData = useMemo(() => {\n    const bureauxObjects = Array.from(selectedBureaux);\n    return bureauxObjects.map((bureauName) => {\n      const relevantData = bureauName === 'Tous les bureaux' ? filteredData :\n        filteredData.filter(datum => datum.ferme_bureau === bureauName);\n      const preparedData = aggregationMethod === 'tonnage' ? prepareTonnageData(relevantData, lang) : prepareTravelData(relevantData, lang);\n      return {\n        data: normalizeRadarValues\n          (Object.assign({}, ...preparedData)\n          ),\n        meta: {\n          color: colorPalette[bureauName],\n          name: bureauName\n        }\n      }\n    })\n  }, [selectedBureaux, tonnageFilterValues, aggregationMethod]);\n  // console.log('selected bureaux', selectedBureaux, 'radarData', radarData)\n\n  if (!data || !radarData) {\n    return null;\n  }\n  return (\n    <div className={cx(\"RadarWrapper\", { 'is-minified': minified })}>\n\n      <h5 className=\"visualization-title\">{title}</h5>\n      <RadarPlot\n        lang={lang}\n        data={radarData.reverse()}\n        size={minified ? globalWidth * .4 : globalWidth * .7}\n        axis={axis}\n      />\n      <div\n        className={cx(\"controls-container\", { 'is-minified': minified })}\n      >\n        <div className=\"controls-contents\">\n          <strong>{filteredData.length}</strong> {translate('viz-principale-partie-2', 'travel_aggregate', lang)} <span className=\"aggregation-controls-container\">\n\n            <select value={aggregationMethod} onChange={e => setAggregationMethod(e.target.value)}>\n              <option\n                key={'tonnage'}\n                id={'tonnage'}\n                value={'tonnage'}\n              >{\n                (lang === 'fr' && translate('viz-principale-partie-2', 'radar_tonnage', 'fr', { method: aggregationMethod === 'tonnage' ? ` (navires de ${tonnageFilterValues[0]}  ${tonnageFilterValues[1]} tonneaux)` : '' }))\n                || translate('viz-principale-partie-2', 'radar_tonnage', 'en', { method: aggregationMethod === 'tonnage' ? ` (ships of ${tonnageFilterValues[0]} to ${tonnageFilterValues[1]} tonnage)` : '' })\n              }</option>\n              <option\n                key={'voyages'}\n                id={'voyages'}\n                value={'voyages'}\n              >{translate('viz-principale-partie-2', 'radar_flows', lang)}</option>\n            </select>\n            {\n              aggregationMethod && aggregationMethod === 'tonnage' &&\n              <span className=\"slider-container\">\n                <SliderRange\n                  min={datasetMinimumTonnage}\n                  max={datasetMaximumTonnage}\n                  value={tonnageFilterValues}\n                  onChange={value => [setTonnageFilterValues(value)]}\n                />\n              </span>\n            }\n          </span>\n          <p className=\"legend-explanation\">\n            {translate('viz-principale-partie-2', 'radar_legend', lang)}&nbsp;:\n          </p>\n          <ul className=\"bureaux-list\">\n            {\n              bureauxList.map((bureau, index) => {\n                const handleClick = () => {\n                  const newSelectedBureaux = new Set(selectedBureaux);\n                  if (selectedBureaux.has(bureau) && Array.from(selectedBureaux).length > 1) {\n                    newSelectedBureaux.delete(bureau);\n                  } else {\n                    newSelectedBureaux.add(bureau);\n                  }\n                  setSelectedBureaux(newSelectedBureaux);\n                }\n                return (\n                  <li\n                    key={index}\n                    onClick={handleClick}\n                    className={cx(\"bureau-item\", { 'is-active': selectedBureaux.has(bureau) })}\n                  >\n                    <span\n                      className=\"color-marker\"\n                      style={{ background: colorPalette[bureau] }}\n                    />\n                    <span className=\"bureau-label\">\n                      {bureau === 'Tous les bureaux' ? lang === 'fr' ? 'Ensemble des ports' : 'All ports' : bureau}\n                    </span>\n                  </li>\n                )\n              })\n            }\n          </ul>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default RadarWrapper;","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import {useMemo} from 'react';\nimport cx from 'classnames';\nimport CircularAlluvialChart from \"../../components/CircularAlluvialChart/CircularAlluvialChart\";\nimport RadarWrapper from './RadarWrapper';\n\nimport colorsPalettes from '../../colorPalettes';\nimport {fixSvgDimension, formatNumber} from '../../helpers/misc';\n\nimport './PrincipalVisualizationPart2.scss';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Composes the principal visualization for part 2\n * @param {number} width\n * @param {number} height\n * @param {object} datasets\n * @param {boolean} showOnlyToflit\n * @param {boolean} atlasMode\n * @param {boolean} screenshotMode\n * @param {string} highlight - enum ['navigo', 'toflit18']\n * @param {string} lang\n * @param {string} filter - custom filters enum ['aucun', 'colonial', 'eau-de-vie', 'sel']\n * @param {string} bureaux - bureaux to highlight enum ['tous', <bureaux names separated by comas>']\n * @param {string} navigoAgregation - enum[\"tonnage\", ...]\n * @param {number} minTonnage\n * @param {number} maxTonnage\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart2 = ({\n  width: inputWidth, \n  height: containerHeight, \n  datasets, \n  showOnlyToflit = false, \n  atlasMode, \n  screenshotMode,\n  highlight = 'toflit18',\n  lang = 'fr',\n  filter = 'aucun',\n  bureaux=\"tous\",\n  navigoAgregation=\"tonnage\",\n  minTonnage,\n  maxTonnage,\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? 1200 : fixSvgDimension(containerHeight);\n  const {sumToflitBy, alluvialFilters} = useMemo(() => {\n    let sumBy = 'value';\n    let filters = [];\n    switch(filter) {\n      case \"colonial\":\n        filters = [\n          {\n            key: 'product',\n            value: `produits coloniaux`\n          },\n          {\n            key: 'partner',\n            value: `Afrique`\n          },\n          {\n            key: 'partner',\n            value: `Colonies`\n          }\n        ];\n        break;\n      case \"eau-de-vie\":\n        filters = [\n          {\n            key: 'product',\n            value: `eau-de-vie et vins divers`\n          }\n        \n        ];\n        break;\n      case \"sel\":\n        filters = [{\n          key: 'product',\n          value: `sel`\n        }];\n        sumBy = 'product_weight_kg'\n        break;\n      default:\n        break;\n    }\n\n    return {\n      sumToflitBy: sumBy,\n      alluvialFilters: filters\n    }\n  }, [filter]);\n  const toflit18titles = (() => {\n    if (lang === 'fr') {\n      return translate('viz-principale-partie-2', 'toflit18titles', lang, {sumToflitBy: sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'})\n    }\n    return translate('viz-principale-partie-2', 'toflit18titles', lang, {sumToflitBy: sumToflitBy === 'value' ? 'commercial value' : 'weight of goods'})\n  })()\n  const navigoTitles = translate('viz-principale-partie-2', 'navigoTitles', lang)\n  return (\n    <div \n      className={cx(\"PrincipalVisualizationPart2\", \"highlight-\" + highlight, {'is-atlas-mode': atlasMode, 'is-screenshot-mode': screenshotMode})}\n    >\n     <div \n      className=\"circular-alluvial-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .5,\n        height: atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .5,\n      }}\n    >\n        <CircularAlluvialChart\n          data={datasets['part_2_toflit_viz_data/part_2_toflit_viz_data.csv']}\n          width={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? width * .6 : width * .45}\n          height={atlasMode ? window.innerWidth * .5 : highlight === 'toflit18' ? height : height * .45}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          lang={lang}\n          title={toflit18titles}\n          displaceHorizontalLabels={highlight === 'toflit18'}\n          centerHorizontalLabels={highlight === 'toflit18'}\n          tooltips={{\n            node: ({id, ...node}, step) => {\n              const importTranslate = lang === 'fr' ? 'import' : 'imported';\n              const exportTranslate = lang === 'fr' ? 'export' : 'exported';\n\n              if (step === 0 || step === 5) {\n                return translate('viz-principale-partie-2', 'node_0_5', lang, { \n                  id: node.label, \n                  step: step < 3 ? exportTranslate : importTranslate, \n                  number: formatNumber(parseInt(node.valueAbs)), \n                  sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' \n                })\n              } else if (step === 1 || step === 4) {\n                return translate('viz-principale-partie-2', 'node_1_4', lang, { \n                  id: node.label, \n                  step: step < 3 ? exportTranslate : importTranslate, \n                  number: formatNumber(parseInt(node.valueAbs)), \n                  sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' \n                })\n              } else {\n                return translate('viz-principale-partie-2', 'node_other', lang, { \n                  id: node.label, \n                  step: step < 3 ? exportTranslate : importTranslate, \n                  number: formatNumber(parseInt(node.valueAbs)), \n                  sumBy: sumToflitBy === 'value' ? 'livres tournoi' : 'kg' \n                })\n              }\n            },\n            flow: {\n              fr: ({flow_type, customs_office, product, sumBy, value, partner}) => translate('viz-principale-partie-2', 'flow', lang, { customs_office, flow_type: flow_type === 'import' ? 'import' : 'export', number: formatNumber(parseInt(value)), sumBy: sumBy === 'value' ? 'livres tournois' : 'kg', product, flow_direction: flow_type === 'import' ? 'depuis' : 'vers', partner }),\n              en: ({flow_type, customs_office, product, sumBy, value, partner}) => translate('viz-principale-partie-2', 'flow', lang, { customs_office, flow_type: flow_type === 'import' ? 'imported' : 'exported', number: formatNumber(parseInt(value), 'en'), sumBy: sumBy === 'value' ? 'livres tournois' : 'kg', product, flow_direction: flow_type === 'import' ? 'from' : 'to', partner }),\n            }\n          }}\n          steps={[\n            {\n              field: \"customs_office\",\n              labelField: \"customs_office\",\n              labels: translate('viz-principale-partie-2', 'customs_office', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'bureau' : 'office'\n            },\n            {\n              field: \"product\",\n              labelField: \"product_\" + lang,\n              labels: translate('viz-principale-partie-2', 'product', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'produit' : 'product'\n            },\n            {\n              field: \"partner\",\n              labelField: \"partner_\" + lang,\n              labels: translate('viz-principale-partie-2', 'partner', lang),\n              filters: [{key: 'flow_type', value: 'export'}],\n              name: lang === 'fr' ? 'partenaire' : 'partner'\n            },\n            {\n              field: \"partner\",\n              labelField: \"partner_\" + lang,\n              labels: translate('viz-principale-partie-2', 'partner', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'partenaire' : 'partner'\n            },\n            {\n              field: \"product\",\n              labelField: \"product_\" + lang,\n              labels: translate('viz-principale-partie-2', 'product', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'produit' : 'product'\n            },\n            {\n              field: \"customs_office\",\n              labelField: 'customs_office',\n              labels: translate('viz-principale-partie-2', 'customs_office', lang),\n              filters: [{key: 'flow_type', value: 'import'}],\n              name: lang === 'fr' ? 'bureau' : 'office'\n            },\n          ]}\n        />\n     </div>\n     <div \n      className=\"radar-container\"\n      style={{\n        width: atlasMode ? window.innerWidth * .5 : highlight === 'navigo' ? width * .7 : width * .4\n      }}\n    >\n      <RadarWrapper \n        data={datasets['part_2_navigo_viz_data/part_2_navigo_viz_data.csv']}\n        minified={!atlasMode && highlight !== 'navigo'}\n        globalWidth={atlasMode ? window.innerWidth * .5 : width}\n        bureaux={bureaux}\n        navigoAgregation={navigoAgregation}\n        minTonnage={minTonnage}\n        maxTonnage={maxTonnage}\n        title={navigoTitles}\n        lang={lang}\n        axis={lang === 'fr' ? \n        [\n          'Local',\n          'Afrique',\n          'Colonies',\n          'Grande-Bretagne',\n          'Europe',\n          'Ports francs et petites les',\n          'France',\n          'Reste du monde',\n        ] :\n        [\n          'Local',\n          'Africa',\n          'Colonies',\n          'Great Britain',\n          'Europe',\n          'Free ports and small islands',\n          'France',\n          'Rest of the world',\n        ]\n      }\n        colorPalette={colorsPalettes.customs_office}\n      />\n       {/* <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} /> */}\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","\nimport NetworkGraphChart from \"../../components/NetworkGraphChart/GraphContainer\";\nimport BarChart from \"../../components/BarChart\";\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport translate from \"../../i18n/translate\";\n\n/**\n * Viz 3.2 wrapper\n * @param {number} width\n * @param {number} height\n * @param {object} datasets\n * @returns {React.ReactElement} - React component\n */\nconst Step2 = ({\n  width: inputWidth,\n  height: inputHeight,\n  datasets,\n  lang\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = fixSvgDimension(inputHeight);\n  return (\n    <>\n          <div className=\"graphs-container\" style={{ position: 'relative', height: height * .6 }}>\n            <div className=\"graph-container\" style={{ width: width * .6, height: height * .6, position: 'absolute' }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_La Rochelle/flows_1787_around_La Rochelle.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                ratio={1.1}\n                title={translate('viz-principale-partie-3', 'network_1_title', lang)}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, top: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Bordeaux/flows_1787_around_Bordeaux.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                title={translate('viz-principale-partie-3', 'network_2_title', lang)}\n                ratio={1}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, bottom: 0 }}>\n              <NetworkGraphChart\n                data={datasets['flows_1787_around_Nantes/flows_1787_around_Nantes.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                title={translate('viz-principale-partie-3', 'network_3_title', lang)}\n                ratio={0.7}\n                spatialize\n              />\n            </div>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: '1rem',\n            left: 0,\n            width: width * .3,\n            height: height * .3,\n            paddingLeft: 0,\n            // marginBottom: '1rem'\n          }}\n            className=\"ColorLegend\"\n          >\n            <h5>{translate('viz-principale-partie-3', 'network_legend_title', lang)}</h5>\n            <ul className=\"color-legend\">\n              <li>\n                {translate('viz-principale-partie-3', 'network_legend_color_title', lang)}\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.dark }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  {translate('viz-principale-partie-3', 'network_legend_color_1', lang)}\n                </span>\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.accent2 }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  {translate('viz-principale-partie-3', 'network_legend_color_2', lang)}\n                </span>\n              </li>\n            </ul>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: width * .7,\n            height: height * .3,\n            // marginBottom: '2rem'\n          }}>\n            <BarChart\n              data={datasets['part_3_centralite_comparaison/part_3_centralite_comparaison.csv']}\n              title={translate('viz-principale-partie-3', 'barchart_title', lang)}\n              width={width * .7}\n              height={height * .3}\n              orientation={'vertical'}\n              layout={'groups'}\n              y={{\n                field: 'port',\n                title: translate('viz-principale-partie-3', 'barchart_y', lang),\n              }}\n              x={{\n                field: 'score',\n                title: translate('viz-principale-partie-3', 'barchart_x', lang),\n                // tickSpan: .1,\n                // tickFormat: (d, i) => parseInt(d * 100) + '%'\n              }}\n              color={{\n                field: 'metrics_type',\n                title: translate('viz-principale-partie-3', 'barchart_color', lang),\n                palette: {\n                  'PageRank': colorPalettes.generic.dark,\n                  'betweenness centrality': colorPalettes.generic.accent1,\n                }\n              }}\n              margins={{\n                bottom: 40\n              }}\n              tooltip={d => d.metrics_type === 'PageRank' ? translate('viz-principale-partie-3', 'barchart_toolip_pagerank', lang) : translate('viz-principale-partie-3', 'barchart_toolip_nopagerank', lang)}\n            />\n          </div>\n        </>\n  )\n}\n\nexport default Step2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\nimport { useState, useEffect } from 'react';\n\nimport GeographicMapChart from '../../components/GeographicMapChart/GeographicMapChart';\nimport { Step3Objects, SmallMultiples, renderTriangles } from './renderObjectsFunctions'; // pas sur que a reste  terme\n\nimport './PrincipalVisualizationPart3.scss';\nimport colorsPalettes from '../../colorPalettes.js';\nimport Step2 from './Step2';\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate';\n\n/**\n * Renders main viz #3\n * @param {object} datasets\n * @param {number} step - scrollytelling step\n * @param {number} width\n * @param {number} height\n * @param {boolean} atlasMode\n * @returns {React.ReactElement} - React component\n */\nconst PrincipalVisualizationPart3 = ({ \n  datasets, \n  step, \n  width: inputWidth, \n  height: inputHeight, \n  atlasMode,\n  lang\n}) => {\n  const width = fixSvgDimension(inputWidth);\n  const height = atlasMode ? window.innerHeight : fixSvgDimension(inputHeight);\n  const [currentMapTemplate, setCurrentMapTemplate] = useState('France');\n  useEffect(() => {\n    setTimeout(() => {\n      switch (step) {\n        case 1:\n          setCurrentMapTemplate('rotated Poitou');\n          break;\n        case 3:\n          setCurrentMapTemplate('Poitou zoomed');\n          break;\n        default:\n          break;\n      }\n    })\n  }, [step])\n  return (\n    <div className={cx(\"PrincipalVisualizationPart3\", { 'is-atlas-mode': atlasMode })} style={{ height: atlasMode ? undefined : height }}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        <GeographicMapChart\n          title={translate('viz-principale-partie-3', 'GeographicMapChart_title', lang)}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],\n              animated: true\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: () => (\n                <>\n                  <rect\n                    x={0}\n                    y={0}\n                    width={width}\n                    height={height / 8}\n                    fill={`url(#radial-bg-${atlasMode})`}\n                  />\n                  <defs>\n                    <linearGradient id={`radial-bg-${atlasMode}`} gradientTransform=\"rotate(90)\">\n                      <stop offset=\"10%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} />\n                      <stop offset=\"100%\" stopColor={atlasMode ? 'white' : colorsPalettes.ui.colorBackgroundBlue} stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                </>\n              )\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data/part_3_step1_viz_data.csv'],\n              renderObjects: props => renderTriangles({...props, atlasMode, lang})\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'rotated Poitou' : currentMapTemplate}\n          height={atlasMode ? window.innerHeight * .9 : height}\n          width={width}\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })} style={{ height }}>\n        <Step2\n          lang={lang}\n          {\n          ...{\n            width,\n            height,\n            datasets,\n          }\n          }\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],\n              color: {\n                field: 'shortname'\n              },\n              animated: true,\n            },\n            {\n              type: 'custom',\n              data: {\n                customsOffices: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv']\n              .filter(d => \n                d.customs_region === 'La Rochelle' \n                && d.name !== 'undefined customs office'\n                && !d.name.includes('Bouin')\n                ),\n                ports: datasets['part_3_step3_viz_ports_data/part_3_step3_viz_ports_data.csv']\n              },\n              renderObjects: Step3Objects // besoin de montrer les labels des bureaux et ports => modifier la fonction\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n              renderObjects: SmallMultiples\n            }\n          ]}\n          projectionTemplate={atlasMode ? 'Poitou zoomed' : currentMapTemplate}\n          height={height}\n          width={width}\n          title={translate('viz-principale-partie-3', 'GeographicMapChart_second_title', lang)}\n        />\n\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","import cx from 'classnames';\nimport GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\";\nimport { useSpring, animated } from 'react-spring'\n\nimport { useEffect, useState } from 'react';\nimport './IntroBureaux.scss';\n\nimport colorPalettes from \"../../colorPalettes\";\nimport { fixSvgDimension } from '../../helpers/misc';\n\nimport translate from '../../i18n/translate';\n\nconst BureauBackground = ({\n  projection,\n  atlasMode,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <animated.circle\n        r={radius * 2}\n        cx={0}\n        cy={0}\n        fill={`url(#bureau-${index})`}\n      />\n      <radialGradient id={`bureau-${index}`}>\n        <stop offset={atlasMode ? '0%' : \"20%\"} stopColor={colorPalettes.customs_office[datum.name]} />\n        <stop offset=\"100%\" stopColor={atlasMode ? \"rgba(255,255,255,0)\" : \"rgba(51,109,124,0)\"} />\n      </radialGradient>\n    </animated.g>\n  )\n}\n\nconst BureauLabel = ({\n  projection,\n  height,\n  datum,\n  width,\n  index,\n  radius\n}) => {\n  const [x, y] = projection([+datum.longitude, +datum.latitude]);\n  const labelOnRight = ['La Rochelle', 'Tonnay-Charente'].includes(datum.name);\n  const thatWidth = fixSvgDimension(datum.name.length * width * height * .0005);\n\n  const [isInited, setIsInited] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setIsInited(true)\n    })\n  }, [])\n\n  const {transform} = useSpring({ \n    to: {\n      transform: `translate(${x}, ${y})` \n    },\n    immediate: !isInited\n  });\n  return (\n    <animated.g transform={transform}>\n      <circle\n        r={2}\n        cx={0}\n        cy={0}\n        fill={'white'}\n      />\n      <foreignObject\n        x={labelOnRight ? radius / 2 : -radius / 2 - thatWidth}\n        y={-height / 70}\n        fill=\"white\"\n        width={thatWidth}\n        height={height / 20}\n        className={cx(\"bureau-label\", {\n          'is-reversed': !labelOnRight\n        })}\n      >\n        <span xmlns=\"http://www.w3.org/1999/xhtml\">\n          {datum.name}\n        </span>\n      </foreignObject>\n    </animated.g>\n  )\n}\n\nconst renderBureaux = ({ data, projection, width, height, atlasMode }) => {\n  const radius = width * height * 0.00006;\n\n  return (\n    <g className={cx(\"IntroBureaux\", {'is-atlas-mode': atlasMode})}>\n      \n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauBackground\n              key={index}\n              {\n              ...{\n                projection,\n                atlasMode,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n      {\n        data\n          .filter(d => !isNaN(+d.latitude) && colorPalettes.customs_office[d.name])\n          .map((datum, index) => (\n            <BureauLabel\n              key={index}\n              {\n              ...{\n                projection,\n                height,\n                datum,\n                width,\n                index,\n                radius\n              }\n              }\n            />\n          ))\n      }\n    </g>\n  )\n}\n\n/**\n * Displays a basic visualization of bureaux des fermes with fancy blurry gradient backgrounds on points\n * @param {object} datasets\n * @param {boolean} atlasMode\n * @param {object} dimensions\n * @returns {React.ReactElement} - React component\n */\nconst IntroBureaux = ({\n  datasets,\n  atlasMode,\n  dimensions,\n  lang\n}) => {\n  return (\n    <GeographicMapChart\n      title={translate('intro-bureaux', 'title', lang)}\n      layers={[\n        {\n          type: 'choropleth',\n          data: datasets['map_backgrounds/map_france_1789.geojson'],\n          reverseColors: atlasMode ? false : true,\n          // color:{\n          //   field: 'shortname',\n          //   palette: colorPalettes.provinces\n          // }\n        },\n        {\n          type: 'custom',\n          data: datasets['part_3_step3_viz_customs_offices_data/part_3_step3_viz_customs_offices_data.csv'],\n          renderObjects: props => renderBureaux({...props, atlasMode})\n        }\n      ]}\n      projectionTemplate='Poitou'\n      width={fixSvgDimension(dimensions.width)}\n      height={atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height)}\n    />\n  )\n}\n\nexport default IntroBureaux;","import IntroBureaux from './IntroBureaux';\n\nexport default IntroBureaux;","import GeographicMapChart from \"../../components/GeographicMapChart/GeographicMapChart\"\nimport { fixSvgDimension } from \"../../helpers/misc\";\n\nimport translate from \"../../i18n/translate\";\n\nimport './HomeportFlows.scss';\n\n/**\n * Displays the homport flows vis (multiple flow maps)\n * @param {object} datasets\n * @param {boolean} atlasMode\n * @param {object} dimensions\n * @returns {React.ReactElement} - React component\n */\nconst HomeportFlows = ({\n  datasets,\n  atlasMode,\n  dimensions,\n  lang\n}) => {\n  const totalHeight = atlasMode ? window.innerHeight * .9 : fixSvgDimension(dimensions.height);\n  const hotFixedData = datasets['voyages-bateaux-homeport-larochelle-1787/voyages-bateaux-homeport-larochelle-1787.csv']\n  .map(datum => {\n    if (datum.port_dest.includes(`Cte d'Or`)) {\n      return {\n        ...datum,\n        latitude_dest: 5,\n        longitude_dest: -0.6107851\n      }\n    }\n    return datum;\n  })\n  return (\n    <div className=\"HomeportFlows\">\n      <div className=\"column\">\n        <GeographicMapChart\n          title={translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'title', lang)}\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData,\n              size: {\n                field: 'tonnages_cumuls',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category_' + lang,\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              },\n              hideOverflowingFlows: true\n            }\n          ]}\n          projectionTemplate={'coast from Nantes to Bordeaux'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          withLegend={'bottom left'}\n          legendLayerFilter={l => l.type === 'flows'}\n          height={totalHeight}\n        />\n      </div>\n      <div className=\"column\">\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_france_1789.geojson'], // currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category !== 'pasa'),\n              hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumuls',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category_' + lang,\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              }\n            },\n          ]}\n          projectionTemplate={'France'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n        <GeographicMapChart\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['map_backgrounds/map_world_1789.geojson'],// currentProjectionTemplate === 'World' ? datasets['map_world_1789.geojson'] : datasets['map_france_1789.geojson'],\n              reverseColors: atlasMode ? undefined : true,\n            },\n            {\n              type: 'flows',\n              data: hotFixedData.filter(d => d.port_dest_category === 'tranger'),\n              // hideOverflowingFlows: true,\n              size: {\n                field: 'tonnages_cumuls',\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'size', lang)\n              },\n              label: {\n                fields: ['port_dep', 'port_dest'],\n              },\n              color: {\n                field: 'category_' + lang,\n                title: translate('partie-2-carte-direction-bateaux-de-la-rochelle', 'color', lang)\n              }\n            },\n          ]}\n          projectionTemplate={'World'}\n          width={fixSvgDimension(dimensions.width / 2)}\n          height={totalHeight / 2}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default HomeportFlows","\nimport { useRef, useState, useEffect, useMemo, useContext } from 'react';\nimport {nest} from 'd3-collection';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\nimport {\n  treemap, \n  hierarchy, \n  // treemapResquarify,\n  treemapBinary,\n} from 'd3-hierarchy';\n\nimport { fixSvgDimension, generatePalette } from '../../helpers/misc';\nimport { SettingsContext } from '../../helpers/contexts';\n\nconst formatNestResults = (input) => {\n  if (Array.isArray(input)) {\n    return {\n      name: 'root',\n      children: input.map(formatNestResults)\n    }\n  } else if (input.key && input.values) {\n    return {\n      name: input.key,\n      children: input.values.map(formatNestResults)\n    }\n  } else return input;\n}\n\n\n\n/**\n * Returns a treemap visualization\n * @param {array<object>} data - tabular data\n * @param {array} fieldsHierarchy - array of fieldnames to use to build the nested hierarchy from tabular data\n * @param {string} title\n * @param {number} width\n * @param {number} height\n * @param {object} leaf - parameters for computing leafs in the form {labelField: [string], countField: [string]}\n * @param {object} color\n * @param {function} tooltip\n * @param {object} margins\n * @returns {React.ReactElement} - React component\n */\nconst TreemapChart = ({\n  data,\n  fieldsHierarchy = [],\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  leaf: {\n    labelField,\n    countField,\n  },\n  color,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = fixSvgDimension(initialWidth - legendWidth - 10);\n  const height = fixSvgDimension(initialHeight - headersHeight);\n\n\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const root = useMemo(() => {\n    const res = nest()\n    fieldsHierarchy.forEach((field) => {\n      res.key((d) => d[field])\n    })\n    \n    const visData = formatNestResults(res.entries(data))\n    const result = hierarchy(visData).sum(d => +d[countField]);\n    treemap()\n    .size([width, height])\n    .tile(treemapBinary)\n    .round(true)\n    (result);\n    return result;\n  }, [data, fieldsHierarchy, width, height, countField])\n\n\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n    // return () => {\n    //   setHeadersHeight(0);\n    //   setLegendWidth(0);\n    // };\n  }, [width, height, color, data])\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n  \n\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n\n  const { lang } = useContext(SettingsContext);\n  const legendTitle = lang === 'fr' ? 'Lgende' : 'Legend';\n\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"TreemapChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" >{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            {\n              root.leaves().map((datum, datumIndex) => {\n                const {x0, y0, x1, y1} = datum;\n                const rectWidth = x1 - x0;\n                const rectHeight = y1 - y0;\n                const labelText = `${datum.data[labelField]} (${datum.data[countField]})`;\n                const fontSize = rectWidth / labelText.length * 1.5\n                // const labelWidth = window.innerWidth * 0.003 * labelText.length;\n                return (\n                  <g \n                    key={`${x0}-${y0}`} \n                    transform={`translate(${x0},${y0})`}\n                    data-for=\"treemap-tooltip\"\n                    data-tip={tooltip ? tooltip(datum.data) : undefined}\n                  >\n                    <rect\n                      stroke=\"white\"\n                      x={0}\n                      y={0}\n                      width={rectWidth}\n                      height={rectHeight}\n                      fill={colorPalette[datum.data[color.field]]}\n                    />\n                    {\n                      rectHeight > fontSize ?\n                        <text\n                          x={rectWidth/2}\n                          y={rectHeight / 2 + 5}\n                          style={{\n                            fontSize\n                          }}\n                          textAnchor=\"middle\"\n                        >\n                          {labelText}\n                        </text>\n                      : null\n                    }\n                  </g>\n                )\n              })\n            }\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || legendTitle}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"treemap-tooltip\" />\n    </>\n  )\n}\nexport default TreemapChart;","// @TODO : colorLegends et titres  mettre en place pour cartes notamment\n// @TODO : faire une passe sur visualizationList.json que j'ai rempli approximativement pour les vizs 'intro-provinces', 'intro-ports', et 'intro-bureaux'\n\nimport { useContext, useMemo } from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\nimport BarChart from '../components/BarChart';\nimport LineChart from '../components/LineChart';\nimport GeographicMapChart from '../components/GeographicMapChart/GeographicMapChart';\nimport colorPalettes from '../colorPalettes'\n\nimport {formatNumber} from '../helpers/misc'\nimport { DatasetsContext } from '../helpers/contexts';\nimport { SettingsContext } from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\nimport IntroBureaux from './IntroBureaux';\nimport HomeportFlows from './HomeportFlows/HomeportFlows';\nimport TreemapChart from '../components/TreemapChart/TreemapChart';\nimport { omit } from 'lodash';\nimport translate from '../i18n/translate';\n\n/**\n * This script is the bridge between visualization code, visualizations list, and visualization callers in contents.\n * It returns a visualization component depending on the provided id\n * @param {string} id\n * @param {object} dimensions\n * @param {object} - additional props\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationContainer = ({ \n  id, \n  dimensions: inputDimensions, \n  ...props \n}) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n\n  const hasData = Object.keys(relevantDatasets || {}).length && !Object.entries(relevantDatasets).find(([id, payload]) => !payload);\n  if (!hasData) {\n    // console.log('no data for ', id, 'looked for', visualizationsList.find(v => v.id === id))\n    return null;\n  }\n  switch (id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return (\n        <SettingsContext.Provider value={{ lang: props.lang }}>\n          <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />\n        </SettingsContext.Provider>\n      );\n    case 'partie-1-produits-importants-pour-la-rochelle':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              .sort((a, b) => {\n                if (+a.order > +b.order) {\n                  return 1;\n                }\n                return -1;\n              })\n              .slice(0, 20)\n          }\n          title={translate('partie-1-produits-importants-pour-la-rochelle', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n          orientation={'vertical'}\n          layout={'groups'}\n          y={{\n            field: 'product_' + props.lang,\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'y', props.lang),\n          }}\n          x={{\n            field: 'value_rel_per_direction',\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'x', props.lang),\n            tickSpan: .1,\n            tickFormat: (d, i) => parseInt(d * 100) + '%'\n          }}\n          color={{\n            field: 'entity_' + props.lang,\n            title: translate('partie-1-produits-importants-pour-la-rochelle', 'color', props.lang),\n            palette: {\n              [props.lang === 'fr' ? 'direction des fermes de La Rochelle' : 'direction des fermes of La Rochelle']: '#00C4AF',\n              [props.lang === 'fr' ? 'France (moyenne)' : 'France (mean)']: '#FEA43B'\n            }\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => translate('partie-1-produits-importants-pour-la-rochelle', 'tooltip', props.lang, { product: d.product, value: (d.value_rel_per_direction * 100).toFixed(2), entite: d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle' })}\n        />\n      )\n    case 'partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height * .5}\n          orientation={'horizontal'}\n          layout={'stack'}\n          y={{\n            field: 'portion',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'y', props.lang),\n            tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'year',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'x', props.lang),\n            fillGaps: true,\n            tickSpan: 5,\n            // tickFormat: d => d%10 === 0 ? d : undefined\n          }}\n          color={{\n            field: 'type',\n            title: translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'color', props.lang)\n          }}\n          margins={{\n            left: 140,\n            right: 20,\n            bottom: 30\n          }}\n          tooltip={d =>translate('partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie', 'tooltip', props.lang, { year: d.year, direction: d.type === 'import' ? 'import' : 'export', value: (+d.portion * 100).toFixed(2), type: d.type === 'import' ? 'imports' : 'exports' })}\n        />\n      )\n    case 'sorties-de-sel':\n      console.log(relevantDatasets[Object.keys(relevantDatasets)[0]])\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('sorties-de-sel', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'port',\n            title: translate('sorties-de-sel', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            title: translate('sorties-de-sel', 'x', props.lang),\n            field: 'tonnage',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('sorties-de-sel', 'y', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls })}\n        />\n      )\n    case 'sorties-de-marennes':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('sorties-de-marennes', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height / 2}\n          orientation={'vertical'}\n          y={{\n            field: props.lang === 'fr' ? 'country' : 'country_en',\n            title: translate('sorties-de-marennes', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: translate('sorties-de-marennes', 'x', props.lang),\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('sorties-de-marennes', 'tooltip', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls, country: d.country })}\n        />\n      )\n    case 'partie-1-pays-port-d-attache':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('partie-1-pays-port-d-attache', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'country_' + props.lang,\n            title: translate('partie-1-pays-port-d-attache', 'y', props.lang),\n            sort: {\n              field: 'tonnage',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'tonnage',\n            title: translate('partie-1-pays-port-d-attache', 'x', props.lang),\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${formatNumber(d)} tx`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => translate('partie-1-pays-port-d-attache', 'tooltip', props.lang, { tonnage: d.tonnage, number: d.nb_pointcalls })}\n        />\n      )\n    case 'partie-3-comparaison-exports-coloniaux':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title={translate('partie-3-comparaison-exports-coloniaux', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height * .5}\n          orientation={'vertical'}\n          layout={'grouped'}\n          y={{\n            field: 'customs_office',\n            title: translate('partie-3-comparaison-exports-coloniaux', 'y', props.lang),\n            // tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'value',\n            title: translate('partie-3-comparaison-exports-coloniaux', 'x', props.lang),\n            tickSpan: 1000000,\n            domain: [0, 6000000],\n            tickFormat: d => formatNumber(d) + ' lt'\n          }}\n          color={{\n            field: 'type_' + props.lang,\n            title: translate('partie-3-comparaison-exports-coloniaux', 'color', props.lang)\n          }}\n          margins={{\n            left: 140,\n            right: 50,\n          }}\n          tooltip={d => translate('partie-3-comparaison-exports-coloniaux', 'tooltip', props.lang, { customs_office: d.customs_office, value: d.value, type: d.type })}\n        />\n      )\n    case 'intro-provinces':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('intro-provinces', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                color: {\n                  field: 'shortname',\n                  palette: colorPalettes.provinces\n                },\n                tooltip: (d) => {\n                  return d.properties.shortname\n                }\n              }\n            ]}\n            projectionTemplate='France'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n          />\n        </>\n      )\n    case 'sorties-de-marennes-avec-sel-destinations':\n      return (\n        <div>\n          <div style={{borderBottom: '2px solid #333'}}>\n            <GeographicMapChart\n              title={translate('sorties-de-marennes-avec-sel-destinations', 'title', props.lang)}\n              layers={[\n                {\n                  type: 'choropleth',\n                  data: datasets['map_backgrounds/map_france_1789.geojson']\n                },\n                {\n                  type: 'points',\n                  data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country === 'France'),\n                  // color: {\n                  //   field: 'country',\n                  //   title: 'Pays',\n                  //   palette: colorPalettes.franceAlone\n                  // },\n                  size: {\n                    field: 'tonnage',\n                    title: translate('sorties-de-marennes-avec-sel-destinations', 'size', props.lang),\n                    // custom: '20'\n                  },\n                  tooltip: d => translate('sorties-de-marennes-avec-sel-destinations', 'tooltip', props.lang, { raw_size: d.rawSize, label : d.label}),\n                  label: {\n                    field: 'port',\n                    position: 'left'\n                  },\n                  stackLabels: true\n                }\n              ]}\n              projectionTemplate='France'\n              width={dimensions.width}\n              height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n            />\n          </div>\n          <GeographicMapChart\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_world_1789.geojson']\n              },\n              {\n                type: 'points',\n                data: datasets['sorties-de-marennes-avec-sel-destinations/sorties-de-marennes-avec-sel-destinations.csv'].filter(d => d.country !== 'France'),\n                // color: {\n                //   field: 'country',\n                //   title: 'Pays',\n                //   // labelsColor: props.atlasMode ? undefined : 'white'\n                // },\n                size: {\n                  field: 'tonnage',\n                  title: translate('sorties-de-marennes-avec-sel-destinations', 'size', props.lang),\n                  // custom: '20'\n                },\n                tooltip: d => translate('sorties-de-marennes-avec-sel-destinations', 'tooltip', props.lang, { rawSize: d.rawSize, label : d.label}),\n                label: {\n                  field: 'port',\n                },\n                stackLabels: true\n              }\n            ]}\n            projectionTemplate='World'\n            projectionConfig={{\n              scale: (props.atlasMode ? window.innerHeight : dimensions.height) * .8,\n              centerY:  45,\n              centerX: -30\n            }}\n            width={dimensions.width}\n            withLegend={'bottom right'}\n            height={props.atlasMode ? window.innerHeight * .4 : dimensions.height / 2}\n          />\n        </div>\n      )\n    case 'intro-ports':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('intro-ports', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['ports_locations_data_intro/ports_locations_data_intro.csv'],\n                color: {\n                  field: 'province',\n                  title: translate('intro-ports', 'color', props.lang),\n                  palette: omit(colorPalettes.provinces, ['Angoumois']),\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'nb_pointcalls',\n                  title: translate('intro-ports', 'size', props.lang),\n                  // custom: '20'\n                },\n                tooltip: d => translate('intro-ports', 'tooltip', props.lang, { rawSize: d.rawSize, label: d.label }),\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      )\n    case 'intro-bureaux':\n      // console.log(\"heyyyyyy bureaux map\");\n      return (\n        <IntroBureaux\n          lang={props.lang}\n          {\n            ...{\n              datasets,\n              atlasMode: props.atlasMode,\n              dimensions\n            }\n          }\n        />\n      )\n    case 'partie-2-part-navigation-francaise':\n      return (\n        <>\n          <GeographicMapChart\n            title={translate('partie-2-part-navigation-francaise', 'title', props.lang)}\n            layers={[\n              {\n                type: 'choropleth',\n                data: datasets['map_backgrounds/map_france_1789.geojson'],\n                reverseColors: props.atlasMode ? undefined : true,\n                // color:{\n                //   field: 'shortname',\n                //   palette: colorPalettes.provinces\n                // }\n              },\n              {\n                type: 'points',\n                data: datasets['part_navigation_fr/part_navigation_fr.csv'],\n                color: {\n                  field: props.lang === 'fr' ? 'tonnage_part_of_french' : 'tonnage_part_of_french_en',\n                  title: translate('partie-2-part-navigation-francaise', 'color', props.lang),\n                  palette: props.lang === 'fr' ? colorPalettes.tonnageClasses : colorPalettes.tonnageClassesEn,\n                  labelsColor: props.atlasMode ? undefined : 'white'\n                },\n                size: {\n                  field: 'tonnage',\n                  title: translate('partie-2-part-navigation-francaise', 'size', props.lang),\n                  displayMetric: true,\n                  // custom: '20'\n                },\n                // tooltip: d => `${d.rawSize} mouvements de bateaux ont t enregistrs par le port de ${d.label} en 1789`,\n                label: {\n                  field: 'port',\n                  position: 'left'\n                },\n                stackLabels: true\n              }]}\n            projectionTemplate='Poitou'\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .9 : dimensions.height}\n            withLegend={'top right'}\n\n          />\n        </>\n      );\n    case 'partie-2-carte-direction-bateaux-de-la-rochelle':\n      // voyages-bateaux-homeport-larochelle-1787.csv\n      return (\n        <HomeportFlows\n        lang={props.lang}\n        {\n          ...{\n            datasets,\n            atlasMode: props.atlasMode,\n            dimensions,\n          }\n        }\n        />\n      );\n    case 'partie-1-ports-dattache':\n      // console.log(datasets['hierarchie_ports_dattache_des_navires_partant_de_la_region/hierarchie_ports_dattache_des_navires_partant_de_la_region.csv'])\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_ports_dattache_des_navires_partant_de_la_region/hierarchie_ports_dattache_des_navires_partant_de_la_region.csv'],\n            title: translate('partie-1-ports-dattache', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => translate('partie-1-ports-dattache', 'tooltip', props.lang, { \n              tonnage: formatNumber(d.tonnage), \n              homeport: d[`homeport_${props.lang}`], \n              category: props.lang === 'fr' ? d.category_2 : d.category_2_en \n            }),\n            fieldsHierarchy: ['country_group', 'category_1', 'category_2', 'ports'],\n            color: {\n              field: props.lang === 'fr' ? 'category_2' : 'category_2_en',\n              palette: props.lang === 'fr' ? colorPalettes.portsTreemaps :  colorPalettes.portsTreemapsEn\n            },\n            leaf: {\n              labelField: 'homeport_' + props.lang,\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      )\n    case 'partie-1-ports-destinations':\n      const thatPalette = {\n        ...(props.lang === 'fr' ? colorPalettes.portsTreemaps : colorPalettes.portsTreemapsEn)\n      }\n      delete thatPalette['France (rgion PASA)'];\n      delete thatPalette['France (hors rgion PASA)'];\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region/hierarchie_destinations_des_navires_partant_de_la_region.csv'],\n            title: translate('partie-1-ports-destinations', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            tooltip: d => translate('partie-1-ports-destinations', 'tooltip', props.lang, { tonnage: d.tonnage, homeport: props.lang === 'fr' ? d.homeport : d.homeport_en, category: props.lang === 'fr' ? d.category_2 : d.category_2_en }),\n            fieldsHierarchy: props.lang === 'fr' ? ['country_group', 'category_1', 'category_2', 'ports'] : ['country_group_en', 'category_1_en', 'category_2_en', 'ports'],\n            color: {\n              field: props.lang === 'fr' ? 'category_2' : 'category_2_en',\n              palette: thatPalette\n            },\n            leaf: {\n              labelField: props.lang === 'fr' ? 'port' : 'port_en',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'exports-eau-de-vie-la-rochelle-longitudinal':\n      return (\n      <LineChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              // .sort((a, b) => {\n              //   if (+a.order > +b.order) {\n              //     return 1;\n              //   }\n              //   return -1;\n              // })\n              // .slice(0, 20)\n          }\n          title={translate('exports-eau-de-vie-la-rochelle-longitudinal', 'title', props.lang)}\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n          orientation={'horizontal'}\n          // layout={'groups'}\n          y={{\n            field: 'value',\n            title: translate('exports-eau-de-vie-la-rochelle-longitudinal', 'y', props.lang),\n            tickFormat: d => formatNumber(d) + ' lt'\n          }}\n          x={{\n            field: 'year',\n            title: translate('exports-eau-de-vie-la-rochelle-longitudinal', 'x', props.lang),\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => translate('exports-eau-de-vie-la-rochelle-longitudinal', 'y', props.lang, { year: d.year, value: d.value })}\n        />\n      );\n    case 'exports-eau-de-vie-comparaison-directions-des-fermes':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n                // .sort((a, b) => {\n                //   if (+a.order > +b.order) {\n                //     return 1;\n                //   }\n                //   return -1;\n                // })\n                // .slice(0, 20)\n            }\n            title={translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'title', props.lang)}\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'year',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'y', props.lang),\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'x', props.lang),\n              tickSpan: 1000000,\n              tickFormat: d => formatNumber(d) + ' lt'\n            }}\n            color={{\n              field: 'customs_region',\n              title: translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'color', props.lang)\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => translate('exports-eau-de-vie-comparaison-directions-des-fermes', 'tooltip', props.lang, { year: d.year, customsRegion: d.customs_region, value: parseInt(d.value) })}\n          />\n        );\n    case 'origines-exports-eau-de-vie-1789-la-rochelle':\n      return (\n        <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n            }\n            title={translate('origines-exports-eau-de-vie-1789-la-rochelle', 'title', props.lang)}\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight / 2 : dimensions.height / 2}\n            orientation={'vertical'}\n            layout={'groups'}\n            y={{\n              field: 'origin',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'y', props.lang),\n              // tickFormat: d => d + ' lt'\n            }}\n            x={{\n              field: 'value',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'x', props.lang),\n              tickFormat: d => formatNumber(d / 100) + ' lt'\n            }}\n            color={{\n              field: 'type',\n              title: translate('origines-exports-eau-de-vie-1789-la-rochelle', 'color', props.lang),\n            }}\n            margins={{\n              left: 140,\n              right: 50\n            }}\n            tooltip={d => translate('origines-exports-eau-de-vie-1789-la-rochelle', 'tooltip', props.lang, { value: parseInt(d.value), type: d.type, origin: d.origin })}\n          />\n        );\n    case 'partie-1-ports-dattache-vers-etranger':\n      return (\n        <TreemapChart\n        {\n          ...{\n            data: datasets['hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger/hierarchie_destinations_des_navires_partant_de_la_region_vers_letranger.csv'],\n            title: translate('partie-1-ports-dattache-vers-etranger', 'title', props.lang),\n            width: dimensions.width,\n            height: props.atlasMode ? window.innerHeight * .8 : dimensions.height * .8,\n            // tooltip: d => `En 1789, ${d.tonnage} tonneaux cumuls sortis de la rgion PASA taient rattachs au port de ${d.homeport} - ${d.category_2}.`,\n            tooltip: d => translate('partie-1-ports-dattache-vers-etranger', 'tooltip', props.lang, { tonnage: d.tonnage, homeport: props.lang === 'fr' ? d.homeport : d.homeport_en, category: props.lang === 'fr' ? d.category_2 : d.category_2_en }),\n            fieldsHierarchy: props.lang === 'fr' ? ['country_group', 'category_1', 'category_2', 'homeport'] : ['country_group_en', 'category_1_en', 'category_2_en', 'homeport'],\n            color: {\n              field: props.lang === 'fr' ? 'category_2' : 'category_2_en',\n              palette: props.lang === 'fr' ? colorPalettes.portsTreemaps : colorPalettes.portsTreemapsEn\n            },\n            leaf: {\n              labelField:props.lang === 'fr' ? 'homeport' : 'homeport_en',\n              countField: 'tonnage'\n            }\n          }\n        }\n        />\n      );\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\n/**\n * Controller preparing a given visualization for rendering (cleaning props, providing dimensions)\n * @param {object} activeVisualization - JSON data about the visualization to display\n * @param {string} lang\n * @param {boolean} atlasMode\n * @param {boolean} screenshotMode\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationController = ({\n  activeVisualization,\n  lang,\n  atlasMode,\n  screenshotMode\n}) => {\n  const [dimensions, setDimensions] = useState({\n    width: 1000,\n    height: 1000\n  });\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer \n                lang={lang} \n                screenshotMode={screenshotMode} \n                atlasMode={atlasMode} \n                id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} \n                {...visProps} \n                dimensions={dimensions} \n              />\n            </>\n            : null // <div>Pas de visualisation  afficher</div>\n          }\n  \n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import { useState, useRef, useEffect } from 'react';\nimport { homepage } from '../../../package.json';\nimport copy from 'copy-to-clipboard';\nimport VisualizationController from '../VisualizationController/VisualizationController.js';\nimport Md from 'react-markdown';\n\nimport './VisualizationFocus.scss';\n\n\n/**\n * Displays an overlay with a visualization and its meta and descriptions in a 2-to-1 columns layout\n * @param {object} visualization - JSON data about the visualization to display\n * @param {string} lang\n * @param {function} onClose\n * @returns {React.ReactElement} - React component\n */\nconst VisualizationFocus = ({ \n  visualization, \n  lang, \n  onClose \n}) => {\n\n  const [copyClicked, setCopyClicked] = useState(false);\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    if (inputRef && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [visualization])\n  let howDone, howRead;\n  if (visualization) {\n    howDone = visualization[`comment_cest_fait_${lang}`];\n    howRead = visualization[`comment_lire_${lang}`];\n  }\n\n  const messages = {\n    howDone: {\n      fr: 'Comment les donnes et la visualisation ont-elles t produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    },\n    copyLink: {\n      fr: 'copier le lien de cette visualisation',\n      en: 'copy this visualization link'\n    },\n    linkCopied: {\n      fr: 'lien copi dans le presse-papier !',\n      en: 'link copied in the clipboard !'\n    }\n  }\n\n  const handleCopyClick = (e) => {\n    e.stopPropagation();\n    const url = `${homepage}/${lang}/atlas/${visualization.id}`;\n    setCopyClicked(true);\n    copy(url);\n    setTimeout(() => setCopyClicked(false), 5000);\n  }\n  const handleKeyUp = (e) => {\n    // on press escape\n    if (e.keyCode === 27 && visualization) {\n      onClose();\n    }\n  }\n  // handle click on wrapper (and wrapper only - not children)\n  const handleWrapperClick = e => {\n    if (e.target.className === 'visualization-wrapper') {\n      onClose();\n    }\n  }\n  return (\n    <div className={`VisualizationFocus ${visualization ? 'is-visible' : 'is-hidden'}`}>\n      <input style={{ opacity: 0, zIndex: -10, 'pointerEvents': 'none' }} type=\"text\" onKeyUp={handleKeyUp} ref={inputRef} />\n      <div onClick={onClose} className=\"lightbox-background\" />\n      {\n        visualization ?\n          <div className=\"lightbox-contents-container\">\n            <div className=\"lightbox-contents\">\n\n              <div className=\"visualization-details\">\n                <div className=\"details-header\">\n                  <h2>{visualization[`titre_${lang}`]}</h2>\n                  <button className=\"close-btn\" onClick={onClose}>\n                    \n                  </button>\n                </div>\n                <div className=\"copy-link-container\">\n                  <button onClick={handleCopyClick}>{copyClicked ? messages.linkCopied[lang] : messages.copyLink[lang]}</button>\n                </div>\n                <div className=\"details-contents\">\n                  {\n                    howDone && howDone.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howDone[lang]}</h3>\n                        <Md>\n                          {howDone.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                  {\n                    howRead && howRead.length ?\n                      <section className=\"details-contents-section\">\n                        <h3>{messages.howRead[lang]}</h3>\n                        <Md>\n                          {howRead.replace(/<br\\/>/g, '\\n\\n')}\n                        </Md>\n                      </section>\n                      : null\n                  }\n                </div>\n              </div>\n              <div className=\"visualization-wrapper\" onClick={handleWrapperClick}>\n                <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n              </div>\n            </div>\n          </div>\n          : null\n      }\n\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import VisualizationFocus from './VisualizationFocus';\n\nexport default VisualizationFocus;","import { useState, useReducer, useEffect, useRef } from 'react';\nimport { Helmet } from \"react-helmet\";\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport VisualizationFocus from '../../components/VisualizationFocus';\nimport { VisualizationControlContext } from '../../helpers/contexts';\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport visualizations from '../../visualizationsList';\n\nimport './ScrollyPage.scss';\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  // mobile mode: focus on text or on viz\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  // whether to open the active viz in \"atlas mode\"\n  const [visualizationIsFullScreen, setVisualizationIsFullScreen] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const updateCurrentVisualization = () => {\n    if (visualizationIsFullScreen) {\n      return;\n    } \n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const y = scrollY + DISPLACE_Y;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n    const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n    if (y > sectionEnd) {\n      if (activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n      return;\n    }\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      }\n    }\n    if (scrollY === 0 && visualizationEntries.length) {\n      setActiveVisualization(visualizationEntries[0][1])\n    }\n    else if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n        <section ref={sectionRef} className={cx({ 'is-focused': !focusOnViz })}>\n          <ContentSync />\n        </section>\n        <aside className={cx({ 'is-focused': focusOnViz })}>\n          <VisualizationController lang={lang} activeVisualization={activeVisualization} />\n          {\n            activeVisualization ?\n              <div className=\"fullscreen-viz-toggle-container\">\n                <button\n                  data-for=\"contents-tooltip\"\n                  data-tip={lang === 'fr' ? \"plus d'informations sur cette visualisation\" : 'More information about this visualization'}\n                  onClick={() => {\n                    setIsLoading(true);\n                    setTimeout(() => {\n                      setVisualizationIsFullScreen(true);\n                      setIsLoading(false);\n                    }, 100)\n                  }}\n                >\n                  <span>+</span>\n                </button>\n              </div>\n              : null\n          }\n        </aside>\n        <VisualizationFocus\n          visualization={visualizationIsFullScreen && activeVisualization ? visualizationsMap[activeVisualization.visualizationId] : undefined}\n          lang={lang}\n          onClose={() => {\n            setVisualizationIsFullScreen(false);\n          }}\n        />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n        })}>\n          <button \n            data-for=\"contents-tooltip\" \n            data-effect=\"solid\" \n            data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} \n            onClick={() => {\n              setFocusOnViz(!focusOnViz);\n            }}>\n            <span>{''}</span>\n          </button>\n        </div>\n        <ReactTooltip id=\"contents-tooltip\" />\n        <div className={cx(\"loader-indication-wrapper\", {'is-loading': isLoading})}>\n          <div className=\"loader-indication-container\">\n            {lang === 'fr' ? 'Chargement de la visualisation' : 'Loading visualization'}\n          </div>\n        </div>\n      </div>\n      \n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/a-propos.mdx';\n\nimport ReferencesFr from '!babel-loader!mdx-loader!./contents/fr/references.mdx';\nimport ReferencesEn from '!babel-loader!mdx-loader!./contents/en/references.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le dclin de la rgion de La Rochelle suite  la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le dclin de la rgion de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spcialisation portuaire: le cas de la traite ngrire, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spcialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'references',\n      en: 'references'\n    },\n    titles: {\n      fr: 'Rfrences',\n      en: 'References'\n    },\n    shortTitles: {\n      fr: 'rfrences',\n      en: 'references'\n    },\n    contents: {\n      fr: 'fr/references.mdx',\n      en: 'en/references.mdx'\n    },\n    contentsProcessed: {\n      fr: ReferencesFr,\n      en: ReferencesEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: ' propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: ' propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang = 'fr', summary }) {\n  const messages = {\n    intro: {\n      fr: 'dcouvrir les 3 chapitres de ltude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accder  l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .filter(item => item.routes[lang])\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        {/* @todo this is a react-snap trick that should be cleaned some day, removing it somehow breaks the pages building process */}\n        <Link to={navigator.userAgent === \"ReactSnap\" ? '/fr/atlas' : `/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport CitationWidget from '../../components/CitationWidget';\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nimport './Home.scss';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang = 'fr' }\n} }) {\n  const introRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const [inVis, setInVis] = useState(false);\n  const currentMetadata = metadata[lang] || metadataFr;\n  const title = currentMetadata.title;\n  const titleHTML = currentMetadata.titleHTML;\n  const subtitle = currentMetadata.subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    let newActiveVisualization;\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    let firstOneY = Infinity;\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (visY < firstOneY) {\n          firstOneY = visY;\n        }\n        if (index === 0 && y < visY) {\n          found = true;\n          newActiveVisualization = visualization;\n        } /*else if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          newActiveVisualization = undefined;\n          break;\n        }*/ else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            newActiveVisualization = visualization;\n          } else {\n            newActiveVisualization = undefined;\n          }\n          break;\n        }\n      } else {\n        // console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n\n    if (scrollY > window.innerHeight * .9 && !inVis) {\n      setInVis(true);\n    } else if (scrollY < window.innerHeight * .9 && inVis) {\n      setInVis(false);\n    }\n\n    if (!found && scrollY < firstOneY && visualizationEntries.length) {\n      newActiveVisualization = visualizationEntries[0][1]\n    }\n    if (!found && activeVisualization) {\n      newActiveVisualization = undefined;\n    }\n    if (activeVisualization !== !newActiveVisualization) {\n      setActiveVisualization(newActiveVisualization)\n    } else if ((!activeVisualization && newActiveVisualization) || activeVisualization.id !== newActiveVisualization.id) {\n      setActiveVisualization(newActiveVisualization)\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    const { y: initialVisY } = ref.current.getBoundingClientRect();\n    const visY = initialVisY + window.scrollY;\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const scrollTo = visY - DISPLACE_Y * .9;\n    window.scrollTo({\n      top: scrollTo,\n      behavior: 'smooth'\n    });\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <CitationWidget\n            lang={lang}\n          />\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n            <span></span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            \n            <section className={cx({'is-focused': !focusOnViz})}>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside className={cx({'is-focused': focusOnViz, 'is-fixed': inVis})}>\n              <VisualizationController lang={lang} activeVisualization={activeVisualization} />\n            </aside>\n            \n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n      </main>\n      <ReactTooltip id=\"contents-tooltip\" />\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la rgion Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from '../../components/VisualizationFocus/VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nimport './Atlas.scss';\n\n\nconst visualizationsMap = visualizations\n.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang = 'fr'\n    }\n  }\n}) {\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  const [isLoading, setIsLoading] = useState(false);\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className={cx(\"Atlas secondary-page\", {'has-focus': shownVisualization})}>\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>{lang === 'fr' ? 'Atlas des visualisations' : 'Visualizations atlas'}</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations\n            .map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                setIsLoading(true);\n                setTimeout(() => {\n                  history.push({\n                    pathname: `/${lang}/atlas/${visualization.id}`\n                  });\n                  setIsLoading(false);\n                }, 100)\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                      <img\n                        src={`${process.env.PUBLIC_URL}/thumbnails/${lang}/${visualization.id}.png`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n        <VisualizationFocus \n          visualization={shownVisualization} \n          lang={lang}\n          onClose={() => {\n            history.push({\n              pathname: `/${lang}/atlas/`\n            })\n          }}\n        />\n        <div className={cx(\"loader-indication-wrapper\", {'is-loading': isLoading})}>\n          <div className=\"loader-indication-container\">\n            {lang === 'fr' ? 'Chargement de la visualisation' : 'Loading visualization'}\n          </div>\n        </div>\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import StandaloneVisualization from './StandaloneVisualization';\n\nexport default StandaloneVisualization;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\nimport './StandaloneVisualization';\n\nimport visualizationsList from '../../visualizationsList.json';\nconst StandaloneVisualization = ({\n  id,\n  lang\n}) => {\n  const visualization = visualizationsList.find(({id: thatId}) => thatId === id)\n  return (\n    <div className=\"StandaloneVisualization\">\n      <VisualizationController lang={lang} atlasMode screenshotMode activeVisualization={visualization} />\n    </div>\n  )\n}\n\nexport default StandaloneVisualization;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import { Suspense } from 'react';\nimport { Helmet } from \"react-helmet\";\n\nimport { buildPageTitle } from '../../helpers/misc';\n\nimport './PlainPage.scss';\n\nconst PlainPage = ({\n  Content,\n  ContentSync,\n  title,\n  lang = 'fr',\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        {\n          ContentSync ?\n            <ContentSync />\n            :\n            <Suspense fallback={<div>Chargement</div>}>\n              <Content />\n            </Suspense>\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default PlainPage;","import React, { useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { NavLink as Link } from 'react-router-dom';\nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport { scaleLinear } from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\n/**\n * Displays header nav handling active link and background color change\n * @param {array<object>} routes\n * @param {function} onLangChange\n * @returns {React.ReactElement} - React component \n */\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/part')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n\n  const liveScrollY = useScrollYPosition();\n  const scrollY = useDebounce(liveScrollY, 50)\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const { fontColor, backgroundColor } = useMemo(() => {\n    const screenHeight = window.innerHeight;\n    switch (pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n\n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: colorBackground\n        }\n\n    }\n\n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                  :\n                  <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link to={`/${lang}/atlas`}>\n              {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n            </Link>\n          </li>\n          {\n            routes\n              .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n              .map(({ shortTitles, routes: inputRoute }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n              })\n          }\n          <li className=\"navitem-container lang-toggle\">\n            <button\n              className={lang === 'fr' ? 'is-active' : ''}\n              onClick={() => onLangChange('fr')}\n            >fr</button>\n          </li>\n          <li className=\"navitem-container lang-toggle\">\n            <button\n              className={lang === 'en' ? 'is-active' : ''}\n              onClick={() => onLangChange('en')}\n            >en</button>\n          </li>\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", { 'is-open': drawerIsOpen })}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n          <ul className=\"primary-nav-container\">\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link exact to={`/${lang}/`}>\n                {lang === 'fr' ? 'accueil' : 'home'}\n              </Link>\n            </li>\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'primary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n          </ul>\n          <ul className=\"secondary-nav-container\">\n            {\n              routes\n                .filter(({ routeGroup = 'primary', hide }) => routeGroup === 'secondary' && !hide)\n                .map(({ shortTitles, routes: inputRoute }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  return (\n                    <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                      <Link to={route}>\n                        {shortTitles[lang]}\n                      </Link>\n                    </li>\n                  )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n                <li className=\"navitem-container lang-toggle\">\n                  <ul className=\"lang-toggle-container\">\n                    <li>\n                      <button\n                        className={lang === 'fr' ? 'is-active' : ''}\n                        onClick={() => onLangChange('fr')}\n                      >fr</button>\n                    </li>\n                    <li>\n                      <button\n                        className={lang === 'en' ? 'is-active' : ''}\n                        onClick={() => onLangChange('en')}\n                      >en</button>\n                    </li>\n                  </ul>\n\n                </li>\n                :\n                null\n            }\n\n\n          </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img style={{ background: drawerIsOpen ? undefined : backgroundColor }} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n            }} dangerouslySetInnerHTML={{ __html: title }} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","import cx from 'classnames';\n\nimport './Loader.scss';\n\n/**\n * A basic full-size loader with loading bar\n * @param {number} percentsLoaded\n * @returns {React.ReactElement} - React component \n */\nconst Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className={cx(\"Loader\", {'is-complete': percentsLoaded === 100})}>\n      <div className=\"loader-container\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/en/footer.mdx';\n\n/**\n * Displays the footer from attached mdx contents\n * @param {string} lang\n * @returns {React.ReactElement} - React component\n */\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/**\n * Entrypoint of the application\n */\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n  Link,\n} from \"react-router-dom\";\nimport uniq from 'lodash/uniq';\nimport { csvParse, tsvParse } from 'd3-dsv';\nimport axios from 'axios';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\nimport StandaloneVisualization from \"./pages/StandaloneVisualization\";\nimport PlainPage from './pages/PlainPage';\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\nimport Footer from \"./components/Footer\";\n\n/* import utils */\nimport { DatasetsContext } from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport visualizationsList from './visualizationsList';\nimport { homepage } from '../package.json';\nimport routes from './summary';\n\nconst LANGUAGES = ['fr', 'en'];\n\n\n/**\n * General application container - handles routing logic, data retrieval, and lang toggle\n * @returns  {React.ReactElement} - React component\n */\nfunction App() {\n  const history = useHistory();\n  const location = useLocation();\n\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n  useEffect(() => {\n    // loading all datasets from the atlas\n    // note: it would be preferable to do this on a page-to-page basis if datasets happens to be too big/numerous\n    const datasetsNames = uniq(\n      visualizationsList\n        .filter(d => d.datasets)\n        .reduce(\n          (res, d) => [\n            ...res,\n            ...d.datasets.split(',').map(d => d.trim())],\n          [])\n    );\n    // console.groupCollapsed('loading data');\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          // console.info('get', url);\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              let status = progressEvent.loaded / progressEvent.total;\n              status = status > 1 ? 1 : status;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              // console.info(parseInt(globalFraction * 100) + '%')\n              setLoadingFraction(globalFraction + status / datasetsNames.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({ ...res, [datasetName]: loadedData })\n              })\n            })\n            // make get errors non-blocking to get all available datasets in the app even if some are broken\n            .catch(err => {\n              console.error(err);\n              return resolve(res);\n            })\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n      .then(newDatasets => {\n        // console.groupEnd('loading data');\n        setLoadingFraction(1);\n        setDatasets(newDatasets)\n      })\n      .catch(console.error)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    // @todo this is dirty, refactor this to be handled based on the routes config JSON ?\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n    lang,\n  }) => {\n    return (\n      <>\n        <ThatComponent\n          {\n          ...{\n            Content,\n            ContentSync,\n            title,\n            lang\n          }\n          }\n        />\n      </>\n\n    )\n  };\n  const currentLang = location.pathname.includes('/en/') ? 'en' : 'fr';\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        {\n          !location.pathname.includes('/visualization/') ?\n          <header>\n            <HeaderNav {...{ onLangChange, routes }} />\n          </header>\n          :\n          null\n        }\n        <main>\n          <Switch>\n            {// looping through the page\n              LANGUAGES.map(lang => {\n                return routes\n                  .map(({\n                    titles,\n                    routes: inputRoute,\n                    contents,\n                    Component: ThatComponent,\n                    contentsProcessed,\n                  }, index) => {\n                    const route = `/${lang}/page/${inputRoute[lang]}`\n                    const title = titles[lang];\n                    // @todo remove Content as it is not used anymore ? (importing md content with React.lazy did not play nice with scrollytelling-related features)\n                    const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                    const ContentSync = contentsProcessed[lang];\n                    return (\n                      <Route key={index} path={route} exact>\n                        {renderRoute({ Content, ThatComponent, title, ContentSync, lang })}\n                      </Route>\n                    )\n                  })\n              })\n            }\n            {\n              LANGUAGES.map(lang => {\n                return visualizationsList\n                  .map(({\n                    id\n                  }, index) => {\n                    const route = `/${lang}/visualization/${id}`;\n                    return (\n                      <Route key={index} path={route} exact component={() => <StandaloneVisualization {...{ id, lang }} />} />\n                    )\n                  })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/${currentLang}/`} />\n          </Switch>\n          <Loader percentsLoaded={loadingFraction * 100} />\n        </main>\n        {\n          !location.pathname.includes('/visualization/') ?\n          <Footer\n            lang={currentLang}\n          />\n          : null\n        }\n\n\n      </div>\n      {/* following react fragment is aimed at allowing react-snap to parse all the pages that have a dynamic URL */}\n      <React.Fragment>\n        {// looping through the pages to add a blank link to all of them\n          LANGUAGES.map(lang => {\n            return routes\n              // @todo this is dirty and should be removed at some point (test page is not exported in prod, so no need for react-snap)\n              .filter(({ routes }) => routes[lang] && !routes[lang].includes('test'))\n              .map(({\n                routes: inputRoute,\n              }, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n        {// looping through all the atlas visualizations links\n          LANGUAGES.map(lang => {\n            return visualizationsList\n              .map(({\n                id\n              }, index) => {\n                const route = `/${lang}/atlas/${id}`;\n                return (\n                  <Link to={route} exact />\n                )\n              })\n          })\n        }\n      </React.Fragment>\n    </DatasetsContext.Provider>\n  );\n}\n\n/**\n * the following variable is aimed at allowing browser-router to function\n * for deployments on gh-pages (prefixing all routes with the repo name to match ghp URL pattern e.g. https://username.github.io/projectname/)\n */\nconst BASE_NAME =\n  process.env.NODE_ENV === 'development'\n    ? undefined\n    : `/${homepage.split('/').pop()}`;\n\n\n/**\n * Wrapper of the router and application\n * @returns  {React.ReactElement} - React component\n */\nexport default function Wrapper() {\n  return (\n    <Router basename={BASE_NAME}>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { useEffect, useRef, useState } from 'react';\n\n/**\n * Runs a given function each {delay} miliseconds\n * @param {function} callback\n * @param {number} delay - in ms\n * @returns {void}\n */\nexport function useInterval(callback, delay = 100) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\n/**\n * Debounces the update of a value given a certain delay\n * @param {any} value\n * @param {number} delay - in ms\n * @returns {any} - returned value\n */\nexport function useDebounce(value, delay = 100) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay]\n  );\n\n  return debouncedValue;\n}\n\n/**\n * Records the previous value of a given value\n * @param {any} value\n * @returns {any} previous value\n */\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Multiscale trade in eighteenth-century La Rochelle region\",\n  \"titleHTML\": \"Multiscale trade in eighteenth-century La Rochelle region\",\n  \"subtitle\": \"A case study from the PORTIC interdisciplinary research program\"\n}"],"sourceRoot":""}