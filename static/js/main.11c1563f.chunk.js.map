{"version":3,"sources":["contents/fr/footer.mdx","components/SigmaComponent/reducers.js","components/SigmaComponent/GraphContainer.js","components/SigmaComponent/index.js","components/TriangleComponent/TriangleComponent.js","helpers/hooks.js","colorPalettes.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","contents/fr/partie-1.mdx","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2-intro.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/about.mdx","contents/en/tests.mdx","components/SvgComponent/SvgComponent.js","components/GeoComponent/index.js","components/TriangleComponent/index.js","components/BezierComponent/index.js","components/BezierComponent/BezierComponent.js","components/DataProvider/index.js","components/DataProvider/DataProvider.js","components/LineChart/LineChart.js","contents/fr/tests.mdx","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","helpers/misc.js","components/Caller/Caller.js","components/Caller/index.js","../ /^/.//.*$/ groupOptions: {} namespace object","visualizations/Test.js","components/DeclineComponent/LongitudinalTradeChart.js","components/DeclineComponent/ProductsDistributionChart.js","components/DeclineComponent/index.js","components/DeclineComponent/DeclineComponent.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialComponent/CircularAlluvialComponent.js","components/CircularAlluvialComponent/utils.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","pages/ScrollyPage/index.js","pages/ScrollyPage/ScrollyPage.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/VisualizationFocus.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","pages/StandaloneVisualization/index.js","pages/StandaloneVisualization/StandaloneVisualization.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/contexts.js","components/GeoComponent/ChoroplethLayer.js","components/GeoComponent/PointsLayer.js","components/GeoComponent/FlowsLayer.js","components/GeoComponent/CustomObjectLayer.js","components/GeoComponent/Button.js","components/GeoComponent/Input.js","components/GeoComponent/GeoComponent.js","contents/fr/metadata.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/BarChart.js","components/BarChart/index.js","contents/en/metadata.js","visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js"],"names":["readingTime","layoutProps","MDXContent","components","props","mdxType","className","parentName","isMDXComponent","tableOfContents","id","level","title","children","frontMatter","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","width","height","ratio","sizes","useMemo","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","max","name","field","values","attr","uniq","palette","colors","generatePalette","length","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","x","isNaN","undefined","y","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","smallerNode","Color","lighten","rgb","string","createEdgeReducer","container","useRef","useState","renderer","setRenderer","useEffect","getCamera","animate","needToRefresh","settings","labelGrid","cell","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","labelFont","camera","setState","getState","disable","on","state","current","ref","style","minHeight","minWidth","gexfString","data","spatialize","inputCameraPosition","angle","headerRef","headerHeight","getBoundingClientRect","setCameraPosition","find","prop","g","gexf","parse","Graph","forceAtlas2","inferSettings","assign","iterations","position","flex","cam","TriangleComponent","totalWidth","legendWidth","margins","left","right","rowHeight","projection","numberOfColumns","columnWidth","totalHeight","fontSize","scaleX","map","port","nb_pointcalls_out","scaleY","mean_tonnage","legendTriangleWidth","legendTriangleHeight","border","x2","y2","offset","stop-color","colorsPalettes","generic","dark","stop-opacity","transform","classname","d","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient","fill","stroke","strokeWidth","marker-start","marker-end","font-size","sort","a","b","longitude","latitude","xa","index","triangleWidth","triangleHeight","xTransform","yTransform","x1","y1","strokeDasharray","cx","cy","r","class","transformOrigin","text-anchor","useInterval","callback","delay","savedCallback","setInterval","clearInterval","useDebounce","value","debouncedValue","setDebouncedValue","handler","setTimeout","clearTimeout","step","SvgComponent","GeoComponent","BezierComponent","dataFilename","inPercentage","setData","loadingData","setLoadingData","dataURL","process","then","csvString","newData","csvParse","catch","err","partialCircle","require","start","None","end","leftPath","Math","PI","command","join","console","log","rightPath","stroke-width","DataProvider","str","extension","split","pop","backgroundData","visData","layers","type","renderObject","renderStep3Object","projectionTemplate","colorPalettes","provinces","admiralties","label","customs_office","backgroundFilename","markerColor","markerSize","showLabels","PASS_DURATION","Hull","bottomRightX","bottomLeftX","Sail","sailSpeed","distance","randomFactor","random","minRightX","maxLeftX","maxRightX","step1","points","step2","useSpring","loop","to","from","config","duration","polygon","Matt","secondWidth","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","opacity","BoatsIllustration","useReducer","action","Object","entries","reduce","boat","payload","genId","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","now","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","lang","currentMetadata","trimText","limit","words","output","slice","cartesian2Polar","sqrt","radians","atan2","count","accent1","accent2","iwanthue","colorSpace","seed","clustering","Caller","visualizationId","useContext","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","onClick","e","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","keys","module","exports","Test","datasets","datasetName","JSON","stringify","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","fillGaps","barTooltipFn","cityName","highlightYears","colorScaleMessages","annotations","filter","year","footerRef","setHeight","newHeight","offsetHeight","ReactTooltip","rebuild","yearsExtent","yearsEnumerated","xBand","scaleBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","nice","bottom","top","yShareScale","rightYAxisValues","axisPropsFromTickScale","leftYAxisValue","marginLeft","background","maximum","minimum","marginRight","bandwidth","aStartYear","aEndYear","annotation","annotationIndex","patternUnits","data-tip","toFixed","replace","data-for","data-effect","data-html","data-class","data-place","includes","next","datum","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","sum","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","totalValue","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","flows","her","labelScale","element","maxWidth","backgroundColor","DeclineComponent","productTradePartThreshold","rows","atlasMode","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","austriaWar","usIndependance","totalRows","renderRow","row","rowFlex","rowIndex","region","comparison","rowId","PrincipalVisualizationPart1","colorSchemes","colorScheme1","colorScheme2","colorScheme3","CircularAlluvialComponent","sumBy","inputHeight","filters","debug","centerHorizontalLabels","displaceHorizontalLabels","tooltips","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","spec","stepsSpec","_id","stepIndex","stepData","groups","groupBy","flow","valueAbs","actualValue","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","abs","VERTICAL_BAR_SIZE","stepScales","0","orientation","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","tooltipContent","fontWeight","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","cos","sin","flow_type","partner","tContent","trim","nodeHeight","initialY","initialHeight","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelY","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","labelFontSize","flowX","flowY","flowWidth","flowHeight","PrincipalVisualizationPart2","showOnlyToflit","sumToflitBy","alluvialFilters","titles","labels","alt","src","PrincipalVisualizationPart3","renderObjects","renderTriangles","SigmaComponent","BarChart","layout","tooltip","metrics_type","renderStep3SmallMultiples","VisualizationContainer","inputDimensions","dimensions","DatasetsContext","relevantDatasets","viz","visualizationsList","datasetsIds","order","window","innerHeight","tickSpan","tickFormat","parseInt","value_rel_per_direction","entity","portion","autoSort","ascending","nb_outs","reverseColors","labelsColor","custom","VisualizationController","setDimensions","visProps","omit","bounds","onResize","contentRect","measureRef","ScrollyPage","ContentSync","sectionRef","focusOnViz","setFocusOnViz","setActiveVisualization","newState","visualizations","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","visualizationEntries","sectionDims","visualization","visY","Provider","params","finalParams","newVis","thatId","Helmet","summary","routes","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","item","itemIndex","route","navigator","userAgent","Home","match","introRef","titleHTML","subtitle","dangerouslySetInnerHTML","__html","behavior","VisualizationFocus","history","handleClose","pathname","howDone","howRead","visualizationsMap","Atlas","useHistory","shownVisualization","visualizationIndex","StandaloneVisualization","PlainPage","Content","contentsURL","fallback","ui","colorText","colorAccentBackground","colorBackgroundBlue","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","url","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","tsvParse","error","newDatasets","renderRoute","ThatComponent","ln","otherLang","pathOtherLang","routeItem","React","lazy","path","component","Fragment","BASE_NAME","homepage","Wrapper","basename","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","createContext","ChoroplethLayer","layer","features","colorValues","properties","generatedPalette","geoPath","PointsLayer","markerData","coordsMap","mark","grouped","sizeCoef","sizeScale","FlowsLayer","strokeWidthScale","arrowSizeScale","copy","arrowSize","latitude_dep","longitude_dep","latitude_dest","longitude_dest","xDep","yDep","xDest","yDest","CustomObjectLayer","Button","onMouseDown","isMouseDown","interval","onMouseUp","Input","inputValue","onBlur","setValue","onChange","target","inputProjectionConfig","projectionConfig","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","defaultProjectionConfig","rotationDegree","geoEqualEarth","center","translate","placeHolder","val","layerIndex","HorizontalBarChart","initialWidth","inputMargins","headersHeight","setHeadersHeight","legendRef","Tooltip","newHeadersHeight","colorPalette","colorModalities","yTickFormat","yTickSpan","initialYDomain","yField","sortY","xTickFormat","xTickSpan","initialXDomain","fillXGaps","xField","sortX","sortYField","sortYAscending","sortYType","yAutoSort","sortXField","sortXAscending","sortXType","modality","xValues","vizWidth","xDomain","bandsNb","xScale","xExtent","yDomain","bandWidth","yScale","yStackScale","xAxisValues","yAxisValues","valueIndex","axis","labelPosition","thatHeight","thatY1","thatY2","thatX1","thatX2","multiplier","groupIndex","items","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","setLegendWidth","newLegendWidth","fixedRowHeight","formatLabel","vizHeight","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX","thatWidth","totalTonnage","parseFloat","cumulated_tonnage_out_region","cumulated_tonnage_in_region","type_of_object","leftTriangleHeight","rightTriangleHeight","cumulated_exports_value_from_region","cumulated_exports_value_from_ext","noOverlapTransform","pow","legendLeftPath","legendRightPath","legendStart","legendEnd","legendCustomOffice","legendSizeCoef","legendTotalTonnage","legendLeftTriangleHeight","legendRightTriangleHeight","legendTotalValue","legendInPercentage","legendPartialCircle","custom_office","xIndex"],"mappings":"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,iBAAGA,KAAK,QACjE,wCACA,mEACA,+BACA,qCACA,iCACA,qCACA,oCACA,qCACA,iDACA,mCACA,iCACA,qCACA,kCACA,mCACA,8CACA,qCACA,+BACA,qCACA,4CACA,sCACA,sEACA,qEACA,kBACE,GAAM,8CADR,gDAGA,YAAC,IAAD,CAAQvC,GAAG,0BAA0BiO,KAAM,EAAGtO,QAAQ,WACtD,8zCACA,ylBACA,onCACA,0UACA,k3BACA,iJACA,yjBAAwd,iBAAGE,WAAW,IACle,KAAQ,mLAD4c,6EAGxd,4iBACA,iBAAG0C,KAAK,+CAAiD,iBAAGA,KAAK,QACjE,oIACA,6BACA,iCACA,6CACA,4BACA,wCACA,4BACA,iCACA,4BACA,iCACA,4BACA,mCACA,4BACA,mDACA,4BACA,qDACA,4BACA,wCACA,6BACA,sDACA,4BACA,wDACA,4BACA,05CACA,yuEACA,u+BACA,sBACE,kBAAI1C,WAAW,MAAf,wDAEF,kBACE,GAAM,iCADR,yCAGA,YAAC,IAAD,CAAQG,GAAG,0BAA0BiO,KAAM,EAAGtO,QAAQ,WACtD,sLACA,80EACA,wqBACA,gHACA,oHACA,uaACA,mqBACA,2QACA,kBACE,GAAM,qCADR,uCAGA,YAAC,IAAD,CAAQK,GAAG,0BAA0BiO,KAAM,EAAGtO,QAAQ,WACtD,+BACA,sfACA,2XACA,gyBACA,mDAA+B,iBAAGE,WAAW,IACzC,KAAQ,gwBADmB,0kBAG/B,+CACA,4IACA,wEACA,6DACA,sDACA,iEACA,0tBACA,2xBACA,uMACA,y6BACA,0CACA,sBACE,kBAAIA,WAAW,MAAf,yGACA,kBAAIA,WAAW,MAAf,yFACA,kBAAIA,WAAW,MAAf,qcACA,kBAAIA,WAAW,MAAf,kKAMNL,EAAWM,gBAAiB,EACrB,IAAMC,EAAkB,iBAAmB,CAChD,CACEC,GAAI,eACJC,MAAO,EACPC,MAAO,eACPC,SAAU,IAId,CACIH,GAAI,6CACJC,MAAO,EACPC,MAAO,+CACPC,SAAU,IAId,CACIH,GAAI,gCACJC,MAAO,EACPC,MAAO,wCACPC,SAAU,IAId,CACIH,GAAI,oCACJ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","file":"static/js/main.11c1563f.chunk.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.54,\"time\":32400,\"words\":108}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme ANR PORTIC se propose de croiser les donnes sur la navigation et sur la valeur du commerce tranger de la France  la veille de la Rvolution franaise pour mieux saisir les dynamiques commerciales  luvre. Pour ce faire, il offre des interfaces dinterrogation et de visualisation des donnes adaptes  des publics et des intrts varis.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placs sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est plac sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      // console.log('color the attr', nodeColor.name, attr[nodeColor.name]);\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      // console.log('size attr', nodeSize.name, attr);\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const smallerNode = sourceNodeSize < targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (smallerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = smallerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[smallerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React, { useCallback, useRef, useState, useEffect, useMemo } from 'react';\nimport gexf from 'graphology-gexf';\nimport forceAtlas2 from 'graphology-layout-forceatlas2';\nimport Graph from 'graphology';\nimport { WebGLRenderer as Renderer } from 'sigma';\nimport { scaleLinear } from 'd3-scale';\nimport { min, max, extent } from 'd3-array';\nimport { uniq } from 'lodash';\n// import get from 'axios';\n\nimport { createNodeReducer, createEdgeReducer } from './reducers';\nimport { generatePalette, usePrevious } from '../../helpers/misc';\n\n// import GraphControls from './GraphControls';\n\nimport './GraphContainer.scss';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\n// function rescale(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedReset(renderer);\n// }\n\n// function zoomIn(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedZoom(renderer);\n// }\n\n// function zoomOut(renderer) {\n//   const camera = renderer.getCamera();\n//   camera.animatedUnzoom(renderer);\n// }\n\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n  width,\n  height,\n  ratio,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n\n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable && nodeColorVariable.field) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable.field])\n      })\n      values = uniq(values);\n      let palette = {};\n      if (nodeColorVariable.palette) {\n        palette = nodeColorVariable.palette;\n      } else {\n        const colors = generatePalette(nodeColorVariable.field, values.length);\n        let i = 0;\n        values.forEach(option => {\n          palette[option] = colors[i];\n          i++;\n        });\n      }\n\n      return {\n        palette,\n        name: nodeColorVariable.field\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n        m.set(edge, { sourceNode: sourceAttributes, targetNode: targetAttributes })\n      });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n\n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n\n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n      const camera = renderer.getCamera();\n      // console.log('animate camera', camera);\n      camera.animate(cameraPosition);\n    }\n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n\n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n  useEffect(() => {\n    if (renderer) {\n      renderer.refresh();\n    }\n  }, [width, height])\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, { nodeReducer, edgeReducer });\n\n        newRenderer.settings.labelFont = 'IBM Plex Sans';\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        camera.setState({ ...camera.getState(), ratio: ratio || 1 });\n        camera.disable();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{ width: '100%', height: '100%', minHeight: '10vh', minWidth: '1vw' }}></div>\n      {/*renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )*/}\n    </div>\n  );\n}\n\n\nexport default function SigmaComponent({\n  data: gexfString,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  spatialize,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 },\n  width = 0,\n  height,\n  ratio,\n  title\n}) {\n  const headerRef = useRef(null);\n  const headerHeight = useMemo(\n    () => headerRef.current ? headerRef.current.getBoundingClientRect().height : 0, [headerRef.current])\n\n  // useState renvoie un state et un seter qui permet de le modifier\n  const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n\n  useEffect(() => {\n    if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n      setCameraPosition(inputCameraPosition);\n    }\n  }, [inputCameraPosition])\n\n  const onCameraUpdate = cam => {\n    setCameraPosition(cam);\n  }\n  const graph = useMemo(() => {\n    const g = gexf.parse(Graph, gexfString);\n    if (spatialize) {\n      const settings = forceAtlas2.inferSettings(g);\n      // To directly assign the positions to the nodes:\n      forceAtlas2.assign(g, {\n        settings,\n        iterations: 50\n      });\n    }\n    return g;\n  }, [gexfString]);\n\n  if (!graph) {\n    return null;\n  }\n  return (\n    <div className=\"SigmaComponent\" style={{ \n      width: '100%', \n      height: height || '100%'\n    }}>\n      <div ref={headerRef} className=\"row visualization-title-container\">\n        {title ? <h5 className=\"visualization-title\">{title}</h5> : null}\n      </div>\n      <div style={{\n        position: 'relative',\n        flex: 1,\n        // top: headerHeight,\n        // background: 'red',\n        // height: height - headerHeight\n      }}>\n\n        <GraphContainer\n          {\n          ...{\n            graph,\n            cameraPosition,\n            nodeColor,\n            nodeSize,\n            labelDensity,\n            nodeLabel,\n            ratio,\n            onCameraUpdate,\n            width,\n            height: height - headerHeight\n          }\n          }\n        />\n      </div>\n    </div>\n  )\n}","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","/* DOCUMENTATION : API de ce TriangleComponent\n\n  Principe :\n    Composant conu spcifiquement pour les triangles de la viz 3.1, mais pourrait tre dclin\n    -> permet de produire une srie d'objets en SVG, qui se disposent dans une grille en fonction de la longueur du dataset, et les dimensions de cette grille sont paramtrables\n\n  Paramtres : \n    data : donnes  afficher sur la carte,\n    totalWidth : largeur totale du composant (1 objet de lgende + grille d'objets) (par dfaut  1200 px)\n    legendWidth : largeur de la lgende (par dfaut  un dizime de la largeur totale)\n    margins : marges de gauche (entre l'objet de la lgende et la grille) et de froite (entr la droite de la grille et l'extrmit droite de l'cran)\n    rowHeight : hauteur d'une ligne de la grille (par dfaut  200px)\n    projection : on passe en paramtre la projection de d3 geo pour pouvoir donner accs au positionnement gographique sur une carte (permet dans le cas de la viz 3.1 de lier les triangles au point de localisation gographique du port qu'ils reprsentent => point et triangle sont nest dans un mme objet, ce qui permet d'tablir une courbe pointille entre eux et grer l'interaction avec des jeux d'opacit au hover)\n\n  Pistes d'amlioration : \n  - filtrer les objets  l'entre ? (par exemple pour la viz 3.1 on pourrait choisir d'afficher le triangle associ  un port que si les dimensions dpassent un certain seuil) => cela permettrait d'allger la carte, en affichant seulement les ports pour lesquels on a des donnes reprsentatives\n\n  @TODO : documenter ce component de maire standardise\n  */\n\nimport React from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\n\nimport './TriangleComponent.scss'\nimport colorsPalettes from '../../colorPalettes';\n\n\nconst TriangleComponent = ({\n  data,\n  totalWidth = 1200,\n  legendWidth = 0.1,\n  margins = {\n    left: 0.0,\n    right: 0.09\n  },\n  rowHeight = 200,\n  projection\n}) => {\n\n  const numberOfColumns = data.length\n  const columnWidth = (totalWidth * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns\n  const numberOfRows = data.length / numberOfColumns\n  const totalHeight = numberOfRows * rowHeight\n  const fontSize = totalHeight * 0.05\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n  ]).range([0, columnWidth * 5]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter  la taille d'une colonne (+ centre de mon triangle  grer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([0, rowHeight * 0.85]); // pour l'instant j'ai mis le max de longueur  85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupe par le texte]\n\n  const legendTriangleWidth = 35;\n  const legendTriangleHeight = 60;\n\n  return (\n\n    <g className=\"TriangleComponent\" width={totalWidth} height={totalHeight} style={{ border: '1px solid lightgrey' }}>\n\n      <defs>\n        <linearGradient id=\"TriangleGradient\" x2='0%' y2='100%'>\n          <stop offset=\"20%\" stop-color={colorsPalettes.generic.dark} />\n          <stop offset=\"100%\" stop-color={colorsPalettes.generic.dark} stop-opacity={0.3} />\n        </linearGradient>\n      </defs>\n      <g className=\"TriangleLegend\" width={legendWidth} transform={`translate(${legendWidth * totalWidth * 0.5}, ${totalHeight * 2.3})`} >\n        <g classname=\"arrows\">\n          <path\n            d={`M ${(legendWidth - legendTriangleWidth) / 2} ${(rowHeight - legendTriangleHeight) / 1.2} \n                        H ${(legendWidth - legendTriangleWidth) / 2 + legendTriangleWidth}\n                        L ${legendWidth / 2} ${(rowHeight - legendTriangleHeight) / 1.2 + legendTriangleHeight}\n                        Z\n                        `}\n          />\n\n          <g className=\"top-arrow\">\n            <defs>\n              <marker id=\"triangle-left\" viewBox=\"0 0 10 10\"\n                refX=\"1\" refY=\"5\"\n                markerUnits=\"strokeWidth\"\n                markerWidth={legendWidth * totalWidth * 0.08} markerHeight={rowHeight * 0.04}\n                orient=\"auto\">\n                <path d=\"M 10 0 L 0 5 L 10 10 Z\" fill=\"black\" />\n              </marker>\n              <marker id=\"triangle-right\" viewBox=\"-10 0 10 10\"\n                refX=\"1\" refY=\"5\"\n                markerUnits=\"strokeWidth\"\n                markerWidth={legendWidth * totalWidth * 0.08} markerHeight={rowHeight * 0.04}\n                orient=\"auto\">\n                <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"black\" />\n              </marker>\n            </defs>\n            <path d={`M ${(legendWidth - legendTriangleWidth) / 2} ${(rowHeight - legendTriangleHeight) / 1.3}  \n                    H ${(legendWidth - legendTriangleWidth) / 2 + legendTriangleWidth}\n                    `} stroke=\"black\" strokeWidth={1} marker-start=\"url(#triangle-left)\" marker-end=\"url(#triangle-right)\" />\n          </g>\n\n          <g className=\"left-arrow\">\n            <defs>\n              <marker id=\"triangle-left\" viewBox=\"-10 0 10 10\"\n                refX=\"1\" refY=\"5\"\n                markerUnits=\"strokeWidth\"\n                markerWidth={legendWidth * totalWidth * 0.08} markerHeight={rowHeight * 0.04}\n                orient=\"auto\">\n                <path d=\"M 0 0 L -10 5 L 0 10 Z\" fill=\"black\" />\n              </marker>\n              <marker id=\"triangle-right\" viewBox=\"0 0 10 10\"\n                refX=\"1\" refY=\"5\"\n                markerUnits=\"strokeWidth\"\n                markerWidth={legendWidth * totalWidth * 0.08} markerHeight={rowHeight * 0.04}\n                orient=\"auto\">\n                <path d=\"M 0 0 L 10 5 L 0 10 Z\" fill=\"black\" />\n              </marker>\n            </defs>\n            <path d={`M ${(legendWidth - legendTriangleWidth) / 1.6} ${(rowHeight - legendTriangleHeight) / 1.2}  \n                    V ${(rowHeight - legendTriangleHeight) / 1.2 + legendTriangleHeight}\n                    `} stroke=\"black\" strokeWidth={1} marker-start=\"url(#triangle-left)\" marker-end=\"url(#triangle-right)\" />\n          </g>\n\n        </g>\n\n        <g className=\"textLegend\">\n          {/* <text className=\"legendTitle\"\n            // transformOrigin=\"top left\"\n            // transform=\"rotate (-45)\"\n            font-size={totalHeight * 0.07}\n            font-weight=\"bold\"\n            // x={legendWidth / 2}\n            x={0}\n            y={(rowHeight - legendTriangleHeight) / 2}\n          // text-anchor=\"left\"\n          > Lgende </text> */}\n\n          <g transform={`translate(${legendWidth / 2 + fontSize / 2}, ${(rowHeight - legendTriangleHeight) / 1.4})`}>\n            <text className=\"legendContent\"\n              font-size={fontSize}\n            > nombre de navires</text>\n          </g>\n\n          <g transform={`translate(${(legendWidth - legendTriangleWidth) / 1.2}, ${(rowHeight - legendTriangleHeight) / 1.2 + legendTriangleHeight / 2})`}>\n            <text className=\"legendContent\"\n              font-size={fontSize}\n            > tonnage moyen des navires </text>\n          </g>\n        </g>\n\n      </g>\n      <g className=\"triangles\" width={totalWidth * (1 - margins.left - margins.right - legendWidth)}>\n        {\n          data.sort((a, b) => {\n            const [xa] = projection([+a.longitude, +a.latitude]);\n            const [xb] = projection([+b.longitude, +b.latitude]);\n\n            if (xa > xb) {\n              return 1;\n            }\n            return -1;\n\n          })\n          .map((port, index) => {\n\n            const triangleWidth = scaleX(+port.nb_pointcalls_out)\n            const triangleHeight = scaleY(+port.mean_tonnage)\n\n            const xIndex = index % numberOfColumns;\n            // const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n            const xTransform = xIndex * columnWidth + (legendWidth + margins.left) * totalWidth;\n            const yTransform = totalHeight * 2.3;\n\n            const [x, y] = projection([+port.longitude, +port.latitude]);\n\n            return (\n              <g className='port-point-and-triangle'>\n                \n                <line\n                  x1={xTransform + columnWidth/2}\n                  y1={yTransform + rowHeight / 7}\n                  x2={x}\n                  y2={y}\n                  stroke='grey'\n                  strokeDasharray='2, 8'\n                  />\n\n                <g className='port-point' transform={`translate(${x}, ${y})`}>\n                  <circle\n                    key={index}\n                    cx={0}\n                    cy={0}\n                    r={totalHeight * 0.035}\n                    style={{ fill: colorsPalettes.generic.dark }}\n                    className=\"marker\"\n                  />\n                </g>\n\n                <g className='port-triangle'\n                  key={index}\n                  // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n                  transform={`translate(${xTransform}, ${yTransform})`}\n                >\n                  <rect\n                    x={0}\n                    y={0}\n                    width={columnWidth}\n                    height={rowHeight}\n                  />\n\n                  <path class='horizontalLine'\n                    d={`M ${columnWidth / 2} ${(rowHeight - triangleHeight) / 1.2} \n                        V ${rowHeight / 7}\n                        `}\n                  />\n\n                  <path className='triangle'\n                    d={`M ${(columnWidth - triangleWidth) / 2} ${(rowHeight - triangleHeight) / 1.2} \n                        H ${(columnWidth - triangleWidth) / 2 + triangleWidth}\n                        L ${columnWidth / 2} ${(rowHeight - triangleHeight) / 1.2 + triangleHeight}\n                        Z\n                        `}\n                    fill=\"url(#TriangleGradient)\"\n                  />\n\n\n                  <g className='label' transformOrigin=\"bottom left\" transform={`translate(${columnWidth / 2}, ${rowHeight / 7 - totalHeight * 0.025})`}>\n\n                    <text\n                      transformOrigin=\"bottom left\"\n                      transform=\"rotate (-45)\"\n                      font-size={fontSize}\n                      x={0}\n                      y={0}\n                      text-anchor=\"left\"\n                    > {port.port} </text>\n                  </g>\n\n                </g>\n              </g>\n            )\n          })\n\n        }\n      </g>\n\n    </g>\n  )\n\n}\n\nexport default TriangleComponent;","import { useEffect, useRef, useState } from 'react';\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Poitou': '#668EDB',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produit colonial': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites les': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indtermin suppos Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-R': '#277262',\n    'Tonnay-Charente': '#5AD0F4',\n    'Marans': '#67CBB6',\n    \"Les Sables-d'Olonne\": '#668EDB',\n    'Marennes': '#A7E6F9',\n  }\n}\n\nexport default colorsPalettes;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.39,\"time\":203400,\"words\":678}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`[`}{`texte martyr/de test pour lintro du site - fait notamment avec des extraits du kit de bienvenue`}{`]`}</p>\n    <p>{`En 1789,  laube de la rvolution, la faade atlantique de la France entame un long dclin conomique qui se poursuivra jusquau XIXme sicle.`}</p>\n    <p>{` lintrieur de la France de 1789, les ctes charentaises possdent un dense maillage portuaire (co-prsence dune quarantaine de ports) en tant que destination dclare par les navires. Certains ports ne font que du cabotage micro-local, dautres intgrent petit et grand cabotage, dautres enfin comprennent aussi une navigation de long-cours. Cette rgion se prte donc particulirement  une tude portant sur larticulation entre les diffrentes chelles de commerce maritime  laube de la rvolution.`}</p>\n    <p>{`Comment reconstituer lhistoire maritime et commerciale de la rgion  partir des sources historiques disponibles ?`}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`Dune part, nous disposons de traces administratives de la navigation maritime grce au systme fiscal dimposition des voyages dans lancien rgime. Les registres de cong rpertoriaient les taxes imposes aux navires  leur dpart dun port (selon leur tonnage et destination) et taient rdigs par les greffiers de lamiraut locale. Ces documents ont t numriss et structurs sous la forme dune base de donnes intitule Navigocorpus. Dans cette dernire, on compte plus de 15000 congs pour lanne 1789.`}</p>\n    <p>{`Les registres de congs nous permettent de reprer les dates de sortie de port des bateaux de la rgion, ainsi que diverses informations relatives  lobjet de leur voyage, leur tonnage, leur capitaine, etc.. Ces derniers ne sont cependant pas dnus dincertitude : litinraire dclar par les capitaines de bateau au moment de la sortie de port ne correspond pas ncessairement au voyage effectif qui la suivi. Les congs permettent une bonne mesure des trafics de la rgion de La Rochelle, y compris  toute petite chelle, tout en demandant une attention fine  la dimension dincertitude inhrente  la source mobilise.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`Dautre part, nous disposons de traces administratives relatives au commerce gnral de la rgion. La base de donnes Toflit18 se fonde sur la numrisation des documents du Bureau de la balance du commerce de 1716  1821. Ces documents ont t produits grce aux services des Fermes : chaque bureau des Fermes enregistrait localement les tats de sortie et dentre des marchandises entre la France et ltranger. Plus de 550 000 flux de sortie / entre ont t documents dans la base de donnes Toflit18.`}</p>\n    <p>{`Grce aux donnes de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les diffrents bureaux de ferme de la rgion et les partenaires trangers du royaume de France. Les informations que lon peut extraire de ces flux sont, entre autres, le nom du produit chang, la quantit, la valeur, le partenaire commercial, et lentit administrative ayant enregistr le flux au niveau local. Elles fournissent donc des informations complmentaires  celles donnes par les sources relatives  la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congs de navigation et donnes fiscales de la Ferme rendu possible par les bases de donnes Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de prciser les flux et leur valeur pour ce qui est du commerce international, et dexplorer les relations et larticulation entre les diffrents trafics de cette rgion.`}</p>\n        <p>{`La prsente tude de cas dcrit en trois temps lhistoire de la rgion de La Rochelle  laube de la rvolution franaise. Dabord, nous dcrivons la relative perte dimportance et de diversit commerciale de la rgion  la suite de la perte du Canada par le royaume de France durant la guerre de sept ans. Nous proposons ensuite une analyse dtaille de la restructuration de la rgion en relation avec cet vnement, selon des filires spcialises qui associent des ports particuliers avec le commerce de produits spcifiques. Nous dmontrons enfin que, bien que rest dominant dans sa rgion, le port de la Rochelle a cess de structurer la rgion de Poitou-Aunis-Saintonge au profit dun rseau dchange plus diversifi.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Todo intro en`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"6 min read\",\"minutes\":5.33,\"time\":319800,\"words\":1066}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-dclin-de-la-rgion-de-la-rochelle-suite--la-perte-du-canada\"\n    }}>{`Partie 1. Le dclin de la rgion de La Rochelle suite  la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitime sicle, la France a pleinement profit du dveloppement des relations conomiques entre lAfrique, lAmrique et lEurope. L Atlantique franais reposant sur la traite des Africains et leur exploitation dans les les franaises (Antilles et Mascareignes) a connu son apoge juste avant la rvolte de Saint-Domingue en aot 1791 et le dbut de la guerre maritime avec lAngleterre en fvrier 1793. Lancienne rgion Poitou-Charente, correspondant approximativement aux gnralits de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une tradition maritime ancienne et tait bien situe pour bnficier de cet pisode de prosprit. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`Lexamen du commerce avec les pays trangers et les colonies de la direction des Fermes de La Rochelle, qui tait leur faade maritime, montre toutefois un dynamisme limit. Il y a bien eu croissance du commerce. Mais cette croissance a t plus lente que celle des autres grands ports du royaume. Cela sexplique en grande partie par les relations privilgies de la direction de la Rochelle avec le Canada. Dune part, celui-ci se dveloppe beaucoup moins vite que les Antilles, et la rgion souffre de ce manque de dynamisme durant la premire moiti du sicle. Dautre part, le Canada est cd aux Anglais lors du trait de Paris qui clt la guerre de Sept Ans en 1763. Qubec avait dj t pris en 1759. Cette perte est svre pour la rgion dont le commerce entame alors un recul relatif trs net. `}</p>\n    <Caller id=\"partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie\" mdxType=\"Caller\" />\n    <p>{`Aprs une anne exceptionnelle en 1747, explique par lorganisation de convois trans-atlantiques au dpart de La Rochelle escorts par la marine pour chapper aux prdations britanniques, la direction de La Rochelle effectue 4,8% du commerce extrieur franais en 1750. En 1789 sa part ne reprsente plus que 3%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`La trajectoire de la rgion de la Rochelle contraste avec celles de Bordeaux et de Nantes. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et sa part du commerce franais ne cesse daugmenter jusquen 1789.`}</p>\n    <p>{`Le recul de La Rochelle nest pas que quantitatif. En 1750, les donnes de la direction des Fermes de La Rochelle, charge de la collecte des droits sur le commerce extrieur et colonial, montre que cette partie du territoire commerce 21% des types de biens changs par la France (645 sur 3055, aprs `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_orthographic%26selectedParent%3Dproduct_source&sa=D&source=editors&ust=1626443515616000&usg=AOvVaw1I5uLrQpZqH7GVCn7vXAtW\"\n      }}>{`uniformisation des variations orthographiques`}</a>{`). En 1789, elle nen commerce plus que 7% (248/3565). Cela sobserve  la fois pour les exportations et pour les importations.  un niveau plus agrg de typologie des produits, parmi les 150 secteurs de la `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=http://toflit18.medialab.sciences-po.fr/%23/classification/browser?kind%3Dproduct%26selected%3Dproduct_revolutionempire%26selectedParent%3Dproduct_simplification&sa=D&source=editors&ust=1626443515616000&usg=AOvVaw132Ng55AlehXUY4uRxiQau\"\n      }}>{`classification Rvolution et Empire, utilise dans le cadre du programme ANR Toflit18`}</a>{`, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diverses en 1750 quen 1789. Lindice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Un bien pour lequel il ny a pas beaucoup de concurrence nationale (les eaux-de-vie) et deux rexportations coloniales (le caf et le sucre) dominent en 1789 les exportations. Les toiles de coton, souvent des rexportations en direction de lAfrique, sont en quatrime place, suivies du sel (dont la valeur est faible par rapport au tonnage quil mobilise car cest une marchandise trs pondreuse). En 1750, la mercerie et les toffes de laine font partie des cinq principales exportations (avec lindigo, les eaux-de-vie et le sucre : le sel est en 14e position). La direction des Fermes de La Rochelle sest spcialise dans les produits agricoles et les rexportations au dpens des biens manufacturs de la rgion. Ce jugement ngatif est toutefois nuanc par lintensit capitalistique de la production deaux-de-vie qui la rapproche des biens manufacturs.`}</p>\n    <p>{`Nous ne connaissons pas la destination des rexportations coloniales en 1789. En les excluant, on constate que la concentration des marchs de la direction des Fermes de La Rochelle est la mme en 1750 et en 1789 (entre 0,41 et 0,44), mais que lAngleterre a pris la place de lAmrique (dsignant ici essentiellement les Antilles Franaises). Pour aller vite, on pourrait rsumer en disant que la direction des fermes de La Rochelle nexporte plus des biens diffrencis vers le Canada, mais essentiellement des eaux-de-vie vers lAngleterre.`}</p>\n    <Caller id=\"partie-1-produits-importants-pour-la-rochelle\" mdxType=\"Caller\" />\n    <p>{`Les donnes de la navigation ne nous permettent pas daller beaucoup plus loin dans lanalyse du dclin de cette rgion: dune part, car navons le dtail des sorties que pour la fin de lAncien Rgime, ce qui empche une analyse diachronique. Dautre part, car les donnes collectes pour 1789 napportent que des informations limites pour ce qui est des produits transportes: les congs du port de La Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports de la rgion le greffier se limite le plus souvent  noter seulement larticle principal qui constitue la cargaison. Les registres des congs indiquent, toutefois, les destinations de chaque navire sorti et cette donne permettra de constater un relatif clatement des marchs de cette rgion. `}</p>\n    <p>{`Sans que lon puisse affirmer quil sagit dune nouveaut, la marginalisation de de la rgion vers la fin de lAncien Rgime est confirme par son manque de capacit  assurer ses propres trafics. La navigation avec ltranger est assure,  90%, par de pavillons trangers ou extrieur  la rgion tudie. Il sagit, pour lessentiel, des pavillons britannique et des pays de lEurope du Nord.`}</p>\n    <Caller id=\"partie-1-pays-port-d-attache\" mdxType=\"Caller\" />\n    <p>{`Mme Si on prend en compte la part de navigation sous pavillon franais assure par des navires de la rgion tudie, elle est en effet infrieure  celle de la plupart des autres provinces franaises: en 1787, les ports de lAunis-Saintonge-Poitou assurent 51.6% du tonnage quils expdient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne. En affinant, on peut voir si la rgion tudie assure plus ou moins que dautres ses trafics extrieurs. `}</p>\n    <p>{`ON SORT LE RESTE JE LE GARDE L PAR SUPERSTITION GUILLAUME`}</p>\n    <p>{`Si on regarde les dparts depuis la rgion tudie vers de ports franais, calculer la part de la navigation assure par homeport locaux en 1787 dans ports de la direction de la Rochelle vers intrieur direction / reste France / international / hors Europe et comparer avec idem pour Bordeaux et pour Nantes par ex. (en tonnage)`}</p>\n    <p>{`De toutes les manires, plutt des camemberts ?`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 1 intro`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"18 min read\",\"minutes\":17.18,\"time\":1030800,\"words\":3436}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spcialisation-portuaire--le-cas-de-la-traite-ngrire-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spcialisation portuaire : le cas de la traite ngrire, du commerce du sel et de leau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La rgion tudie se caractrise par une densit importante de ports, qui entretiennent des relations plus ou moins tendues et plus ou moins intenses avec le reste de la France et du monde. `}</p>\n    <p>{`La carte reprsente le tonnage expdi en 1787,  partir des congs dlivrs aux navires, toute destination confondue. Les 8 ports dpassant les 10000 tonneaux entretiennent tous, sauf Marans, un commerce avec ltranger; la presque totalit des ports sous ce seuil se cantonnent en revanche  un commerce rgional ou national.`}</p>\n    <Caller id=\"partie-2-part-navigation-francaise\" mdxType=\"Caller\" />\n    <p>{`Nos analyses ont montr que les tonnages enregistrs  Marennes semblent surestims  40%. Mme en prenant en compte cette distorsion, le tonnage ncessaire aux exportations vers ltranger du port de La Rochelle nest pas le plus important dans la rgion. Comme nous le verrons `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://medialab.github.io/portic-storymaps-2021/fr/page/partie-3&sa=D&source=editors&ust=1626443515620000&usg=AOvVaw0nyKPsXARHs9c_Ml8_GOKZ\"\n      }}>{`dans la partie 3`}</a>{`, La Rochelle na pas un rle structurant dans les relations que les ports de cette rgion ont avec ltranger. `}</p>\n    <p>{`La carte permet de constater que les navires expdis depuis lAunis se dirigent vers lensemble de lEurope du Nord, ceux depuis la Saintonge essentiellement vers les les britanniques et la Hollande, et que ceux au dpart du Poitou, nettement moins importants en volume, privilgient lespace Baltique. Cette diffrenciation est lie  la nature des produits exports et du commerce de chaque port.`}</p>\n    <Caller id=\"partie-2-destinations-bateaux-de-la-region\" mdxType=\"Caller\" />\n    <p>{`De par ses relations exclusives avec les colonies et surtout son investissement dans la traite ngrire, La Rochelle mrite une tude  part. Pour ce qui des relations avec ltranger (hors colonies), on constate des circuits relativement distincts: Noirmoutier, Ars-en-R et Marennes - qui exportent pour lessentiel du sel, ont comme principales dbouches extrieures la Baltique et les pays scandinaves. Nous dvelopperons ici en dtail le cas de Marennes, principal port exportateur franais de sel.`}</p>\n    <p>{`Pour le commerce des eaux-de-vie, nous tudierons le cas de Tonnay-Charente. La mention de leau-de-vie parmi les cargaisons est rare, il faut donc se tourner dabord vers la Balance du commerce, pour affiner ensuite les donnes par lanalyse de la navigation. `}</p>\n    <p>{`Limportance des tonnages impliqus nest au demeurant pas directement corrle  la valeur des marchandises transportes. En effet, les donnes de la Ferme donnent les valeurs suivantes:`}</p>\n    <p>{`Bureaux de Ferme de la direction de La Rochelle, exportations en 1789`}</p>\n    <a name=\"t.f271f803a2027ad5854321e7817f569fb280399d\"></a><a name=\"t.0\"></a>\n    <p>{`Bureau de Ferme`}</p>\n    <p>{`Valeur des exportations en livres tournois`}</p>\n    <p>{`Aligre`}</p>\n    <p>{`1 302 594,57`}</p>\n    <p>{`Charente`}</p>\n    <p>{`6 194 522,97`}</p>\n    <p>{`La Rochelle`}</p>\n    <p>{`7 698 983,18`}</p>\n    <p>{`Les Sables dOlonne`}</p>\n    <p>{`110 527,00`}</p>\n    <p>{`Marennes`}</p>\n    <p>{`1 921 839,39`}</p>\n    <p>{`Rochefort`}</p>\n    <p>{`274 173,22`}</p>\n    <p>{`Saint-Martin-de-R`}</p>\n    <p>{`1 209 320,67`}</p>\n    <p>{`(vide)`}</p>\n    <p>{`1 662 254,00`}</p>\n    <p>{`Total gnral`}</p>\n    <p>{`20 374 214,99`}</p>\n    <p>{`Exports avec ports francs / petites les: `}</p>\n    <p>{`Total avec ports francs / petites les : `}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={2} mdxType=\"Caller\" />\n    <p>{`Au XVIIIe sicle, les colonies antillaises augmentent trs considrablement leur production de sucre, caf, indigo et produits tinctoriaux, pour rpondre  une demande europenne fortement oriente  la hausse. La croissance de la production passe par un nombre de plus en plus lev dunits de production, appeles plantations, qui ont un recours massif  une main-duvre desclaves, que les Europens dportent par centaines de milliers depuis lAfrique dans le cadre de la traite ngrire. Ce commerce transatlantique dtres humains, achets sur les ctes dAfrique par les ngriers europens, a commenc au XVe sicle, mais il atteint son apoge au XVIIIe sicle, lorsque 6 millions dAfricains sont apports aux Amriques. La moiti dentre eux est vendue aux Antilles. On estime  1.25 millions `}{`[`}{`Silvia:  vrifier`}{`]`}{` le nombre dAfricains introduits dans les colonies franaises au XVIIIe sicle. La principale destination est la colonie de Saint-Domingue (aujourdhui Hati) qui compte,  la veille de la grande rvolte desclaves de 1791, un demi-million desclaves, dont plus de la moiti sont ns en Afrique.`}</p>\n    <p>{`Lactivit ngrire est aux mains darmateurs privs qui esprent raliser un profit lors de la revente des esclaves. Si Nantes est le principal port ngrier franais, La Rochelle a jou un rle significatif, tout particulirement dans les annes 17301740 : entre 1713 et 1744, La Rochelle arme 15% des expditions ngrires, sa part tombe  11% aprs la perte du Canada, en sorte que si La Rochelle est le deuxime port ngrier le plus important en France avant 1763, il passe au 4e rang par la suite. `}</p>\n    <p>{`Malgr un dclin relatif, lactivit ngrire rochelaise est rsolument oriente  la hausse. Les armateurs rochelais passent de 4,3 armements ngriers par an pour la priode 17131744  12,5 armements par an dans la dcennie 17831793. Pendant cette dernire, la traite est vritablement de lactivit principale, voire presque exclusive, des armateurs rochelais: sur un total de 200 dparts depuis le port de La Rochelle de navires rochelais, un peu plus de la moiti des tonnages se dirigent vers lAfrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se rpartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers ltranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dpasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dpassant le 50 tx `}{`[`}{`le plus grand faisant 827 tonneaux`}{`]`}{` sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et ngrier.`}</p>\n    <p>{`Les donnes de la Balance du commerce confirment la centralit du commerce colonial et ngrier : en 1789, les exportations vers lAfrique reprsentent 23% du total des exportations du bureau des Fermes, alors que 73% est constitu par les r-exportations des denres coloniales. `}</p>\n    <p>{`Alors que dans la plupart des ports ngriers franais, la part des armements ngriers est nettement infrieure  celle des armements en droiture vers les Antilles, cela nest pas le cas  La Rochelle, o les trois quarts des expditions de 1787 destines  approvisionner les Antilles en hommes ou en produits sont des ngriers. Comme  Honfleur, il y a donc clairement, en matire de trafics transatlantiques, une spcialisation ngrire de larmement rochelais. Par ailleurs, et contrairement aux autres ports franais qui font le commerce avec les Amriques (Marseille, Bordeaux, Nantes, Rouen/Le Havre), La Rochelle a une prfrence quasi-exclusive pour Saint-Domingue o plusieurs grandes familles de la ville (Belin, Garesch, Poupet Rasteau) sont trs bien implantes.`}</p>\n    <p>{`En 1789, les 12 ngriers partis de La Rochelle sont tous rochelais. Rochefort arme pour sa part 3 autres ngriers.`}</p>\n    <p>{`Au total, dans les dernires annes de lAncien Rgime, une douzaine de navires reviennent chaque anne  La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour dune expdition ngrire. La valeur des produits ramens est estime, en 1789,  7.1 millions de livres tournois, dont 5.1 sont rexports  ltranger (ANOM, F 2 B 14, tableaux 3 et 5). Les ngociants rochelais semblent stre taills une position forte dans le march du caf. `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21&sa=D&source=editors&ust=1626443515630000&usg=AOvVaw3j5Xtz2xbgQnlqtWZ5YAFx\"\n      }}>{`https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21`}</a></p>\n    <p>{`Si les donnes collectes par la Balance du commerce ne permettent pas de connatre les destinations des rexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative: en excluant  coup sr la Grande-Bretagne et les Etats-Unis, qui sapprovisionnement autrement que sur les marchs franais, cest essentiellement lEurope du Nord et la Baltique qui absorbent le caf et le sucre antillais rexports. `}</p>\n    <a name=\"t.e04ea08ffc0a1e5af3987339feba50fdcd3863fc\"></a><a name=\"t.1\"></a>\n    <p>{`Destinations des navires vers ltranger (Afrique exclue) au dpart du port de La Rochelle, 1789`}</p>\n    <p>{`pays`}</p>\n    <p>{`tx total`}</p>\n    <p>{`Pays-Bas autrichiens`}</p>\n    <p>{`512`}</p>\n    <p>{`Provinces-Unies`}</p>\n    <p>{`550`}</p>\n    <p>{`Brme`}</p>\n    <p>{`520`}</p>\n    <p>{`Hambourg`}</p>\n    <p>{`530`}</p>\n    <p>{`Norvge`}</p>\n    <p>{`150`}</p>\n    <p>{`Prusse (ports en Baltique)`}</p>\n    <p>{`370`}</p>\n    <p>{`Baltique (indtermin)`}</p>\n    <p>{`200`}</p>\n    <p>{`Grande-Bretagne`}</p>\n    <p>{`1048`}</p>\n    <p>{`Etats-Unis dAmrique`}</p>\n    <p>{`160`}</p>\n    <p>{`tranger (indtermin)`}</p>\n    <p>{`104`}</p>\n    <p>{`Ds lors, il nest pas surprenant que le ngoce rochelais porte toute son attention aux questions lies au commerce colonial et ngrier. Cela apparat clairement parmi les sujets discuts par la chambre de commerce de La Rochelle. Lindexation faite  la main,  lpoque, sur la marge des registres de dlibration la Chambre (Arch dpt. Charente Maritime, 41 ETP 8) permet de constater que dans la seule anne 1789, le commerce dAfrique est discut  une trentaine de reprises, et les colonies  une 50 des reprises, le commerce de lInde  9;  titre de comparaison, le commerce avec ltranger est abord 11 fois en tout, et la pche (avec notamment la question de la concurrence et de ladmission de la pche tats-unienne, trs dbattue cette anne l en France), 17 fois. Parmi les produits indexs au marge des registres de dlibrations, les comestibles sont mentionns 16 fois - ce qui dans la conjoncture cralire particulire de lpoque nest gure tonnant-, leau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure clairement, en dpit dun critre sans doute grossier, que le regard des membres de la Chambre de commerce est clairement riv sur les colonies et  la traite. `}</p>\n    <p>{`Si la question de la traite est absente des cahiers de dolances de la rgion `}{`[`}{`prciser leur nombre et fournir un % approximatif de leur compltude par rapport  tous ceux rdigs?`}{`]`}{`, la dfense des intrts coloniaux apparat, significativement, uniquement dans le cahier de dolances du Tiers-tat de la ville de La Rochelle, dont les reprsentants envoys  Versailles demanderont la rvocation de larrt rendu au conseil du roi, le 30 aot 1784, concernant le commerce tranger dans les colonies, et le rtablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrs quont faits la navigation franoise et la culture des isles franoises de lAmrique; par ailleurs, ils demanderont la suppression de lentrept et des droits actuels de consommation sur les sucres, cafs et lindigo venant des colonies, et quil soit substitu,  lentre de la totalit de ces denres dans tous les ports du roaume, un droit uniforme `}{`[`}{``}{`]`}{` : que le terrage des sucres tant dfavorable  la navigation, sil nest pas possible de linterdire entirement dans nos colonies, comme il lest dans les colonies anglaises, il soit au moins dfendu `}{`[`}{``}{`]`}{` de ltendre davantage par de nouveaux tablissemens, et que, les sucres bruts devant tre, ainsi que le coton, considrs comme matire premire, il soit mis un droit  la sortie du roaume des sucres bruts, assez sensible pour que la plus grande quantit de cette matire soit conserve en France et serve  relever et  soutenir les raffineries et  procurer du travail, puisque cest dans ces vues que le gouvernement dAngleterre interdit rigoureusement la sortie en nature des sucres bruts imports de ses colonies. Enfin Les dputs demanderont la rvocation de larrt du 14 avril 1785 , qui a cr une nouvelle compagnie des Indes et de celui pour ladmission des trangers dans les isles de France et de Bourbon. `}</p>\n    <p>{`Il faut observer que la participation rocheloise  la navigation au-del du cap de Bonne-Esprance est modeste: ltat des exportations de 1789, nindique que 38060 livres tournois exports vers lInde, et rien vers les Mascareignes (ANOM, COl F 2B 14, tableau 28`}{`]`}{`. Ces donnes semblent toutefois incompatibles avec le dpart du Henri IV pour lle de France et  lle Bourbon, le 9 mai 1789, qui arrive  bon port en fvrier 1790, et qui nest pas un ngrier `}{`[`}{`Toussaint, p. 291`}{`]`}{`  moins que sa cargaison ne viennent entirement dautres directions de Fermes du royaume. En 1787, ce sont trois armements vers les Mascareignes qui partent de La Rochelle: une certaine diversification des armements coloniaux apparat donc, ici comme  Bordeaux, dans les annes 1780, lorsque les profits du commerce antillais incitent  chercher des investissements plus rentables.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`vrifier si cahiers de dolances en parlent. `}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de leau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={3} mdxType=\"Caller\" />\n    <p>{`total exportations eau-de-vie depuis la France et destinations pour mesurer part direction de la Rochelle (en prcisant le bureau des Fermes concerns)`}</p>\n    <p>{`Les congs de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux deau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin dannoter les cargaisons (il le fait 12 fois sur un total de 601 dparts): nous avons donc un aperu global de la navigation, sans pouvoir distinguer la nature des produits. `}{`[`}{`extrait de louvrage sur Tonnay-Charente, paru en 2012:`}{`]`}{` Si on se base sur les seules sorties de lanne 1787, 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent  ltranger (en Angleterre pour les deux tiers, le reste vers les les anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent  Dunkerque. On identifie ici la flotte europenne de leau-de-vie, qui reprsente 22 % du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, compos dune poussire de petits caboteurs (tonnage moyen 35 tx) et qui reprsente tout de mme 30 % du tonnage sortant. Ces navires sont aligns sur une destination unique : la Rochelle. Ils sont pour partie occups  lapprovisionnement de la ville mais une part est certainement relie avec lactivit dentrept des eaux-de-vie que pratiquent les ngociants rochelais. Enfin, des units plus modestes (25 tx en moyenne) voluent au sein de la mer des Pertuis (depuis la Seudre sud jusquaux Sables dOlonne) : elles reprsentent 23 % du tonnage  la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congs dlivrs en 1787 dans ce port concernent les navires avalant et attachs  des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrire et les produits manufacturs de larrire-pays  Tonnay-Charente, leurs matres quittent ce port soit  vide, soit avec une cargaison destine  Rochefort, La Rochelle ou bien aux ports de la mer des pertuis, qui leur fournissent du fret de retour pour leur navigation vers lamont du fleuve Charente. `}{`[`}{`Cette structure du commerce de Tonnay Charente - Rvlateur du commerce deau de vie - pourrait tre montre  laide des diagrammes de Louvain ?`}{`]`}</p>\n    <p>{`Les exportations deau-de-vie charentaise en 1789 sont trs suprieures  la moyenne sculaire. Lexplication rside dans les modifications induites par le Trait dEden de 1786, qui entrane une augmentation extrmement importante des exportations deau-de-vie vers lAngleterre, notamment des eaux-de-vie de qualit produites dans la rgion de Cognac, au dtriment de celles de moindre qualit. Le total des exportations deaux-de-vie franaises vers la Grande-Bretagne passe de 10  15 millions de livres tournois dans les annes 176070,  40 millions en 178789.`}</p>\n    <p>{` -`}{`>`}{` voir valeur export eau-de-vie de la direction de La Rochelle dans le temps), `}</p>\n    <p>{`En effet, les exportations dEaux-de-vie de 1789 semblent anormalement leves :`}</p>\n    <p>{`Il faudrait avoir un graphique sur les exportations totales deau de vie sur la France entire et en particulier sur les gnralits de Bordeaux, Bayonne et Nantes. Il y aussi  partir du milieu des annes 20 une augmentation des exportations  partir des ports mridionaux, en particulier Ste. On pourrait avoir des coupes en 1750, une autre anne (?) et 1789. `}</p>\n    <p>{`Autre ide de visualisation: en 1789, regarder les origines des exports. Il est possible quune partie des exports de la rgion de Cognac passe par Bordeaux, lArmagnac a priori passe par Bayonne (selon Cullen 1998 qui est LA rfrence sur ce thme). Il y aussi des choses intressantes dans larticle de Thierry (2013) sur Tonneau-Charente et Rochefort. Il faut distinguer aussi entre eau de vie simple et eau de vie double dans TOFLIT18, la 2e catgorie correspond je pense  la meilleure qualit (elle est plus chre et on la trouve moins souvent), donc le Cognac (et Armagnac).`}</p>\n    <p>{`Par ailleurs, daprs Cullen le commerce dexportation des eaux de vie connat une croissance forte aprs la fin de guerre dindpendance amricaine, mais il na pas de stat trs dtaill pour 1789.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={4} mdxType=\"Caller\" />\n    <p>{``}</p>\n    <p>{`Denre pondreuse de faible valeur, le sel voyage ds que cela est possible par voie maritime. Les ctes de la rgion tudie sont, avec celles du sud de la Bretagne, de trs grands producteurs de sel. Les marchs sont aussi bien nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment  la grande pche - que vers les pays de lEurope du Nord, qui sapprovisionnent galement au Portugal (Setubal). `}</p>\n    <p>{`Le bureau des fermes de Marennes est en absolu le principal exportateur de sel en France (quantits), si lon inclut aussi les quantits expdies vers les ports francs franais. Il vient en troisime position, derrire les bureaux du Croisic et de Saint-Martin-de-R, si on se limite aux marchs extrieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas trs leves, compares  celles des flux commerciaux dont il a t question pour La Rochelle et Tonnay-Charente: le sel export depuis Marennes, y compris  destination des ports francs franais, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers ltranger). En revanche, son commerce alimente un mouvement portuaire extrmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la rgion tudie. Son commerce maritime est donc une activit importante, tant pour la production locale quil soutient, que pour lactivit induite lie  son transport (construction navale, emploi maritime).`}</p>\n    <p>{`Tous les flux sont l : `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=http://toflit18.medialab.sciences-po.fr/%23/exploration/flows?sourceType%3DBest%2520Guess%2520customs%2520region%2520product%2520x%2520partner%26productClassification%3Dproduct_revolutionempire%26product%3D%255B%2522Sel%257Eproduct_revolutionempire%2522%255D%26page%3D0%26region%3D%2524all%2524%26kind%3Dtotal%26dateMin%3D1789%26dateMax%3D1789%26columns%3D%255B%2522product%2522%252C%2522region%2522%252C%2522year%2522%252C%2522partner%2522%252C%2522import%2522%252C%2522value%2522%252C%2522unitPrice%2522%252C%2522source%2522%252C%2522rawUnit%2522%255D%26orders%3D%255B%257B%2522key%2522%253A%2522unitPrice%2522%252C%2522order%2522%253A%2522DESC%2522%257D%255D&sa=D&source=editors&ust=1626443515642000&usg=AOvVaw0rWZW_9ioiosSWvHWsrLDU\"\n      }}>{`http://toflit18.medialab.sciences-po.fr/`}{`#`}{`/exploration/flows?sourceType=Best%20Guess%20customs%20region%20product%20x%20partner`}{`&`}{`productClassification=product`}{`_`}{`revolutionempire`}{`&`}{`product=%5B%22Sel%7Eproduct`}{`_`}{`revolutionempire%22%5D`}{`&`}{`page=0`}{`&`}{`region=%24all%24`}{`&`}{`kind=total`}{`&`}{`dateMin=1789`}{`&`}{`dateMax=1789`}{`&`}{`columns=%5B%22product%22%2C%22region%22%2C%22year%22%2C%22partner%22%2C%22import%22%2C%22value%22%2C%22unitPrice%22%2C%22source%22%2C%22rawUnit%22%5D`}{`&`}{`orders=%5B%7B%22key%22%3A%22unitPrice%22%2C%22order%22%3A%22DESC%22%7D%5D`}</a></p>\n    <p>{`(mais pas par bureau).`}</p>\n    <p>{`Grosses variations de prix. Pas mal de prix absurdes. Dun peu moins de 36 livres  10 sous le quintal (!) `}</p>\n    <p>{`Exports par bureau (y compris vers la France): `}</p>\n    <p>{`Exports par bureau hors la France : `}</p>\n    <p>{`Marchs pour les exports :`}</p>\n    <p>{`Marchs pour les exports de Marennes:`}</p>\n    <p>{`Les donnes sur la navigation aident  prciser la gographie commerciale du sel export depuis Marennes, mme si elles nindiquent les quantits exportes. Dans la mesure o les navires qui le transportent sortent souvent chargs entirement de sel, on peut de manire approximative additionner le total des tonnages des navires chargs de sel pour avoir un ordre de grandeur des trafics.  compter du rgne de Louis XIV, la lgislation relative aux gabelles fait dailleurs obligation au chargeur de naviguer avec une cargaison complte. Le tonnage des navires chargs de sel est donc un assez bon indicateur des quantits exportes.`}</p>\n    <p>{`Les congs confirment que, parmi les ports exportateurs de la rgion tudie, la primaut revient incontestablement  Marennes: en 1787, le tonnage additionn de navires sortis de ports franais avec du sel y est de plus du double qu Ars-en-R, le deuxime grand exportateur de la rgion. Mme en prenant en compte la survaluation des tonnages de navires  Marennes, que nous avons constate en comparant le tonnage dun mme navire relev en plusieurs ports, Marennes demeure le principal fournisseur de sel en France, ce qui est confirm par la Balance du commerce. La carte indique le tonnage total des navires sortis chargs du sel dans les ports de la France atlantique et leurs destinations.`}</p>\n    <p>{`Lexportation de sel est en outre une activit quasi exclusive  Marennes : sur 1174 dparts en 1787, 990 ont charg du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    <p>{`Les destinations des navires chargs de sel partis de Marennes montrent que le march national est nettement plus important que les marchs trangers additionns. Marennes simpose donc comme un fournisseur privilgi pour les greniers  sel des gabelles, ainsi que le montre la gographie des destinations franaises: elles sont souvent des ports de rupture de charge sur des estuaires : Honfleur, Nantes, Bordeaux et Libourne (sur la Dordogne), ou de ports francs (Bayonne et Dunkerque). Cette situation est peut-tre  lorigine de la surestimation des tonnages constate dans ce seul port de Marennes, qui travaille vraisemblablement sous le regard serr des agents de la Ferme. Les bureaux des fermes associs aux autres grandes zones de production de sel - Le Croisic et Saint-Martin-de-R - montrent une plus grande internationalisation du trafic.`}</p>\n    <p>{`Pistes possibles:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`dvp texte sur marchs extrieurs avec valeur et quantits (Toflit) et faire calcul valeur/tx`}</li>\n      <li parentName=\"ul\">{`regarder si Chambre de commerce et cahiers de dolances parlent du commerce du sel`}</li>\n      <li parentName=\"ul\">{`Piste: vrifier qui, parmi les ports exportateurs du sel, ont de liens forts avec ltranger et mettre cela en relation, ventuellement, aux tirants deau - tonnage moyen des navires exportateurs par destination et par port de dpart. En clair: est-ce que Marennes exporte plus vers ltranger que vers le march national compar aux autres ports qui vendent du sel? ici on a besoin de lexpertise de Thierry`}</li>\n      <li parentName=\"ul\">{`Il y a un ouvrage rcent publi aux PUR (et lisible sur openedition) avec 2 articles sur le sujet. Je (Loc) nai pas eu le temps de les lire.`}</li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de leau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 2 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"8 min read\",\"minutes\":7.21,\"time\":432600,\"words\":1442}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`En 1789, les navires des ports locaux exportateurs de sels (Marennes, Rochefort, Ars en R) ont un tonnage moyen plus important que ceux de la Rochelle. De manire plus surprenante, la quantit de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de R, voire mme Rochefort - tmoigne dun dynamisme qui chappe largement au port dominant, La Rochelle. Cette particularit sinscrit dans une histoire maritime longue de la rgion centre-ouest.`}</p>\n    <p>{`Jusqu la perte des colonies nord-amricaines, le port de La Rochelle a cultiv une certaine spcificit gographique. Quoique le port de La Rochelle pratiquait, comme la presque totalit des ports atlantiques, le commerce antillais et ngrier, une part importante et qui a progressivement augment jusqu reprsenter plus de la moiti de ses armements pour les colonies dans les annes 1750 tait constitu par le commerce nord-amricain - Canada, Louisiane et pcheries de Terre-Neuve. Cette spcificit gographique a galement influ sur sa spcialisation par produits. Le commerce des fourrures est ainsi une spcialit rochelaise jusquau dbut des annes 1760. Les fourrures taient importes non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de lOhio. Ces fourrures taient pour partie r-exportes en France et en Europe (principalement vers lespace allemand et en Suisse). Une part importante, les peaux de castors en particulier, ntaient pas r-exportes, mais alimentaient lindustrie de chamoiserie niortaise et dautres localits franaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matires premires et en produits manufacturs. LAmrique du Nord tait donc un dbouch important et facile pour les crales de la rgion, les toffes locales de basse qualit et, dans une moindre mesure, le sel ncessaire aux pcheries de Terre-Neuve. Ainsi, ce commerce quoique modeste avant les annes 1740 fournissait des volumes importants demploi dans ces trois secteurs de lconomie rgionale et contribuait  faire du port de La Rochelle, le centre de gravit du complexe portuaire rgional. Cette domination tait renforce par la domination des capitaux rochelais qui sinvestissaient de manire prioritaire dans le commerce Atlantique - Nord amricain et Antillais. Cette domination se mesurait notamment au dbut du sicle par la prsence des bureaux principaux des maisons de Cognac  La Rochelle. Mais, ds la crise qui suivit la chute du systme de Law, La Rochelle commena  perdre sa place et Tonnay-Charente  saffirmer comme le principal port dexportation de leau-de-vie produite dans la rgion, et du Cognac en particulier. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Ainsi, mme si le port de la Rochelle domine les autres ports de la rgion par la diversit des produits quil importe et exporte et, surtout, par son activit dans le commerce atlantique, les changes des ports de la rgion sont largement autonomes comme le montre le rseau des voyages de la rgion PASA de 1787 compar  ceux des deux autres rgions situes au nord (la Loire-Atlantique) et au sud (lAquitaine). Les indices de centralit compares avec dautres rgions domines par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacit  structurer les trafics maritimes locaux.`}</p>\n    <p>{`Ce constat peut tre li historiquement  la perte des colonies Nord-amricaines (Canada et Louisiane) qui a bris une dynamique vertueuse qui stait tablie dans annes postrieures  la guerre de succession dAutriche. En effet, avant 1748, le commerce des Antilles en droiture et la traite ngrire continuaient  dominer le commerce de la Direction de la Rochelle en valeur, tant donn le dynamisme limit de la demande manant de lAmrique du Nord. Mais, ds la fin de la guerre de Succession dAutriche, souvre une priode de croissance exceptionnelle pour le commerce avec lAmrique du Nord. Sur la priode 17481758, La Rochelle reoit annuellement plus de 1 million 300 mille livres de peaux dAmrique du Nord, soit presque autant en valeur que de sucre des Antilles (1 million 450 mille livres). Le nombre darmements  destination du Canada est multipli par deux alors que celui pour la Louisiane augmente de moiti. Par rapport aux annes prcdant la guerre, le trafic li au commerce triangulaire baisse en moyenne dun quart pour les Antilles et de plus de moiti pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et mme Dunkerque et Marseille. A linverse, les rochelais ont un monopole de fait pour la Louisiane qui nintresse gure les ports plus importants et seul Bordeaux les concurrence pour lapprovisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilits complmentaires. Dun ct, le commerce  destination du Canada pouvait se transformer en commerce triangulaire invers - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les les  sucre en morue sale et, plus rarement, en crales. La Louisiane permettait galement de raliser des oprations de contrebande avec les colons espagnols, offrant la possibilit de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1986).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limit en volume, mais crateur demplois locaux et, au milieu du sicle, facteur dun dynamisme certain scroule avec la perte des colonies franaises nord-amricaines  la fin de la Guerre de Sept ans. Cette perte dstructure durablement le commerce rochelais qui perd ses marchs privilgis et sa position dominante au sein du rseau portuaire rgional. En 1789, le commerce du port de la Rochelle est quasi-exclusivement colonial - prs de 90% de ses exportations en valeur sont destins  la traite africaine et aux Antilles. Les graphiques que nous proposons illustrent fidlement ces remarques. Ce dclin est visible sur le graphiqueprcdent o linfrastructure de la province de lAunis apparat originale par le faible poids relatif de son port principal - La Rochelle - incapable de freiner le dveloppement des ports quil maintenait dans sa dpendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-R. Dans la priode pr-rvolutionnaire (17871789), les flux de navires comme de marchandises tmoignent de la recomposition de lconomie de la faade maritime. Dsormais, la valeur des flux de marchandises au dpart de Tonnay-Charente et  larrive de Rochefort, qui entretient directement les productions locales, se rapprochent de ceux de La Rochelle.`}</p>\n    <p>{`Cette volution est la consquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des ngociants rochelais, consquence directe de la vague de faillites qui secouent le milieu  la fin de la Guerre de Sept Ans; la fermeture des marchs nord-amricains subventionns qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite ngrire. Pour lanimer, les ngociants rochelais se procurent les marchandises ncessaires  ce commerce dans toute la France et lEurope et ne se fournissent que trs peu dans larrire-pays rochelais. Le port nest donc plus rellement connect  larrire-pays et ce, dautant plus, que la faiblesse capitalistique de la place loigne les maisons de commerce spcialises dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux  Tonnay-Charente ou  Paris. `}</p>\n    <Caller id=\"partie-3-comparaison-exports-coloniaux\" mdxType=\"Caller\" />\n    <p>{`Il y a aussi lautorisation accorde en 1775  Rochefort de faire le commerce colonial, qui signale la perte de pouvoir de La Rochelle.`}</p>\n    <p>{`Argument du paragraphe final: `}</p>\n    <p>{`Spcialisations des ports, mais sans complmentarit: Marennes (Sel), La Rochelle (colonial), Rochefort (commerce dimportation), Tonnay-Charente (eau de vie dont eau de vie double) et ports de lIle de R (sel + eau-de-vie).`}</p>\n    <p>{`Tonnage au dpart des ports des diffrentes provinces en 1787, agrg suivant que la destination est au sein de la mme province (local  droite) ou en dehors (externe  gauche)`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle  destination des colonies:`}</p>\n    <p>{`1 865 652 livres tournois`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle  destination du reste du monde (y compris local): 240 500`}</p>\n    <p>{`Les exportations du bureau de La Rochelle pour les colonies et les traite reprsente 88,58% du total des exportations`}</p>\n    <p>{`Pour montrer que La Rochelle ne structure pas rgion, faire voir faible impact sur rgion:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`ce qui rentre des colonies en ressort (visu reexport/pas reexport)`}</li>\n      <li parentName=\"ul\">{`tudier et visualiser origines des produits exports pour traite et commerce colonial`}</li>\n    </ul>\n    <p>{`Guillaume D.: Remarque : Jai fait pour 1789. Plus calmement :`}</p>\n    <p>{`!`}{`[`}{`]`}{`(cid:`}<a parentName=\"p\" {...{\n        \"href\": \"mailto:4B3595B0-62E8-43D9-A20A-482ECAB697D4@mac.com\"\n      }}>{`4B3595B062E843D9-A20A-482ECAB697D4@mac.com`}</a>{` \"PastedImage.png\")`}</p>\n    <p>{` Monde  cest hors colonies (probablement les rexports coloniales)`}</p>\n    <p>{`Donc hors r-exports, je pense que les chiffres de Loc sont bons.`}</p>\n    <p>{`use \"/Users/guillaumedaudin/Documents/Recherche/Commerce International Franais XVIIIe.xls/Balance du commerce/Retranscriptions`}{`_`}{`Commerce`}{`_`}{`France/Donnes Stata/bdd courante.dta\", clear`}</p>\n    <p>{`keep if year==1789`}</p>\n    <p>{`keep if customs`}{`_`}{`office==\"La Rochelle\"`}</p>\n    <p>{`tab partner`}{`_`}{`simplification if partner`}{`_`}{`grouping==\"Monde `}</p>\n    <p>{`collapse (sum) value, by (partner`}{`_`}{`grouping)`}</p>\n    <p>{`egen total = total(value)`}</p>\n    <p>{`gen pcrt = value/total`}</p>\n    <p>{`br`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 3 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.02,\"time\":1200,\"words\":4}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{` propos - TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`About TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\n\nfunction SvgComponent ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgComponent;","import GeoComponent from './GeoComponent';\n\nexport default GeoComponent;","import TriangleComponent from './TriangleComponent';\n\nexport default TriangleComponent;","import BezierComponent from './BezierComponent';\n\nexport default BezierComponent;","import React, { useState, useEffect } from 'react';\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport { None } from 'vega';\n\n\nconst BezierComponent = ({\n    dataFilename,\n    totalWidth = 1200,\n    rowHeight = 200,\n    cx,\n    cy,\n    r,\n    inPercentage\n    // start,\n    // end\n}) => {\n\n    // raw marker data\n    const [data, setData] = useState(null);\n\n    const [loadingData, setLoadingData] = useState(true);\n\n\n\n    /**\n     * Marker data loading\n     */\n    useEffect(() => {\n        if (dataFilename) {\n            const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n            get(dataURL)\n                .then(({ data: csvString }) => {\n                    const newData = csvParse(csvString);\n\n                    setData(newData);\n                    setLoadingData(false);\n                })\n                .catch((err) => {\n                    setLoadingData(false);\n                })\n        }\n\n    }, [dataFilename])\n\n    if (loadingData) {\n        return (\n            <div>Chargement des donnes ...</div>\n        )\n    } else if (!data) {\n        return (\n            <div>Erreur ...</div>\n        )\n    }\n    // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n    // ${70} ${140}, ${110} ${140}, ${110} ${110} \n    // a ${R} : aire selon x de l'ellipse, ${R} : aire selon y de l'elipse, 0 : rotation de l'ellipse selon x, 1, 0 : sweep-flag (dtermine si larc doit commencer son mouvement  un angle ngatif ou positif), -(${R} * 2) 0 : coords de l'arrive\n\n    const partialCircle = require('svg-partial-circle')\n\n    let start = None\n    let end = None\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (inPercentage - 50) / 100 * Math.PI \n    end = Math.PI * 3 / 2 - (inPercentage - 50) / 100 * Math.PI\n\n    const leftPath = partialCircle(\n        cx, cy,         // center X and Y\n        r,              // radius\n        start,          // start angle in radians --> Math.PI / 4\n        end             // end angle in radians --> Math.PI * 7 / 4\n    )\n    .map((command) => command.join(' '))\n    .join(' ')\n    console.log(`<path d=\"${leftPath}\" />`)\n\n    const rightPath = partialCircle(\n        cx, cy,             // center X and Y\n        r,                  // radius\n        start,              // start angle in radians --> Math.PI / 4\n        end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n    .map((command) => command.join(' '))\n    .join(' ')\n    console.log(`<path d=\"${rightPath}\" />`)\n\n    return (\n        <div className=\"BezierComponent\">\n            \n            <svg width={1000} height={800} style={{ border: '1px solid lightgrey' }}>\n\n                <path \n                    d={`${leftPath}\n                    `} \n                    stroke=\"blue\" \n                    stroke-width=\"10\" //  ajuster en fonction de la largeur de l'cran\n                    fill=\"transparent\"\n                />\n\n                <path \n                    d={`${rightPath}\n                    `} \n                    stroke=\"red\" \n                    stroke-width=\"10\" //  ajuster en fonction de la largeur de l'cran\n                    fill=\"transparent\"\n                />\n            </svg>\n        </div>\n    );\n\n}\n\nexport default BezierComponent;\n","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: str }) => {\n          const extension = dataFilename.split('.').pop();\n          let newData;\n          if (extension === 'csv') {\n            newData = csvParse(str);\n          } else if (extension === 'geojson' || extension === 'json') {\n            newData = str;\n          }\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data\n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"9 min read\",\"minutes\":8.1,\"time\":486000,\"words\":1620}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgComponent from '../../components/SvgComponent';\nimport VegaComponent from '../../components/VegaComponent';\nimport SigmaComponent from '../../components/SigmaComponent';\nimport GeoComponent from '../../components/GeoComponent';\nimport TriangleComponent from '../../components/TriangleComponent';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport BezierComponent from '../../components/BezierComponent';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\nimport { renderLabel, renderStep3Object } from '../../visualizations/PrincipalVisualizationPart3/renderObjectsFunctions.js'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <p>{`Test en prod`}</p>\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + donnes avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h3 {...{\n      \"id\": \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\"\n    }}>{`Fond de carte - test custom layer avec config coast from Nantes to Bordeaux`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step3_viz_customs_offices_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname'\n          }\n        }, {\n          type: 'custom',\n          data: visData,\n          renderObject: renderStep3Object\n        }]} projectionTemplate='coast from Nantes to Bordeaux' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider> \n    <h3 {...{\n      \"id\": \"fond-de-carte---test-flows-avec-config-world\"\n    }}>{`Fond de carte - test flows avec config World`}</h3>\n    <DataProvider data={'world_1789_23mars2021_level0.json'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'aggregated_flows.json'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'flows',\n          data: visData,\n          size: {\n            field: 'tonnages_cumuls'\n          }\n        }]} projectionTemplate='World' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-france\"\n    }}>{`Fond de carte - config France`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'ports_locations_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'admiralty',\n            palette: colorPalettes.admiralties\n          },\n          size: {\n            field: 'customs_region'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='France' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-rotated-poitou\"\n    }}>{`Fond de carte - config rotated Poitou`}</h3>\n    <DataProvider data={'cartoweb_france_1789_geojson.geojson'} mdxType=\"DataProvider\">\n  {backgroundData => <DataProvider data={'part_3_step1_viz_data.csv'} mdxType=\"DataProvider\">\n        {visData => <GeoComponent layers={[{\n          type: 'choropleth',\n          data: backgroundData,\n          color: {\n            field: 'shortname',\n            palette: colorPalettes.provinces\n          }\n        }, {\n          type: 'points',\n          data: visData,\n          color: {\n            field: 'customs_office',\n            palette: colorPalettes.customs_office\n          },\n          size: {\n            field: 'mean_tonnage'\n          },\n          label: {\n            field: 'port'\n          }\n        }]} projectionTemplate='rotated Poitou' height={800} width={1200} mdxType=\"GeoComponent\" />}\n      </DataProvider>}\n    </DataProvider>\n    <h3 {...{\n      \"id\": \"fond-de-carte---config-poitou\"\n    }}>{`Fond de carte - config Poitou`}</h3>\n    <p>{`Cartographie des destination des bateaux aillant un port dattache dans la rgion, par tonnage cumul (couleur = amiraut) :`}</p>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels projectionTemplate='Poitou' height={800} width={1200} mdxType=\"GeoComponent\" />\n    <h2 {...{\n      \"id\": \"fond-de-carte-sans-template-pour-la-config\"\n    }}>{`Fond de carte sans template pour la config`}</h2>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeoComponent\" />\n    <h2 {...{\n      \"id\": \"test-courbes-de-bzier\"\n    }}>{`Test courbes de bzier`}</h2>\n    <BezierComponent dataFilename=\"part_3_step3_viz_customs_offices_data.csv\" cx={300} cy={250} r={210} inPercentage={10} start={Math.PI / 2} end={Math.PI * 3 / 2} mdxType=\"BezierComponent\" />\n    {\n      /* # Tests composant LineChart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data.filter(d => d.region === 'France')}\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 5,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n             annotations={[\n                   {\n                     type: 'span',\n                     start: 1756,\n                     end: 1763,\n                     axis: 'x',\n                     label: 'guerre de sept ans'\n                   },\n                   {\n                     type: 'span',\n                     start: 400000000,\n                     end: 500000000,\n                     axis: 'y',\n                     label: 'priode de faste'\n                   }\n                 ]}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de titre\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de line chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`,\n               fillGaps: true\n             }}\n             color={{\n               field: 'region',\n               title: 'Rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <LineChart\n             data={data}\n             title=\"test de linechart (minimum de props)\"\n             // width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               // title: 'anne',\n             }}\n             y={{\n               field: 'Imports',\n               // title: 'imports',\n               // tickSpan: 100000000,\n               // tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               // title: 'Rgion'\n             }}\n             // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      # Tests composant BarChart\n      ## Horizontal bar chart\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (sans fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             annotations={[\n               {\n                 type: 'span',\n                 start: 1756,\n                 end: 1763,\n                 axis: 'x',\n                 label: 'guerre de sept ans'\n               },\n               {\n                 type: 'span',\n                 start: 400000000,\n                 end: 500000000,\n                 axis: 'y',\n                 label: 'priode de faste'\n               }\n             ]}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart (fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, fill gaps)\"\n             width={window.innerWidth - 20}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (grouped, fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n               fillGaps: true\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped, no fill gaps)\"\n             width={window.innerWidth - 20}\n             layout={'groups'}\n             x={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             y={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 100000000,\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      ## Vertical bar charts\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => d.region === 'France')}\n             title=\"Test de bar chart\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               // tickSpan: 1000000,\n               //tickFormat: v => `${v} lt.`\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             height={200}\n             y={{\n               field: 'year',\n               title: 'anne',\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_LR_partners.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data}\n             title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\"\n             // width={window.innerWidth - 20}\n             orientation=\"vertical\"\n             y={{\n               field: 'year',\n               title: 'anne',\n               rowHeight: 30,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickFormat: v => `${v} lt.`\n             }}\n             color={{\n               field: 'partner',\n               title: 'partenaire'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`}\n           />\n         )\n       }\n      </DataProvider>\n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      <DataProvider data={'decline_longitudinal_data.csv'}>\n       {\n         data => (\n           <BarChart\n             data={data.filter(d => +d.year < 1750)}\n             title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\"\n             width={window.innerWidth - 20}\n             orientation={'vertical'}\n             layout={'groups'}\n             y={{\n               field: 'year',\n               title: 'anne',\n               tickSpan: 10,\n               rowHeight: 50\n               // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n             }}\n             x={{\n               field: 'Imports',\n               title: 'imports',\n               tickSpan: 50000000,\n               tickFormat: v => `${v / 1000}k lt.`\n             }}\n             color={{\n               field: 'region',\n               title: 'rgion'\n             }}\n             tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`}\n           />\n         )\n       }\n      </DataProvider>\n      \n      ## Test triangle \n      <TriangleComponent \n       dataFilename=\"part_3_step1_viz_data.csv\" \n       rowHeight={300}\n       totalWidth = {1600}\n       />\n      ## Test courbes de bzier\n      <BezierComponent\n       dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n       cx={300}\n       cy={250}\n       r={210}\n       inPercentage={10}\n       // start={Math.PI / 2}\n       // end={Math.PI * 3 / 2}\n       />\n      # Test bateaux\n      <BoatsIllustration />\n      \n      # Commerce multi-chelle dans la rgion de La Rochelle\n      \n      Voici un tour d'horizon des modules react prpars pour faciliter le dveloppement :\n      ## Image SVG (avec webpack)\n      On intgre une image  SVG depuis le local (elle sera donc packe par webpack) :\n      \n      ## Image SVG (sans webpack)\n      On intgre ici directement une image  partir de son URL en ligne (depuis le dossier `public`)\n      ##### ! cass pour le moment\n      // <SvgComponent path =\"/svg/ports-region-1789.svg\" />\n      ## Visualisation vega\n      Les visualisations vega ont besoin d'un fichier csv stock dans le dossier `public/data` et d'une spec vega.\n      <VegaComponent \n       data=\"sorties_navires_vers_colonies.csv\" \n       spec={{\n         \"mark\": \"rect\",\n         \"encoding\": {\n           \"x\": {\n             \"field\": \"port_depart\",\n             \"type\": \"nominal\"\n           },\n           \"y\": {\n             \"field\": \"port_destination\",\n             \"type\": \"nominal\"\n           },\n           \"color\": {\n             \"type\": \"quantitative\",\n             \"field\": \"tonnage\",\n             \"aggregate\": \"sum\"\n           }\n           \n         }\n       }}\n      />\n      ## Rseau avec sigma\n      Les visualisations sigma ont besoin d'un fichier gexf stock dans le dossier `public/data`.\n      Paramtres :\n      * `nodeColor` : attribut pour couleur\n      * `nodeSize` : attribut pour taille\n      * `labelDensity` : densit des labels (float dans [0, 1])\n      \n      <SigmaComponent \n       data=\"toflit_aggregate_1789_only_out.gexf\" \n       nodeColor={`admiralty`}\n       nodeSize={`inside_degree`}\n       labelDensity={0.5}\n      />\n      */\n    }\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        {\n              id: \"fond-de-carte---test-custom-layer-avec-config-coast-from-nantes-to-bordeaux\",\n              level: 3,\n              title: \"Fond de carte - test custom layer avec config coast from Nantes to Bordeaux\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---test-flows-avec-config-world\",\n              level: 3,\n              title: \"Fond de carte - test flows avec config World\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-france\",\n              level: 3,\n              title: \"Fond de carte - config France\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-rotated-poitou\",\n              level: 3,\n              title: \"Fond de carte - config rotated Poitou\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"fond-de-carte---config-poitou\",\n              level: 3,\n              title: \"Fond de carte - config Poitou\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"fond-de-carte-sans-template-pour-la-config\",\n    level: 2,\n    title: \"Fond de carte sans template pour la config\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"test-courbes-de-bzier\",\n    level: 2,\n    title: \"Test courbes de bzier\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\nconst BoatsIllustration = ({\n  width = 1200,\n  height = 100,\n}) => {\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","import { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\nimport {useRef, useEffect} from 'react';\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\n// import Graph from 'graphology-types';\nimport palettes from '../colorPalettes';\n\nconst {generic} = palettes;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\nexport function buildPageTitle (title, lang = 'fr') {\n  const currentMetadata = metadata[lang] || metadataFr;\n  return `${title} | ${currentMetadata.title} | PORTIC`;\n}\n\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\nexport function cartesian2Polar(x, y){\n  const distance = Math.sqrt(x*x + y*y)\n  const radians = Math.atan2(y,x) //This takes y first\n  return { distance:distance, radians:radians }\n}\n\n\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajout startYear et endYear pour\n      // la rcupration de portic il s'agira de dduire ce year des donnes\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble tre indiable mais pas sur qu'on doive pas le mettre dans un format spcial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas  garder dans le rsultats (colonne donnes dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau  une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        //  partir de l, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptes par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intressent dans le rsultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'tait else { ... } et on passait jamais dedans apparemment du coup l c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // diffrencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"aprs le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // mthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // mthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // mthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : rcupre les flux toflit18\n  --- \n  Paramtres :\n  * startYear : <int> # anne de dbut\n  * endYear : <int> # anne de fin\n  * params : <arr> # proprits  renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs  filtrer dans les flux (peut tre une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // a sert  quelque chose ?? pour moi c'est pas utilis, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'tat a ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les rsultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        // console.log(\"finalData : \", finalData);\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\nexport const getToflitFlowsByApi = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest\n}) => {\n\n  return new Promise((resolve, reject) => {\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n    // 1. Test de la validit des paramtres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    const URL = `http://data.portic.fr/api/flows/?date=${year}`;\n    console.log({ URL })\n    // quivalent  : const URL = 'http://data.portic.fr/api/flows/?date=' + year;\n    get(URL) // get de axios\n      // mixed content issue => comme l'API ne fournit pas d'accs HTTPS je me sentais un peu bloque\n      .then(({ data: str }) => {\n        // conversion en js (avec d3-dsv)\n        // const newData = csvParse(csvString);\n        try {\n          const newData = JSON.parse(str);\n          // contraire : JSON.stringify()\n          // faire des choses avec les rsultats (filtres, ...)\n          const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest })\n          resolve(finalData);\n        } catch (e) {\n          reject(e);\n        }\n\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\n\n\n\n\nexport const getPorticPointcallsByApi = ({\n  filename,\n  spec\n}) => {\n\n}\n\n","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nconst Caller = ({id: visualizationId, ...props}) => {\n  const ref = useRef(null);\n  const [id] = useState(genId());\n  const {\n    activeVisualization,\n    onBlockClick,\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  useEffect(() => {\n    // on wrappe dans un setTimeout pour avoir une ref non-nulle vers le composant\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        'is-hidden': process.env.NODE_ENV !== 'development'\n      })}\n    >\n      {\n        process.env.NODE_ENV === 'development' ?\n        <>\n          {\n          visualizationId ?\n          <>caller pour la visualisation <code>{visualizationId}</code> </>\n          :\n          <>caller sans id (agit comme un clearfix)</>\n        }{\n          Object.keys(props).length ? \n            <span>avec les paramtres {JSON.stringify(props)}</span>\n          : null\n        }\n        </>\n        :\n        null\n      }\n      \n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","var map = {\n\t\"./en/about.mdx\": [\n\t\t201\n\t],\n\t\"./en/footer.mdx\": [\n\t\t552,\n\t\t5\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t193\n\t],\n\t\"./en/metadata\": [\n\t\t292,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t292,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t195\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t553,\n\t\t6\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t554,\n\t\t7\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t555,\n\t\t8\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t197\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t199\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t556,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t202\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t200\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t107\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t192\n\t],\n\t\"./fr/metadata\": [\n\t\t293,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t293,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t194\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t196\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t198\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t557,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t203\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 544;\nmodule.exports = webpackAsyncContext;","const Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore t dveloppe</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport {extent, max} from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport {axisPropsFromTickScale} from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n    \n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ',' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n    \n  }, [wholeHeight])\n  \n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n      .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n      .domain([0, max(data, (d) => +d[shareField])])\n      .nice()\n      .range([height - margins.bottom, margins.top]);\n\n  const {values: rightYAxisValues} = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  const {values: leftYAxisValue} = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", {'has-highlights': highlightYears !== undefined})}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 style={{marginLeft: margins.left}}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n            <div className=\"color-scale-container\">\n              <div className=\"color-scale-detail\">\n                <div \n                  className=\"bar\"\n                  style={{\n                    background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                  }}\n                />\n                <div className=\"labels\">\n                  <span>{colorScaleMessages.maximum}</span>\n                  {/* <span>{colorScaleMessages.title}</span> */}\n                  <span>{colorScaleMessages.minimum}</span>\n                </div>\n              </div>\n            </div>\n            : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value/1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n            .map(year => {\n              const x = xBand(year) + xBand.bandwidth() / 2;\n              const y = height - margins.bottom;\n              return (\n                <g\n                  key={year}\n                  className=\"axis-group\"\n                  transform={`translate(${x}, ${y})`}\n                >\n                  <line\n                    x1={0}\n                    x2={0}\n                    y1={0}\n                    y2={margins.bottom / 6}\n                    stroke=\"grey\"\n                  />\n                  <g \n                    transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                  >\n                  <text fill=\"grey\">\n                    {year}\n                  </text>\n                  </g>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations\n            .filter(({startYear: aStartYear, endYear: aEndYear}) => aStartYear >= startYear && aEndYear <= endYear)\n            .map((annotation, annotationIndex) => {\n              const {startYear, endYear, label} = annotation;\n              return (\n                <g className=\"annotation\" key={annotationIndex}>\n                  <rect\n                    x={xBand(startYear)}\n                    width={xBand(endYear) - xBand(startYear)}\n                    height={height - margins.top - margins.bottom}\n                    y={margins.top}\n                    fill=\"url(#diagonalHatch)\"\n                    opacity={.4}\n                  />\n                  <line\n                    x1={xBand(startYear)}\n                    x2={xBand(startYear)}\n                    y1={margins.top}\n                    y2={height - margins.bottom}\n                    stroke=\"grey\"\n                    opacity={.4}\n                    strokeDasharray={'4,2'}\n                  />\n                  <line\n                    x1={xBand(endYear)}\n                    x2={xBand(endYear)}\n                    y1={margins.top}\n                    y2={height - margins.bottom}\n                    stroke=\"grey\"\n                    opacity={.4}\n                    strokeDasharray={'4,2'}\n                  />\n                  <line \n                    x1={xBand(endYear) + 20} \n                    x2={xBand(endYear) + 10} \n                    y1={margins.top + 7.5}\n                    y2={margins.top + 7.5}\n                    stroke=\"grey\" \n                    marker-end=\"url(#arrowhead)\" \n                  />\n                  <text\n                    x={xBand(endYear) + 22}\n                    y={margins.top + 10}\n                    fontSize={'.5rem'}\n                    fill=\"grey\"\n                  >\n                    {label}\n                  </text>\n                  <defs>\n                    <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                    refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                      <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                    </marker>\n                  </defs>\n                  <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                  <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\" \n                        style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                </pattern>\n\n                </g>\n              )\n            })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={yShareScale(0) - yShareScale(d[shareField])}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ? \n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] ||0).toFixed(2)) \n                    .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] ||0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', {'is-highlighted': highlightYears && highlightYears.includes(+d.year)})}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {\n            data\n            .sort((a, b) => {\n              if (+a.year > +b.year) {\n                return 1;\n              }\n              return -1;\n            })\n            .filter((d, index) => {\n              const next = data[index + 1];\n              return index < data.length - 1\n              && (fillGaps ? true : +next.year === +d.year + 1)\n            })\n            .map((datum, index) => {\n              const next = data[index + 1];\n              const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n              const x2 = xBand(+next.year)+ xBand.bandwidth() / 2;\n              const y1 = yAbsoluteScale(+datum[absoluteField]);\n              const y2 = yAbsoluteScale(+next[absoluteField]);\n              if (!+datum[absoluteField]|| !+next[absoluteField]) {\n                return null;\n              }\n              const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n              return (\n                 <line\n                   key={datum.year}\n                   {\n                     ...{\n                       x1,\n                       x2,\n                       y1,\n                       y2\n                     }\n                   }\n                   stroke={colorsPalettes.generic.accent1}\n                   title={`${datum.year}-${next.year}`}\n                   strokeWidth={2}\n                   data-tip={`${datum.year}  <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year}  <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                 />\n              )\n            })\n          }\n\n        </g>\n        \n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n      \n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = wholeHeight;\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${thisYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3 style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg ref={svgRef} className={cx(\"links-container\", {'has-highlights': hoveredProduct})} style={{top: svgOffset}} width={width} height={height}>\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 15])\n\n          return (\n            <div\n            key={year}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d.product, (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d.product}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineComponent from './DeclineComponent';\n\nexport default DeclineComponent;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineComponent.scss';\n\nconst DeclineComponent = (props) => {\n  const {\n    width, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : containerHeight;\n  const messages = {\n    franceOverviewTitle: {\n      fr: (start, end) => `volution de la valeur des exports du royaume de France de ${start}  ${end}`,\n      en: (start, end) => `Evolution of the value of exports from the kingdom of France from ${start} to ${end}`\n    },\n    tradeEvolutionTitle: {\n      fr: (cityName, start, end) => `volution du commerce de la direction des fermes de ${cityName} de ${start}  ${end}`,\n      en: (cityName, start, end) => `Evolution of the direction des fermes of ${cityName} trade from ${start} to ${end}`\n    },\n    top90PctTitle: {\n      fr: (cityName, start, end) => `Comparaison des parts des produits exports par la direction des fermes de ${cityName} totalisant plus de 90% du commerce en ${start} et en ${end} (ports francs non pris en compte)`,\n      en: (cityName, start, end) => `Comparison of shares of the top 90% of exported products by the direction des fermes of ${cityName} in ${start} and in ${end} (ports francs non pris en compte)`,\n    },\n    partInPct: {\n      fr: () => 'part des exports fr.',\n      en: () => 'share of french exports'\n    },\n    absoluteValue: {\n      fr: () => 'valeur absolue des exports',\n      en: () => 'exports\\' absolute value'\n    },\n    herfindalLegendTitle: {\n      // fr: () => `Degr de diversit du commerce (inverse de lindice de Herfindahl)`,\n      // en: () => `Degree of trade diversity (inverse of the Herfindahl index)`,\n      fr: () => `degr de diversit du commerce`,\n      en: () => `degree of trade diversity`,\n    },\n    herfindal0: {\n      fr: () => `commerce peu diversifi`,\n      en: () => `fewly diversified trade`,\n    },\n    herfindal1: {\n      fr: () => `commerce trs diversifi`,\n      en: () => `very diversified trade`,\n    },\n    barTooltip: {\n      fr: (year, pct, city, herfindal) => `En <strong>${year}</strong>, ${pct}% des biens exports depuis la France le sont  partir de <strong>${city}</strong>.<br/><br/>Concentration du commerce <i>(indice de Herfindahl-Hirschmann : somme du carr des parts du march franais par classe de produits exports)</i> : <span>[colorBox] ${herfindal}</span>`,\n      en: (year, pct, city, herfindal) => `In <strong>${year}</strong>, ${pct}% of exported goods from France are exported <strong>${city}</strong>.<br/><br/>Trade concentration <i>(Herfindahl-Hirschmann index : sum of square french market' shares sorted by exported products classes)</i> : <span>[colorBox] ${herfindal}</span>`,\n    },\n    productTooltip: {\n      fr: (year, product, pct) => `En <strong>${year}</strong>, les produits de la classe \"${product}\" reprsentent <strong>${pct}%</strong> de la valeur des biens exports par la direction des fermes de La Rochelle.`,\n      en: (year, product, pct) => `In <strong>${year}</strong>, products classed as \"${product}\" represent ${pct}% of goods exported by La Rochelle's direction des fermes.`,\n    },\n    sevenYearsWar: {\n      fr: () => 'guerre de sept ans',\n      en: () => 'seven years war'\n    },\n    austriaWar: {\n      fr: () => 'guerre de succession dAutriche',\n      en: () => 'guerre de succession dAutriche',\n    },\n    usIndependance: {\n      fr: () => 'guerre dindpendance Amricaine',\n      en: () => 'guerre dindpendance Amricaine',\n    },\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle[lang](startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                label: messages.usIndependance[lang]()\n              },\n\n              \n            ]}\n            fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip[lang]}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                label: messages.usIndependance[lang]()\n              },\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            barTooltipFn={ messages.barTooltip[lang]}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1744,\n                endYear: 1748,\n                label: messages.austriaWar[lang]()\n              },\n              {\n                type: 'span',\n                startYear: 1778,\n                endYear: 1781,\n                label: messages.usIndependance[lang]()\n              },\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products.csv`] || !datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={height/totalRows * rowFlex}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle[lang]('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip[lang]}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineComponent\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineComponent;\n","import Decline from '../components/DeclineComponent';\n\nconst PrincipalVisualizationPart1 = ({width, height, step, ...props}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialComponent.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, trimText } from '../../helpers/misc';\nimport ReactTooltip from 'react-tooltip';\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3]\n\nconst CircularAlluvialComponent = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width = 1200,\n  height : inputHeight = 800,\n  filters = [],\n  debug = false,\n  title,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true,\n  tooltips,\n  lang,\n}) => {\n  const titleRef = useRef(null);\n  const height = titleRef.current ? inputHeight - titleRef.current.getBoundingClientRect().height : inputHeight;\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters]);\n\n  let tooltipContent;\n\n  useEffect(() => {\n    ReactTooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }, [filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 70]).domain([0, 1])\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n  return (\n    <>\n      <h5 ref={titleRef} className=\"visualization-title\">{title}</h5>\n      <svg \n      data-for=\"alluvial-tooltip\"\n      data-tip={tooltipContent}\n      width={width} height={height} className={cx(\"CircularAlluvialComponent\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}>\n        <g  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <g className=\"background-marks\" transform={`translate(${width / 2 - smallestDimension / 2}, 0)`} >\n          <line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </text>\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </text>\n        </g>\n        <g \n        transform={`translate(${width / 2 - smallestDimension / 2}, 0)`}>\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <g\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <g\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleClick = () => {\n                                      if (highlightedFlow && highlightedFlow._id === flow._id) {\n                                        setHighlightedFilter(undefined);\n                                        setHighlightedFlow(undefined);\n                                      }\n                                      else {\n                                        if (highlightedFilter) {\n                                          setHighlightedFilter(undefined);\n                                        }\n                                        setHighlightedFlow({...flow, stepIndex});\n                                      }\n                                      \n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH;\n                                      y3 += BAR_WIDTH;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH;\n                                      y4 += BAR_WIDTH;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    const {flow_type, customs_office, product, partner} = flow;\n                                    const value = flow[sumBy];\n                                    const tContent = tooltips.flow[lang]({flow_type, customs_office, product, sumBy, value, partner})\n                                    return (\n                                      <g\n                                        onClick={handleClick}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                        data-for=\"alluvial-tooltip\"\n                                        data-tip={tContent}\n                                      >\n                                        {/* <path \n                                    d={`\n                                    M ${x1} ${y1} \n                                    Q ${controlPoint1AX} ${controlPoint1AY}, ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    Q ${controlPoint2AX} ${controlPoint2AY}, ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                    title={'Valeur : ' + flow.valueAbs}\n                                    style={{fill: colorScales[step.field][node.id]}}\n                                  /> */}\n                                        <path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </g>\n                                    )\n                                  })\n                              }\n                            </g>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH;\n                        }\n                        const handleClick = () => {\n                          if (highlightedFilter && highlightedFilter.value === node.id) {\n                            setHighlightedFlow(undefined);\n                            setHighlightedFilter(undefined);\n                          }\n                          else {\n                            if (highlightedFlow) {\n                              setHighlightedFlow(undefined);\n                            }\n                            setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                          }\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                          // console.groupEnd('test');\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        const tContent = tooltips.node[lang](node, stepIndex);\n                        return (\n                          <g\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onClick={handleClick}\n                            data-for=\"alluvial-tooltip\"\n                            data-tip={tContent}\n                          >\n                            <rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <g\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <text\n                                style={{\n                                  fontSize: labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </text>\n                            </g>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 ||stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </g>\n                        )\n                      })\n                    }\n\n                  </g>\n                )\n              })\n          }\n        </g>\n        </g>\n      </svg>\n      <ReactTooltip id=\"alluvial-tooltip\" />\n    </>\n  )\n}\n\nexport default CircularAlluvialComponent;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import {useMemo} from 'react';\nimport CircularAlluvialComponent from \"../../components/CircularAlluvialComponent/CircularAlluvialComponent\";\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport './PrincipalVisualizationPart2.scss';\n\nconst PrincipalVisualizationPart2 = ({\n  width, \n  height: containerHeight, \n  datasets, \n  showOnlyToflit = false, \n  atlasMode, \n  lang = 'fr', \n  ...props\n}) => {\n  const {step} = props;\n  const height = atlasMode ? 1200 : containerHeight;\n  const {sumToflitBy, alluvialFilters} = useMemo(() => {\n    let sumBy = 'value';\n    let filters = [];\n    switch(step) {\n      case 2:\n        filters = [\n          {\n            key: 'product',\n            value: `produit colonial ('Caf', 'Sucre', 'Indigo', 'Coton non transform')`\n          },\n          {\n            key: 'partner',\n            value: `Afrique`\n          },\n          {\n            key: 'partner',\n            value: `Colonies`\n          }\n        ];\n        break;\n      case 3:\n        filters = [\n          {\n            key: 'product',\n            value: `eau-de-vie et vins divers`\n          }\n        \n        ];\n        break;\n      case 4:\n        filters = [{\n          key: 'product',\n          value: `sel`\n        }];\n        sumBy = 'product_weight_kg'\n        break;\n      default:\n        break;\n    }\n\n    return {\n      sumToflitBy: sumBy,\n      alluvialFilters: filters\n    }\n  }, [step]);\n  const titles = {\n    fr: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`,\n    en: `changes de la direction des fermes de La Rochelle en 1789 par produit et partenaire, dimensionns selon leur ${sumToflitBy === 'value' ? 'valeur commerciale' : 'poids de marchandises'}`\n  };\n  return (\n    <div className=\"PrincipalVisualizationPart2\">\n     <div>\n        <CircularAlluvialComponent\n          data={datasets['part_2_toflit_viz_data.csv']}\n          width={showOnlyToflit ? width : width / 2}\n          height={height}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          lang={lang}\n          title={titles[lang]}\n          tooltips={{\n            node: {\n              fr: ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `En 1789, le bureau des fermes de ${id} a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} de ${id}.`;\n                } else {\n                  return `En 1789, la direction des fermes de La Rochelle a ${step < 3 ? 'export' : 'import'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} vers le partenaire ${id}.`;\n                }\n              },\n              en: () => ({id, ...node}, step) => {\n                if (step === 0 || step === 5) {\n                  return `In 1789, the bureau des fermes of ${id} has ${step < 3 ? 'imported' : 'exported'} ${node[sumToflitBy]} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'}.`;\n                } else if (step === 1 || step === 4) {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} of ${id}.`;\n                } else {\n                  return `In 1789, the direction des fermes de La Rochelle has ${step < 3 ? 'imported' : 'exported'} ${node.valueAbs} ${sumToflitBy === 'value' ? 'livres tournoi' : 'kg'} to the partner ${id}.`;\n                }\n              },\n            },\n            flow: {\n              fr: ({flow_type, customs_office, product, sumBy, value, partner}) => `En 1789, le bureau des fermes de ${customs_office} a ${flow_type === 'import' ? 'import' : 'export'} ${value} ${sumBy === 'value' ? 'livres tournois' : 'kg'} de ${product} ${flow_type === 'import' ? 'depuis' : 'vers'} le partenaire ${partner}`,\n              en: ({flow_type, customs_office, product, sumBy, value, partner}) => `In 1789, the bureau des fermes of ${customs_office} has ${flow_type === 'import' ? 'imported' : 'exported'} ${value} ${sumBy === 'value' ? 'livres tournois' : 'kg'} of ${product} ${flow_type === 'import' ? 'from' : 'to'} the partner ${partner}`,\n            }\n          }}\n          steps={[\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extrieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n          ]}\n        />\n     </div>\n     <div className=\"radar-container\">\n       <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} />\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\n\nimport SigmaComponent from '../../components/SigmaComponent';\nimport GeoComponent from '../../components/GeoComponent/GeoComponent';\nimport { renderStep3Object, renderStep3SmallMultiples, renderTriangles } from './renderObjectsFunctions'; // pas sur que a reste  terme\nimport BarChart from '../../components/BarChart';\nimport colorPalettes from '../../colorPalettes.js';\n\nimport './PrincipalVisualizationPart3.scss';\n\n\nconst PrincipalVisualizationPart3 = ({ datasets, step, width, height }) => {\n  return (\n    <div className=\"PrincipalVisualizationPart3\" height={height}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        <GeoComponent\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['cartoweb_france_1789_geojson.geojson']\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step1_viz_data.csv'],\n              renderObjects: renderTriangles\n            }\n          ]}\n          projectionTemplate='rotated Poitou'\n          height={height}\n          width={width}\n        />\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })}>\n        <>\n          <div className=\"graphs-container\" style={{ position: 'relative', height: height * .6 }}>\n            <div className=\"graph-container\" style={{ width: width * .6, height: height * .6, position: 'absolute' }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_La Rochelle.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                ratio={1.1}\n                title={'Rseau des voyages partant ou arrivant dans la rgion PASA en 1787 ...'}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, top: 0 }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_Bordeaux.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                spatialize\n                title={'...compar  celui de l\\'amiraut de Bordeaux'}\n                ratio={1}\n              />\n            </div>\n            <div className=\"graph-container\" style={{ width: width * .4, height: height * .3, position: 'absolute', right: 0, bottom: 0 }}>\n              <SigmaComponent\n                data={datasets['flows_1787_around_Nantes.gexf']}\n                nodeSize={`degree`}\n                labelDensity={1}\n                nodeColor={{\n                  field: 'internal',\n                  palette: {\n                    'interne  la rgion': colorPalettes.generic.dark,\n                    'externe  la rgion': colorPalettes.generic.accent2,\n                  }\n                }}\n                title={'...compar  celui de l\\'amiraut de Nantes'}\n                ratio={1}\n                spatialize\n              />\n            </div>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            left: 0,\n            width: width * .3,\n            height: height * .3\n          }}\n            className=\"ColorLegend\"\n          >\n            <h5>Lgende des rseaux</h5>\n            <ul className=\"color-legend\">\n              <li>\n                Taille des points reprsentant les ports : nombre de liens avec d'autres ports dans le rseau\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.dark }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port interne  la rgion\n                </span>\n              </li>\n              <li>\n                <span style={{ background: colorPalettes.generic.accent2 }} className=\"color-box\"></span>\n                <span className=\"color-label\">\n                  Port externe  la rgion\n                </span>\n              </li>\n            </ul>\n          </div>\n          <div style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: width * .7,\n            height: height * .3\n          }}>\n            <BarChart\n              data={datasets['part_3_centralite_comparaison.csv']}\n              title=\"Centralit compare de La Rochelle par rapport  PASA et, pour ses rgions ctires voisines, du port principal par rapport au rseau des voyages de son amiraut (1787)\"\n              width={width * .7}\n              height={height * .3}\n              orientation={'vertical'}\n              layout={'groups'}\n              y={{\n                field: 'port',\n                title: 'Port (dans son rseau local)',\n              }}\n              x={{\n                field: 'score',\n                title: 'Score',\n                // tickSpan: .1,\n                // tickFormat: (d, i) => parseInt(d * 100) + '%'\n              }}\n              color={{\n                field: 'metrics_type',\n                title: 'Type de mtrique',\n                palette: {\n                  'PageRank': colorPalettes.generic.dark,\n                  'betweenness centrality': colorPalettes.generic.accent1,\n                }\n              }}\n              margins={{\n                bottom: 20\n              }}\n              tooltip={d => d.metrics_type === 'PageRank' ? 'Le PageRank est une mesure de centralit qui consiste  donner  chaque port un score proportionnel  la somme des pageranks des ports avec lesquels il a des voyages en commun.' : 'La centralit intermdiaire est une mesure de centralit gale au nombre de fois o un port donn est sur le chemin le plus court entre deux autres ports du rseau des voyages.'}\n            />\n          </div>\n        </>\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n        <GeoComponent\n          layers={[\n            {\n              type: 'choropleth',\n              data: datasets['cartoweb_france_1789_geojson.geojson'],\n              color: {\n                field: 'shortname'\n              }\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n              renderObject: renderStep3Object // besoin de montrer les labels des bureaux et ports => modifier la fonction\n            },\n            {\n              type: 'custom',\n              data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n              renderObjects: renderStep3SmallMultiples\n            }\n          ]}\n          projectionTemplate='Poitou'\n          height={height}\n          width={width}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","// @TODO : colorLegends et titres  mettre en place pour cartes notamment\n// @TODO : faire une passe sur visualizationList.json que j'ai rempli approximativement pour les vizs 'intro-provinces', 'intro-ports', et 'intro-bureaux'\n\nimport { useContext, useMemo } from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\nimport BarChart from '../components/BarChart';\nimport GeoComponent from '../components/GeoComponent/GeoComponent';\nimport colorPalettes from '../colorPalettes'\n\n\nimport { DatasetsContext } from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\n\nconst VisualizationContainer = ({ id, dimensions: inputDimensions, ...props }) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n  const hasData = Object.keys(relevantDatasets || {}).length && !Object.entries(relevantDatasets).find(([id, payload]) => !payload);\n  if (!hasData) {\n    return null;\n  }\n  switch (id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'partie-1-produits-importants-pour-la-rochelle':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n              .sort((a, b) => {\n                if (+a.order > +b.order) {\n                  return 1;\n                }\n                return -1;\n              })\n              .slice(0, 20)\n          }\n          title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n          orientation={'vertical'}\n          layout={'groups'}\n          y={{\n            field: 'product',\n            title: 'produit',\n          }}\n          x={{\n            field: 'value_rel_per_direction',\n            title: 'Valeur en pourcentage',\n            tickSpan: .1,\n            tickFormat: (d, i) => parseInt(d * 100) + '%'\n          }}\n          color={{\n            field: 'entity',\n            title: 'Part des exports pour :'\n          }}\n          margins={{\n            left: 140\n          }}\n          tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n        />\n      )\n    case 'partie-1-evolution-de-la-part-des-echanges-de-la-rochelle-au-xviiie':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"volution globale de la part des changes de La Rochelle par rapport  l'ensemble de la France\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight / 2 : dimensions.height * .5}\n          orientation={'horizontal'}\n          layout={'stack'}\n          y={{\n            field: 'portion',\n            title: 'part du commerce fr.',\n            tickFormat: d => parseInt(d * 100) + '%'\n          }}\n          x={{\n            field: 'year',\n            title: 'anne',\n            fillGaps: true,\n            tickSpan: 5,\n            // tickFormat: d => d%10 === 0 ? d : undefined\n          }}\n          color={{\n            field: 'type',\n            title: 'Type'\n          }}\n          margins={{\n            left: 140,\n            right: 0,\n          }}\n          tooltip={d => `En ${d.year}, la direction des fermes de la Rochelle a ${d.type === 'import' ? 'import' : 'export'} ${(+d.portion * 100).toFixed(2)}% des ${d.type === 'import' ? 'imports' : 'exports'} franais totaux`}\n        />\n      )\n    case 'partie-1-pays-port-d-attache':\n      return (\n        <BarChart\n          data={\n            relevantDatasets[Object.keys(relevantDatasets)[0]]\n          }\n          title=\"Pays d'attache des navires trangers partant de la rgion en 1789\"\n          width={dimensions.width}\n          height={props.atlasMode ? window.innerHeight * .8 : dimensions.height}\n          orientation={'vertical'}\n          y={{\n            field: 'country',\n            title: 'Pays du port d\\'attache',\n            sort: {\n              field: 'nb_outs',\n              autoSort: true,\n              ascending: false,\n              type: 'number'\n            }\n          }}\n          x={{\n            field: 'nb_outs',\n            title: 'Nombre de dparts',\n            // tickSpan: 100,\n            tickFormat: (d, i) => `${d} dparts`\n          }}\n          // color={{\n          //   field: 'entity',\n          //   title: 'Part des exports pour :'\n          // }}\n          margins={{\n            right: 60\n          }}\n          tooltip={d => `En 1789, ${d.nb_outs} bateaux sont partis de la rgion de La Rochelle (amirauts de La Rochelle, Sables d'Olonnes ou Marennes)`}\n        />\n      )\n      // case 'partie-1-produits-importants-pour-la-rochelle':\n      //   return (\n      //     <BarChart\n      //       data={\n      //         relevantDatasets[Object.keys(relevantDatasets)[0]]\n      //           .sort((a, b) => {\n      //             if (+a.order > +b.order) {\n      //               return 1;\n      //             }\n      //             return -1;\n      //           })\n      //           .slice(0, 20)\n      //       }\n      //       title=\"Produits dont les valeurs d'exports sont les plus importantes en 1789 : comparaison de La Rochelle  la moyenne franaise\"\n      //       width={dimensions.width}\n      //       height={props.atlasMode ? window.innerHeight / 2 : dimensions.height}\n      //       orientation={'vertical'}\n      //       layout={'groups'}\n      //       y={{\n      //         field: 'product',\n      //         title: 'produit',\n      //       }}\n      //       x={{\n      //         field: 'value_rel_per_direction',\n      //         title: 'Valeur en pourcentage',\n      //         tickSpan: .1,\n      //         tickFormat: (d, i) => parseInt(d * 100) + '%'\n      //       }}\n      //       color={{\n      //         field: 'entity',\n      //         title: 'Part des exports pour :'\n      //       }}\n      //       margins={{\n      //         left: 140\n      //       }}\n      //       tooltip={d => `Le produit ${d.product} reprsente ${(d.value_rel_per_direction * 100).toFixed(2)}% des exports pour ${d.entity.includes('France') ? 'la France' : 'la direction des fermes de La Rochelle'}`}\n      //     />\n      //   )\n      case 'partie-3-comparaison-exports-coloniaux':\n        return (\n          <BarChart\n            data={\n              relevantDatasets[Object.keys(relevantDatasets)[0]]\n            }\n            title=\"Comparaison des exports de produits coloniaux, locaux et autres par bureaux des fermes\"\n            width={dimensions.width}\n            height={props.atlasMode ? window.innerHeight * .8 : dimensions.height * .5}\n            orientation={'vertical'}\n            layout={'grouped'}\n            y={{\n              field: 'customs_office',\n              title: 'Bureau des fermes',\n              // tickFormat: d => parseInt(d * 100) + '%'\n            }}\n            x={{\n              field: 'value',\n              title: 'valeur en livres tournoi',\n              tickSpan: 1000000,\n              domain: [0, 6000000]\n            }}\n            color={{\n              field: 'type',\n              title: 'Type de produit'\n            }}\n            margins={{\n              left: 140,\n              right: 50,\n            }}\n            tooltip={d => `En 1789, le bureau des fermes de ${d.customs_office} a export  l'trange ${d.value} livres tournois de produits de type ${d.type}`}\n          />\n        )\n    case 'intro-provinces':\n      return(\n        <>\n        <GeoComponent \n              layers={[\n                {\n                  type: 'choropleth',\n                  data: datasets['cartoweb_france_1789_geojson.geojson'],\n                  reverseColors: props.atlasMode ? undefined : true,\n                  color:{\n                    field: 'shortname',\n                    palette: colorPalettes.provinces\n                  }\n                }\n              ]}\n              projectionTemplate = 'France'\n              height={dimensions.height}\n              width={dimensions.width}\n            />\n          </>\n      )\n    case 'intro-ports':\n      return(\n        <>\n        <GeoComponent \n              layers={[\n                {\n                  type: 'choropleth',\n                  data: datasets['cartoweb_france_1789_geojson.geojson'],\n                  reverseColors: props.atlasMode ? undefined : true,\n                  // color:{\n                  //   field: 'shortname',\n                  //   palette: colorPalettes.provinces\n                  // }\n                },\n                {\n                  type: 'points',\n                  data: datasets['ports_locations_data.csv'],\n                  color: {\n                    field: 'province',\n                    palette: colorPalettes.provinces,\n                    labelsColor: props.atlasMode ? undefined : 'white'\n                  },\n                  // size: {\n                  //   field: 'name',\n                  //   custom: '20'\n                  // },\n                  label: {\n                    field: 'port'\n                  }\n              }]}\n              projectionTemplate = 'Poitou'\n              height={dimensions.height}\n              width={dimensions.width}\n            />\n          </>\n      )\n      case 'intro-bureaux':\n        // console.log(\"heyyyyyy bureaux map\");\n        return(\n          <>\n          <GeoComponent \n                layers={[\n                  {\n                    type: 'choropleth',\n                    data: datasets['cartoweb_france_1789_geojson.geojson'],\n                    reverseColors: props.atlasMode ? false : true,\n                    // color:{\n                    //   field: 'shortname',\n                    //   palette: colorPalettes.provinces\n                    // }\n                  },\n                  {\n                    type: 'points',\n                    data: datasets['part_3_step3_viz_customs_offices_data.csv'],\n                    color: {\n                      field: 'name',\n                      palette: colorPalettes.customs_office,\n                      labelsColor: props.atlasMode ? undefined : 'white'\n                    },\n                    size: {\n                      custom : 3 // 3 fois plus gros que la taille par dfaut\n                    },\n                    label: {\n                      field: 'name'\n                    }\n                }]}\n                projectionTemplate = 'Poitou'\n                height={dimensions.height}\n                width={dimensions.width}\n              />\n            </>\n        )\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\nconst VisualizationController = ({\n  lang,\n  activeVisualization,\n  atlasMode\n}) => {\n  const [dimensions, setDimensions] = useState({});\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer lang={lang} atlasMode={atlasMode} id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} {...visProps} dimensions={dimensions} />\n            </>\n            : null // <div>Pas de visualisation  afficher</div>\n          }\n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","import {useState, useReducer, useEffect, useRef} from 'react';\nimport {Helmet} from \"react-helmet\";\nimport {useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  useEffect(() => {\n    if (!activeVisualization && focusOnViz) {\n      setFocusOnViz(false);\n    }\n  }, [activeVisualization])\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n      const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n      const y = scrollY + DISPLACE_Y;\n      const visualizationEntries = Object.entries(visualizations);\n      let found;\n      const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n      const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n      if (y > sectionEnd) {\n        if (activeVisualization) {\n          setActiveVisualization(undefined);\n        }\n        return;\n      }\n      // on parcourt la liste  l'envers pour rcuprer\n      // la visualisation la plus haute de la page qui est\n      // au-dessus du milieu de l'cran\n      for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n        const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n        const { ref } = visualization;\n        if (ref.current) {\n          const { y: initialVisY } = ref.current.getBoundingClientRect();\n          let visY = initialVisY + window.scrollY;\n          // @todo refactor this, it is dirty\n          if (ref.current.parentNode.className === 'centered-part-contents') {\n            visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n          }\n          if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n            found = true;\n            setActiveVisualization(undefined);\n            break;\n          } else if (y > visY) {\n            found = true;\n            if (visualization.visualizationId) {\n              setActiveVisualization(visualization);\n            } else {\n              setActiveVisualization(undefined);\n            }\n            break;\n          }\n        }\n      }\n      if (scrollY === 0 && visualizationEntries.length) {\n        setActiveVisualization(visualizationEntries[0][1])\n      }\n      else if (!found && activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    console.log('on block click', {id, ref})\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n          <section ref={sectionRef} className={cx({'is-focused': !focusOnViz})}>\n            <ContentSync />\n          </section>\n          <aside className={cx({'is-focused': focusOnViz})}>\n            <VisualizationController activeVisualization={activeVisualization} />\n          </aside>\n          <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n          <ReactTooltip id=\"contents-tooltip\" />\n      </div>\n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\n// import TestScrollyFr from '!babel-loader!mdx-loader!./contents/fr/test-scrolly.mdx';\n// import testScrollyEn from '!babel-loader!mdx-loader!./contents/en/test-scrolly.mdx';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\n// import Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2-intro.mdx';\n// import Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\n// import Part21Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-1.mdx';\n// import Part21En from '!babel-loader!mdx-loader!./contents/en/part-2-1.mdx';\n\n// import Part22Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-2.mdx';\n// import Part22En from '!babel-loader!mdx-loader!./contents/en/part-2-2.mdx';\n\n// import Part23Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-3.mdx';\n// import Part23En from '!babel-loader!mdx-loader!./contents/en/part-2-3.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/about.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le dclin de la rgion de La Rochelle suite  la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le dclin de la rgion de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spcialisation portuaire: le cas de la traite ngrire, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spcialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  // {\n  //   routes: {\n  //     fr: 'partie-2',\n  //     en: 'part-2'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2 - Une forte spcialisation portuaire: le cas de la traite ngrire, du commerce du sel et de l\\'eau-de-vie',\n  //     en: 'Partie 2 - A strong portual specialization'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-intro.mdx',\n  //     en: 'en/part-2-intro.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part2IntroFr,\n  //     en: Part2IntroEn,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-1',\n  //     en: 'part-2-1'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.1 - La Rochelle et le commerce triangulaire',\n  //     en: 'Partie 2.1 - La Rochelle and triangular trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-1.mdx',\n  //     en: 'en/part-2-1.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part21Fr,\n  //     en: Part21En,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-2',\n  //     en: 'part-2-2'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.2 - Le commerce de leau-de-vie',\n  //     en: 'Partie 2.2 - Eau-de-vie trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-2.mdx',\n  //     en: 'en/part-2-2.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part22Fr,\n  //     en: Part22En,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-3',\n  //     en: 'part-2-3'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.3 - Marennes et le commerce du sel',\n  //     en: 'Partie 2.3 - Marennes and salt trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-3.mdx',\n  //     en: 'en/part-2-3.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part23Fr,\n  //     en: Part23En,\n  //   },\n  // },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: ' propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: ' propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang = 'fr', summary }) {\n  const messages = {\n    intro: {\n      fr: 'dcouvrir les 3 chapitres de ltude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accder  l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .filter(item => item.routes[lang])\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        {/* @todo this is a react-snap trick that should be cleaned some day, removing it somehow breaks the pages building process */}\n        <Link to={navigator.userAgent === \"ReactSnap\" ? '/fr/atlas' : `/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang = 'fr' }\n} }) {\n  const introRef = useRef(null);\n  const [focusOnViz, setFocusOnViz] = useState(false);\n  const currentMetadata = metadata[lang] || metadataFr;\n  const title = currentMetadata.title;\n  const titleHTML = currentMetadata.titleHTML;\n  const subtitle = currentMetadata.subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    // on parcourt la liste  l'envers pour rcuprer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'cran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      } else {\n        // console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n    \n    if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    // console.log('on block click', { id, ref })\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n          <span></span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            <section className={cx({'is-focused': !focusOnViz})}>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside className={cx({'is-focused': focusOnViz})}>\n              <VisualizationController activeVisualization={activeVisualization} />\n            </aside>\n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n        <div className={cx(\"vis-focus-container\", {\n          'is-active': focusOnViz,\n          'is-visible': activeVisualization\n          })}>\n          <button data-for=\"contents-tooltip\" data-effect=\"solid\" data-tip={lang === 'fr' ? 'voir la visualisation associe' : 'see associated visualization'} onClick={() => setFocusOnViz(!focusOnViz)}>\n            <span>{''}</span>\n          </button>\n        </div>\n      </main>\n      <ReactTooltip id=\"contents-tooltip\" />\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la rgion Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\n\nconst VisualizationFocus = ({ visualization, lang, history }) => {\n  const handleClose = () => {\n    history.push({\n      pathname: `/${lang}/atlas/`\n    })\n  }\n  const howDone = visualization[`comment_cest_fait_${lang}`];\n  const howRead = visualization[`comment_lire_${lang}`];\n  const messages = {\n    howDone: {\n      fr: 'Comment les donnes et la visualisations ont-elles t produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    }\n  }\n  return (\n    <div className=\"VisualizationFocus\">\n      <div onClick={handleClose} className=\"lightbox-background\" />\n      <div className=\"lightbox-contents\">\n        \n        <div className=\"visualization-details\">\n          <div className=\"details-header\">\n            <h2>{visualization[`titre_${lang}`]}</h2>\n            <button className=\"close-btn\" onClick={handleClose}>\n            \n            </button>\n          </div>\n          <div className=\"details-contents\">\n            {\n              howDone && howDone.length ?\n              <section className=\"details-contents-section\">\n                <h3>{messages.howDone[lang]}</h3>\n                <p>\n                  {howDone}\n                </p>\n              </section>\n              : null\n            }\n            {\n              howRead && howRead.length ?\n              <section className=\"details-contents-section\">\n                <h3>{messages.howRead[lang]}</h3>\n                <p>\n                  {howRead}\n                </p>\n              </section>\n              : null\n            }\n          </div>\n        </div>\n        <div className=\"visualization-wrapper\">\n          <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import React, { useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from './VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang = 'fr'\n    }\n  }\n}) {\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className=\"Atlas secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>Atlas</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations.map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                history.push({\n                  pathname: `/${lang}/atlas/${visualization.id}`\n                })\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                      <img\n                        src={`${process.env.PUBLIC_URL}/thumbnails/${lang}/${visualization.id}.png`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n      {\n        shownVisualization ?\n          <VisualizationFocus history={history} visualization={shownVisualization} lang={lang} />\n          : null\n      }\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import StandaloneVisualization from './StandaloneVisualization';\n\nexport default StandaloneVisualization;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\nimport visualizationsList from '../../visualizationsList.json';\nconst StandaloneVisualization = ({\n  id,\n  lang\n}) => {\n  const visualization = visualizationsList.find(({id: thatId}) => thatId === id)\n  return (\n    <div className=\"StandaloneVisualization\">\n      <VisualizationController lang={lang} atlasMode activeVisualization={visualization} />\n    </div>\n  )\n}\n\nexport default StandaloneVisualization;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import {Suspense} from 'react';\nimport {Helmet} from \"react-helmet\";\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst PlainPage = ({\n  Content,\n  contentsURL,\n  title,\n  lang = 'fr'\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <Suspense fallback={<div>Chargement</div>}>\n          <Content />\n        </Suspense>\n      </div>\n  </div>\n  )\n}\n\nexport default PlainPage;","import React, { useMemo, useState } from 'react';\nimport {useLocation} from 'react-router-dom';\nimport {NavLink as Link} from 'react-router-dom'; \nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport {scaleLinear} from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n  const liveScrollY = useScrollYPosition();\n\n  const scrollY = useDebounce(liveScrollY, 50)\n\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const {fontColor, backgroundColor} = useMemo(() => {\n    // const wrapper = document.getElementById('wrapper');\n    // if (!wrapper) {\n    //   return {fontColor: undefined, backgroundColor: undefined}\n    // }\n    // const scrollHeight = wrapper.offsetHeight;\n    const screenHeight = window.innerHeight;\n    switch(pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n        \n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: undefined\n        }\n\n    }\n    \n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'primary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'secondary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n            <li className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n              <>\n              <li className=\"navitem-container lang-toggle\">\n                <button \n                  className={lang === 'fr' ? 'is-active': ''}\n                  onClick={() => onLangChange('fr')}\n                >fr</button>\n              </li>\n              <li className=\"navitem-container lang-toggle\">\n                <button\n                  className={lang === 'en' ? 'is-active': ''}\n                  onClick={() => onLangChange('en')}\n                >en</button>\n              </li>\n              </>\n              : null\n            }\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", {'is-open': drawerIsOpen})}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n        <ul className=\"primary-nav-container\">\n          <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {lang === 'fr' ? 'accueil' : 'home'}\n            </Link>\n          </li>\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'primary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'secondary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n              <li className=\"navitem-container lang-toggle\">\n                <ul className=\"lang-toggle-container\">\n                  <li>\n                    <button \n                      className={lang === 'fr' ? 'is-active': ''}\n                      onClick={() => onLangChange('fr')}\n                    >fr</button>\n                  </li>\n                  <li>\n                    <button\n                      className={lang === 'en' ? 'is-active': ''}\n                      onClick={() => onLangChange('en')}\n                    >en</button>\n                  </li>\n                </ul>\n                \n              </li>\n              :\n              null\n            }\n            \n            \n        </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n              <img style={{background: drawerIsOpen ? undefined: backgroundColor}} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n              :\n              <img style={{background: drawerIsOpen ? undefined: backgroundColor}} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n              }} dangerouslySetInnerHTML={{__html: title}} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","const Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className=\"loader-container\">\n      <div className=\"loader\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\n\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  // HashRouter as Router,\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n  Link,\n} from \"react-router-dom\";\nimport uniq from 'lodash/uniq';\nimport { csvParse, tsvParse } from 'd3-dsv';\nimport axios from 'axios';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\nimport StandaloneVisualization from \"./pages/StandaloneVisualization\";\nimport PlainPage from './pages/PlainPage';\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\nimport Footer from \"./components/Footer\";\n\n/* import utils */\nimport { DatasetsContext } from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport visualizationsList from './visualizationsList';\nimport {homepage} from '../package.json';\nimport routes from './summary';\n\nconst LANGUAGES = ['fr', 'en'];\n\nfunction App() {\n\n  const history = useHistory();\n  const location = useLocation();\n\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n  useEffect(() => {\n    // loading all datasets from the atlas\n    // @todo do this on a page-to-page basis if datasets happens to be too big/numerous\n    const datasetsNames = uniq(visualizationsList.filter(d => d.datasets).reduce((res, d) => [...res, ...d.datasets.split(',').map(d => d.trim())], []));\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              const status = progressEvent.loaded / progressEvent.total;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              setLoadingFraction(globalFraction + status / routes.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({ ...res, [datasetName]: loadedData })\n              })\n            })\n            // make get errors non-blocking to get all available datasets in the app even if some are broken\n            .catch(err => {\n              console.error(err);\n              return resolve(res);\n            })\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n      .then(newDatasets => {\n        setLoadingFraction(1);\n        setDatasets(newDatasets)\n      })\n      .catch(console.error)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    // @todo refactor this to be handled based on the routes config JSON ?\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n  }) => (\n    <>\n      <ThatComponent\n        {\n        ...{\n          Content,\n          ContentSync,\n          title\n        }\n        }\n      />\n    </>\n\n  );\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        <header>\n          <HeaderNav {...{ onLangChange, routes }} />\n        </header>\n        <main>\n          <Switch>\n            {// looping through the page\n              LANGUAGES.map(lang => {\n                return routes\n                .map(({\n                  titles,\n                  routes: inputRoute,\n                  contents,\n                  Component: ThatComponent,\n                  contentsProcessed\n                }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  const title = titles[lang];\n                  // @todo remove Content as it is not used anymore ? (importing md content with React.lazy did not play nice with scrollytelling-related features)\n                  const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                  const ContentSync = contentsProcessed[lang];\n                  return (\n                    <Route key={index} path={route} exact>\n                      {renderRoute({ Content, ThatComponent, title, ContentSync })}\n                    </Route>\n                  )\n                })\n              })\n            }\n            {\n              LANGUAGES.map(lang => {\n                return visualizationsList\n                .map(({\n                  id\n                }, index) => {\n                  const route = `/${lang}/visualization/${id}`;\n                  return (\n                    <Route key={index} path={route} exact component={() => <StandaloneVisualization {...{id, lang}} />} />\n                  )\n                })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/fr/`} />\n          </Switch>\n          {\n            datasets ?\n              null :\n              <Loader percentsLoaded={loadingFraction * 100} />\n          }\n        </main>\n        <Footer\n          lang={'fr'}\n        />\n\n\n      </div>\n      {/* following react fragment is aimed at allowing react-snap to parse all the pages that have a dynamic URL */}\n      <React.Fragment>\n        {// looping through the pages to add a blank link to all of them\n          LANGUAGES.map(lang => {\n            return routes\n            // @todo this is dirty and should be removed at some point (test page is not exported in prod, so no need for react-snap)\n            .filter(({routes}) => routes[lang] && !routes[lang].includes('test'))\n            .map(({\n              titles,\n              routes: inputRoute,\n              contents,\n              Component: ThatComponent,\n              contentsProcessed\n            }, index) => {\n              const route = `/${lang}/page/${inputRoute[lang]}`;\n              return (\n                <Link to={route} exact />\n              )\n            })\n          })\n        }\n      </React.Fragment>\n    </DatasetsContext.Provider>\n  );\n}\n\n/**\n * the following variable is aimed at allowing browser-router to function\n * for deployments on gh-pages (prefixing all routes with the repo name to match ghp URL pattern e.g. https://username.github.io/projectname/)\n */\nconst BASE_NAME =\n  process.env.NODE_ENV === 'development'\n    ? undefined\n    : `/${homepage.split('/').pop()}`;\n\n\nexport default function Wrapper() {\n  return (\n    <Router basename={BASE_NAME}>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","\nimport React from 'react';\n\nexport const VisualizationControlContext = React.createContext({\n\n})\n\nexport const DatasetsContext = React.createContext({\n\n})\n","import { geoPath } from \"d3-geo\";\nimport { generatePalette } from '../../helpers/misc';\nimport { uniq } from 'lodash';\nimport cx from 'classnames';\n\n\n// @TODO : mettre en place une palette de couleurs quantitative \n\nconst ChoroplethLayer = ({ layer, projection, width, height, reverseColors }) => {\n\n    let palette;\n\n    if (layer.data.features && layer.color && layer.color.field) {\n        // colors palette building\n        const colorValues = uniq(layer.data.features.map(datum => datum.properties[layer.color.field]));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n            palette = layer.color.palette;\n        } else if (layer.color.generatedPalette) {\n            const colors = generatePalette('map', layer.data.features.length);\n            palette = colorValues.reduce((res, key, index) => ({\n                ...res,\n                [key]: colors[index]\n            }), {});\n        }\n    }\n\n    return (\n        <>\n            <g className={cx(\"ChoroplethLayer\", {'reverse-colors': reverseColors})}>\n                {\n                    layer.data.features.map((d, i) => {\n                        return (\n                            <path\n                                key={`path-${i}`}\n                                d={geoPath().projection(projection)(d)}\n                                className=\"geopart\"\n                                style={{\n                                    fill: layer.color !== undefined && palette !== undefined ? palette[d.properties[layer.color.field]] : 'transparent'\n                                }}\n                            />\n                        )\n                    })\n                }\n            </g>\n            {/* LEGENDE A METTRE EN PLACE, pour l'instant j'ai trop galr\n                {\n                layer.color ?\n                    <g className=\"legend\">\n                        <rect\n                            className=\"color-legend\"\n                            width={width / 6}\n                            height={height / 6}\n                            transform={`translate(0, ${height / 5})`}\n                            // ref={legendRef}\n                            style={{\n                                fill: \"transparent\",\n                                top: height\n                            }}\n                        >\n                            <text class='title'\n                            width={width / 6}\n                            height={height / 6}\n                            x={0}\n                            y={height/5}\n                            style = {{textSizeAdjust}}\n                            transform={`translate(0, ${height / 5})`}\n                            >{'Lgende'}</text>\n                            <g className=\"colors-legend\">\n                                {\n                                    Object.entries(palette)\n                                        .map(([modality, color]) => (\n                                            <rect\n                                                style= {{fill: \"transparent\"}}\n                                                key={modality}\n                                            >\n                                                <rect className=\"color-box\"\n                                                    style={{ fill: color }}\n                                                />\n                                                <text className=\"color-label\">\n                                                    {modality}\n                                                </text>\n                                            </rect>\n                                        ))\n                                }\n                            </g>\n                        </rect>\n                    </g>\n                    : null\n            } */}\n        </>\n    );\n\n}\n\nexport default ChoroplethLayer;","\nimport { useMemo } from 'react';\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\n\nconst PointsLayer = ({ layer, projection, width }) => {\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      // regroup data by coordinates\n      const coordsMap = {};\n      layer.data.forEach(datum => {\n        // id\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: layer.label ? datum[layer.label.field] : undefined,\n            latitude: +datum.latitude,\n            longitude: +datum.longitude,\n            color: layer.color !== undefined ? datum[layer.color.field] : 'default',\n            size: (layer.size !== undefined && layer.size.field !== undefined) ? isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field] : 0\n          }\n        } else {\n          coordsMap[mark].size += (isNaN(+datum[layer.size.field]) ? 0 : +datum[layer.size.field])\n        }\n      })\n\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n      console.log(\"grouped : \", grouped)\n\n\n      let palette;\n      if (layer.color !== undefined) {\n        // colors palette building\n        const colorValues = uniq(grouped.map(g => g.color));\n        if (layer.color.palette) { // if palette given in parameters we use it, otherwise one palette is generated\n          palette = layer.color.palette;\n        } else {\n          const colors = generatePalette('map', colorValues.length);\n          palette = colorValues.reduce((res, key, index) => ({\n            ...res,\n            [key]: colors[index]\n          }), {});\n        }\n      }\n      \n      // size building\n\n      // compute size (would have been more elegand with a ternary but I did not manage to write it properly)\n      let sizeCoef = width / 300; // default size\n      if (layer.size !== undefined && layer.size.custom !== undefined) {\n        sizeCoef = parseInt(layer.size.custom * width / 100);\n      }\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      const sizeScale = scaleLinear().domain(sizeExtent).range([1, width / 30]) // adapt size to width, @TODO : enable to parameter scale (with domain & range)\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: layer.color !== undefined ? palette[datum.color] : 'grey',\n        size: layer.size !== undefined ? layer.size.custom !== undefined ? sizeCoef : sizeScale(datum.size) : width / 100\n      }))\n\n      console.log(\"grouped (PointsLayer): \", grouped)\n      return grouped;\n    }\n  }, [projection, width, layer])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  // console.log(\"markerData (pointsLayer): \", markerData)\n\n  return (\n    <g className=\"PointsLayer\">\n      {\n        markerData\n          .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n          .map((datum, index) => {\n            const { latitude, longitude, size, color, label } = datum;\n            const [x, y] = projection([+longitude, +latitude]);\n\n            return (\n              <g className=\"point-group\" key={index} transform={`translate(${x},${y})`}>\n                <circle\n                  cx={0}\n                  cy={0}\n                  r={size}\n                  style={{ fill: color }}\n                  className=\"marker\"\n                />\n                {\n                  label ?\n                    <text\n                      x={size + 5}\n                      y={size / 2}\n                      fill={layer.color && layer.color.labelsColor}\n                    >\n                      {label}\n                    </text>\n                    : null\n                }\n              </g>\n\n            );\n          })\n      }\n    </g>\n  );\n}\n\nexport default PointsLayer;","\nimport { useMemo } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\n\n/*\nPrincipe : path entre deux point gographiques, dont le stroke peut varier, et on peut avoir la direction avec une fleche \n\nformat des donnes attendu (json) : \n\nExemple :\n\"flow_id\": \"45.95_-0.9_46.166667_-1.15\", \n\"port_dep\": \"Charente\", \n\"port_dest\": \"La Rochelle\", \n\"latitude_dep\": 45.95, \n\"longitude_dep\": -0.9, \n\"latitude_dest\": 46.166667, \n\"longitude_dest\": -1.15, \n\"nb_flows\": 22, \n\"tonnages_cumuls\": 730}\n\n@TODO : rgler le fait que la pointe des flches ne soit pas  l'arrive (en l'tat c'est la base du triangle qui est sur les coords d'arrive) => se rgle en reculant le triangle :   viewBox=\"-10 0 10 10\" &  <path d=\"M -10 0 L 0 5 L -10 10 Z\" fill=\"black\" /> ( ce moment il fut rtrcir la longueur du path qui fait la barre de la flche)\n@TODO : mettre un point au dpart de mes flows ? (pas adapt quand on a des points de dpart et d'arrive qui se recoupent)\n*/\n\nconst FlowsLayer = ({ layer, projection, width, height }) => {\n\n  /**\n    * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n  */\n  const markerData = useMemo(() => {\n    if (layer.data) {\n\n      console.log(\"data : \", layer.data)\n      // size building\n      const strokeWidthScale = scaleLinear().domain([\n        0,\n        max(\n          layer.data.map((flow) => {\n            // return +flow[tonnages_cumuls];\n            console.log(\"flow[layer.size.field] : \", flow[layer.size.field])\n            return +flow[layer.size.field];\n          })\n        )\n      ]).range([0, width*height / 100000]);\n\n      const arrowSizeScale = strokeWidthScale.copy().range([0, width*height / 100000]);\n\n      let grouped = layer.data.map(flow => ({ // je ne sais pas si grouped reste le plus adapt\n        ...flow,\n        // color: palette[datum.color],\n        strokeWidth: strokeWidthScale(+flow[layer.size.field]),\n        arrowSize: arrowSizeScale(layer.data.strokeWidth) \n      }))\n      console.log(\"grouped : \", grouped)\n      return grouped;\n    }\n  }, [projection, width, layer, height])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  console.log(\"markerData (FlowsLayer) : \", markerData)\n\n  return (\n    <g className=\"FlowsLayer\" >\n      {\n        markerData\n          .filter(({ latitude_dep, longitude_dep, latitude_dest, longitude_dest }) => latitude_dep && longitude_dep && latitude_dest && longitude_dest && !isNaN(latitude_dep) && !isNaN(longitude_dep) && !isNaN(latitude_dest) && !isNaN(longitude_dest))\n          .map((datum, index) => {\n            const { latitude_dep, longitude_dep, latitude_dest, longitude_dest, strokeWidth, arrowSize } = datum;\n            const [xDep, yDep] = projection([+longitude_dep, +latitude_dep]);\n            const [xDest, yDest] = projection([+longitude_dest, +latitude_dest]);\n            // console.log(\"[xDep, yDep] / [xDest, yDest] : \", [xDep, yDep], \" / \", [xDest, yDest]);\n\n            return (\n              <g className=\"flow-group\">\n                <defs>\n                  <marker id=\"triangle\" viewBox=\"0 0 10 10\"\n                    refX=\"1\" refY=\"5\"\n                    markerUnits=\"strokeWidth\"\n                    markerWidth={arrowSize} markerHeight={arrowSize}\n                    orient=\"auto\">\n                    <path d=\"M 0 0 L 10 5 L 0 10 Z\" fill=\"black\" />\n                  </marker>\n                </defs>\n                <path d={`M ${xDep} ${yDep} L ${xDest} ${yDest}`} stroke=\"black\" strokeWidth={strokeWidth} marker-end=\"url(#triangle)\" />\n                {/* <line x1={xDep} y1={yDep} x2={xDest} y2={yDest} stroke=\"black\" stroke-width={size} marker-end=\"url(#triangle)\" /> */}\n              </g>\n\n            );\n          })\n      }\n    </g>\n  );\n}\n\nexport default FlowsLayer;","\n\n\nconst CustomObjectLayer = ({ layer, projection, width, height }) => {\n\n    return (\n        <g className=\"CustomObjectsLayer\">\n          {\n            typeof layer.renderObjects === 'function' ?\n                layer.renderObjects({data: layer.data, projection, width, height})\n            :\n            layer.data\n              // .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n              .map((datum, index) => {\n                // const { latitude, longitude, size, color, label } = datum;\n                // const [x, y] = projection([+longitude, +latitude]);\n                return layer.renderObject({ datum, projection, width, height })\n              })\n          }\n        </g>\n      );\n}\n\nexport default CustomObjectLayer;","import { useEffect, useState } from \"react\"\n\nconst Button = ({\n    children,\n    onMouseDown,\n    ...props\n  }) => {\n    const [isMouseDown, setState] = useState(false)\n  \n    useEffect(() => {\n      let interval\n      if (isMouseDown) {\n        console.log(\"setInterval\")\n        interval = setInterval(onMouseDown, 100)\n      }\n      return () => {\n        console.log(\"clearInterval\")\n        clearInterval(interval)\n      }\n    }, [isMouseDown, onMouseDown])\n  \n    return <button\n      {...props}\n      onMouseDown={() => {\n        setState(true)\n      }}\n      onMouseUp={() => {\n        setState(false)\n      }}\n      style={{ background: isMouseDown ? 'red' : undefined }}\n    >\n      {children}\n    </button>\n  }\n\n  export default Button ;","import { useState, useEffect } from \"react\" ;\n\nconst Input = ({\n    value: inputValue,\n    onBlur,\n    ...props\n  }) => {\n    const [value, setValue] = useState(inputValue)\n    useEffect(() => {\n      setValue(inputValue)\n    }, [inputValue])\n  \n    return <input\n      value={value}\n      onChange={(e) => {\n        setValue(e.target.value)\n      }}\n      onBlur={(e) => {\n        onBlur(e.target.value)\n      }}\n    />\n  }\n  \nexport default Input ;  ","/* DOCUMENTATION : API de ce GoComponent\n\n  Principe :\n    Composants rutilisable pour toutes les cartes utiliss sur les sites PORTIC\n    cartographie en SVG\n    -> permet de faire des cartes choroplthes, de reprsenter des ports, des flux de navires, ...\n\n  Paramtres : \n    * width : largeur de la carte (par dfaut  1500 px)\n    * height : hauteur de la carte (par dfaut  1500 px)\n\n    * layers : diffrentes couches de la carte ('choropleth', 'points', 'flows', 'custom'),  chaque layer il faut donner un fichier de donnes (stock dans public/data) pour construire le objets qui le constituent, les couleurs, tailles, labels de ces objets sont paramtrables \n        si layer 'custom' choisi, il faut passer au layer une fonction d'affichage des donnes :\n        - renderObject : donner un objet de donne en paramtre, la fonction s'occupe de construire sa reprsentation SVG et de la positionner individuellement sur la carte\n        - renderObjects : donner un dataset, la fonction s'occupe de construire une reprsentation SVG de l'ensemble des objets, et de grer leurs positionnement sur la carte (souvent adapt quand le positionnement n'est pas gographique, qu'on a besoin de grer les espacements entre objets ...)\n\n    * projectionTemplate : configuration de carte utilise frquemment ('France', 'coast from Nantes to Bordeaux', 'Poitou', 'rotated Poitou')\n    * projectionConfig: configuration de carte customise (ce paramtre prime sur projectionTemplate si les 2 sont donnes en mme temps)\n\n    * debug : permet d'ajuster manuellement la configuration de la carte quand true (les paramtres de zoom, les coordonnes du centre, la rotation et les translations sont ajustables)\n    \n  @TODO : documenter ce component de manire standardise\n  */\n\n\nimport React, { useState, useMemo } from 'react';\nimport { geoEqualEarth } from \"d3-geo\";\nimport ChoroplethLayer from './ChoroplethLayer';\nimport PointsLayer from './PointsLayer';\nimport FlowsLayer from './FlowsLayer';\nimport CustomObjectLayer from './CustomObjectLayer';\n// import TriangleComponent from '../TriangleComponent/TriangleComponent';\nimport Button from './Button';\nimport Input from './Input';\n\nimport './GeoComponent.scss'\n\n\nconst GeoComponent = ({\n  width = 1500,\n  height = 1500,\n  layers = [],\n  projectionTemplate,\n  projectionConfig: inputProjectionConfig, // customed config that will overwrite a template (optional argument) \n  debug = false // @TODO :  rparer\n}) => {\n\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur rgion\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n\n  // define a default map Config\n  const defaultProjectionConfig = useMemo(() => {\n    return {\n      rotationDegree: 0,\n      centerX: 2.4486203,\n      centerY: 46.8576176,\n      scale: height * 6\n    };\n  }, [height]) // repsonsive : se fait en fonction de la height de l'cran\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => { // def les bonnes valeurs pour la config de la projection // enregistrer dans le state // les appliquer dans la projection\n\n    let projectionConfig = { ...defaultProjectionConfig } // casser la rfrence  defaultProj pour respecter principe react qu'on ne modifie pas un objet reu en argument\n\n    let projection = geoEqualEarth()\n\n    switch (projectionTemplate) {\n      case 'World':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height/2.5,\n          centerX: 21.201099,\n          centerY:  -6.356008,\n          // translationX: width * 0.4,\n          // translationY: height * 0.28\n        }\n        break;\n      case 'coast from Nantes to Bordeaux':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 24,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.28\n        }\n        break;\n      case 'Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          scale: height * 45,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.4,\n          translationY: height * 0.05\n        }\n        break;\n      case 'rotated Poitou':\n        projectionConfig = {\n          ...projectionConfig,\n          rotationDegree: 58,\n          scale: height * 32,\n          centerX: -1.7475027,\n          centerY: 46.573642,\n          translationX: width * 0.29,\n          translationY: height * 0.25\n        }\n        break;\n      case 'France':\n      default: // as France config \n        // console.log('projection config in dry version', projectionConfig);\n        // console.log(`we are taking the config as specified in config parameters ===> if not specified, the view should correspond to France`);\n        break;\n    }\n\n    if (inputProjectionConfig !== undefined) {\n      projectionConfig = {\n        ...projectionConfig,\n        ...inputProjectionConfig\n      }\n    }\n\n    // update the config\n    setScale(projectionConfig.scale)\n\n    setRotation(projectionConfig.rotationDegree)\n\n    setCenterX(projectionConfig.centerX)\n    setCenterY(projectionConfig.centerY)\n\n    if (projectionConfig.translationX !== undefined) {\n      setTranslationX(projectionConfig.translationX)\n      setTranslationY(projectionConfig.translationY)\n    }\n    else {\n      projectionConfig.translationX = width / 2;\n      projectionConfig.translationY = height / 2;\n      setTranslationX(width / 2)\n      setTranslationY(height / 2)\n    }\n\n    projection\n      .scale(projectionConfig.scale)\n\n    projection.center([projectionConfig.centerX, projectionConfig.centerY])\n\n    if (projectionConfig.rotationDegree) {\n      projection.angle(projectionConfig.rotationDegree)\n    }\n\n    projection.translate([projectionConfig.translationX, projectionConfig.translationY])\n\n    return projection;\n  }, [width, height, defaultProjectionConfig, inputProjectionConfig, projectionTemplate]) \n\n\n\n  // const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n\n  return (\n    <div>\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div class=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg className=\"GeoComponent\" width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n\n        {\n          layers.map((layer, layerIndex) => {\n\n            switch (layer.type) {\n              case 'choropleth':\n                return <ChoroplethLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                  reverseColors={layer.reverseColors}\n                />\n\n              case 'points':\n                return <PointsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'flows': \n                return <FlowsLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              case 'custom':\n                return <CustomObjectLayer\n                  key={layerIndex}\n                  layer={layer}\n                  projection={projection}\n                  width={width}\n                  height={height}\n                />\n\n              default:\n                return <g key={layerIndex}><text>Unsupported layer type</text></g>\n            }\n          })\n        }\n        {/* <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n        <rect x=\"58%\" y=\"78%\" width={width * 0.4} height={height * 0.2} rx=\"15\" ry=\"15\" fill={'white'} opacity={0.5} /> */}\n      </svg>\n    </div>\n  )\n}\n\nexport default GeoComponent;\n\n\n// old GeoComp handling for configs\n\n\n/*\nconst projection = useMemo(() => {\n  setTranslationX(width/2)\n  setTranslationY(height/2)\n\n let projection = geoEqualEarth() // ce qui vaut dans tous les cas ...\n   .scale(scale)\n   .translate([translationX, translationY]) // put the center of the map at the center of the box in which the map takes place ?\n\n if (backgroundData) { // que si center on region\n   if (centerOnRegion) {\n     setScale(height*24); // 500000 //*24\n     setCenterX(-1.7475027);\n     setCenterY(46.573642);\n     projection\n       .scale(scale) // 50000 for a centered map\n       .center([centerX, centerY]) // -1.7475027, 46.573642 for a centered map\n       .translate([translationX * 0.8, translationY * 0.56]) // @TODO : stabiliser avec coefficients calculs (pour l'instant c'est du bricolage : j'essaie de cadrer entre Nantes et Bordeaux)\n   } else {\n     // if bg data is available fit on whole geometry\n     projection\n       .fitSize([width, height], backgroundData)\n   }\n   if (rotationDegree !== 0) { // seul cas o on veut une carte tourne pour le moment c'est dans le cas step 1 main viz part 3\n     setScale(width*28)\n     setRotation(rotationDegree);\n     projection\n       .angle(rotation)\n       .translate([translationX * 0.65, translationY * 0.65]) // dans ce cas besoin de dcaler la carte vers la droite et vers le haut :  @TODO stabiliser avec coefficients calculs (pour l'instant c'est du bricolage)\n   }\n\n }\n return projection;\n}, [backgroundData, width, height, centerOnRegion, scale, rotation, translationX, translationY, centerX, centerY, rotationDegree])\n\n*/\n","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  // const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      // const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      // setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number',\n    autoSort: yAutoSort = false\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + xExtent[1] % xTickSpan;\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  \n\n  // let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  const xAxisValues = xTickSpan ? range(xDomain[0], xDomain[xDomain.length - 1], xTickSpan) : xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 15} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          if (!yAutoSort) {\n                            return 0;\n                          }\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={bandWidth}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={thatHeight}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width: initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n\n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    Tooltip.rebuild();\n  })\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ? headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ? legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort: sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    autoSort = false,\n    ascending: sortYAscending = true,\n    type: sortYType,\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixedRowHeight || vizHeight / bandsNb;\n\n  const groups = Object.entries(groupBy(data, d => d[y.field]));\n\n  const xDomain = initialXDomain || layout === 'stack' ?\n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) =>\n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n    )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n\n  let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n  const xScale = scaleLinear().domain(xDomain).range([0, width - margins.left - margins.right]).nice();\n  const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + xDomain[1] % xTickSpan;\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n  return (\n    <>\n      <figure style={{ width: initialWidth, height: finalHeight }} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${margins.left + xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    {/* <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    /> */}\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                  .sort((a, b) => {\n                    if (!autoSort) {\n                      return 0;\n                    }\n                    const multiplier = sortYAscending ? 1 : -1;\n                    if (sortYField === y.field) {\n                      const aVal = sortYType === 'number' ? +a[0] : a[0];\n                      const bVal = sortYType === 'number' ? +b[0] : b[0];\n                      if (aVal < bVal) {\n                        return -1 * multiplier;\n                      }\n                      return 1 * multiplier;\n                    }\n                    const aVal = sortYType === 'number' ?\n                      +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : a[1][sortYField];\n                    const bVal = sortYType === 'number' ?\n                      +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0)\n                      : b[1][sortYField];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n\n                  })\n                  .map(([yModality, items], groupIndex) => {\n                    let stackDisplaceX = margins.left;\n                    return (\n                      <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                        <foreignObject x={0} y={layout === 'stack' ? bandHeight / 4 : bandHeight/2 /* + bandHeight * (items.length / 2)*/} width={margins.left} height={rowHeight}>\n                          <div className=\"vertical-bar-label\">\n                          <div>{typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}</div>\n                          </div>\n                        </foreignObject>\n                        {/* <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                          {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                        </text> */}\n                        {\n                          items\n                            .sort((a, b) => {\n                              if (!autoSort) {\n                                return 0;\n                              }\n                              const multiplier = sortXAscending ? 1 : -1;\n                              const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n                              const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n                              if (aVal > +bVal) {\n                                return -1 * multiplier;\n                              }\n                              return 1 * multiplier;\n                            })\n                            .map((item, itemIndex) => {\n\n                              const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                              const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) : xScale(item[x.field]);\n                              const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                              if (layout === 'stack') {\n                                stackDisplaceX += thatWidth;\n                              }\n                              const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                              return (\n                                <>\n                                  {\n                                    +item[x.field] > 0 ?\n                                      <rect key={itemIndex}\n                                        fill={thatColor}\n                                        width={thatWidth}\n                                        x={thatX}\n                                        y={thatY}\n                                        height={bandHeight - 1}\n                                        data-for=\"bar-tooltip\"\n                                        data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                      />\n                                      : null\n                                  }\n                                </>\n                              )\n                            })\n                        }\n                      </g>\n                    );\n                  })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight\n                }}\n              >\n                <h5>{color.title || 'Lgende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-chelles autour du port de La Rochelle au XVIIIme sicle\",\n  \"titleHTML\": \"Commerce multi-chelles autour du port de La Rochelle au XVIII<sup>e</sup> sicle\",\n  \"subtitle\": \"Une tude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","/*\nDOCUMENTATION : sommaires des fonctions\n\n- renderLabel (renderObject)\npositionner geographiquement des labels\n\n- renderStep3Object (renderObject)\ncration d'un double triangle et d'un cercle autour (deux courbes de bzier), positionn gographiquement\n(objet associ  un bureau de ferme)\n\n- fonction renderStep3SmallMultiples (renderObjects)\ncration des objets double triangle et cercles pour les small multiples de la viz 3.3, positionns en bas  droite du SVG\n+ un objet de lgende\n\n- renderTriangles (renderObjects)\ncration des triangles pour la viz 3.1, relis par une courbe pointille  des points positionns gographiquement\n+ un triangle de lgende\n\n@TODO : complter la fonction step3Object (ou crer une nouvelle fonction), pour grer l'apparition des doubles triangles pour chaque port\n-  cette fonctionnalit est dj prvue dans la fonction renderStep3Object (dans la boucle   if (datum.type_of_object === \"port\") { ...}) mais en l'tat les objets ports sont positionns gographiquement\n- il faudrait adapter pour positionner les objets ports en colonne, sur la gauche du SVG, et qu'ils aient par dfaut une opacit  0% sauf au hover de l'objet bureau des fermes correspondant => apparition\n\n*/\n\n\nimport TriangleComponent from '../../components/TriangleComponent/TriangleComponent';\nimport colorsPalettes from '../../colorPalettes';\n\nexport function renderLabel(datum, projection, { width }) { //  terme on pourrait mettre un objet \n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text size={width * 0.05}>{datum.label}</text>\n    </g>);\n}\n\n\nexport function renderStep3Object({ datum, projection, width, height }) { //  priori plus besoin de datum et de width qui sont dj passs au composant CustomObjectLayer\n\n  const [x, y] = projection([+datum.longitude, +datum.latitude])\n\n  let sizeCoef = width * 0.05;\n  const totalTonnage = parseFloat(datum.cumulated_tonnage_out_region) + parseFloat(datum.cumulated_tonnage_in_region)\n  // console.log(\"tonnage total : \",totalTonnage)\n\n  if (datum.type_of_object === \"port\") {\n    // dfinition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la dfinition des classes est exprimentale)\n\n    // se grerait bien avec un switch\n    if (totalTonnage < 1000) { // * 1000\n      sizeCoef = width * 0.025\n    }\n    else {\n      if (totalTonnage > 5000) {\n        sizeCoef = width * 0.075\n      }\n    }\n  }\n\n  const leftTriangleHeight = parseFloat(datum.cumulated_tonnage_out_region) / totalTonnage * sizeCoef;\n  const rightTriangleHeight = parseFloat(datum.cumulated_tonnage_in_region) / totalTonnage * sizeCoef; // je pourrais dduire cette donne de la taille du triangle gauche\n\n  let leftPath = null\n  let rightPath = null\n\n  if (datum.type_of_object === \"customs_office\") {\n\n    const totalValue = parseFloat(datum.cumulated_exports_value_from_region) + parseFloat(datum.cumulated_exports_value_from_ext)\n    const inPercentage = parseFloat(datum.cumulated_exports_value_from_region) / totalValue * 100\n    // console.log(\"inPercentage \", datum.label,\" : \", inPercentage)\n\n    const partialCircle = require('svg-partial-circle')\n\n    let start = null\n    let end = null\n    // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement rparti en bas  droite si co sans coords\n\n    // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n    start = Math.PI / 2 + (inPercentage - 50) / 100 * Math.PI\n    end = Math.PI * 3 / 2 - (inPercentage - 50) / 100 * Math.PI\n\n    leftPath = partialCircle(\n      0, 0,         // center X and Y\n      leftTriangleHeight + rightTriangleHeight,              // radius\n      start,          // start angle in radians --> Math.PI / 4\n      end             // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n    rightPath = partialCircle(\n      0, 0,             // center X and Y\n      leftTriangleHeight + rightTriangleHeight,                  // radius\n      start,              // start angle in radians --> Math.PI / 4\n      end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n    )\n      .map((command) => command.join(' '))\n      .join(' ')\n\n  }\n\n  // handle overlap \n  let noOverlapTransform = undefined\n  if (datum.name === 'Tonnay-Charente') {\n    noOverlapTransform = `translate(${x + width * 0.03},${y})`\n  }\n  else if ((datum.name === 'Rochefort')) {\n    noOverlapTransform = `translate(${x - width * 0.03},${y})`\n  }\n  else {\n    noOverlapTransform = `translate(${x},${y})` // mettre entre accolades ??\n  }\n\n  return (\n    <g\n      className='double-triangle'\n      transform={noOverlapTransform}\n    // { datum.longitude === 0 ? x=1 : null }\n    >\n\n      <path className='left-triangle' fill={colorsPalettes.generic.accent2}\n        d={`M ${0} ${0}\n                V ${leftTriangleHeight / 2}\n                L ${-Math.pow(5, 0.5) * leftTriangleHeight / 2} ${0}\n                L ${0} ${-leftTriangleHeight / 2}\n                Z\n                `}\n      />\n\n      <path className='right-triangle' fill={colorsPalettes.ui.colorAccentBackground}\n        d={`M ${0} ${0}\n                V ${rightTriangleHeight / 2}\n                L ${Math.pow(5, 0.5) * rightTriangleHeight / 2} ${0}\n                L ${0} ${-rightTriangleHeight / 2}\n                Z\n                `}\n      />\n\n      <>\n        {\n          // datum.else.type_of_object === \"customs_office\" ?\n          leftPath != null ?\n\n            <>\n\n              <path\n                d={`${leftPath}\n                  `}\n                stroke={colorsPalettes.generic.accent2}\n                stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n              />\n\n              <path\n                d={`${rightPath}\n                  `}\n                stroke={colorsPalettes.ui.colorAccentBackground}\n                stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                fill=\"transparent\"\n              />\n            </>\n            :\n            null\n        }\n\n        <text\n          className='label'\n          transform={`translate(${-Math.pow(5, 0.5) * (leftTriangleHeight + rightTriangleHeight) / 4}, ${(rightTriangleHeight + leftTriangleHeight) / 1.8})`}\n          font-size={parseInt(height * 0.013)}\n        >\n          {datum.name}\n        </text>\n      </>\n    </g>);\n}\n\n\n\nexport function renderStep3SmallMultiples({ data, width, height, projection }) {\n  // could be parametered in props too\n  const legendWidth = width / 6\n  // const margins = {\n  //   left: 0.05,\n  //   right: 0.05\n  // }\n\n  // console.log(\"data : layder.data \", data)\n  const numberOfColumns = 3\n  // const columnWidth = (width * (1 - legendWidth - margins.left - margins.right)) / numberOfColumns\n  const columnWidth = (width * 0.8) / numberOfColumns\n  const numberOfRows = 1\n  const rowHeight = height / 6\n  const totalHeight = numberOfRows * rowHeight\n  // const fontSize = totalHeight * 0.05\n\n  // console.log({ width, numberOfColumns, columnWidth, numberOfRows, rowHeight, totalHeight, fontSize })\n\n\n  // create object for legend\n  const legendCustomOffice = {\n    name: 'Lgende',\n    cumulated_tonnage_in_region: 60,\n    cumulated_tonnage_out_region: 40,\n    cumulated_exports_value_from_region: 70,\n    cumulated_exports_value_from_ext: 30\n  }\n\n  // @TODO : rendre la lgend interactive : on n'a pas la place d'afficher le texte => se fera on hover\n\n  const legendSizeCoef = width * 0.05;\n  const legendTotalTonnage = parseFloat(legendCustomOffice.cumulated_tonnage_out_region) + parseFloat(legendCustomOffice.cumulated_tonnage_in_region)\n  // console.log(\"tonnage total : \", totalTonnage)\n\n  const legendLeftTriangleHeight = parseFloat(legendCustomOffice.cumulated_tonnage_out_region) / legendTotalTonnage * legendSizeCoef;\n  const legendRightTriangleHeight = parseFloat(legendCustomOffice.cumulated_tonnage_in_region) / legendTotalTonnage * legendSizeCoef; // je pourrais dduire cette donne de la taille du triangle gauche\n\n  let legendLeftPath = null\n  let legendRightPath = null\n\n  const legendTotalValue = parseFloat(legendCustomOffice.cumulated_exports_value_from_region) + parseFloat(legendCustomOffice.cumulated_exports_value_from_ext)\n  const legendInPercentage = parseFloat(legendCustomOffice.cumulated_exports_value_from_region) / legendTotalValue * 100\n  // console.log(\"inPercentage \", datum.label,\" : \", inPercentage)\n\n  const legendPartialCircle = require('svg-partial-circle')\n\n  let legendStart = null\n  let legendEnd = null\n\n  // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n  legendStart = Math.PI / 2 + (legendInPercentage - 50) / 100 * Math.PI\n  legendEnd = Math.PI * 3 / 2 - (legendInPercentage - 50) / 100 * Math.PI\n\n  legendLeftPath = legendPartialCircle(\n    0, 0,         // center X and Y\n    legendLeftTriangleHeight + legendRightTriangleHeight,              // radius\n    legendStart,          // start angle in radians --> Math.PI / 4\n    legendEnd             // end angle in radians --> Math.PI * 7 / 4\n  )\n    .map((command) => command.join(' '))\n    .join(' ')\n\n  legendRightPath = legendPartialCircle(\n    0, 0,             // center X and Y\n    legendLeftTriangleHeight + legendRightTriangleHeight,                  // radius\n    legendStart,              // start angle in radians --> Math.PI / 4\n    legendEnd - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n  )\n    .map((command) => command.join(' '))\n    .join(' ')\n\n\n  return (\n    <g className=\"small-multiples-and-legend-and-title\" width={width} height={totalHeight} style={{ border: '1px solid lightgrey' }}>\n\n      <text\n      className='title'\n      transform={`translate(${width * 0.1}, ${height * 0.025})`}\n      // style={{\n      //   font-size: '12'\n      //   font-weight: 'bold'}}\n      > Comparaison des profils de bureaux de Fermes : tourns vers l'extrieur / l'intrieur de leur rgion </text>\n\n      <g className='legend-object' width={legendWidth} transform={`translate(${width * 0.55}, ${height * 0.9})`}>\n\n        <path className='legend-left-triangle' fill='grey'\n          d={`M ${0} ${0}\n                          V ${legendLeftTriangleHeight / 2}\n                          L ${-Math.pow(5, 0.5) * legendLeftTriangleHeight / 2} ${0}\n                          L ${0} ${-legendLeftTriangleHeight / 2}\n                          Z\n                          `}\n        />\n\n        <path className='legend-right-triangle' fill='black'\n          d={`M ${0} ${0}\n                          V ${legendRightTriangleHeight / 2}\n                          L ${Math.pow(5, 0.5) * legendRightTriangleHeight / 2} ${0}\n                          L ${0} ${-legendRightTriangleHeight / 2}\n                          Z\n                          `}\n        />\n\n        <>\n          {\n            legendLeftPath != null ?\n\n              <>\n                <path\n                  d={`${legendLeftPath}`}\n                  stroke='grey'\n                  stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                  fill=\"transparent\"\n                />\n\n                <path\n                  d={`${legendRightPath}`}\n                  stroke=\"black\"\n                  stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                  fill=\"transparent\"\n                />\n              </>\n              :\n              null\n          }\n        </>\n        <text\n          className='label'\n          transform={`translate(${-Math.pow(5, 0.5) * (legendLeftTriangleHeight + legendRightTriangleHeight) / 6}, ${- (legendRightTriangleHeight + legendLeftTriangleHeight) / 1.8})`}\n          font-size={parseInt(height * 0.013)}\n        >\n          {legendCustomOffice.name}\n        </text>\n\n      </g>\n\n\n      <g className=\"small-multiples\" width={width * 0.5} height={totalHeight}>\n\n        {\n          data.filter(({ name }) => name === 'Le Havre' || name === 'Nantes' || name === 'Bordeaux')\n\n            .map((custom_office, index) => {\n\n              const xIndex = index % numberOfColumns;\n\n              let sizeCoef = width * 0.05;\n              const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n              // console.log(\"tonnage total : \",totalTonnage)\n\n              const leftTriangleHeight = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage * sizeCoef;\n              const rightTriangleHeight = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage * sizeCoef; // je pourrais dduire cette donne de la taille du triangle gauche\n\n              let leftPath = null\n              let rightPath = null\n\n              const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n              const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n              // console.log(\"inPercentage \", datum.label,\" : \", inPercentage)\n\n              const partialCircle = require('svg-partial-circle')\n\n              let start = null\n              let end = null\n              // let transformGeo = {`translate(${x},${y})`} // ce serzit param qui se mmodifie en attribue de positionnement rparti en bas  droite si co sans coords\n\n              // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n              start = Math.PI / 2 + (inPercentage - 50) / 100 * Math.PI\n              end = Math.PI * 3 / 2 - (inPercentage - 50) / 100 * Math.PI\n\n              leftPath = partialCircle(\n                0, 0,         // center X and Y\n                leftTriangleHeight + rightTriangleHeight,              // radius\n                start,          // start angle in radians --> Math.PI / 4\n                end             // end angle in radians --> Math.PI * 7 / 4\n              )\n                .map((command) => command.join(' '))\n                .join(' ')\n\n              rightPath = partialCircle(\n                0, 0,             // center X and Y\n                leftTriangleHeight + rightTriangleHeight,                  // radius\n                start,              // start angle in radians --> Math.PI / 4\n                end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n              )\n                .map((command) => command.join(' '))\n                .join(' ')\n\n\n              return (\n                <g className={`${custom_office.name}-small-multiple`} width={columnWidth} transform={`translate(${width * 0.7}, ${height * 0.9})`}>\n\n                  <g className='double-triangle-and-circle'\n                    key={index}\n                    // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n                    // transform={`translate(${xTransform}, ${yTransform})`}\n                    transform={`translate(${xIndex * width * 0.12}, ${0})`}\n                  >\n\n                    {/* <circle\n                      cx={0}\n                      cy={0}\n                      r={2}\n                      fill='red'\n                    /> */}\n\n                    <path className='left-triangle' fill={colorsPalettes.generic.accent2}\n                      d={`M ${0} ${0}\n                V ${leftTriangleHeight / 2}\n                L ${-Math.pow(5, 0.5) * leftTriangleHeight / 2} ${0}\n                L ${0} ${-leftTriangleHeight / 2}\n                Z\n                `}\n                    />\n\n                    <path className='right-triangle' fill={colorsPalettes.ui.colorAccentBackground}\n                      d={`M ${0} ${0}\n                V ${rightTriangleHeight / 2}\n                L ${Math.pow(5, 0.5) * rightTriangleHeight / 2} ${0}\n                L ${0} ${-rightTriangleHeight / 2}\n                Z\n                `}\n                    />\n\n                    <>\n                      {\n                        // datum.else.type_of_object === \"customs_office\" ?\n                        leftPath != null ?\n\n                          <>\n\n                            <path\n                              d={`${leftPath}\n                  `}\n                              stroke={colorsPalettes.generic.accent2}\n                              stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                              fill=\"transparent\"\n                            />\n\n                            <path\n                              d={`${rightPath}\n                  `}\n                              stroke={colorsPalettes.ui.colorAccentBackground}\n                              stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                              fill=\"transparent\"\n                            />\n                          </>\n                          :\n                          null\n                      }\n\n                      <text\n                        className='label'\n                        transform={`translate(${-Math.pow(5, 0.5) * (leftTriangleHeight + rightTriangleHeight) / 4}, ${(rightTriangleHeight + leftTriangleHeight) / 1.8})`}\n                        font-size={parseInt(height * 0.013)}\n                      >\n                        {custom_office.name}\n                      </text>\n                    </>\n                  </g>\n\n\n\n                </g>);\n\n            })\n        }\n\n      </g>\n    </g>\n\n  );\n\n}\n\nexport function renderTriangles({ data, width, height, projection }) {\n  // console.log(\"data : layder.data \", data)\n  return (<TriangleComponent\n    data={data}\n    totalWidth={width} // @TODO : il faudrait rduire cette width \n    rowHeight={height * 0.3}\n    projection={projection}\n  />);\n}\n\n\n// trash code\n/* eslint-disable */\n{/* { showLegend?\n        // create an exemple object for the legend that has all required properties for the viz\n        \n\n        let sizeCoef = width * 0.05;\n        // const totalTonnage = parseFloat(custom_office.cumulated_tonnage_out_region) + parseFloat(custom_office.cumulated_tonnage_in_region)\n        // console.log(\"tonnage total : \",totalTonnage)\n\n        // const leftTriangleHeight = parseFloat(custom_office.cumulated_tonnage_out_region) / totalTonnage * sizeCoef;\n        // const rightTriangleHeight = parseFloat(custom_office.cumulated_tonnage_in_region) / totalTonnage * sizeCoef; // je pourrais dduire cette donne de la taille du triangle gauche\n\n        // let leftPath = null\n        // let rightPath = null\n\n        // const totalValue = parseFloat(custom_office.cumulated_exports_value_from_region) + parseFloat(custom_office.cumulated_exports_value_from_ext)\n        // const inPercentage = parseFloat(custom_office.cumulated_exports_value_from_region) / totalValue * 100\n        // // console.log(\"inPercentage \", datum.label,\" : \", inPercentage)\n\n        // const partialCircle = require('svg-partial-circle')\n\n        // let start = null\n        // let end = null\n\n        // // calcul des angles de dpart et d'arrive de l'arc de cercle, en fonction des donnes\n        // start = Math.PI / 2 + (inPercentage - 50) / 100 * Math.PI\n        // end = Math.PI * 3 / 2 - (inPercentage - 50) / 100 * Math.PI\n\n        // leftPath = partialCircle(\n        // 0, 0,         // center X and Y\n        // leftTriangleHeight + rightTriangleHeight,              // radius\n        //         start,          // start angle in radians --> Math.PI / 4\n        //         end             // end angle in radians --> Math.PI * 7 / 4\n        // )\n        //         .map((command) => command.join(' '))\n        // .join(' ')\n\n        // rightPath = partialCircle(\n        // 0, 0,             // center X and Y\n        // leftTriangleHeight + rightTriangleHeight,                  // radius\n        //         start,              // start angle in radians --> Math.PI / 4\n        //         end - 2 * Math.PI   // end angle in radians --> Math.PI * 7 / 4\n        // )\n        //         .map((command) => command.join(' '))\n        // .join(' ')\n\n        :\n        // console.log(\"hey ==> no legend\");\n        // return (\n        //   <text> text </text>\n        // )\n        sizeCoef = 2;\n\n        return(\n          <g className='double-triangle-and-circle'\n            key={index}\n            // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n            // transform={`translate(${xTransform}, ${yTransform})`}\n            transform={`translate(${xIndex * width * 0.12}, ${0})`}\n            >\n\n            {/* <circle\n              cx={0}\n              cy={0}\n              r={2}\n              fill='red'\n            /> */}\n\n{/* <path className='left-triangle' fill='rgb(39, 129, 141)'\n              d={`M ${0} ${0}\n                  V ${leftTriangleHeight / 2}\n                  L ${-Math.pow(5, 0.5) * leftTriangleHeight / 2} ${0}\n                  L ${0} ${-leftTriangleHeight / 2}\n                  Z\n                  `}\n            />\n\n            <path className='right-triangle' fill='rgb(44, 74, 156)'\n              d={`M ${0} ${0}\n                  V ${rightTriangleHeight / 2}\n                  L ${Math.pow(5, 0.5) * rightTriangleHeight / 2} ${0}\n                  L ${0} ${-rightTriangleHeight / 2}\n                  Z\n                  `}\n            />\n\n            <>\n              {\n                leftPath != null ?\n\n                  <>\n                    <path\n                      d={`${leftPath}`}\n                      stroke={colorsPalettes.generic.dark}\n                      stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                      fill=\"transparent\"\n                    />\n\n                    <path\n                      d={`${rightPath}`}\n                      stroke={colorsPalettes.generic.accent2}\n                      stroke-width={width * 0.005} //  ajuster en fonction de la largeur de l'cran\n                      fill=\"transparent\"\n                    />\n                  </>\n                  :\n                  null\n              }\n            </>\n          </g>\n\n          );\n        \n        \n        } */}"],"sourceRoot":""}