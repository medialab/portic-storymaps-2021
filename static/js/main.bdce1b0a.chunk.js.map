{"version":3,"sources":["contents/fr/footer.mdx","helpers/hooks.js","components/SigmaComponent/reducers.js","components/SigmaComponent/GraphControls.js","components/SigmaComponent/GraphContainer.js","components/SigmaComponent/index.js","components/BoatsIllustration/BoatsIllustration.js","components/BoatsIllustration/index.js","contents/fr/introduction.mdx","contents/en/introduction.mdx","components/GeoComponent/GeoComponent.js","components/TriangleComponent/TriangleComponent.js","contents/fr/partie-1.mdx","contents/en/part-1.mdx","contents/fr/partie-2.mdx","contents/en/part-2-intro.mdx","contents/fr/partie-3.mdx","contents/en/part-3.mdx","contents/fr/a-propos.mdx","contents/en/about.mdx","contents/en/tests.mdx","components/SvgComponent/SvgComponent.js","components/SvgComponent/index.js","components/VegaComponent/index.js","components/VegaComponent/VegaComponent.js","components/GeoComponent/index.js","components/TriangleComponent/index.js","components/BezierComponent/index.js","components/BezierComponent/BezierComponent.js","components/DataProvider/index.js","components/DataProvider/DataProvider.js","components/LineChart/LineChart.js","components/LineChart/index.js","components/BarChart/HorizontalBarChart.js","components/BarChart/VerticalBarChart.js","components/BarChart/index.js","components/BarChart/BarChart.js","contents/fr/tests.mdx","colorPalettes.js","helpers/misc.js","components/Caller/Caller.js","components/Caller/index.js","../ /^/.//.*$/ groupOptions: {} namespace object","visualizations/Test.js","components/DeclineComponent/LongitudinalTradeChart.js","components/DeclineComponent/ProductsDistributionChart.js","components/DeclineComponent/index.js","components/DeclineComponent/DeclineComponent.js","visualizations/PrincipalVisualizationPart1.js","components/CircularAlluvialComponent/CircularAlluvialComponent.js","components/CircularAlluvialComponent/utils.js","visualizations/PrincipalVisualizationPart2/index.js","visualizations/PrincipalVisualizationPart2/PrincipalVisualizationPart2.js","visualizations/PrincipalVisualizationPart3/index.js","visualizations/PrincipalVisualizationPart3/PrincipalVisualizationPart3.js","visualizations/index.js","components/VisualizationController/VisualizationController.js","components/VisualizationController/index.js","pages/ScrollyPage/index.js","pages/ScrollyPage/ScrollyPage.js","summary.js","pages/Home/BoatsContainer.js","pages/Home/HomeSummary.js","pages/Home/Home.js","pages/Home/index.js","pages/Atlas/VisualizationFocus.js","pages/Atlas/Atlas.js","pages/Atlas/index.js","components/HeaderNav/HeaderNav.js","components/HeaderNav/index.js","components/Loader/Loader.js","pages/PlainPage/index.js","pages/PlainPage/PlainPage.js","components/Footer/index.js","components/Footer/Footer.js","App.js","reportWebVitals.js","index.js","helpers/contexts.js","contents/fr/metadata.js","contents/en/metadata.js"],"names":["readingTime","layoutProps","MDXContent","components","props","mdxType","className","parentName","isMDXComponent","tableOfContents","id","level","title","children","frontMatter","useInterval","callback","delay","savedCallback","useRef","useEffect","current","setInterval","clearInterval","useDebounce","value","useState","debouncedValue","setDebouncedValue","handler","setTimeout","clearTimeout","DEFAULT_NODE_COLOR","DEFAULT_NODE_SIZE_RANGE","GraphControls","rescale","zoomIn","zoomOut","cx","onClick","CELL_HEIGHT_SCALE","scaleLinear","domain","range","CELL_WIDTH_SCALE","renderer","getCamera","animatedReset","animatedZoom","animatedUnzoom","GraphContainer","graph","nodeColorVariable","nodeColor","nodeSizeVariable","nodeSize","labelDensity","nodeLabel","onCameraUpdate","cameraPosition","updateTimestamp","sizes","useMemo","res","forEachNode","_node","attributes","push","size","sizeExtent","extent","extents","min","max","name","values","attr","uniq","colors","generatePalette","length","palette","i","forEach","option","edgesMap","m","Map","_source","_target","sourceAttributes","targetAttributes","edge","_edgeAttributes","set","sourceNode","targetNode","previousNodeColor","usePrevious","previousNodeSize","previousNodeLabel","previousLabelDensity","nodeReducer","nodeSizeFactor","nodeSizeScale","key","renderedNode","x","isNaN","undefined","y","color","v","createNodeReducer","edgeReducer","dontColorEdges","el1","el2","get","renderedEdge","biggerNode","Color","lighten","rgb","string","createEdgeReducer","container","setRenderer","animate","needToRefresh","settings","labelGrid","cell","width","height","displayedLabels","Set","refresh","setContainer","useCallback","node","kill","newRenderer","Renderer","camera","getState","on","state","ref","style","bind","filename","data","inputCameraPosition","angle","ratio","setGraph","setCameraPosition","loading","setLoading","find","prop","URL","process","then","gexfString","gexf","parse","Graph","updateNode","catch","_err","cam","PASS_DURATION","Hull","bottomRightX","bottomLeftX","d","Sail","sailSpeed","distance","randomFactor","Math","random","minRightX","maxLeftX","maxRightX","step1","points","step2","useSpring","loop","to","from","config","duration","polygon","Matt","secondWidth","transform","x1","x2","y1","y2","Boat","hullHeightRatio","setHullHeightRatio","mattNumber","setMattNumber","matts","heightRatio","nOfMatts","round","newHullHeightRatio","boatWidth","g","map","matt","mattIndex","displace","Bird","boatHeight","containerHeight","dimension","moveSteps","steps","scale","MovingBoat","containerWidth","rightToLeft","startAt","birds","numberOfBirds","b","start","end","opacity","index","BoatsIllustration","useReducer","action","type","Object","entries","reduce","boat","payload","genId","createdAt","Date","getTime","createBoat","boats","updateBoats","timeout","now","Input","inputValue","onBlur","setValue","onChange","e","target","Button","onMouseDown","isMouseDown","setState","interval","console","log","onMouseUp","background","GeoComponent","dataFilename","backgroundFilename","label","renderObject","markerSize","markerColor","showLabels","centerOnRegion","rotationDegree","debug","setScale","rotation","setRotation","translationX","setTranslationX","translationY","setTranslationY","centerX","setCenterX","centerY","setCenterY","setData","backgroundData","setBackgroundData","colorsMap","setColorsMap","loadingData","setLoadingData","loadingBackground","setLoadingBackground","dataURL","csvString","newData","csvParse","err","markerData","coordsMap","datum","mark","latitude","longitude","else","grouped","colorValues","thatColorsMap","sizeScale","backgroundURL","bgData","projection","geoEqualEarth","translate","center","fitSize","xCenterPoint","yCenterPoint","class","placeHolder","str","val","viewBox","border","features","geoPath","fill","stroke","strokeWidth","filter","cy","r","keys","fontWeight","TriangleComponent","totalWidth","rowHeight","numberOfColumns","columnWidth","totalHeight","scaleX","port","nb_pointcalls_out","scaleY","mean_tonnage","triangleWidth","triangleHeight","xTransform","yTransform","parseInt","text-anchor","step","SvgComponent","path","alt","src","VegaComponent","spec","VegaLite","BezierComponent","R","DataProvider","generic","colorsPalettes","LineChart","initialWidth","initialHeight","tooltip","margins","inputMargins","annotations","headersHeight","setHeadersHeight","legendWidth","setLegendWidth","legendRef","headerRef","newHeadersHeight","getBoundingClientRect","newLegendWidth","colorPalette","left","top","bottom","right","yTickFormat","tickFormat","yTickSpan","tickSpan","initialYDomain","fillGaps","xTickFormat","xTickSpan","initialXDomain","colorModalities","field","modality","xDomain","yDomain","xScale","nice","yScale","groups","groupBy","xAxisValues","axisPropsFromTickScale","yAxisValues","marginLeft","valueIndex","a","axis","annotation","annotationIndex","labelPosition","thatHeight","thatY1","thatY2","strokeDasharray","marker-end","fontSize","markerWidth","markerHeight","refX","refY","orient","patternUnits","thatX1","thatX2","abs","groupIndex","groupName","items","dark","item","itemIndex","next","consecutive","hasNext","data-tip","data-for","genreIndex","genre","HorizontalBarChart","orientation","layout","yField","sort","sortY","fillXGaps","xField","sortX","sortYField","ascending","sortYAscending","sortYType","sortXField","sortXAscending","sortXType","xValues","vizWidth","bandsNb","scaleBand","xExtent","sum","bandWidth","yStackScale","copy","multiplier","stackDisplaceY","thatX","thatY","thatColor","VerticalBarChart","fixedRowHeight","formatLabel","vizHeight","bandHeight","xStackScale","svgHeight","finalHeight","yModality","stackDisplaceX","thatWidth","BarChart","SigmaComponent","region","window","innerWidth","Imports","year","partner","palettes","metadata","fr","metadataFr","en","metadataEn","DEFAULT_COLOR_SPACE","cmin","cmax","lmin","lmax","SINGLE_COLOR_PALETTE","buildPageTitle","lang","trimText","limit","words","split","output","join","slice","cartesian2Polar","sqrt","radians","atan2","count","accent1","accent2","iwanthue","colorSpace","seed","clustering","Caller","visualizationId","useContext","VisualizationControlContext","activeVisualization","onBlockClick","onRegisterVisualization","onUnregisterVisualization","JSON","stringify","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","Error","code","ids","all","module","exports","Test","datasets","datasetName","prettifyValue","inted","finalStr","LongitudinalTradeChart","inputData","absoluteField","shareField","herfindhalField","wholeHeight","axisLeftTitle","axisRightTitle","startYear","endYear","barTooltipFn","cityName","highlightYears","colorScaleMessages","footerRef","setHeight","newHeight","offsetHeight","ReactTooltip","rebuild","yearsExtent","yearsEnumerated","xBand","padding","herfindhalColorScale","scalePow","yearTicks","yAbsoluteScale","yShareScale","rightYAxisValues","leftYAxisValue","maximum","minimum","marginRight","bandwidth","toFixed","replace","data-effect","data-html","data-class","data-place","includes","ProductsDistributionChart","allData","tradeData","partTreshold","barWidth","years","productTooltipFn","compareFrom","titleRef","svgRef","yearsRef","Array","hoveredProduct","setHoveredProduct","yearLabelHeight","finalData","lastYear","lastYearData","lastYearTotalValue","partAcc","dataTillTreshold","sortBy","topProducts","product","aggregatedMiscProducts","dict","thisData","thisTotalValue","thisYearData","totalValue","links","nextYear","nextData","thisYearTotalValue","nextYearTotalValue","thisYearOffset","datumIndex","otherHeight","otherOffset","thisHeight","otherDatum","nextYearScaleValue","height1","height2","svgOffset","parentNode","offsetTop","yearLinks","ref1","ref2","isHighlighted","yearIndex","flows","her","labelScale","element","position","maxWidth","minWidth","backgroundColor","DeclineComponent","productTradePartThreshold","rows","atlasMode","messages","franceOverviewTitle","tradeEvolutionTitle","top90PctTitle","partInPct","absoluteValue","herfindalLegendTitle","herfindal0","herfindal1","barTooltip","pct","city","herfindal","productTooltip","sevenYearsWar","totalRows","renderRow","row","rowFlex","rowIndex","comparison","rowId","PrincipalVisualizationPart1","colorSchemes","colorScheme1","colorScheme2","colorScheme3","CircularAlluvialComponent","sumBy","filters","centerHorizontalLabels","displaceHorizontalLabels","highlightedFlow","setHighlightedFlow","highlightedFilter","setHighlightedFilter","stepsSpec","_id","stepIndex","stepData","flow","valueAbs","actualValue","valuePart","sortAscending","nodes","displaceAbs","displacePart","newNodes","localDisplaceAbs","localDisplacePart","newNode","newFlow","relativeDisplaceAbs","relativeDisplacePart","nextStep","nextKey","nodeIndex","newFlows","flowIndex","nextVal","nextStepGroup","nextFlow","flow2","nextPosition","prepareAlluvialData","filtersTotal","colorScales","modalitiesMap","cur","fieldIndex","counter","smallestDimension","BAR_SIZE","BAR_WIDTH","HORIZONTAL_MARGIN","textScale","secondCircleRadius","thirdCircleRadius","HORIZONTAL_DISPLACE","VERTICAL_BAR_SIZE","stepScales","0","direction","displaceX","displaceY","displaceText","1","2","3","4","5","highlightedNode","s","highlightedNodeTotal","f","alignSelf","onMouseOut","initialDisplaceY","nodesSizeScale","displaceLabels","linkIndex","nextStepScales","nextNodesSizeScale","x3","y3","y4","x4","controlPoint1AX","controlPoint1AY","controlPoint1BX","controlPoint1BY","controlPoint2AX","controlPoint2AY","controlPoint2BX","controlPoint2BY","cos","sin","onMouseOver","trim","nodeHeight","initialY","nodeWidth","actualHeight","labelHighlightPart","isFilteredIn","textRotate","initialLabelX","labelX","labelY","labelMain","labelSecondary","nodeHasHighlights","nodeIsHighlighted","labelFontSize","flowX","flowY","flowWidth","flowHeight","flow_type","PrincipalVisualizationPart2","showOnlyToflit","alluvialFilters","sumToflitBy","labels","PrincipalVisualizationPart3","VisualizationContainer","inputDimensions","dimensions","DatasetsContext","relevantDatasets","viz","visualizationsList","datasetsIds","VisualizationController","setDimensions","visProps","omit","bounds","onResize","contentRect","measureRef","ScrollyPage","ContentSync","sectionRef","setActiveVisualization","newState","visualizations","setVisualizations","scrollY","useScrollYPosition","scrollTo","found","DISPLACE_Y","innerHeight","visualizationEntries","sectionDims","visualization","visY","Provider","params","finalParams","newVis","thatId","Helmet","summary","routes","titles","shortTitles","contents","contentsProcessed","Part1Fr","Part1En","Component","routeGroup","Part2IntroFr","Part2IntroEn","Part3Fr","Part3En","AboutFr","AboutEn","TestsFr","TestsEn","hide","BoatsContainer","HomeSummary","intro","atlas","chapter","route","Home","match","introRef","titleHTML","subtitle","error","dangerouslySetInnerHTML","__html","behavior","VisualizationFocus","history","handleClose","pathname","howDone","howRead","visualizationsMap","Atlas","useHistory","shownVisualization","visualizationIndex","thumbnail","colorPalettes","ui","colorText","colorAccentBackground","colorBackgroundBlue","colorBackground","HeaderNav","onLangChange","drawerIsOpen","setDrawerIsOpen","location","useLocation","pageType","paramsLang","liveScrollY","pageColorScale","screenHeight","fontColor","exact","inputRoute","Loader","percentsLoaded","PlainPage","Content","contentsURL","fallback","Footer","LANGUAGES","App","setDatasets","loadingFraction","setLoadingFraction","datasetsNames","datasetIndex","reject","url","axios","onDownloadProgress","progressEvent","status","loaded","total","globalFraction","loadedData","pop","tsvParse","newDatasets","renderRoute","ThatComponent","ln","otherLang","pathOtherLang","routeItem","React","lazy","component","Wrapper","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rootElement","document","getElementById","hasChildNodes","hydrate","StrictMode","render","createContext"],"mappings":"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","file":"static/js/main.bdce1b0a.chunk.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.54,\"time\":32400,\"words\":108}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <div className=\"column\">\n      <h2 {...{\n        \"id\": \"le-programme-portic\"\n      }}>{`Le programme PORTIC`}</h2>\n      <p>{`Le programme ANR PORTIC se propose de croiser les données sur la navigation et sur la valeur du commerce étranger de la France à la veille de la Révolution française pour mieux saisir les dynamiques commerciales à l’œuvre. Pour ce faire, il offre des interfaces d’interrogation et de visualisation des données adaptées à des publics et des intérêts variés.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://anr.portic.fr/\"\n        }}>{`En savoir plus sur le programme PORTIC`}</a></p>\n    </div>\n    <div className=\"column\">\n      <p>{`Les contenus de ce site sont placés sous `}<a parentName=\"p\" {...{\n          \"href\": \"https://creativecommons.org/licenses/by-nc-sa/3.0/fr/\"\n        }}>{`licence libre creative commons CC-BY-SA-NC`}</a>{`.`}</p>\n      <p>{`Le code source de ce site est placé sous licence libre `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.gnu.org/licenses/agpl-3.0.fr.html\"\n        }}>{`AGPL-3.0`}</a>{`.`}</p>\n      <p><a parentName=\"p\" {...{\n          \"href\": \"https://github.com/medialab/portic-storymaps-2021/\"\n        }}>{`Accéder au code source de ce site`}</a></p>\n    </div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"le-programme-portic\",\n    level: 2,\n    title: \"Le programme PORTIC\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","import { useEffect, useRef, useState } from 'react';\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}","import Color from 'color';\nimport {scaleLinear} from 'd3-scale';\n// import {evalIfNodeMatches} from '../../helpers/misc';\n\n\n// Defaults\nconst DEFAULT_NODE_COLOR = '#999';\nconst DEFAULT_NODE_SIZE_RANGE = [2, 15];\n\nexport function createNodeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  // filters = [],\n  // filtersModeAnd\n}) {\n  \n  let nodeSizeScale = null;\n\n  // Creating scales\n  if (!nodeSize) {\n    nodeSizeScale = scaleLinear()\n      .domain([extents.nodeSize.min, extents.nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  } else {\n    nodeSizeScale = scaleLinear()\n      .domain([nodeSize.min, nodeSize.max])\n      .range(DEFAULT_NODE_SIZE_RANGE);\n  }\n  \n  // Creating actual reducer\n  const nodeReducer = function (key, attr) {\n    const renderedNode = {\n      ...attr,\n      x: isNaN(attr.x) || attr.x === undefined ? 0 : attr.x,\n      y: isNaN(attr.y) || attr.y === undefined ? 0 : attr.y\n    };\n\n\n\n    // Color\n    if (!nodeColor) {\n      renderedNode.color = attr.color || DEFAULT_NODE_COLOR;\n    } else {\n      renderedNode.color =\n        nodeColor.palette[attr[nodeColor.name]] || DEFAULT_NODE_COLOR;\n    }\n    // Size\n    if (!nodeSize) {\n      let v = attr.size || 1;\n      renderedNode.size = nodeSizeScale(v);\n    } else {\n      let v = attr[nodeSize.name];\n      v = typeof v === 'number' ? v : 1;\n      renderedNode.size = nodeSizeScale(v);\n    }\n\n    renderedNode.size *= nodeSizeFactor;\n\n    return renderedNode;\n  };\n\n\n  return nodeReducer;\n}\n\n\nexport function createEdgeReducer({\n  nodeColor,\n  nodeSize,\n  nodeLabel,\n  nodeSizeFactor = 1,\n  extents,\n  dontColorEdges,\n  edgesMap\n}) {\n\n  \n  // Creating actual reducer\n  const edgeReducer = function (key, attr, el1, el2) {\n    const {\n      sourceNode, \n      targetNode\n    } = edgesMap.get(key);\n    const renderedEdge = {};\n    // color with biggest node\n    const sourceNodeSize = nodeSize ? sourceNode[nodeSize.name] : sourceNode.size;\n    const targetNodeSize = nodeSize ? targetNode[nodeSize.name] : targetNode.size;\n    const biggerNode = sourceNodeSize > targetNodeSize ? sourceNode : targetNode;\n\n    // Color\n    if (biggerNode) {\n      if (!nodeColor) {\n        renderedEdge.color = biggerNode.color || DEFAULT_NODE_COLOR;\n      } else {\n        renderedEdge.color =\n          nodeColor.palette[biggerNode[nodeColor.name]] || DEFAULT_NODE_COLOR;\n      }\n      renderedEdge.color = Color(renderedEdge.color).lighten(0.4).rgb().string();\n    }\n    return renderedEdge;\n  };\n\n  return edgeReducer;\n}","import React from 'react';\nimport cx from 'classnames';\n\n\nexport default function GraphControls({\n  rescale, \n  zoomIn, \n  zoomOut, \n}) {\n  return (\n    <ul className={cx(\"VisControls GraphControls\")}>\n      <li className=\"vis-controls-item camera\">\n      \n      <button onClick={zoomOut}>\n        -\n      </button>\n      <button onClick={zoomIn}>\n        +\n      </button>\n      <button onClick={rescale}>\n        Recentrer\n      </button>\n      </li>\n    </ul>\n  );\n}","import React, {useCallback, useRef, useState, useEffect, useMemo} from 'react';\nimport gexf from 'graphology-gexf';\nimport Graph from 'graphology';\nimport {WebGLRenderer as Renderer} from 'sigma';\nimport {scaleLinear} from 'd3-scale';\nimport {min, max, extent} from 'd3-array';\nimport {uniq} from 'lodash';\nimport get from 'axios';\n\nimport {createNodeReducer, createEdgeReducer} from './reducers';\nimport {generatePalette, usePrevious} from '../../helpers/misc';\n\nimport GraphControls from './GraphControls';\n\nimport './GraphContainer.css';\n\n// Defaults\nconst CELL_HEIGHT_RANGE = [200, 10];\nconst CELL_WIDTH_RANGE = [300, 30];\nconst CELL_HEIGHT_SCALE = scaleLinear().domain([0, 1]).range(CELL_HEIGHT_RANGE);\nconst CELL_WIDTH_SCALE = scaleLinear().domain([0, 1]).range(CELL_WIDTH_RANGE);\n\n// Camera controls\nfunction rescale(renderer) {\n  const camera = renderer.getCamera();\n  camera.animatedReset(renderer);\n}\n\nfunction zoomIn(renderer) {\n  const camera = renderer.getCamera();\n  camera.animatedZoom(renderer);\n}\n\nfunction zoomOut(renderer) {\n  const camera = renderer.getCamera();\n  camera.animatedUnzoom(renderer);\n}\n\nfunction GraphContainer({\n  graph,\n  nodeColor: nodeColorVariable,\n  nodeSize: nodeSizeVariable,\n  labelDensity,\n  nodeLabel,\n  onCameraUpdate,\n  cameraPosition,\n  updateTimestamp,\n}) {\n  let sizes = useMemo(() => {\n    const res = [];\n    graph.forEachNode((_node, attributes) => {\n      res.push(+(nodeSizeVariable ? attributes[nodeSizeVariable] : attributes.size));\n    })\n    return res;\n  }, [nodeSizeVariable, graph]);\n  \n  const sizeExtent = extent(sizes);\n  const extents = {\n    nodeSize: {\n      min: sizeExtent[0],\n      max: sizeExtent[1]\n    }\n  }\n\n  const nodeSize = useMemo(() => {\n    if (nodeSizeVariable) {\n\n      return {\n        min: min(sizeExtent),\n        max: max(sizeExtent),\n        name: nodeSizeVariable\n      }\n    } else return undefined;\n  }, [nodeSizeVariable, graph])\n\n  const nodeColor = useMemo(() => {\n    if (nodeColorVariable) {\n      let values = [];\n      graph.forEachNode((_node, attr) => {\n        values.push(attr[nodeColorVariable])\n      })\n      values = uniq(values);\n      const colors = generatePalette(nodeColorVariable, values.length);\n      let palette = {};\n      let i = 0;\n      values.forEach(option => {\n        palette[option] = colors[i];\n        i++;\n      });\n      return {\n        palette,\n        name: nodeColorVariable\n      }\n    } else return undefined;\n  }, [nodeColorVariable, graph])\n\n  const edgesMap = useMemo(() => {\n    const m = new Map()\n    graph.forEach(\n      (_source, _target, sourceAttributes, targetAttributes, edge, _edgeAttributes) => {\n      m.set(edge, {sourceNode: sourceAttributes, targetNode: targetAttributes})\n    });\n    return m;\n  }, [graph])\n\n  const previousNodeColor = usePrevious(nodeColor);\n  const previousNodeSize = usePrevious(nodeSize);\n  const previousNodeLabel = usePrevious(nodeLabel);\n  const previousLabelDensity = usePrevious(labelDensity);\n  // const previousSearchString = usePrevious(searchString);\n  // const previousDontColorEdges = usePrevious(dontColorEdges);\n  // const previousFilters = usePrevious(filters);\n\n  const nodeReducer = createNodeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n  });\n  \n  const edgeReducer = createEdgeReducer({\n    nodeColor,\n    nodeSize,\n    nodeLabel,\n    extents,\n    edgesMap\n  });\n  \n\n  const container = useRef(null);\n  const [renderer, setRenderer] = useState(null);\n\n  useEffect(() => {\n    if (cameraPosition && renderer) {\n        const camera = renderer.getCamera();\n        // console.log('animate camera', camera);\n        camera.animate(cameraPosition);     \n    }  \n  }, [updateTimestamp]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  // Should we refresh?\n  if (renderer) {\n    let needToRefresh = false;\n    \n\n    if (\n      previousNodeColor !== nodeColor ||\n      previousNodeSize !== nodeSize ||\n      // previousDontColorEdges !== dontColorEdges ||\n      previousNodeLabel !== nodeLabel\n      // previousSearchString !== searchString ||\n      // previousFilters !== filters\n    ) {\n      // console.log('Refreshing sigma');\n\n      // TODO: use upcoming #.setNodeReducer\n      renderer.settings.nodeReducer = nodeReducer;\n      renderer.settings.edgeReducer = edgeReducer;\n      needToRefresh = true;\n    }\n\n    if (previousLabelDensity !== labelDensity) {\n      renderer.settings.labelGrid.cell = {\n        width: CELL_WIDTH_SCALE(labelDensity),\n        height: CELL_HEIGHT_SCALE(labelDensity)\n      };\n\n      // TODO: we can improve sigma to handle this\n      renderer.displayedLabels = new Set();\n      needToRefresh = true;\n    }\n\n    if (needToRefresh) {\n      renderer.refresh();\n    }\n  }\n\n  const setContainer = useCallback(\n    node => {\n      if (renderer && renderer.graph !== graph) {\n        renderer.kill();\n        setRenderer(null);\n      }\n\n      if (node && graph) {\n        const newRenderer = new Renderer(graph, node, {nodeReducer, edgeReducer});\n        setRenderer(newRenderer);\n        const camera = newRenderer.getCamera();\n        onCameraUpdate(camera.getState())\n        camera.on('updated', state => {\n          onCameraUpdate(state);\n        })\n      }\n\n      container.current = node;\n    },\n    [graph]\n  );\n\n  return (\n    <div className=\"VisContainer GraphContainer\" >\n\n      <div ref={setContainer} style={{width: '100%', height: '50vh'}}></div>\n      {renderer && (\n        <GraphControls\n          rescale={rescale.bind(null, renderer)}\n          zoomIn={zoomIn.bind(null, renderer)}\n          zoomOut={zoomOut.bind(null, renderer)}\n        />\n      )}\n    </div>\n  );\n}\n\n\nexport default function SigmaComponent({\n  data: filename,\n  nodeColor,\n  nodeLabel,\n  nodeSize,\n  labelDensity = 0.5,\n  cameraPosition: inputCameraPosition = { x: 0.5, y: 0.5, angle: 0, ratio: 1 }\n}) {\n    // useState renvoie un state et un seter qui permet de le modifier\n    const [graph, setGraph] = useState(null);\n    const [cameraPosition, setCameraPosition] = useState(inputCameraPosition);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n      if (['x', 'y', 'angle', 'ratio'].find(prop => inputCameraPosition[prop] !== cameraPosition[prop])) {\n        setCameraPosition(inputCameraPosition);\n      }\n    }, [inputCameraPosition])\n\n    const onCameraUpdate = cam => {\n      setCameraPosition(cam);\n    }\n  \n    const URL = `${process.env.PUBLIC_URL}/data/${filename}`;\n  \n    useEffect(() => {\n      // aller chercher les données (get : lancement de la promesse se lance de suite : synchrone, then et catch plus tard)\n      get(URL)\n      .then(({data: gexfString}) => {\n        const graph = gexf.parse(Graph, gexfString);\n        graph.forEachNode((node) => {\n          graph.updateNode(node, attr => {\n            return {\n              ...attr,\n              x: attr.x ? attr.x : 0,\n              y: attr.y ? attr.y : 0\n            }\n          })\n        })\n        setGraph(graph);\n        setLoading(false);\n      })\n      .catch((_err) => {\n        setLoading(false);\n      })\n    }, [URL])\n  \n    if (loading) {\n      return (\n        <div>Chargement des données ({URL}) ...</div>\n      )\n    } else if (!graph) {\n      return (\n      <div>Erreur ...</div>\n      )\n    }\n    return (\n        <div className=\"SigmaComponent\">\n          <GraphContainer\n            {\n              ...{\n                graph,\n                cameraPosition,\n                nodeColor,\n                nodeSize,\n                labelDensity,\n                nodeLabel,\n                onCameraUpdate\n              }\n            }\n          />\n        </div>\n    )\n}","import GraphContainer from './GraphContainer';\n\nexport default GraphContainer;","import { useState, useEffect, useMemo, useReducer } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport {v4 as genId} from 'uuid';\n\nimport {useInterval} from '../../helpers/hooks';\n\nimport './BoatsIllustration.scss';\n\nconst PASS_DURATION = 100000;\nconst UPDATE_RATE = 4000;\n\nconst Hull = ({\n  width,\n  height,\n}) => {\n  const bottomRightX = width * .7;\n  const bottomLeftX = width * .05;\n  return (\n    <path\n      className=\"hull\"\n      d={`M 0 0 L ${width / 3} ${0} L ${width / 3} ${height / 4} L ${width * .6} ${height / 4} L ${width * .6} 0 L ${width} 0 L ${bottomRightX} ${height} L ${bottomLeftX} ${height} Z`}\n    />\n  )\n\n}\n\nconst Sail = ({\n  width,\n  height,\n  sailSpeed,\n  distance = 1\n}) => {\n\n  const randomFactor = useMemo(() => Math.random() * .4 + 1, [])\n  \n  const minRightX = width;\n  const minLeftX = 0;\n  const maxLeftX = 5 * distance;\n  const maxRightX = width + 5 * distance;\n\n  const step1 = {\n    points: `0,${height * .1} ${width},${0} ${maxRightX},${height / 2} ${width},${height * .9} 0,${height} ${maxLeftX} ${height / 2}`\n  }\n  const step2 = {\n    points: `0,${height * .1} ${width},${0} ${minRightX},${height / 2} ${width},${height * .9} 0,${height} ${minLeftX} ${height / 2}`\n  }\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 500 * sailSpeed * randomFactor }\n  });\n  return (\n    <>\n      <animated.polygon\n        points={points}\n        className=\"sail\"\n      />\n    </>\n  )\n}\n\nconst Matt = ({\n  width,\n  height,\n  sailSpeed,\n  distance\n}) => {\n  const secondWidth = width * .7;\n  return (\n    <>\n      <g transform={`translate(${width/2 - secondWidth/2}, ${height * .1})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={secondWidth} height={height /4} />\n      </g>\n      <g transform={`translate(0, ${height * .4})`}>\n        <Sail sailSpeed={sailSpeed} distance={distance} width={width} height={height * .45} />\n      </g>\n      <line\n        x1={width / 2}\n        x2={width / 2}\n        y1={0}\n        y2={height * 1.1}\n      />\n    </>\n  )\n}\n\nconst Boat = ({\n  x,\n  height,\n  distance\n}) => {\n  const [hullHeightRatio, setHullHeightRatio] = useState(.2);\n  const [mattNumber, setMattNumber] = useState(1);\n  const matts = useMemo(() => {\n    let m = [];\n    for (let i = 0; i < mattNumber; i++) {\n      m.push({ heightRatio: 1 })\n    }\n    return m;\n  }, [mattNumber])\n\n  const step1 = {\n    transform: `skewX(-3)`\n  }\n  const step2 = {\n    transform: `skewX(3)`\n  }\n  const {transform} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 3000 }\n  });\n\n\n  useEffect(() => {\n    const nOfMatts = Math.round(Math.random() * 2) + 1;\n    const newHullHeightRatio = .1 + Math.random() * .1;\n    setMattNumber(nOfMatts)\n    setHullHeightRatio(newHullHeightRatio);\n  }, []);\n  const randomFactor = useMemo(() => Math.random(), [])\n\n\n  const boatWidth = height;\n\n  return (\n    <animated.g\n      className=\"boat\"\n      transform={transform}\n    >\n      {\n        matts.map((matt, mattIndex) => {\n          const displace = (boatWidth * .9);\n          const x = ((mattIndex) / (matts.length)) * displace;\n          const width = (boatWidth / matts.length) * .8;\n          return (\n            <g key={mattIndex} className=\"matt\" transform={`translate(${x}, 0)`}>\n              <Matt\n                width={width}\n                height={height - height * hullHeightRatio}\n                sailSpeed={randomFactor * .5 + 1}\n                distance={distance}\n              />\n            </g>\n          )\n        })\n      }\n      <g transform={`translate(0, ${height - height * hullHeightRatio})`}>\n        <Hull\n          width={boatWidth}\n          height={height * hullHeightRatio}\n        />\n      </g>\n    </animated.g>\n  )\n}\n\nconst Bird = ({\n  boatHeight,\n  containerHeight,\n  distance\n}) => {\n  \n  const dimension = containerHeight / 20 * (distance / 2);\n  const step1 = {\n    points: `0,${0}, ${dimension/2},${dimension/3} ${dimension},${0} ${dimension/2} ${dimension / 2}`\n  }\n  const step2 = {\n    points: `0,${dimension}, ${dimension/2},${0} ${dimension},${dimension} ${dimension/2} ${dimension / 3}`\n  }\n\n  const moveSteps = useMemo(() => {\n    const steps = []\n    for (let i = 0 ; i < 30 ; i++) {\n      const y = Math.random() * boatHeight * 1.3 + containerHeight - boatHeight * 1.5;\n      const x = Math.random() * boatHeight * 2 - boatHeight;\n      const scale = Math.random() + .5\n      steps.push({\n        transform: `translate(${x}, ${y})scale(${scale})`\n      })\n    }\n    return steps;\n  }, [boatHeight, containerHeight])\n\n  const {points} = useSpring({\n    loop: true,\n    to: [step1, step2, step1],\n    from: step1,\n    config: { duration: 300 }\n  });\n  const {transform} = useSpring({\n    loop: true,\n    to: [...moveSteps, moveSteps[0]],\n    from: moveSteps[0],\n    config: { duration: 900 }\n  });\n  return (\n    <animated.g className=\"bird\" transform={transform}>\n      <animated.polygon\n        points={points}\n      />\n    </animated.g>\n  )\n}\n\nconst MovingBoat = ({\n  containerHeight,\n  containerWidth,\n  rightToLeft,\n  startAt,\n  size,\n  distance = 1\n}) => {\n  const birds = useMemo(() => {\n    if (distance > .5 && Math.random() > .5) {\n      const numberOfBirds = 1 + Math.round(Math.random() * 20);\n      let b = [];\n      for (let i = 0 ; i < numberOfBirds ; i++) {\n        b.push(i);\n      }\n      return b;\n    } else {\n      return [];\n    }\n  }, [distance])\n  const start = -containerWidth * 0.3; \n  const end = containerWidth * 1.3;\n  const step1 = {\n    transform: `translate(${rightToLeft ? end : start}, 0)`\n  }\n  const step2 = {\n    transform: `translate(${rightToLeft ? start : end}, 0)`\n  }\n  if (startAt) {\n    step1.transform =  `translate(${startAt}, 0)`\n  }\n  const randomFactor = useMemo(() => Math.random(), [])\n  const {transform} = useSpring({\n    from: step1,\n    to: step2,\n    config: { duration: PASS_DURATION * (2 - distance * (1 + randomFactor / 10)) }\n  });\n  const height = containerHeight * 0.2 * size * distance;\n  return (\n    <animated.g\n      transform={transform}\n    >\n      <g style={{opacity: distance}} transform={rightToLeft ? 'scale(-1, 1)' : ''}>\n        <g transform={`translate(0, ${containerHeight - height})`}>\n          <Boat\n            x={0}\n            height={height}\n            distance={distance}\n          />\n        </g>\n        {\n          birds.map(index => (\n            <Bird\n              containerHeight={containerHeight}\n              boatHeight={height}\n              distance={distance}\n              key={index}\n            />\n          ))\n        }\n        \n      </g>\n    </animated.g>\n  )\n}\n\n\nconst BoatsIllustration = ({\n  width = 1200,\n  height = 100,\n}) => {\n  const createBoat = (payload = {}) => {\n    const {startAt = 0} = payload;\n    const id = genId();\n    const distance = Math.random() * .8 + .2;\n    const rightToLeft = Math.random() >= .5;\n    const size = Math.round(Math.random() * 3) + 1;\n    return {\n      id,\n      distance, \n      rightToLeft,\n      size,\n      createdAt: new Date().getTime(),\n      startAt\n    }\n  }\n  const [boats, updateBoats] = useReducer((b, action) => {\n    switch(action.type) {\n      case 'removeBoat':\n        return Object.entries(b).reduce((res, [id, boat]) => {\n          if (id !== action.payload) {\n            return {\n              ...res,\n              [id]: boat\n            }\n          } else {\n            return res;\n          }\n        }, {});\n      case 'createBoat':\n      default:\n        const boat = createBoat(action.payload);\n        return {\n          ...b,\n          [boat.id]: boat\n        }\n    }\n  }, {});\n\n  useEffect(() => {\n    // add boats regularly\n    const timeout = setTimeout(() => {\n      // add boat\n      updateBoats({type: 'createBoat'})\n    }, PASS_DURATION / 10)\n    return () => clearTimeout(timeout)\n  }, [boats, updateBoats])\n\n  useInterval(() => {\n    const now = new Date();\n    Object.entries(boats).reduce((res, [id, boat]) => {\n      if (now.getTime() < boat.createdAt + PASS_DURATION * 1.3) {\n        return {\n          ...res,\n          [id]: boat\n        }\n      } else {\n        updateBoats({type: 'removeBoat', payload: id})\n        return res;\n      }\n    }, {})\n  }, UPDATE_RATE)\n\n  useEffect(() => {\n    for (let i = 0 ; i < 5 ; i++) {\n      updateBoats({type: 'createBoat', payload: {startAt: width * Math.random()}})\n    }\n  }, []);/* eslint react-hooks/exhaustive-deps : 0 */\n\n  return (\n    <svg className=\"BoatsIllustration\" width={width} height={height}>\n      {\n        Object.entries(boats).map(([id, {\n          distance, \n          rightToLeft, \n          size,\n          startAt\n        }]) => (\n          <MovingBoat \n            key={id} \n            distance={distance} \n            size={size} \n            rightToLeft={rightToLeft} \n            containerHeight={height} \n            containerWidth={width} \n            startAt={startAt}\n          />\n        ))\n      }\n    </svg>\n  )\n}\n\nexport default BoatsIllustration;","import BoatsIllustration from './BoatsIllustration';\n\nexport default BoatsIllustration;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"4 min read\",\"minutes\":3.39,\"time\":203400,\"words\":678}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h1>\n    <Caller id=\"intro-provinces\" mdxType=\"Caller\" />\n    <p>{`[`}{`texte martyr/de test pour l’intro du site - fait notamment avec des extraits du kit de bienvenue`}{`]`}</p>\n    <p>{`En 1789, à l’aube de la révolution, la façade atlantique de la France entame un long déclin économique qui se poursuivra jusqu’au XIXème siècle.`}</p>\n    <p>{`À l’intérieur de la France de 1789, les côtes charentaises possèdent un dense maillage portuaire (co-présence d’une quarantaine de ports) en tant que destination déclarée par les navires. Certains ports ne font que du cabotage micro-local, d’autres intègrent petit et grand cabotage, d’autres enfin comprennent aussi une navigation de long-cours. Cette région se prête donc particulièrement à une étude portant sur l’articulation entre les différentes échelles de commerce maritime à l’aube de la révolution.`}</p>\n    <p>{`Comment reconstituer l’histoire maritime et commerciale de la région à partir des sources historiques disponibles ?`}</p>\n    <Caller id=\"intro-ports\" mdxType=\"Caller\" />\n    <p>{`D’une part, nous disposons de traces administratives de la navigation maritime grâce au système fiscal d’imposition des voyages dans l’ancien régime. Les registres de congé répertoriaient les taxes imposées aux navires à leur départ d’un port (selon leur tonnage et destination) et étaient rédigés par les greffiers de l’amirauté locale. Ces documents ont été numérisés et structurés sous la forme d’une base de données intitulée Navigocorpus. Dans cette dernière, on compte plus de 15000 congés pour l’année 1789.`}</p>\n    <p>{`Les registres de congés nous permettent de repérer les dates de sortie de port des bateaux de la région, ainsi que diverses informations relatives à l’objet de leur voyage, leur tonnage, leur capitaine, etc.. Ces derniers ne sont cependant pas dénués d’incertitude : l’itinéraire déclaré par les capitaines de bateau au moment de la sortie de port ne correspond pas nécessairement au voyage effectif qui l’a suivi. Les congés permettent une bonne mesure des trafics de la région de La Rochelle, y compris à toute petite échelle, tout en demandant une attention fine à la dimension d’incertitude inhérente à la source mobilisée.`}</p>\n    <Caller id=\"intro-bureaux\" mdxType=\"Caller\" />\n    <p>{`D’autre part, nous disposons de traces administratives relatives au commerce général de la région. La base de données Toflit18 se fonde sur la numérisation des documents du Bureau de la balance du commerce de 1716 à 1821. Ces documents ont été produits grâce aux services des Fermes : chaque bureau des Fermes enregistrait localement les états de sortie et d’entrée des marchandises entre la France et l’étranger. Plus de 550 000 flux de sortie / entrée ont été documentés dans la base de données Toflit18.`}</p>\n    <p>{`Grâce aux données de la base Toflit18, nous sommes en mesure de lister les exports et imports entre les différents bureaux de ferme de la région et les partenaires étrangers du royaume de France. Les informations que l’on peut extraire de ces flux sont, entre autres, le nom du produit échangé, la quantité, la valeur, le partenaire commercial, et l’entité administrative ayant enregistré le flux au niveau local. Elles fournissent donc des informations complémentaires à celles données par les sources relatives à la navigation.`}</p>\n    <div className=\"centered-part\"><div className=\"centered-part-contents\">\n        <Caller mdxType=\"Caller\" />\n        <p>{`Le croisement entre congés de navigation et données fiscales de la Ferme rendu possible par les bases de données Toflit18 et Navigocorpus nous permet de saisir le commerce local, national et international, de préciser les flux et leur valeur pour ce qui est du commerce international, et d’explorer les relations et l’articulation entre les différents trafics de cette région.`}</p>\n        <p>{`La présente étude de cas décrit en trois temps l’histoire de la région de La Rochelle à l’aube de la révolution française. D’abord, nous décrivons la relative perte d’importance et de diversité commerciale de la région à la suite de la perte du Canada par le royaume de France durant la guerre de sept ans. Nous proposons ensuite une analyse détaillée de la restructuration de la région en relation avec cet événement, selon des filières spécialisées qui associent des ports particuliers avec le commerce de produits spécifiques. Nous démontrons enfin que, bien que resté dominant dans sa région, le port de la Rochelle a cessé de structurer la région de Poitou-Aunis-Saintonge au profit d’un réseau d’échange plus diversifié.`}</p>\n      </div></div>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Todo intro en`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport { geoEqualEarth, geoPath } from \"d3-geo\";\nimport { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { extent } from 'd3-array';\n\nimport { generatePalette } from '../../helpers/misc';\n// import { resetIdCounter } from 'vega-lite';\n\nimport './GeoComponent.css'\n\nconst Input = ({\n  value: inputValue,\n  onBlur,\n  ...props\n}) => {\n  const [value, setValue] = useState(inputValue)\n  useEffect(() => {\n    setValue(inputValue)\n  }, [inputValue])\n\n  return <input\n    value={value}\n    onChange={(e) => {\n      setValue(e.target.value)\n    }}\n    onBlur={(e) => {\n      onBlur(e.target.value)\n    }}\n  />\n}\n\nconst Button = ({\n  children,\n  onMouseDown,\n  ...props\n}) => {\n  const [isMouseDown, setState] = useState(false)\n\n  useEffect(() => {\n    let interval\n    if (isMouseDown) {\n      console.log(\"setInterval\")\n      interval = setInterval(onMouseDown, 100)\n    }\n    return () => {\n      console.log(\"clearInterval\")\n      clearInterval(interval)\n    }\n  }, [isMouseDown, onMouseDown])\n\n  return <button\n    {...props}\n    onMouseDown={() => {\n      setState(true)\n    }}\n    onMouseUp={() => {\n      setState(false)\n    }}\n    style={{ background: isMouseDown ? 'red' : undefined }}\n  >\n    {children}\n  </button>\n}\n\n\nconst GeoComponent = ({\n  dataFilename,\n  backgroundFilename,\n  width = 1800,\n  height = 1500,\n  label,\n  renderObject, // fonction : par défaut la représentation des données est sous forme de cercles, mais peut se changer en passant une autre fonction\n  markerSize, // TODO : permettre de paramétrer le type d'objet rendu (callback function ? => appeler un component par exemple)\n  markerColor,\n  showLabels,\n  centerOnRegion, // @TODO : rendre centerOnRegion et RotationDegree moins spécifique aux 2 configs existantes sur le site pour l'instant\n  rotationDegree = 0,\n  debug = false\n}) => {\n  // viz params variables\n  const [scale, setScale] = useState(200)\n  const [rotation, setRotation] = useState(0)\n  const [translationX, setTranslationX] = useState(width / 2)\n  const [translationY, setTranslationY] = useState(height / 2)\n  const [centerX, setCenterX] = useState(-1.7475027) // -1.7475027 pour centrer sur région\n  const [centerY, setCenterY] = useState(46.573642) // 46.573642\n\n  // raw marker data\n  const [data, setData] = useState(null);\n  // map background data\n  const [backgroundData, setBackgroundData] = useState(null);\n  const [colorsMap, setColorsMap] = useState(null);\n\n  const [loadingData, setLoadingData] = useState(true);\n  const [loadingBackground, setLoadingBackground] = useState(true);\n\n\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: csvString }) => {\n          const newData = csvParse(csvString);\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n\n  /**\n   * Data aggregation for viz (note : could be personalized if we visualize other things than points)\n   */\n  const markerData = useMemo(() => {\n    if (data) {\n      // regroup data by coordinates\n      const coordsMap = {};\n      data.forEach(datum => {\n        const mark = datum.latitude + ',' + datum.longitude;\n        if (!coordsMap[mark]) {\n          coordsMap[mark] = {\n            label: showLabels && label ? datum[label] : undefined,\n            latitude: datum.latitude,\n            longitude: datum.longitude,\n            color: datum[markerColor],\n            size: isNaN(+datum[markerSize]) ? 0 : +datum[markerSize],\n            else: datum // à changer mais pour l'instant je ne sais pas faire autrement\n          }\n        } else {\n          coordsMap[mark].size += (isNaN(+datum[markerSize]) ? 0 : +datum[markerSize])\n        }\n      })\n      let grouped = Object.entries(coordsMap).map(([_mark, datum]) => datum);\n      const colorValues = uniq(grouped.map(g => g.color));\n      const palette = generatePalette('map', colorValues.length);\n      const thatColorsMap = colorValues.reduce((res, key, index) => ({\n        ...res,\n        [key]: palette[index]\n      }), {});\n      setColorsMap(thatColorsMap);\n\n      const sizeExtent = extent(grouped.map(g => g.size));\n      const sizeScale = scaleLinear().domain(sizeExtent).range([1, width / 100])\n      grouped = grouped.map(datum => ({\n        ...datum,\n        color: thatColorsMap[datum.color],\n        size: sizeScale(datum.size)\n      }))\n      return grouped;\n    }\n  }, [data, markerColor, markerSize, width, label, showLabels])\n\n  /**\n   * Map background data loading\n   */\n  useEffect(() => {\n    if (backgroundFilename) {\n      const backgroundURL = `${process.env.PUBLIC_URL}/data/${backgroundFilename}`;\n      get(backgroundURL)\n        .then(({ data: bgData }) => {\n          setBackgroundData(bgData);\n          setLoadingBackground(false);\n        })\n        .catch((err) => {\n          setLoadingBackground(false);\n        })\n    }\n\n  }, [backgroundFilename])\n\n  /**\n   * d3 projection making\n   */\n  const projection = useMemo(() => {\n     setTranslationX(width/2)\n     setTranslationY(height/2) \n\n    let projection = geoEqualEarth() // ce qui vaut dans tous les cas ...\n      .scale(scale)\n      .translate([translationX, translationY]) // put the center of the map at the center of the box in which the map takes place ?\n\n    if (backgroundData) { // que si center on region\n      if (centerOnRegion) {\n        setScale(height*24); // 500000\n        setCenterX(-1.7475027);\n        setCenterY(46.573642);\n        projection\n          .scale(scale) // 50000 for a centered map\n          .center([centerX, centerY]) // -1.7475027, 46.573642 for a centered map\n          .translate([translationX * 0.8, translationY * 0.56]) // @TODO : stabiliser avec coefficients calculés (pour l'instant c'est du bricolage : j'essaie de cadrer entre Nantes et Bordeaux)\n      } else {\n        // if bg data is available fit on whole geometry\n        projection\n          .fitSize([width, height], backgroundData)\n      }\n      if (rotationDegree !== 0) { // seul cas où on veut une carte tournée pour le moment c'est dans le cas step 1 main viz part 3\n        setScale(width*28)\n        setRotation(rotationDegree);\n        projection\n          .angle(rotation)\n          .translate([translationX * 0.65, translationY * 0.65]) // dans ce cas besoin de décaler la carte vers la droite et vers le haut :  @TODO stabiliser avec coefficients calculés (pour l'instant c'est du bricolage)\n      }\n\n    }\n    return projection;\n  }, [backgroundData, width, height, centerOnRegion, scale, rotation, translationX, translationY, centerX, centerY, rotationDegree])\n\n\n\n  if (loadingBackground || loadingData) {\n    return (\n      <div>Chargement des données ...</div>\n    )\n  } else if (!backgroundData || !data) {\n    return (\n      <div>Erreur ...</div>\n    )\n  }\n\n  const [xCenterPoint, yCenterPoint] = projection([centerX, centerY]);\n\n  return (\n    <div>\n\n      {\n        debug ?\n          <>\n            <h2>scale: {scale}, rotation: {rotation}, translationX: {translationX}, translationY: {translationY}, centerX: {centerX}, centerY: {centerY}</h2>\n            <div class=\"table\">\n              <ul id=\"horizontal-list\">\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale * 1.6)}>scale+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setScale(scale / 1.6)}>scale-</Button>\n                    </li>\n                    <li>\n                      <Input value={scale} placeHolder={\"entrez une valeur pour la scale\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? scale : +str\n                        setScale(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => { console.log(\"DOWN !!\"); setRotation(rotation + 2) }}>rotation+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setRotation(rotation - 2)}>rotation-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 1.2)}>translationX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationX(translationX * 0.8)}>translationX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setTranslationY(translationY * 1.2)}>translationY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setTranslationY(translationY * 0.8)}>translationY-</Button>\n                    </li>\n                  </ul>\n                </li>\n                <li>\n                  <ul>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX + 0.3)}>centerX+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterX(centerX - 0.3)}>centerX-</Button>\n                    </li>\n                    <li>b\n                      <Button onMouseDown={() => setCenterY(centerY + 0.3)}>centerY+</Button>\n                    </li>\n                    <li>\n                      <Button onMouseDown={() => setCenterY(centerY - 0.3)}>centerY-</Button>\n                    </li>\n                    <li>\n                      <Input value={centerX} placeHolder={\"entrez une valeur pour la latitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerX : +str\n                        setCenterX(val)\n                      }} />\n                    </li>\n                    <li>\n                      <Input value={centerY} placeHolder={\"entrez une valeur pour la longitude\"} onBlur={(str) => {\n                        const val = isNaN(+str) ? centerY : +str\n                        setCenterY(val)\n                      }} />\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            </div>\n          </>\n          : null\n      }\n\n      <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} style={{ border: '1px solid lightgrey' }}>\n        <g className=\"background\">\n          {\n            backgroundData.features.map((d, i) => {\n              return (\n                <path\n                  key={`path-${i}`}\n                  d={geoPath().projection(projection)(d)}\n                  className=\"geopart\"\n                  fill={`rgba(38,50,56,${1 / backgroundData.features.length * i})`}\n                  stroke=\"#FFFFFF\"\n                  strokeWidth={0.5}\n                />\n              )\n            })\n          }\n        </g>\n        <g className=\"markers\">\n          {\n            markerData\n              .filter(({ latitude, longitude }) => latitude && longitude && !isNaN(latitude) && !isNaN(longitude))\n              .map((datum, index) => {\n                // console.log(\"datum : \",datum)\n                const { latitude, longitude, size, color, label } = datum;\n                const [x, y] = projection([+longitude, +latitude]);\n                return (\n                  <>\n                  {\n                    typeof renderObject === \"function\" ? // si la fonction est définie je veux l'utiliser dans mon render, sinon (si j'ai pas ce paramètre je veux rendre cercles par défaut) \n                    // je veux un élément html\n                    renderObject(datum, x, y, {width})\n                        :\n                  <g transform={`translate(${x},${y})`}>\n                          <circle\n                            key={index}\n                            cx={0}\n                            cy={0}\n                            r={size}\n                            fill={color}\n                            className=\"marker\"\n                          />\n                          {\n                            label ?\n                              <text\n                                x={size + 5}\n                                y={size / 2}\n                              >\n                                {label}\n                              </text>\n                              : null\n                          }\n                        </g>\n                      }\n                </>);\n                 })\n          }\n        </g>\n        {\n          colorsMap ?\n            <g className=\"legend\" transform={`translate(${width * .85}, ${height - (Object.keys(colorsMap).length + 1) * 20})`}>\n              <g>\n                <text style={{ fontWeight: 800 }}>\n                  {markerColor}\n                </text>\n              </g>\n              {\n                Object.entries(colorsMap)\n                  .map(([label, color], index) => {\n                    return (\n                      <g transform={`translate(0, ${(index + 1) * 20})`}>\n                        <rect\n                          x={0}\n                          y={-8}\n                          width={10}\n                          height={10}\n                          fill={color}\n                        />\n                        <text x={15} y={0}>\n                          {label || 'Indéterminé'}\n                        </text>\n                      </g>\n                    )\n                  })\n              }\n            </g>\n            : null\n        }\n        <circle cx={xCenterPoint} cy={yCenterPoint} r={5} fill={'red'} />\n      </svg>\n    </div>\n  )\n}\n\nexport default GeoComponent;\n","import React, { useState, useEffect } from 'react';\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n// import { geoEqualEarth, geoPath } from \"d3-geo\";\n// import { uniq } from 'lodash';\nimport { scaleLinear } from 'd3-scale';\nimport { max } from 'd3-array';\n\n// import { generatePalette } from '../../helpers/misc';\n\nimport './TriangleComponent.scss'\n\nconst TriangleComponent = ({\n  dataFilename,\n  totalWidth = 1200,\n  rowHeight = 200,\n  numberOfColumns = 5\n}) => {\n\n  // raw marker data\n  const [data, setData] = useState(null);\n\n  const [loadingData, setLoadingData] = useState(true);\n\n\n\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: csvString }) => {\n          const newData = csvParse(csvString);\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n\n  if (loadingData) {\n    return (\n      <div>Chargement des données ...</div>\n    )\n  } else if (!data) {\n    return (\n      <div>Erreur ...</div>\n    )\n  }\n\n  const columnWidth = totalWidth / numberOfColumns\n  const numberOfRows = data.length / numberOfColumns\n  const totalHeight = numberOfRows * rowHeight\n\n  // scaleLinear<Range = number, Output = Range, Unknown = never>(range?: Iterable<Range>): ScaleLinear<Range, Output, Unknown> (+1 overload)\n  const scaleX = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => { // data.map : boucle fonctionelle\n        // return +port[xVariable];\n        return +port.nb_pointcalls_out;\n      })\n    )\n  ]).range([0, columnWidth*4]); // @TODO : adapter pour permettre chevauchement => ne plus se limiter à la taille d'une colonne (+ centre de mon triangle à gérer)\n\n  const scaleY = scaleLinear().domain([\n    0,\n    max(\n      data.map((port) => {\n        return +port.mean_tonnage; // parseFloat(port.mean_tonnage);\n      })\n    )\n  ]).range([0, rowHeight*0.85]); // pour l'instant j'ai mis le max de longueur à 85% de la hauteur du rectangle conteneur \n  // je pourrais faire  range([0, rowHeight - place occupée par le texte]\n\n\n\n  return (\n    <div className=\"TriangleComponent\">\n\n      <svg width={totalWidth} height={totalHeight} viewBox={`0 0 ${totalWidth} ${totalHeight}`} style={{ border: '1px solid lightgrey' }}>\n        {\n          data.map((port, index) => {\n\n            const triangleWidth = scaleX(+port.nb_pointcalls_out)\n            const triangleHeight = scaleY(+port.mean_tonnage)\n\n            const xIndex = index % numberOfColumns;\n            const yIndex = (index - index % numberOfColumns) / numberOfColumns;\n            const xTransform = xIndex * columnWidth;\n            const yTransform = yIndex * rowHeight;\n            return (\n              <g\n                key={index}\n                // transform={`translate(${(index) * (columnWidth)}, ${height * .33 + (index%3)*(rowHeight)})`}\n                transform={`translate(${xTransform}, ${yTransform})`}\n              >\n                <rect\n                  x={0}\n                  y={0}\n                  width={columnWidth}\n                  height={rowHeight}\n                />\n\n                <path class='horizontalLine'\n                  d={`M ${columnWidth / 2} ${(rowHeight - triangleHeight)/1.2} \n                        V ${rowHeight / 7}\n                        `}\n                />\n\n                <path\n                  d={`M ${(columnWidth - triangleWidth) / 2} ${(rowHeight - triangleHeight)/1.2} \n                        H ${(columnWidth - triangleWidth) / 2 + triangleWidth}\n                        L ${columnWidth / 2} ${(rowHeight - triangleHeight)/1.2 + triangleHeight}\n                        Z\n                        `} // accents chelous : \"je commence à faire des interpolations\" \n                />\n\n                <g transform={`translate(${-columnWidth/1.25}, ${rowHeight/50}) rotate(-45 0 0)`}>\n                  <text\n                    x={parseInt(columnWidth / 2)}\n                    y={parseInt(rowHeight / 3)}\n                    text-anchor=\"left\"\n                  > {port.port} </text>\n                </g>\n\n              </g>\n            )\n          })\n\n        }\n\n      </svg>\n\n    </div>\n  )\n\n}\n\nexport default TriangleComponent;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"5 min read\",\"minutes\":4.815,\"time\":288900,\"words\":963}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-1-le-déclin-de-la-région-de-la-rochelle-suite-à-la-perte-du-canada\"\n    }}>{`Partie 1. Le déclin de la région de La Rochelle suite à la perte du Canada`}</h1>\n    <Caller id=\"viz-principale-partie-1\" step={1} mdxType=\"Caller\" />\n    <p>{`Au dix-huitième siècle, la France a pleinement profité du développement des relations économiques entre l’Afrique, l’Amérique et l’Europe. L’ “Atlantique français” reposant sur la traite des Africains et leur exploitation dans les Îles françaises (Antilles et Mascareignes) a connu son apogée juste avant la révolte de Saint-Domingue en août 1791 et le début de la guerre maritime avec l’Angleterre en février 1793. L’ancienne région Poitou-Charente, correspondant approximativement aux généralités de Poitou, Aunis, Saintonge et Angoumois (PASA), avait une tradition maritime ancienne et était bien située pour bénéficier de cet épisode de prospérité. `}</p>\n    <Caller id=\"viz-principale-partie-1\" step={2} mdxType=\"Caller\" />\n    <p>{`L’examen du commerce avec les pays étrangers et les colonies de la direction des Fermes de La Rochelle, qui était leur façade maritime, montre toutefois un dynamisme limité. Il y a bien eu croissance du commerce. Mais cette croissance a été plus lente que celle des autres grands ports du royaume. Cela s’explique en grande partie par les relations privilégiées de la direction de la Rochelle avec le Canada. D’une part, celui-ci se développe beaucoup moins vite que les Antilles, et la région souffre de ce manque de dynamisme durant la première moitié du siècle. D’autre part, le Canada est cédé aux Anglais lors du traité de Paris qui clôt la guerre de Sept Ans en 1763. Québec avait déjà été pris en 1759. Cette perte est sévère pour la région dont le commerce entame alors un recul relatif très net. La direction de La Rochelle effectue 4,8% du commerce extérieur français en 1750. En 1789 sa part ne représente plus que 3%.`}</p>\n    <Caller id=\"viz-principale-partie-1\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce résultat contraste avec les résultats qu’obtiennent les généralités de Bordeaux et de Nantes. Bordeaux, notamment, est beaucoup plus dynamique que La Rochelle et son commerce dépasse celui de Nantes à partir des années 1740.`}</p>\n    <p>{`Le recul de La Rochelle n’est pas que quantitatif. En 1750, les données de la direction des Fermes de La Rochelle, chargée de la collecte des droits sur le commerce extérieur et colonial, montre que cette partie du territoire commerce 21% des types de biens échangés par la France (645 sur 3055, après uniformisation des variations orthographiques). En 1789, elle n’en commerce plus que 7% (248/3565). Cela s’observe à la fois pour les exportations et pour les importations. A un niveau plus agrégé de typologie des produits, parmi les 150 secteurs de la classification «Révolution et Empire”, utilisée dans le cadre du programme ANR Toflit18, La Rochelle en commerce 121 en 1750, mais seulement 88 en 1789.`}</p>\n    <p>{`Les exportations sont donc beaucoup plus diverses en 1750 qu’en 1789. L’indice de concentration (Herfindhal) est de 0,1 en 1750 et 0,24 en 1789. Deux biens pour lesquels il n’y a pas beaucoup de concurrence nationale (le sel et les eaux-de-vie) et deux réexportations coloniales (le café et le sucre) dominent en 1789 les exportations, avec le blé. En 1750, la mercerie et les étoffes de laine font partie des cinq principales exportations (avec l’indigo, les eaux-de-vie et le sucre : le sel est en 14e position). La direction des Fermes de La Rochelle s’est spécialisée dans les produits agricoles et les réexportations au dépens des biens manufacturés. Ce jugement négatif est toutefois nuancé par l’intensité capitalistique de la production d’eaux-de-vie qui la rapproche des biens manufacturés.`}</p>\n    <p>{`Nous ne connaissons pas la destination des réexportations coloniales en 1789. En les excluant, on constate que la concentration des marchés de la direction des Fermes de La Rochelle est la même en 1750 et en 1789 (entre 0,41 et 0,44), mais que l’Angleterre a pris la place de l’Amérique. La direction des fermes de La Rochelle n’exporte plus des biens différenciés vers le Canada, mais essentiellement des eaux-de-vie vers l’Angleterre.`}</p>\n    <p>{`Les données de la navigation ne nous permettent pas d’aller beaucoup plus loin dans l’analyse du déclin de cette région: d’une part, car n’avons le détail des sorties que pour la fin de l’Ancien Régime, ce qui empêche une analyse diachronique. D’autre part, car les données collectées pour 1789 n’apportent que des informations limitées pour ce qui est des produits transportées: les congés du port de La Rochelle, par exemple, ne mentionnent pas la nature de la cargaison, alors que dans les autres ports le greffier se limite le plus souvent à noter seulement l’article principal qui constitue la cargaison. Les registres des congés indiquent, toutefois, les destinations de chaque navire sorti et cette donnée permettra de constater un relatif éclatement des marchés de cette région. `}</p>\n    <p>{`Enfin, la perte de vitesse de la région vers la fin de l’Ancien Régime semble attestée aussi pour ce qui concerne sa capacité à assurer ses propres trafics. Si on prend en compte la part de navigation sous pavillon français assurée par des navires de la région étudiée, elle est en effet inférieure à celle de la plupart des autres provinces françaises: en 1787, les ports de l’Aunis-Saintonge-Poitou assurent 51.6% du tonnage qu’ils expédient, contre 84.3% pour la Bretagne ou 58,7% pour la Guyenne. En affinant, on peut voir si la région étudiée assure plus ou moins que d’autres ses trafics extérieurs. `}</p>\n    <p>{`La navigation avec l’étranger est assurée, à 90%, par de pavillons étrangers ou extérieur à la région étudiée. Il s’agit, pour l’essentiel, des pavillons britannique et des pays de l’Europe du Nord.`}</p>\n    <p>{`Si on regarde les départs depuis la région étudiée vers de ports français, calculer la part de la navigation assurée par homeport locaux en 1787 dans ports de la direction de la Rochelle vers intérieur direction / reste France / international / hors Europe et comparer avec idem pour Bordeaux et pour Nantes par ex. (en tonnage)`}</p>\n    <p>{`De toutes les manières, plutôt des camemberts ?`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 1 intro`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"18 min read\",\"minutes\":17.155,\"time\":1029300,\"words\":3431}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-2-une-forte-spécialisation-portuaire--le-cas-de-la-traite-négrière-du-commerce-du-sel-et-de-leau-de-vie\"\n    }}>{`Partie 2. Une forte spécialisation portuaire : le cas de la traite négrière, du commerce du sel et de l’eau-de-vie`}</h1>\n    <Caller id=\"viz-principale-partie-2\" step={1} mdxType=\"Caller\" />\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`La région étudiée se caractérise par une densité importante de ports, qui entretiennent des relations plus ou moins étendues et plus ou moins intenses avec le reste de la France et du monde. `}</p>\n    <p>{`La carte représente le tonnage expédié en 1787, à partir des congés délivrés aux navires, toute destination confondue. Les 8 ports dépassant les 10000 tonneaux entretiennent tous, sauf Marans, un commerce avec l’étranger; la presque totalité des ports sous ce seuil se cantonnent en revanche à un commerce régional ou national.`}</p>\n    <p>{`Nos analyses ont montré que les tonnages enregistrés à Marennes semblent surestimés à 40%. Même en prenant en compte cette distorsion, le tonnage nécessaire aux exportations vers l’étranger du port de La Rochelle n’est pas le plus important dans la région. Comme nous le verrons dans la partie 3 `}{`[`}{`lien`}{`]`}{`, La Rochelle n’a pas un rôle structurant dans les relations que les ports de cette région ont avec l’étranger. `}</p>\n    <p>{`La carte permet de constater que les navires expédiés depuis l’Aunis se dirigent vers l’ensemble de l’Europe du Nord, ceux depuis la Saintonge essentiellement vers les îles britanniques et la Hollande, et que ceux au départ du Poitou, nettement moins importants en volume, privilégient l’espace Baltique. Cette différenciation est liée à la nature des produits exportés et du commerce de chaque port.`}</p>\n    <p>{`De par ses relations exclusives avec les colonies et surtout son investissement dans la traite négrière, La Rochelle mérite une étude à part. Pour ce qui des relations avec l’étranger (hors colonies), on constate des circuits relativement distincts: Noirmoutier, Ars-en-Ré et Marennes - qui exportent pour l’essentiel du sel, ont comme principales débouchées extérieures la Baltique et les pays scandinaves. Nous développerons ici en détail le cas de Marennes, principal port exportateur français de sel.`}</p>\n    <p>{`Pour le commerce des eaux-de-vie, nous étudierons le cas de Tonnay-Charente. La mention de l’eau-de-vie parmi les cargaisons est rare, il faut donc se tourner d’abord vers la Balance du commerce, pour affiner ensuite les données par l’analyse de la navigation. `}</p>\n    <p>{`L’importance des tonnages impliqués n’est au demeurant pas directement corrélée à la valeur des marchandises transportées. En effet, les données de la Ferme donnent les valeurs suivantes:`}</p>\n    <p>{`Bureaux de Ferme de la direction de La Rochelle, exportations en 1789`}</p>\n    <a name=\"t.f271f803a2027ad5854321e7817f569fb280399d\"></a><a name=\"t.0\"></a>\n    <p>{`Bureau de Ferme`}</p>\n    <p>{`Valeur des exportations en livres tournois`}</p>\n    <p>{`Aligre`}</p>\n    <p>{`1 302 594,57`}</p>\n    <p>{`Charente`}</p>\n    <p>{`6 194 522,97`}</p>\n    <p>{`La Rochelle`}</p>\n    <p>{`7 698 983,18`}</p>\n    <p>{`Les Sables d’Olonne`}</p>\n    <p>{`110 527,00`}</p>\n    <p>{`Marennes`}</p>\n    <p>{`1 921 839,39`}</p>\n    <p>{`Rochefort`}</p>\n    <p>{`274 173,22`}</p>\n    <p>{`Saint-Martin-de-Ré`}</p>\n    <p>{`1 209 320,67`}</p>\n    <p>{`(vide)`}</p>\n    <p>{`1 662 254,00`}</p>\n    <p>{`Total général`}</p>\n    <p>{`20 374 214,99`}</p>\n    <p>{`Exports avec ports francs / petites Îles: `}</p>\n    <p>{`Total avec ports francs / petites Îles : `}</p>\n    <h2 {...{\n      \"id\": \"21-la-rochelle-et-le-commerce-triangulaire\"\n    }}>{`2.1. La Rochelle et le commerce triangulaire`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={2} mdxType=\"Caller\" />\n    <p>{`Au XVIIIe siècle, les colonies antillaises augmentent très considérablement leur production de sucre, café, indigo et produits tinctoriaux, pour répondre à une demande européenne fortement orientée à la hausse. La croissance de la production passe par un nombre de plus en plus élevé d’unités de production, appelées plantations, qui ont un recours massif à une main-d’œuvre d’esclaves, que les Européens déportent par centaines de milliers depuis l’Afrique dans le cadre de la traite négrière. Ce commerce transatlantique d’êtres humains, achetés sur les côtes d’Afrique par les négriers européens, a commencé au XVe siècle, mais il atteint son apogée au XVIIIe siècle, lorsque 6 millions d’Africains sont apportés aux Amériques. La moitié d’entre eux est vendue aux Antilles. On estime à 1.25 millions `}{`[`}{`Silvia: à vérifier`}{`]`}{` le nombre d’Africains introduits dans les colonies françaises au XVIIIe siècle. La principale destination est la colonie de Saint-Domingue (aujourd’hui Haïti) qui compte, à la veille de la grande révolte d’esclaves de 1791, un demi-million d’esclaves, dont plus de la moitié sont nés en Afrique.`}</p>\n    <p>{`L’activité négrière est aux mains d’armateurs privés qui espèrent réaliser un profit lors de la revente des esclaves. Si Nantes est le principal port négrier français, La Rochelle a joué un rôle significatif, tout particulièrement dans les années 1730–1740 : entre 1713 et 1744, La Rochelle arme 15% des expéditions négrières, sa part tombe à 11% après la perte du Canada, en sorte que si La Rochelle est le deuxième port négrier le plus important en France avant 1763, il passe au 4e rang par la suite. `}</p>\n    <p>{`Malgré un déclin relatif, l’activité négrière rochelaise est résolument orientée à la hausse. Les armateurs rochelais passent de 4,3 armements négriers par an pour la période 1713–1744 à 12,5 armements par an dans la décennie 1783–1793. Pendant cette dernière, la traite est véritablement de l’activité principale, voire presque exclusive, des armateurs rochelais: sur un total de 200 départs depuis le port de La Rochelle de navires rochelais, un peu plus de la moitié des tonnages se dirigent vers l’Afrique (42% du total) ou vers les colonies antillaises ou les Mascareignes, le reste se répartissant entre Terre-Neuve et Saint-Pierre-et-Miquelon (9.2%) La part des armements vers l’étranger est insignifiante (0.2%), et celle hors des ports limitrophes (Aunis, Poitou, Saintonge) ne dépasse pas le 5%. Les trois quarts de la trentaine de navires rochelais dépassant le 50 tx `}{`[`}{`le plus grand faisant 827 tonneaux`}{`]`}{` sortis du port de La Rochelle en 1789 se consacrent au commerce transatlantique et négrier.`}</p>\n    <p>{`Les données de la Balance du commerce confirment la centralité du commerce colonial et négrier : en 1789, les exportations vers l’Afrique représentent 23% du total des exportations du bureau des Fermes, alors que 73% est constitué par les ré-exportations des denrées coloniales. `}</p>\n    <p>{`Alors que dans la plupart des ports négriers français, la part des armements négriers est nettement inférieure à celle des armements en droiture vers les Antilles, cela n’est pas le cas à La Rochelle, où les trois quarts des expéditions de 1787 destinées à approvisionner les Antilles en hommes ou en produits sont des négriers. Comme à Honfleur, il y a donc clairement, en matière de trafics transatlantiques, une spécialisation négrière de l’armement rochelais. Par ailleurs, et contrairement aux autres ports français qui font le commerce avec les Amériques (Marseille, Bordeaux, Nantes, Rouen/Le Havre), La Rochelle a une préférence quasi-exclusive pour Saint-Domingue où plusieurs grandes familles de la ville (Belin, Garesché, Poupet Rasteau) sont très bien implantées.`}</p>\n    <p>{`En 1789, les 12 négriers partis de La Rochelle sont tous rochelais. Rochefort arme pour sa part 3 autres négriers.`}</p>\n    <p>{`Au total, dans les dernières années de l’Ancien Régime, une douzaine de navires reviennent chaque année à La Rochelle depuis les colonies, soit en droiture, soit (et surtout) de retour d’une expédition négrière. La valeur des produits ramenés est estimée, en 1789, à 7.1 millions de livres tournois, dont 5.1 sont réexportés à l’étranger (ANOM, F 2 B 14, tableaux 3 et 5). Les négociants rochelais semblent s’être taillés une position forte dans le marché du café.`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21&sa=D&source=editors&ust=1625503563481000&usg=AOvVaw0yjL-p76XHKOfr0v9oCXmE\"\n      }}>{`https://drive.google.com/drive/folders/1vv6zi6QJVN203lZPTkRjLrgupEvzNW21`}</a></p>\n    <p>{`Si les données collectées par la Balance du commerce ne permettent pas de connaître les destinations des réexportations coloniales rochelaises, les destinations des navires qui quittent le port en 1789 nous en donnent une indication approximative: en excluant à coup sûr la Grande-Bretagne et les Etats-Unis, qui s’approvisionnement autrement que sur les marchés français, c’est essentiellement l’Europe du Nord et la Baltique qui absorbent le café et le sucre antillais réexportés. `}</p>\n    <a name=\"t.e04ea08ffc0a1e5af3987339feba50fdcd3863fc\"></a><a name=\"t.1\"></a>\n    <p>{`Destinations des navires vers l’étranger (Afrique exclue) au départ du port de La Rochelle, 1789`}</p>\n    <p>{`pays`}</p>\n    <p>{`tx total`}</p>\n    <p>{`Pays-Bas autrichiens`}</p>\n    <p>{`512`}</p>\n    <p>{`Provinces-Unies`}</p>\n    <p>{`550`}</p>\n    <p>{`Brême`}</p>\n    <p>{`520`}</p>\n    <p>{`Hambourg`}</p>\n    <p>{`530`}</p>\n    <p>{`Norvège`}</p>\n    <p>{`150`}</p>\n    <p>{`Prusse (ports en Baltique)`}</p>\n    <p>{`370`}</p>\n    <p>{`Baltique (indéterminé)`}</p>\n    <p>{`200`}</p>\n    <p>{`Grande-Bretagne`}</p>\n    <p>{`1048`}</p>\n    <p>{`Etats-Unis d’Amérique`}</p>\n    <p>{`160`}</p>\n    <p>{`étranger (indéterminé)`}</p>\n    <p>{`104`}</p>\n    <p>{`Dès lors, il n’est pas surprenant que le négoce rochelais porte toute son attention aux questions liées au commerce colonial et négrier. Cela apparaît clairement parmi les sujets discutés par la chambre de commerce de La Rochelle. L’indexation faite à la main, à l’époque, sur la marge des registres de délibération la Chambre (Arch dépt. Charente Maritime, 41 ETP 8) permet de constater que dans la seule année 1789, le commerce d’Afrique est discuté à une trentaine de reprises, et les colonies à une 50 des reprises, le commerce de l’Inde à 9; à titre de comparaison, le commerce avec l’étranger est abordé 11 fois en tout, et la pêche (avec notamment la question de la concurrence et de l’admission de la pêche états-unienne, très débattue cette année là en France), 17 fois. Parmi les produits indexés au marge des registres de délibérations, les comestibles sont mentionnés 16 fois - ce qui dans la conjoncture céréalière particulière de l’époque n’est guère étonnant-, l’eau-de-vie et le vin 6, les sucres et les raffineries 8, le charbon de terre 3. On mesure clairement, en dépit d’un critère sans doute grossier, que le regard des membres de la Chambre de commerce est clairement rivé sur les colonies et à la traite. `}</p>\n    <p>{`Si la question de la traite est absente des cahiers de doléances de la région `}{`[`}{`préciser leur nombre et fournir un % approximatif de leur complétude par rapport à tous ceux rédigés?`}{`]`}{`, la défense des intérêts coloniaux apparaît, significativement, uniquement dans le cahier de doléances du Tiers-état de la ville de La Rochelle, dont les représentants envoyés à Versailles “demanderont la révocation de l’arrêt rendu au conseil du roi, le 30 août 1784, concernant le commerce étranger dans les colonies, et le rétablissement des dispositions des lettres patentes de 1717 et 1727, auxquelles on est redevable des progrès qu’ont faits la navigation françoise et la culture des isles françoises de l’Amérique”; par ailleurs, ils “demanderont la suppression de l’entrepôt et des droits actuels de consommation sur les sucres, cafés et l’indigo venant des colonies, et qu’il soit substitué, à l’entrée de la totalité de ces denrées dans tous les ports du roïaume, un droit uniforme `}{`[`}{`…`}{`]`}{` : que le terrage des sucres étant défavorable à la navigation, s’il n’est pas possible de l’interdire entièrement dans nos colonies, comme il l’est dans les colonies anglaises, il soit au moins défendu `}{`[`}{`…`}{`]`}{` de l’étendre davantage par de nouveaux établissemens, et que, les sucres bruts devant être, ainsi que le coton, considérés comme matière première, il soit mis un droit à la sortie du roïaume des sucres bruts, assez sensible pour que la plus grande quantité de cette matière soit conservée en France et serve à relever et à soutenir les raffineries et à procurer du travail, puisque c’est dans ces vues que le gouvernement d’Angleterre interdit rigoureusement la sortie en nature des sucres bruts importés de ses colonies…”. Enfin “Les députés demanderont la révocation de l’arrêt du 14 avril 1785 , qui a créé une nouvelle compagnie des Indes et de celui pour l’admission des étrangers dans les isles de France et de Bourbon.” `}</p>\n    <p>{`Il faut observer que la participation rocheloise à la navigation au-delà du cap de Bonne-Espérance est modeste: l’état des exportations de 1789, n’indique que 38060 livres tournois exportés vers l’Inde, et rien vers les Mascareignes (ANOM, COl F 2B 14, tableau 28`}{`]`}{`. Ces données semblent toutefois incompatibles avec le départ du Henri IV pour l’île de France et à l’île Bourbon, le 9 mai 1789, qui arrive à bon port en février 1790, et qui n’est pas un négrier `}{`[`}{`Toussaint, p. 291`}{`]`}{` à moins que sa cargaison ne viennent entièrement d’autres directions de Fermes du royaume. En 1787, ce sont trois armements vers les Mascareignes qui partent de La Rochelle: une certaine diversification des armements coloniaux apparaît donc, ici comme à Bordeaux, dans les années 1780, lorsque les profits du commerce antillais incitent à chercher des investissements plus rentables.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`vérifier si cahiers de doléances en parlent. `}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"22-le-commerce-de-leau-de-vie\"\n    }}>{`2.2. le commerce de l’eau-de-vie`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={3} mdxType=\"Caller\" />\n    <p>{`total exportations eau-de-vie depuis la France et destinations pour mesurer part direction de la Rochelle (en précisant le bureau des Fermes concernés)`}</p>\n    <p>{`Les congés de navigation ne sont malheureusement pas de beaucoup de secours pour identifier les flux d’eau-de-vie. En effet, le greffier du port de Tonnay-Charente ne prend pas le soin d’annoter les cargaisons (il le fait 12 fois sur un total de 601 départs): nous avons donc un aperçu global de la navigation, sans pouvoir distinguer la nature des produits. `}{`[`}{`extrait de l’ouvrage sur Tonnay-Charente, paru en 2012:`}{`]`}{` Si on se base sur les seules sorties de l’année 1787, 67 navires de tonnage moyen, proche de 100 tx, quittent alors Tonnay-Charente : 42 se rendent à l’étranger (en Angleterre pour les deux tiers, le reste vers les îles anglo-normandes, Ostende et la Baltique) ; les 25 gros caboteurs restants se rendent à Dunkerque. On identifie ici la flotte européenne de l’eau-de-vie, qui représente 22 % du tonnage sortant en 1787. Un cran en dessous, on identifie un second groupe, composé d’une poussière de petits caboteurs (tonnage moyen 35 tx) et qui représente tout de même 30 % du tonnage sortant. Ces navires sont alignés sur une destination unique : la Rochelle. Ils sont pour partie occupés à l’approvisionnement de la ville mais une part est certainement reliée avec l’activité d’entrepôt des eaux-de-vie que pratiquent les négociants rochelais. Enfin, des unités plus modestes (25 tx en moyenne) évoluent au sein de la mer des Pertuis (depuis la Seudre sud jusqu’aux Sables d’Olonne) : elles représentent 23 % du tonnage à la sortie du port de Tonnay-Charente. Il faut remarquer que 479 de 743 congés délivrés en 1787 dans ce port concernent les navires avalant et attachés à des ports fluviaux. Venus porter les eaux-de-vie mais aussi les pierres de carrière et les produits manufacturés de l’arrière-pays à Tonnay-Charente, leurs maîtres quittent ce port soit à vide, soit avec une cargaison destinée à Rochefort, La Rochelle ou bien aux ports de la mer des pertuis, qui leur fournissent du fret de retour pour leur navigation vers l’amont du fleuve Charente. `}{`[`}{`Cette structure du commerce de Tonnay Charente - Révélateur du commerce d’eau de vie - pourrait être montrée à l’aide des diagrammes de Louvain ?`}{`]`}</p>\n    <p>{`Les exportations d’eau-de-vie charentaise en 1789 sont très supérieures à la moyenne séculaire. L’explication réside dans les modifications induites par le Traité d’Eden de 1786, qui entraîne une augmentation extrêmement importante des exportations d’eau-de-vie vers l’Angleterre, notamment des eaux-de-vie de qualité produites dans la région de Cognac, au détriment de celles de moindre qualité. Le total des exportations d’eaux-de-vie françaises vers la Grande-Bretagne passe de 10 à 15 millions de livres tournois dans les années 1760–70, à 40 millions en 1787–89.`}</p>\n    <p>{` -`}{`>`}{` voir valeur export eau-de-vie de la direction de La Rochelle dans le temps), `}</p>\n    <p>{`En effet, les exportations d’Eaux-de-vie de 1789 semblent anormalement élevées :`}</p>\n    <p>{`Il faudrait avoir un graphique sur les exportations totales d’eau de vie sur la France entière et en particulier sur les généralités de Bordeaux, Bayonne et Nantes. Il y aussi à partir du milieu des années 20 une augmentation des exportations à partir des ports méridionaux, en particulier Sète. On pourrait avoir des coupes en 1750, une autre année (?) et 1789. `}</p>\n    <p>{`Autre idée de visualisation: en 1789, regarder les origines des exports. Il est possible qu’une partie des exports de la région de Cognac passe par Bordeaux, l’Armagnac a priori passe par Bayonne (selon Cullen 1998 qui est LA référence sur ce thème). Il y aussi des choses intéressantes dans l’article de Thierry (2013) sur Tonneau-Charente et Rochefort. Il faut distinguer aussi entre “eau de vie simple” et “eau de vie double” dans TOFLIT18, la 2e catégorie correspond je pense à la meilleure qualité (elle est plus chère et on la trouve moins souvent), donc le Cognac (et Armagnac).`}</p>\n    <p>{`Par ailleurs, d’après Cullen le commerce d’exportation des eaux de vie connaît une croissance forte après la fin de guerre d’indépendance américaine, mais il n’a pas de stat très détaillé pour 1789.`}</p>\n    <h2 {...{\n      \"id\": \"23-marennes-et-le-commerce-du-sel\"\n    }}>{`2.3. Marennes et le commerce du sel`}</h2>\n    <Caller id=\"viz-principale-partie-2\" step={4} mdxType=\"Caller\" />\n    <p>{`…`}</p>\n    <p>{`Denrée pondéreuse de faible valeur, le sel voyage dès que cela est possible par voie maritime. Les côtes de la région étudiée sont, avec celles du sud de la Bretagne, de très grands producteurs de sel. Les marchés sont aussi bien nationaux - avec une demande soutenue notamment dans les ports de la Manche qui arment à la grande pêche - que vers les pays de l’Europe du Nord, qui s’approvisionnent également au Portugal (Setubal). `}</p>\n    <p>{`Le bureau des fermes de Marennes est en absolu le principal exportateur de sel en France (quantités), si l’on inclut aussi les quantités expédiées vers les ports francs français. Il vient en troisième position, derrière les bureaux du Croisic et de Saint-Martin-de-Ré, si on se limite aux marchés extérieurs au royaume.`}</p>\n    <p>{`Les valeurs en jeu ne sont pas très élevées, comparées à celles des flux commerciaux dont il a été question pour La Rochelle et Tonnay-Charente: le sel exporté depuis Marennes, y compris à destination des ports francs français, se chiffre autour de 360,000 livres tournois en 1789 (dont 141,000 vers l’étranger). En revanche, son commerce alimente un mouvement portuaire extrêmement intense, qui fait de Marennes, en termes de nombre de navires sortis et de leur tonnage, le principal port de la région étudiée. Son commerce maritime est donc une activité importante, tant pour la production locale qu’il soutient, que pour l’activité induite liée à son transport (construction navale, emploi maritime).`}</p>\n    <p>{`Tous les flux sont là : `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.google.com/url?q=http://toflit18.medialab.sciences-po.fr/%23/exploration/flows?sourceType%3DBest%2520Guess%2520customs%2520region%2520product%2520x%2520partner%26productClassification%3Dproduct_revolutionempire%26product%3D%255B%2522Sel%257Eproduct_revolutionempire%2522%255D%26page%3D0%26region%3D%2524all%2524%26kind%3Dtotal%26dateMin%3D1789%26dateMax%3D1789%26columns%3D%255B%2522product%2522%252C%2522region%2522%252C%2522year%2522%252C%2522partner%2522%252C%2522import%2522%252C%2522value%2522%252C%2522unitPrice%2522%252C%2522source%2522%252C%2522rawUnit%2522%255D%26orders%3D%255B%257B%2522key%2522%253A%2522unitPrice%2522%252C%2522order%2522%253A%2522DESC%2522%257D%255D&sa=D&source=editors&ust=1625503563490000&usg=AOvVaw2_BI5ObK1F0yyn69SLYVZ-\"\n      }}>{`http://toflit18.medialab.sciences-po.fr/`}{`#`}{`/exploration/flows?sourceType=Best%20Guess%20customs%20region%20product%20x%20partner`}{`&`}{`productClassification=product`}{`_`}{`revolutionempire`}{`&`}{`product=%5B%22Sel%7Eproduct`}{`_`}{`revolutionempire%22%5D`}{`&`}{`page=0`}{`&`}{`region=%24all%24`}{`&`}{`kind=total`}{`&`}{`dateMin=1789`}{`&`}{`dateMax=1789`}{`&`}{`columns=%5B%22product%22%2C%22region%22%2C%22year%22%2C%22partner%22%2C%22import%22%2C%22value%22%2C%22unitPrice%22%2C%22source%22%2C%22rawUnit%22%5D`}{`&`}{`orders=%5B%7B%22key%22%3A%22unitPrice%22%2C%22order%22%3A%22DESC%22%7D%5D`}</a></p>\n    <p>{`(mais pas par bureau).`}</p>\n    <p>{`Grosses variations de prix. Pas mal de prix absurdes. D’un peu moins de 36 livres à 10 sous le quintal (!) `}</p>\n    <p>{`Exports par bureau (y compris vers la France): `}</p>\n    <p>{`Exports par bureau hors la France : `}</p>\n    <p>{`Marchés pour les exports :`}</p>\n    <p>{`Marchés pour les exports de Marennes:`}</p>\n    <p>{`Les données sur la navigation aident à préciser la géographie commerciale du sel exporté depuis Marennes, même si elles n’indiquent les quantités exportées. Dans la mesure où les navires qui le transportent sortent souvent chargés entièrement de sel, on peut de manière approximative additionner le total des tonnages des navires chargés de sel pour avoir un ordre de grandeur des trafics. À compter du règne de Louis XIV, la législation relative aux gabelles fait d’ailleurs obligation au chargeur de naviguer avec une cargaison complète. Le tonnage des navires chargés de sel est donc un assez bon indicateur des quantités exportées.`}</p>\n    <p>{`Les congés confirment que, parmi les ports exportateurs de la région étudiée, la primauté revient incontestablement à Marennes: en 1787, le tonnage additionné de navires sortis de ports français avec du sel y est de plus du double qu’à Ars-en-Ré, le deuxième grand exportateur de la région. Même en prenant en compte la surévaluation des tonnages de navires à Marennes, que nous avons constatée en comparant le tonnage d’un même navire relevé en plusieurs ports, Marennes demeure le principal fournisseur de sel en France, ce qui est confirmé par la Balance du commerce. La carte indique le tonnage total des navires sortis chargés du sel dans les ports de la France atlantique et leurs destinations.`}</p>\n    <p>{`L’exportation de sel est en outre une activité quasi exclusive à Marennes : sur 1174 départs en 1787, 990 ont chargé du sel. En 1789, ce sont 1301 sur 1481. `}</p>\n    <p>{`Les destinations des navires chargés de sel partis de Marennes montrent que le marché national est nettement plus important que les marchés étrangers additionnés. Marennes s’impose donc comme un fournisseur privilégié pour les greniers à sel des gabelles, ainsi que le montre la géographie des destinations françaises: elles sont souvent des ports de rupture de charge sur des estuaires : Honfleur, Nantes, Bordeaux et Libourne (sur la Dordogne), ou de ports francs (Bayonne et Dunkerque). Cette situation est peut-être à l’origine de la surestimation des tonnages constatée dans ce seul port de Marennes, qui travaille vraisemblablement sous le regard serré des agents de la Ferme. Les bureaux des fermes associés aux autres grandes zones de production de sel - Le Croisic et Saint-Martin-de-Ré - montrent une plus grande internationalisation du trafic.`}</p>\n    <p>{`Pistes possibles:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`dvp texte sur marchés extérieurs avec valeur et quantités (Toflit) et faire calcul valeur/tx`}</li>\n      <li parentName=\"ul\">{`regarder si Chambre de commerce et cahiers de doléances parlent du commerce du sel`}</li>\n      <li parentName=\"ul\">{`Piste: vérifier qui, parmi les ports exportateurs du sel, ont de liens forts avec l’étranger et mettre cela en relation, éventuellement, aux tirants d’eau - tonnage moyen des navires exportateurs par destination et par port de départ. En clair: est-ce que Marennes exporte plus vers l’étranger que vers le marché national comparé aux autres ports qui vendent du sel? ici on a besoin de l’expertise de Thierry`}</li>\n      <li parentName=\"ul\">{`Il y a un ouvrage récent publié aux PUR (et lisible sur openedition) avec 2 articles sur le sujet. Je (Loïc) n’ai pas eu le temps de les lire.`}</li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"introduction\",\n    level: 2,\n    title: \"Introduction\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"21-la-rochelle-et-le-commerce-triangulaire\",\n    level: 2,\n    title: \"2.1. La Rochelle et le commerce triangulaire\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"22-le-commerce-de-leau-de-vie\",\n    level: 2,\n    title: \"2.2. le commerce de l’eau-de-vie\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"23-marennes-et-le-commerce-du-sel\",\n    level: 2,\n    title: \"2.3. Marennes et le commerce du sel\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 2 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"7 min read\",\"minutes\":6.325,\"time\":379500,\"words\":1265}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport Caller from '../../components/Caller'\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1 {...{\n      \"id\": \"partie-3-la-rochelle-port-dominant-mais-pas-structurant\"\n    }}>{`Partie 3. La Rochelle, port dominant mais pas structurant`}</h1>\n    <Caller id=\"viz-principale-partie-3\" step={1} mdxType=\"Caller\" />\n    <p>{`Jusqu’à la perte des colonies nord-américaines, le port de La Rochelle a cultivé une certaine spécificité géographique. Quoiqu’il pratiquait, comme la presque totalité des ports atlantiques, le commerce antillais et négrier, une part importante et qui a progressivement augmenté jusqu’à représenter plus de la moitié de ses armements pour les colonies dans les années 1750 était constitué par le commerce nord-américain - Canada, Louisiane et pêcheries de Terre-Neuve. Cette spécificité géographique a également influé sur sa spécialisation par produits. Le commerce des fourrures est ainsi une spécialité rochelaise jusqu’au début des années 1760. Les fourrures étaient importées non seulement du Canada, mais aussi de la Louisiane, porte de sortie des peaux de l’Ohio. Ces fourrures étaient pour partie ré-exportées en France et en Europe (principalement vers l’espace allemand et en Suisse). Une part importante, les peaux de castors en particulier, n’étaient pas ré-exportées, mais alimentaient l’industrie de chamoiserie niortaise et d’autres localités françaises. En retour, les Rochelais approvisionnaient les Canadiens et la Louisiane en vivres, matières premières et en produits manufacturés. L’Amérique du Nord était donc un débouché important et facile pour les céréales de la région, les étoffes locales de basse qualité et, dans une moindre mesure, le sel nécessaire aux pêcheries de Terre-Neuve. Ainsi, ce commerce quoique modeste avant les années 1740 fournissait des volumes importants d’emploi dans ces trois secteurs de l’économie régionale. `}</p>\n    <Caller id=\"viz-principale-partie-3\" step={2} mdxType=\"Caller\" />\n    <p>{`Avant 1748, le commerce des Antilles en droiture et la traite négrière continuaient néanmoins à dominer le commerce de la Direction de la Rochelle en valeur, étant donné le dynamisme limité de la demande émanant de l’Amérique du Nord. Mais, dès la fin de la guerre de Succession d’Autriche, s’ouvre une période de croissance exceptionnelle pour le commerce avec l’Amérique du Nord. Sur la période 1748–1758, La Rochelle reçoit annuellement plus de 1 million 300 mille livres de peaux d’Amérique du Nord, soit presque autant en valeur que de sucre des Antilles (1 million 450 mille livres). Le nombre d’armements à destination du Canada est multiplié par deux alors que celui pour la Louisiane augmente de moitié. Par rapport aux années précédant la guerre, le trafic lié au commerce triangulaire baisse en moyenne d’un quart pour les Antilles et de plus de moitié pour la traite, destinations pour lesquelles les envois rochelais sont directement en concurrence avec des ports comme Bordeaux, Nantes, Rouen et même Dunkerque et Marseille. A l’inverse, les rochelais ont un monopole de fait pour la Louisiane qui n’intéresse guère les ports plus importants et seul Bordeaux les concurrence pour l’approvisionnement du Canada. Par ailleurs, ces deux destinations offraient des possibilités complémentaires. D’un côté, le commerce à destination du Canada pouvait se transformer en commerce triangulaire inversé - La Rochelle-Canada-Antilles - lorsque les capitaines rochelais trouvaient au Canada de quoi ravitailler les îles à sucre en morue salée et, plus rarement, en céréales. La Louisiane permettait également de réaliser des opérations de contrebande avec les colons espagnols, offrant la possibilité de riches retours sous forme de piastres (Augeron : 2004; Mathieu : 1986).`}</p>\n    <Caller id=\"viz-principale-partie-3\" step={3} mdxType=\"Caller\" />\n    <p>{`Ce commerce de niche, limité en volume, mais créateur d’emplois locaux et, au milieu du siècle, facteur d’un dynamisme certain s’écroule avec la perte des colonies françaises nord-américaines à la fin de la Guerre de Sept ans. Cette perte déstructure durablement le commerce rochelais qui perd ses marchés privilégiés et sa position dominante au sein du réseau portuaire régional. En 1789, le commerce du port de la Rochelle est quasi-exclusivement colonial - près de 90% de ses exportations en valeur sont destinés à la traite africaine et aux Antilles.`}</p>\n    <p>{`Cette évolution est la conséquence de plusieurs contraintes qui se renforcent: la baisse de la capitalisation des négociants rochelais, conséquence directe de la vague de faillites qui secouent le milieu à la fin de la Guerre de Sept Ans; la fermeture des marchés nord-américains subventionnés qui auraient permis un rebond rapide; la forte concurrence des autres ports sur la destination antillaise. Il ne restait donc que la traite négrière. Pour l’animer, les négociants rochelais se procurent les marchandises nécessaires à ce commerce dans toute la France et l’Europe et ne se fournissent que très peu dans l’arrière-pays rochelais. Le port n’est donc plus réellement connecté à l’arrière-pays et ce, d’autant plus, que la faiblesse capitalistique de la place éloigne les maisons de commerce spécialisées dans le Cognac; ainsi Martell qui rapatrie leurs bureaux principaux à Tonnay-Charente ou à Paris. Ce déclin est visible sur le graphique suivant où l’infrastructure de la province de l’Aunis apparaît originale par le faible poid relatif de son port principal - La Rochelle - incapable de freiner le développement des ports qu’il maintenait dans sa dépendance avant 1763: Tonnay-Charente, Marennes, Rochefort et Ars-en-Ré. Dans la période pré-révolutionnaire (1787–1789), les flux de navires comme de marchandises témoignent de la recomposition de l’économie de la façade maritime. Désormais, la valeur des flux de marchandises au départ de Tonnay-Charente et à l’arrivée de Rochefort, qui entretient directement les productions locales, se rapprochent de ceux de La Rochelle.`}</p>\n    <p>{`Les graphiques que nous proposons illustrent fidèlement ces remarques. En 1787, le port de la Rochelle ne domine que faiblement les autres ports de la région en ce qui concerne le nombre et le tonnage des navires au départ. On constate que navires des ports locaux exportateurs de sels sont en moyenne plus importants que ceux de la Rochelle. De manière plus surprenante, la quantité de navires qui sortent des ports secondaires - Aligre, Charente, Marennes, Saint-Martin de Ré, voire même Rochefort - témoigne d’un dynamisme qui échappe largement au port dominant, La Rochelle. `}</p>\n    <p>{`La deuxième visualisation permet d’approfondir ce premier constat en montrant que La Rochelle n’occupe pas une place centrale dans le réseau des ports de la région. Les indices de centralité comparées avec d’autres régions dominées par un port central (Sud-ouest Atlantique, Normandie, Loire-Atlantique) confirment la relative faiblesse de La Rochelle et son incapacité à structurer les trafics maritimes locaux.`}</p>\n    <p>{`Il y a aussi l’autorisation accordée en 1775 à Rochefort de faire le commerce colonial, qui signale la perte de pouvoir de La Rochelle.`}</p>\n    <p>{`Argument du paragraphe final: `}</p>\n    <p>{`Spécialisations des ports, mais sans complémentarité: Marennes (Sel), La Rochelle (colonial), Rochefort (commerce d’importation), Tonnay-Charente (eau de vie dont eau de vie double) et ports de l’Ile de Ré (sel + eau-de-vie).`}</p>\n    <p>{`Tonnage au départ des ports des différentes provinces en 1787, agrégé suivant que la destination est au sein de la même province (local à droite) ou en dehors (externe à gauche)`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle à destination des colonies:`}</p>\n    <p>{`1 865 652 livres tournois`}</p>\n    <p>{`Valeur des exports du bureau de La Rochelle à destination du reste du monde (y compris local): 240 500`}</p>\n    <p>{`Les exportations du bureau de La Rochelle pour les colonies et les traite représente 88,58% du total des exportations`}</p>\n    <p>{`Pour montrer que La Rochelle ne structure pas région, faire voir faible impact sur région:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`ce qui rentre des colonies en ressort (visu reexport/pas reexport)`}</li>\n      <li parentName=\"ul\">{`étudier et visualiser origines des produits exportés pour traite et commerce colonial`}</li>\n    </ul>\n    <p>{`Guillaume D.: Remarque : J’ai fait pour 1789. Plus calmement :`}</p>\n    <p>{`!`}{`[`}{`]`}{`(cid:`}<a parentName=\"p\" {...{\n        \"href\": \"mailto:4B3595B0-62E8-43D9-A20A-482ECAB697D4@mac.com\"\n      }}>{`4B3595B0–62E8–43D9-A20A-482ECAB697D4@mac.com`}</a>{` \"PastedImage.png\")`}</p>\n    <p>{`« Monde » c’est hors colonies (probablement les réexports coloniales)`}</p>\n    <p>{`Donc hors ré-exports, je pense que les chiffres de Loïc sont bons.`}</p>\n    <p>{`use \"/Users/guillaumedaudin/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions`}{`_`}{`Commerce`}{`_`}{`France/Données Stata/bdd courante.dta\", clear`}</p>\n    <p>{`keep if year==1789`}</p>\n    <p>{`keep if customs`}{`_`}{`office==\"La Rochelle\"`}</p>\n    <p>{`tab partner`}{`_`}{`simplification if partner`}{`_`}{`grouping==\"Monde »`}</p>\n    <p>{`collapse (sum) value, by (partner`}{`_`}{`grouping)`}</p>\n    <p>{`egen total = total(value)`}</p>\n    <p>{`gen pcrt = value/total`}</p>\n    <p>{`br`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.015,\"time\":900,\"words\":3}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Part 3 TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.02,\"time\":1200,\"words\":4}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`À propos - TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`About TODO`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.01,\"time\":600,\"words\":2}\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`some tests`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  \n]\n\nexport const frontMatter = {}\n\n","\n\nfunction SvgComponent ({path}) {\n    return <img alt={path} src={`${process.env.PUBLIC_URL}${path}`} />\n} \n\nexport default SvgComponent;","import SvgComponent from './SvgComponent';\n\nexport default SvgComponent;","import VegaComponent from './VegaComponent';\n\nexport default VegaComponent;","import React, {useState, useEffect} from 'react';\nimport {VegaLite} from 'react-vega';\nimport {csvParse} from 'd3-dsv';\nimport get from 'axios';\n\nconst VegaComponent = ({\n  data: filename,\n  spec\n}) => {\n    // useState renvoie un state et un seter qui permet de le modifier\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const URL = `${process.env.PUBLIC_URL}/data/${filename}`;\n\n  useEffect(() => {\n    // aller chercher les données (get : lancement de la promesse se lance de suite : synchrone, then et catch plus tard)\n    get(URL)\n    .then(({data: csvString}) => {\n      // les convertir en js (avec d3-dsv)\n      const newData = csvParse(csvString);\n      // vega prend qqch comme ça : [{prop1: 'val', pro2: 'val2'}]\n      setData(newData);\n      setLoading(false);\n    })\n    .catch((err) => {\n      setLoading(false);\n    })\n  }, [URL])\n  \n  if (!spec) {\n    return <div>Vous devez spécifier une spec pour le composant vega.</div>\n  }\n\n  if (loading) {\n    return (\n      <div>Chargement des données ({URL}) ...</div>\n    )\n  } else if (!data) {\n    return (\n    <div>Erreur ...</div>\n    )\n  }\n  return (\n      <div>\n        <VegaLite\n          spec={{\n            ...spec,\n            \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.json\",\n            \"data\": {\n              \"values\": data\n            }\n          }}\n        />\n      </div>\n  )\n}\n\nexport default VegaComponent;\n","import GeoComponent from './GeoComponent';\n\nexport default GeoComponent;","import TriangleComponent from './TriangleComponent';\n\nexport default TriangleComponent;","import BezierComponent from './BezierComponent';\n\nexport default BezierComponent;","import React, { useState, useEffect } from 'react';\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\n\nconst BezierComponent = ({\n    dataFilename,\n    totalWidth = 1200,\n    rowHeight = 200,\n}) => {\n\n    // raw marker data\n    const [data, setData] = useState(null);\n\n    const [loadingData, setLoadingData] = useState(true);\n\n\n\n    /**\n     * Marker data loading\n     */\n    useEffect(() => {\n        if (dataFilename) {\n            const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n            get(dataURL)\n                .then(({ data: csvString }) => {\n                    const newData = csvParse(csvString);\n\n                    setData(newData);\n                    setLoadingData(false);\n                })\n                .catch((err) => {\n                    setLoadingData(false);\n                })\n        }\n\n    }, [dataFilename])\n\n    if (loadingData) {\n        return (\n            <div>Chargement des données ...</div>\n        )\n    } else if (!data) {\n        return (\n            <div>Erreur ...</div>\n        )\n    }\n    // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n    // ${70} ${140}, ${110} ${140}, ${110} ${110} \n    // a ${R} : aire selon x de l'ellipse, ${R} : aire selon y de l'elipse, 0 : rotation de l'ellipse selon x, 1, 0 : sweep-flag (détermine si l’arc doit commencer son mouvement à un angle négatif ou positif), -(${R} * 2) 0 : coords de l'arrivée\n\n    const R = totalWidth/10\n\n    return (\n        <div className=\"BezierComponent\">\n            \n            <svg width={1200} height={1500} style={{ border: '1px solid lightgrey' }}>\n                <path\n                    d={`M ${totalWidth/2} ${rowHeight/2} \n                        C ${totalWidth/2} ${rowHeight/2-90}, ${rowHeight/2} ${rowHeight/2+30}, ${rowHeight/2} ${rowHeight/2-90} \n                `       }\n                    stroke=\"black\" fill=\"transparent\" />\n\n                <path\n                    d={`M ${totalWidth/2} ${rowHeight/2}\n                        C ${120} ${80}, ${180} ${80}, ${170} ${60}\n                        `}\n                    stroke=\"red\" fill=\"transparent\" />\n                \n                <path\n                    d={`M ${totalWidth/2} ${rowHeight/1.5}\n                        a ${R} ${R} 0 1 0 ${R*2} 0\n                    `}\n                    stroke=\"pink\" \n                    fill=\"transparent\"\n                />\n                <path\n                    d={`M ${totalWidth/2} ${rowHeight/1.5}\n                        a ${R} ${R} -90 1 0 ${R*2} 0\n                    `}\n                    stroke=\"green\" \n                    fill=\"transparent\"\n                />\n            </svg>\n        </div>\n    );\n\n}\n\nexport default BezierComponent;\n","import DataProvider from './DataProvider';\n\nexport default DataProvider;","import { useEffect, useState } from \"react\";\nimport { csvParse } from 'd3-dsv';\nimport get from 'axios';\n\nconst DataProvider = ({\n  data: dataFilename,\n  children\n}) => {\n  // raw marker data\n  const [data, setData] = useState(null);\n  const [loadingData, setLoadingData] = useState(true);\n  /**\n   * Marker data loading\n   */\n  useEffect(() => {\n    if (dataFilename) {\n      const dataURL = `${process.env.PUBLIC_URL}/data/${dataFilename}`;\n      get(dataURL)\n        .then(({ data: csvString }) => {\n          const newData = csvParse(csvString);\n\n          setData(newData);\n          setLoadingData(false);\n        })\n        .catch((err) => {\n          setLoadingData(false);\n        })\n    }\n\n  }, [dataFilename])\n  return loadingData ? <div>Loading</div> : children(data)\n}\n\nexport default DataProvider;","\nimport { scaleLinear } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n/**\n * LineChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {array} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst LineChart = ({\n  data,\n  title,\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    fillGaps\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n  } = x;\n  let colorPalette;\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorModalities = uniq(data.map(d => d[color.field]));\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  const xDomain = initialXDomain || extent(data.filter(d => +d[y.field]).map(d => +d[x.field]));\n  const yDomain = initialYDomain || [0, max(data.map(d => +d[y.field]))];\n\n  const xScale = scaleLinear().domain(xDomain).range([margins.left, width - margins.right]).nice();\n  const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n  const groups = color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"LineChart GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"lines-container\">\n              {\n                groups.map(([groupName, items], groupIndex) => {\n                  const color = colorPalette && groupName ? colorPalette[groupName] : generic.dark;\n                  return (\n                    <g key={groupIndex}>\n                      {\n                        items.map((item, itemIndex) => {\n                          let next;\n                          let consecutive;\n                          const hasNext = itemIndex < items.length - 1;\n                          if (hasNext) {\n                            next = items[itemIndex + 1];\n                            consecutive = +item[x.field] + 1 === +next[x.field];\n                          }\n                          return (\n                            <>\n                              {\n                                (hasNext && fillGaps)\n                                  || (hasNext && consecutive && +item[y.field] && +next[y.field])\n                                  ?\n                                  <line\n                                    className=\"chart-line\"\n                                    x1={xScale(+item[x.field])}\n                                    x2={xScale(+next[x.field])}\n                                    y1={yScale(+item[y.field])}\n                                    y2={yScale(+next[y.field])}\n                                    style={{ stroke: color }}\n                                  />\n                                  : null\n                              }\n                              {\n                                +item[y.field] > 0 ?\n                                  <g key={itemIndex} className=\"data-dot-container\">\n                                    <circle\n                                      className=\"data-dot\"\n                                      fill={color}\n                                      r={height / 200}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      className=\"data-dot-big\"\n                                      fill={color}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                    />\n                                    <circle\n                                      fill={'transparent'}\n                                      r={5}\n                                      cx={xScale(item[x.field]) || 0}\n                                      cy={yScale(item[y.field]) || 0}\n                                      data-tip={tooltip ? tooltip(item) : undefined}\n                                      data-for=\"line-tooltip\"\n                                    />\n                                  </g>\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Légende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([genre, color], genreIndex) => (\n                        <li\n                          key={genre}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {genre}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"line-tooltip\" />\n    </>\n  )\n}\nexport default LineChart;","import LineChart from './LineChart';\n\nexport default LineChart;","\nimport { scaleLinear, scaleBand } from 'd3-scale';\nimport { extent, range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * @param {number} annotations\n * @params {string} annotations[n].type ['span]\n * @params {number} annotations[n].start\n * @params {number} annotations[n].end\n * @params {string} annotations[n].axis ['x', 'y']\n * @params {string} annotations[n].label\n * @param {function} tooltip\n * @returns {react}\n */\nconst HorizontalBarChart = ({\n  data,\n  title,\n  orientation = 'horizontal',\n  layout = 'stack',\n  width : initialWidth = 1000,\n  height: initialHeight = 400,\n  color,\n  x,\n  y,\n  tooltip,\n  margins: inputMargins = {},\n  annotations = []\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 20,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: yTickFormat,\n    tickSpan: yTickSpan,\n    domain: initialYDomain,\n    field: yField,\n    sort: sortY = {}\n  } = y;\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    fillGaps: fillXGaps,\n    field: xField,\n    sort : sortX = {},\n  } = x;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType = 'number'\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let xValues = uniq(data.filter(d => +d[y.field]).map(d => d[x.field]));\n  let vizWidth = width - margins.left - margins.right;\n\n  let xDomain = xValues;\n  let bandsNb = xValues.length;\n  let columnWidth = vizWidth / bandsNb;\n  let xScale = scaleBand().domain(xDomain).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]);\n\n  if (initialXDomain) {\n    xDomain = range(initialXDomain);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  } else if (fillXGaps) {\n    const xExtent = extent(xValues.filter(v => +v).map(v => +v));\n    if (xTickSpan) {\n      xExtent[0] = xExtent[0] - xExtent[0] % xTickSpan;\n      xExtent[1] = xExtent[1] + (xTickSpan - xExtent[0] % xTickSpan);\n    }\n    xDomain = range(xExtent[0], xExtent[1]);\n    xValues = xDomain;\n    bandsNb = xValues.length;\n    columnWidth = vizWidth / bandsNb;\n    xScale = scaleLinear().domain(extent(xDomain)).range([margins.left + columnWidth / 2, width - margins.right - columnWidth / 2]).nice();\n  }  \n\n  const groups = Object.entries(groupBy(data, d => d[x.field])) // color ? Object.entries(groupBy(data, d => d[color.field])) : [[undefined, data]];\n\n  const yDomain = initialYDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[y.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[y.field]))];\n\n    let bandWidth = layout === 'stack' ? columnWidth / 2 : (columnWidth / colorModalities.length) * .5;\n    const yScale = scaleLinear().domain(yDomain).range([height - margins.bottom, margins.top]).nice();\n    const yStackScale = yScale.copy().range([0, height - margins.bottom - margins.top]);\n\n  \n\n  // let { values: xAxisValues } = axisPropsFromTickScale(xScale);\n  const xAxisValues = xValues;\n  let { values: yAxisValues } = axisPropsFromTickScale(yScale, 10);\n\n  if (yTickSpan) {\n    yDomain[0] = yDomain[0] - yDomain[0] % yTickSpan;\n    yDomain[1] = yDomain[1] + (yTickSpan - yDomain[0] % yTickSpan);\n    yAxisValues = range(yDomain[0], yDomain[1], yTickSpan);\n    yScale.domain(yDomain)\n  }\n  return (\n    <>\n      <figure style={{width: initialWidth, height: initialHeight}} className=\"BarChart is-horizontal GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={height}>\n            <g className=\"axis left-axis ticks\">\n              <text x={margins.left - 10} y={margins.top - 10} className=\"axis-title\">\n                {y.title || y.field}\n              </text>\n              {\n                yAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(0, ${yScale(value)})`}\n                  >\n                    <text x={margins.left - 10} y={3}>\n                      {typeof yTickFormat === 'function' ? yTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"tick-mark\"\n                      x1={margins.left - 5}\n                      x2={margins.left}\n                      y1={0}\n                      y2={0}\n                    />\n                    <line\n                      className=\"background-line\"\n                      x1={margins.left}\n                      x2={xScale(xAxisValues[xAxisValues.length - 1])}\n                      y1={0}\n                      y2={0}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"axis bottom-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={height - margins.bottom + 20}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={yScale(yAxisValues[yAxisValues.length - 1])}\n                      y2={height - margins.bottom}\n                    />\n                    <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    />\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"annotations-container\">\n              {\n                annotations\n                .filter(a => a.axis === 'x')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatHeight = height - yScale(yAxisValues[yAxisValues.length - 1]) - margins.bottom;\n                  const thatY1 = height - margins.bottom;\n                  const thatY2 = yScale(yAxisValues[yAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation x-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={xScale(start)}\n                        width={xScale(end) - xScale(start)}\n                        height={thatHeight}\n                        y={thatY2}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                      <line\n                        x1={xScale(start)}\n                        x2={xScale(start)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={xScale(end)}\n                        x2={xScale(end)}\n                        y1={thatY1}\n                        y2={thatY2}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={xScale(end) + 20} \n                        x2={xScale(end) + 10} \n                        y1={thatY2 + labelPosition - 5}\n                        y2={thatY2 + labelPosition - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                      <text\n                        x={xScale(end) + 22}\n                        y={thatY2 + labelPosition}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n              {\n                annotations\n                .filter(a => a.axis === 'y')\n                .map((annotation, annotationIndex) => {\n                  const {start, end, label, labelPosition = 20} = annotation;\n                  const thatX1 = margins.left;\n                  const thatX2 = xScale(xAxisValues[xAxisValues.length - 1]);\n                  return (\n                    <g className=\"annotation y-axis-annotation\" key={annotationIndex}>\n                      <rect\n                        x={thatX1}\n                        width={thatX2 - thatX1}\n                        y={yScale(start)}\n                        height={Math.abs(yScale(end) - yScale(start))}\n                        fill=\"url(#diagonalHatch)\"\n                        opacity={.4}\n                      />\n                       <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(start)}\n                        y2={yScale(start)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line\n                        x1={thatX1}\n                        x2={thatX2}\n                        y1={yScale(end)}\n                        y2={yScale(end)}\n                        stroke=\"grey\"\n                        opacity={.4}\n                        strokeDasharray={'4,2'}\n                      />\n                      <line \n                        x1={thatX1 + labelPosition - 5} \n                        x2={thatX1 + labelPosition - 5} \n                        y1={yScale(start) - 15}\n                        y2={yScale(start) - 5}\n                        stroke=\"grey\" \n                        marker-end=\"url(#arrowhead)\" \n                      />\n                     <text\n                        x={thatX1 + labelPosition}\n                        y={yScale(start) - 10}\n                        fontSize={'.5rem'}\n                        fill=\"grey\"\n                      >\n                        {label}\n                      </text>\n                      <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                        refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                          <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                        </marker>\n                      </defs>\n                      <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                      <path d=\"M-1,1 l2,-2\n                              M0,4 l4,-4\n                              M3,5 l2,-2\" \n                            style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                    </pattern>\n\n                    </g>\n                  )\n                })\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortXAscending ? 1 : -1;\n                  if (sortXField === x.field) {\n                    const aVal = sortXType === 'number' ? +a[0] : a[0];\n                    const bVal = sortXType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortXType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : a[1][sortXField];\n                  const bVal = sortXType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortXField], 0) \n                    : b[1][sortXField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([xModality, items], groupIndex) => {\n                  let stackDisplaceY = height - margins.bottom;\n                  return (\n                    <g key={groupIndex} transform={`translate(${xScale(items[0][x.field])}, 0)`}>\n                      {\n                        items\n                        .sort((a, b) => {\n                          const multiplier = sortYAscending ? 1 : -1;\n                          const aVal = sortYType === 'number' ? +a[sortYField] : a[sortYField];\n                          const bVal = sortYType === 'number' ? +b[sortYField] : b[sortYField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          const thatX = layout === 'stack' ? -bandWidth / 2 : itemIndex * ((columnWidth * .5) / items.length) - columnWidth / 4;\n                          const thatHeight = layout === 'stack' ? yStackScale(item[y.field]) : height - margins.bottom - yScale(item[y.field]) || 0;\n                          \n                          const thatY = layout === 'stack' ? stackDisplaceY - thatHeight : yScale(item[y.field]);\n                          if (layout === 'stack') {\n                            stackDisplaceY -= thatHeight;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={bandWidth}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={thatHeight}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Légende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default HorizontalBarChart;","\nimport { scaleLinear } from 'd3-scale';\nimport { range, max } from 'd3-array';\nimport { useRef, useState, useEffect } from 'react';\nimport { groupBy } from 'lodash';\nimport { axisPropsFromTickScale } from 'react-d3-axis';\nimport Tooltip from 'react-tooltip';\nimport { uniq } from 'lodash';\n\nimport colorsPalettes from '../../colorPalettes';\nimport { generatePalette } from '../../helpers/misc';\n\nconst { generic } = colorsPalettes;\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * @param {object} x.sort\n * @param {string} x.sort.field\n * @param {boolean} x.sort.ascending\n * @param {string} x.sort.type ['number', 'string']\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * @param {boolean} y.formatLabel\n * @param {object} y.sort\n * @param {string} y.sort.field\n * @param {boolean} y.sort.ascending\n * @param {string} y.sort.type\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst VerticalBarChart = ({\n  data,\n  title,\n  layout = 'stack',\n  width : initialWidth = 1200,\n  height: initialHeight = 1200,\n  color,\n  y,\n  x,\n  tooltip,\n  margins: inputMargins = {},\n}) => {\n  const [headersHeight, setHeadersHeight] = useState(0);\n  const [legendWidth, setLegendWidth] = useState(0);\n\n  const legendRef = useRef(null);\n  const headerRef = useRef(null);\n  \n  const width = initialWidth - legendWidth;\n  const height = initialHeight - headersHeight;\n\n  useEffect(() => {\n    setTimeout(() => {\n      const newHeadersHeight = headerRef.current ?  headerRef.current.getBoundingClientRect().height : 0;\n      const newLegendWidth = legendRef.current ?  legendRef.current.getBoundingClientRect().width : 0;\n      setHeadersHeight(newHeadersHeight);\n      setLegendWidth(newLegendWidth);\n    })\n  }, [width, height, color, data])\n  const margins = {\n    left: 100,\n    top: 30,\n    bottom: 20,\n    right: 30,\n    ...inputMargins\n  };\n\n  const {\n    tickFormat: xTickFormat,\n    tickSpan: xTickSpan,\n    domain: initialXDomain,\n    field: xField,\n    sort : sortX = {}\n  } = x;\n  const {\n    rowHeight: fixedRowHeight,\n    formatLabel,\n    field: yField,\n    sort : sortY = {}\n  } = y;\n  const {\n    field: sortYField = yField,\n    ascending: sortYAscending = true,\n    type: sortYType\n  } = sortY;\n  const {\n    field: sortXField = xField,\n    ascending: sortXAscending = true,\n    type: sortXType = 'number'\n  } = sortX;\n  let colorPalette;\n  let colorModalities;\n  if (color) {\n    colorModalities = uniq(data.map(d => d[color.field]));\n  }\n  if (color && color.palette) {\n    colorPalette = color.palette;\n  } else if (color) {\n    const colorValues = generatePalette(color.field, colorModalities.length);\n    colorPalette = colorModalities.reduce((res, modality, index) => ({\n      ...res,\n      [modality]: colorValues[index]\n    }), {})\n  }\n  let yValues = uniq(data.map(d => d[y.field]));\n  let bandsNb = yValues.length;\n  let vizHeight = (fixedRowHeight ? fixedRowHeight * (bandsNb) : height - headersHeight);\n\n  let rowHeight = fixedRowHeight || vizHeight / bandsNb;\n\n  const groups = Object.entries(groupBy(data, d => d[y.field])) ;\n\n  const xDomain = initialXDomain || layout === 'stack' ? \n    // stack -> max = max sum for a given x modality\n    [0, max(\n      groups.map(\n        ([_groupName, values]) => \n          values.reduce((sum, datum) => sum + +(datum[x.field]), 0)\n      )\n      )\n    ]\n    :\n    // group -> max = abs max\n    [0, max(data.map(d => +d[x.field]))];\n\n    let bandHeight = layout === 'stack' ? rowHeight / 2 : (rowHeight / colorModalities.length) * .5;\n    const xScale = scaleLinear().domain(xDomain).range([ margins.left, width - margins.left - margins.right]).nice();\n    const xStackScale = xScale.copy().range([0, width - margins.left - margins.right]);\n\n  let { values: xAxisValues } = axisPropsFromTickScale(xScale, 10);\n\n  if (xTickSpan) {\n    xDomain[0] = xDomain[0] - xDomain[0] % xTickSpan;\n    xDomain[1] = xDomain[1] + (xTickSpan - xDomain[0] % xTickSpan);\n    xAxisValues = range(xDomain[0], xDomain[1], xTickSpan);\n    xScale.domain(xDomain);\n  }\n  const svgHeight = vizHeight + margins.top + margins.bottom;\n  const finalHeight = initialHeight > (svgHeight + headersHeight) ? initialHeight : svgHeight + headersHeight;\n  return (\n    <>\n      <figure style={{width: initialWidth, height: finalHeight}} className=\"BarChart is-vertical GenericVisualization\">\n        <div ref={headerRef} className=\"row\">\n          {title ? <h5 className=\"visualization-title\" style={{ marginLeft: margins.left }}>{title}</h5> : null}\n        </div>\n        <div className=\"row vis-row\">\n          <svg className=\"chart\" width={width} height={svgHeight}>\n            <g className=\"axis top-axis ticks\">\n              {\n                xAxisValues.map((value, valueIndex) => (\n                  <g\n                    key={value}\n                    transform={`translate(${xScale(value)}, 0)`}\n                  >\n                    <text x={0} y={margins.top - 5}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    <line\n                      className=\"background-line\"\n                      x1={0}\n                      x2={0}\n                      y1={margins.top}\n                      y2={vizHeight + margins.top}\n                    />\n                    <text x={0} y={svgHeight - margins.bottom + 10}>\n                      {typeof xTickFormat === 'function' ? xTickFormat(value, valueIndex) : value}\n                    </text>\n                    {/* <line\n                      className=\"tick-mark\"\n                      x1={0}\n                      x2={0}\n                      y1={height - margins.bottom}\n                      y2={height - margins.bottom + 5}\n                    /> */}\n                  </g>\n                ))\n              }\n            </g>\n            <g className=\"bars-container\">\n              {\n                groups\n                .sort((a, b) => {\n                  const multiplier = sortYAscending ? 1 : -1;\n                  if (sortYField === y.field) {\n                    const aVal = sortYType === 'number' ? +a[0] : a[0];\n                    const bVal = sortYType === 'number' ? +b[0] : b[0];\n                    if (aVal < bVal) {\n                      return -1 * multiplier;\n                    }\n                    return 1 * multiplier;\n                  }\n                  const aVal = sortYType === 'number' ? \n                    +a[1].reduce((sum, datum) => sum + +datum[sortYField], 0) \n                    : a[1][sortYField];\n                  const bVal = sortYType === 'number' ? \n                    +b[1].reduce((sum, datum) => sum + +datum[sortYField], 0) \n                    : b[1][sortYField];\n                  if (aVal < bVal) {\n                    return -1 * multiplier;\n                  }\n                  return 1 * multiplier;\n                  \n                })\n                .map(([yModality, items], groupIndex) => {\n                  let stackDisplaceX = margins.left;\n                  \n                  return (\n                    <g key={groupIndex} transform={`translate(0, ${margins.top + rowHeight * groupIndex})`}>\n                      <text y={rowHeight / 2 + 5} className=\"vertical-bar-label\" x={margins.left - 5}>\n                        {typeof formatLabel === 'function' ? formatLabel(yModality, groupIndex) : yModality}\n                      </text>\n                      {\n                        items\n                        .sort((a, b) => {\n                          const multiplier = sortXAscending ? 1 : -1;\n                          const aVal = sortXType === 'number' ? +a[sortXField] : a[sortXField];\n                          const bVal = sortXType === 'number' ? +b[sortXField] : b[sortXField];\n                          if (aVal > +bVal) {\n                            return -1 * multiplier;\n                          }\n                          return 1 * multiplier;\n                        })\n                        .map((item, itemIndex) => {\n                          \n                          const thatY = layout === 'stack' ? bandHeight / 2 : itemIndex * ((rowHeight * .5) / items.length) + rowHeight / 4;\n                          const thatWidth = layout === 'stack' ? xStackScale(+item[x.field]) :  xScale(item[x.field]);\n                          const thatX = layout === 'stack' ? stackDisplaceX : margins.left;\n                          if (layout === 'stack') {\n                            stackDisplaceX += thatWidth;\n                          }\n                          const thatColor = colorPalette ? colorPalette[item[color.field]] : generic.dark;\n                          return (\n                            <>\n                              {\n                                +item[y.field] > 0 ?\n                                  <rect key={itemIndex}\n                                    fill={thatColor}\n                                    width={thatWidth}\n                                    x={thatX}\n                                    y={thatY}\n                                    height={bandHeight}\n                                    data-for=\"bar-tooltip\"\n                                    data-tip={typeof tooltip === 'function' ? tooltip(item, itemIndex, groupIndex) : undefined}\n                                  />\n                                  : null\n                              }\n                            </>\n                          )\n                        })\n                      }\n                    </g>\n                  );\n                })\n              }\n            </g>\n          </svg>\n          {\n            color ?\n              <div\n                className=\"ColorLegend\"\n                ref={legendRef}\n                style={{\n                  top: headersHeight + margins.top\n                }}\n              >\n                <h5>{color.title || 'Légende'}</h5>\n                <ul className=\"color-legend\">\n                  {\n                    Object.entries(colorPalette)\n                      .map(([modality, color]) => (\n                        <li\n                          key={modality}\n                        >\n                          <span className=\"color-box\"\n                            style={{ background: color }}\n                          />\n                          <span className=\"color-label\">\n                            {modality}\n                          </span>\n                        </li>\n                      ))\n                  }\n                </ul>\n              </div>\n              : null\n          }\n        </div>\n      </figure>\n      <Tooltip id=\"bar-tooltip\" />\n    </>\n  )\n}\n\nexport default VerticalBarChart;","import BarChart from './BarChart';\n\nexport default BarChart;","import HorizontalBarChart from './HorizontalBarChart';\nimport VerticalBarChart from './VerticalBarChart';\n\n\n/**\n * BarChart component - returns a <figure> containing a svg linechart\n * \n * @param {array} data \n * @param {string} title \n * @param {string} orientation ['horizontal', 'vertical'] \n * @param {string} layout ['stack', 'groups'] \n * @param {width} number \n * @param {height} number \n * \n * @param {object} color\n * @param {string} color.field\n * @param {string} color.title\n * @param {object} color.palette\n * \n * @param {object} x\n * @param {string} x.field\n * @param {string} x.title\n * @param {number} x.tickSpan\n * @param {function} x.tickFormat\n * @param {array} x.domain\n * \n * @param {object} x\n * @param {string} y.field\n * @param {string} y.title\n * @param {number} y.tickSpan\n * @param {function} y.tickFormat\n * @param {array} y.domain\n * @param {boolean} y.fillGaps\n * \n * @param {object} margins\n * @param {number} margins.left\n * @param {number} margins.top\n * @param {number} margins.right\n * @param {number} margins.bottom\n * \n * @param {function} tooltip\n * \n * @returns {react}\n */\nconst BarChart = ({\n  orientation = 'horizontal',\n  ...props\n}) => {\n  if (orientation === 'horizontal') {\n    return <HorizontalBarChart {...props} />\n  }\n  return <VerticalBarChart {...props} />\n}\nexport default BarChart;","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"7 min read\",\"minutes\":6.625,\"time\":397500,\"words\":1325}\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport SvgComponent from '../../components/SvgComponent';\nimport VegaComponent from '../../components/VegaComponent';\nimport SigmaComponent from '../../components/SigmaComponent';\nimport GeoComponent from '../../components/GeoComponent';\nimport TriangleComponent from '../../components/TriangleComponent';\nimport BoatsIllustration from '../../components/BoatsIllustration';\nimport BezierComponent from '../../components/BezierComponent';\nimport DataProvider from '../../components/DataProvider';\nimport LineChart from '../../components/LineChart';\nimport BarChart from '../../components/BarChart';\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h2 {...{\n      \"id\": \"test-courbes-de-bézier\"\n    }}>{`Test courbes de bézier`}</h2>\n    <BezierComponent dataFilename=\"part_3_step3_viz_customs_offices_data.csv\" mdxType=\"BezierComponent\" />\n  \n    <h2 {...{\n      \"id\": \"test-triangle\"\n    }}>{`Test triangle`}</h2>\n    <TriangleComponent dataFilename=\"part_3_step1_viz_data.csv\" rowHeight={300} numberOfColumns={25} totalWidth={1600} mdxType=\"TriangleComponent\" />\n    <h2 {...{\n      \"id\": \"carto-en-reactd3svg\"\n    }}>{`Carto en react+d3+SVG`}</h2>\n    <p>{`Ci-dessous un proto/boilerplate pour rendre du svg + données avec la galaxie d3 + du rendu direct en SVG via react.`}</p>\n    <h1 {...{\n      \"id\": \"fond-de-carte-centré-sur-région-avec-1-pt-discret-par-port-tourné-à-90°-ou-270°\"\n    }}>{`Fond de carte centré sur région, avec 1 pt discret par port, tourné à 90° ou 270°`}</h1>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"null\" markerSize=\"null\" label=\"pointcall\" showLabels centerOnRegion // rotationDegree={58}\n    debug=\"true\" mdxType=\"GeoComponent\" />\n    <p>{`Cartographie des destination des bateaux aillant un port d’attache dans la région, par tonnage cumulé (couleur = amirauté) :`}</p>\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels centerOnRegion mdxType=\"GeoComponent\" />\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" mdxType=\"GeoComponent\" />\n    <GeoComponent backgroundFilename=\"cartoweb_france_1789_geojson.geojson\" dataFilename=\"navigo-out-of-ships-from-region.csv\" markerColor=\"pointcall_admiralty\" markerSize=\"tonnage\" label=\"pointcall\" showLabels mdxType=\"GeoComponent\" />\n    <h1 {...{\n      \"id\": \"test-bateaux\"\n    }}>{`Test bateaux`}</h1>\n    <BoatsIllustration mdxType=\"BoatsIllustration\" />\n    <h1 {...{\n      \"id\": \"commerce-multi-échelle-dans-la-région-de-la-rochelle\"\n    }}>{`Commerce multi-échelle dans la région de La Rochelle`}</h1>\n    <p>{`Voici un tour d’horizon des modules react préparés pour faciliter le développement :`}</p>\n    <h2 {...{\n      \"id\": \"image-svg-avec-webpack\"\n    }}>{`Image SVG (avec webpack)`}</h2>\n    <p>{`On intègre une image  SVG depuis le local (elle sera donc packée par webpack) :`}</p>\n    <h2 {...{\n      \"id\": \"image-svg-sans-webpack\"\n    }}>{`Image SVG (sans webpack)`}</h2>\n    <p>{`On intègre ici directement une image à partir de son URL en ligne (depuis le dossier `}<inlineCode parentName=\"p\">{`public`}</inlineCode>{`)`}</p>\n    <h5 {...{\n      \"id\": \"-cassé-pour-le-moment\"\n    }}>{`! cassé pour le moment`}</h5>\n    <p>{`// `}<SvgComponent path=\"/svg/ports-region-1789.svg\" mdxType=\"SvgComponent\" /></p>\n    <h2 {...{\n      \"id\": \"visualisation-vega\"\n    }}>{`Visualisation vega`}</h2>\n    <p>{`Les visualisations vega ont besoin d’un fichier csv stocké dans le dossier `}<inlineCode parentName=\"p\">{`public/data`}</inlineCode>{` et d’une spec vega.`}</p>\n    <VegaComponent data=\"sorties_navires_vers_colonies.csv\" spec={{\n      \"mark\": \"rect\",\n      \"encoding\": {\n        \"x\": {\n          \"field\": \"port_depart\",\n          \"type\": \"nominal\"\n        },\n        \"y\": {\n          \"field\": \"port_destination\",\n          \"type\": \"nominal\"\n        },\n        \"color\": {\n          \"type\": \"quantitative\",\n          \"field\": \"tonnage\",\n          \"aggregate\": \"sum\"\n        }\n      }\n    }} mdxType=\"VegaComponent\" />\n    <h2 {...{\n      \"id\": \"réseau-avec-sigma\"\n    }}>{`Réseau avec sigma`}</h2>\n    <p>{`Les visualisations sigma ont besoin d’un fichier gexf stocké dans le dossier `}<inlineCode parentName=\"p\">{`public/data`}</inlineCode>{`.`}</p>\n    <p>{`Paramètres :`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`nodeColor`}</inlineCode>{` : attribut pour couleur`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`nodeSize`}</inlineCode>{` : attribut pour taille`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`labelDensity`}</inlineCode>{` : densité des labels (float dans `}{`[0, 1]`}{`)`}</li>\n    </ul>\n    <SigmaComponent data=\"toflit_aggregate_1789_only_out.gexf\" nodeColor={`admiralty`} nodeSize={`inside_degree`} labelDensity={0.5} mdxType=\"SigmaComponent\" />\n    <h1 {...{\n      \"id\": \"tests-composant-linechart\"\n    }}>{`Tests composant LineChart`}</h1>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <LineChart data={data.filter(d => d.region === 'France')} width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 5\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} tooltip={d => `import de ${d.Imports} en ${d.year}`} annotations={[{\n        type: 'span',\n        start: 1756,\n        end: 1763,\n        axis: 'x',\n        label: 'guerre de sept ans'\n      }, {\n        type: 'span',\n        start: 400000000,\n        end: 500000000,\n        axis: 'y',\n        label: 'période de faste'\n      }]} mdxType=\"LineChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <LineChart data={data} title=\"test de titre\" width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'region',\n        title: 'Région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`} mdxType=\"LineChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <LineChart data={data} title=\"test de line chart (fill gaps)\" width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`,\n        fillGaps: true\n      }} color={{\n        field: 'region',\n        title: 'Région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`} mdxType=\"LineChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <LineChart data={data} title=\"test de linechart (minimum de props)\" // width={window.innerWidth - 20}\n      x={{\n        field: 'year' // title: 'année',\n\n      }} y={{\n        field: 'Imports' // title: 'imports',\n        // tickSpan: 100000000,\n        // tickFormat: v => `${v} lt.`\n\n      }} color={{\n        field: 'region' // title: 'Région'\n\n      }} // tooltip={d => `import de ${d.Imports} en ${d.year} pour ${d.region}`}\n      mdxType=\"LineChart\" />}\n    </DataProvider>\n    <h1 {...{\n      \"id\": \"tests-composant-barchart\"\n    }}>{`Tests composant BarChart`}</h1>\n    <h2 {...{\n      \"id\": \"horizontal-bar-chart\"\n    }}>{`Horizontal bar chart`}</h2>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => d.region === 'France')} title=\"Test de bar chart (sans fill gaps)\" width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickFormat: (d, i) => +d % 5 === 0 ? d : undefined\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} annotations={[{\n        type: 'span',\n        start: 1756,\n        end: 1763,\n        axis: 'x',\n        label: 'guerre de sept ans'\n      }, {\n        type: 'span',\n        start: 400000000,\n        end: 500000000,\n        axis: 'y',\n        label: 'période de faste'\n      }]} tooltip={d => `import de ${d.Imports} en ${d.year}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => d.region === 'France')} title=\"Test de bar chart (fill gaps)\" width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10,\n        tickFormat: (d, i) => +d % 10 === 0 ? d : undefined,\n        fillGaps: true\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} tooltip={d => `import de ${d.Imports} en ${d.year}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data} title=\"Test de bar chart (stacked, fill gaps)\" width={window.innerWidth - 20} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10,\n        tickFormat: (d, i) => +d % 10 === 0 ? d : undefined,\n        fillGaps: true\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'region',\n        title: 'région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data} title=\"Test de bar chart (grouped, fill gaps)\" width={window.innerWidth - 20} layout={'groups'} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10,\n        tickFormat: (d, i) => +d % 10 === 0 ? d : undefined,\n        fillGaps: true\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'region',\n        title: 'région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => +d.year < 1750)} title=\"Test de bar chart (grouped, no fill gaps)\" width={window.innerWidth - 20} layout={'groups'} x={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10 // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n\n      }} y={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 100000000,\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'region',\n        title: 'région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <h2 {...{\n      \"id\": \"vertical-bar-charts\"\n    }}>{`Vertical bar charts`}</h2>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => d.region === 'France')} title=\"Test de bar chart\" // width={window.innerWidth - 20}\n      orientation=\"vertical\" y={{\n        field: 'year',\n        title: 'année' // tickFormat: (d, i) => +d%5 === 0 ? d : undefined,\n\n      }} x={{\n        field: 'Imports',\n        title: 'imports' // tickSpan: 1000000,\n        //tickFormat: v => `${v} lt.`\n\n      }} tooltip={d => `import de ${d.Imports} en ${d.year}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_LR_partners.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data} title=\"Test de bar chart (stacked)\" // width={window.innerWidth - 20}\n      orientation=\"vertical\" height={200} y={{\n        field: 'year',\n        title: 'année'\n      }} x={{\n        field: 'Imports',\n        title: 'imports',\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'partner',\n        title: 'partenaire'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_LR_partners.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data} title=\"Test de bar chart (stacked, dimensionnement par la hauteur des lignes)\" // width={window.innerWidth - 20}\n      orientation=\"vertical\" y={{\n        field: 'year',\n        title: 'année',\n        rowHeight: 30\n      }} x={{\n        field: 'Imports',\n        title: 'imports',\n        tickFormat: v => `${v} lt.`\n      }} color={{\n        field: 'partner',\n        title: 'partenaire'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} depuis ${d.partner}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => +d.year < 1750)} title=\"Test de bar chart (grouped)\" width={window.innerWidth - 20} orientation={'vertical'} layout={'groups'} y={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10 // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n\n      }} x={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 50000000,\n        tickFormat: v => `${v / 1000}k lt.`\n      }} color={{\n        field: 'region',\n        title: 'région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    <DataProvider data={'decline_longitudinal_data.csv'} mdxType=\"DataProvider\">\n  {data => <BarChart data={data.filter(d => +d.year < 1750)} title=\"Test de bar chart (grouped - dimensionnement par hauteur des lignes)\" width={window.innerWidth - 20} orientation={'vertical'} layout={'groups'} y={{\n        field: 'year',\n        title: 'année',\n        tickSpan: 10,\n        rowHeight: 50 // tickFormat: (d, i) => +d%10 === 0 ? d : undefined,\n\n      }} x={{\n        field: 'Imports',\n        title: 'imports',\n        tickSpan: 50000000,\n        tickFormat: v => `${v / 1000}k lt.`\n      }} color={{\n        field: 'region',\n        title: 'région'\n      }} tooltip={d => `import de ${d.Imports} en ${d.year} par ${d.region}`} mdxType=\"BarChart\" />}\n    </DataProvider>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"test-courbes-de-bézier\",\n    level: 2,\n    title: \"Test courbes de bézier\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"test-triangle\",\n    level: 2,\n    title: \"Test triangle\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"carto-en-reactd3svg\",\n    level: 2,\n    title: \"Carto en react+d3+SVG\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"image-svg-avec-webpack\",\n    level: 2,\n    title: \"Image SVG (avec webpack)\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"image-svg-sans-webpack\",\n    level: 2,\n    title: \"Image SVG (sans webpack)\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"visualisation-vega\",\n    level: 2,\n    title: \"Visualisation vega\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"réseau-avec-sigma\",\n    level: 2,\n    title: \"Réseau avec sigma\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"horizontal-bar-chart\",\n    level: 2,\n    title: \"Horizontal bar chart\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"vertical-bar-charts\",\n    level: 2,\n    title: \"Vertical bar charts\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","\n\nconst colorsPalettes = {\n  'ui': {\n    'colorText': '#403d3d',\n    'colorAccent': '#34495e',\n    'colorAccentBackground': '#336d7c',\n    'colorBackgroundBlue': '#d3e5e5',\n    'colorBackground': '#ebebeb',\n  },\n  'generic':{\n    'dark': '#336D7C',// marine sombre\n    'light': '#E0E3E6',// gris clair\n    'accent1': '#00C4AF',// '#00FFC8',// vert d'eau\n    'accent2': '#FEA43B'// orange\n  },\n  'admiralties': {\n    'La Rochelle': '#41BEA3',\n    'Marennes': '#A7E6F9',\n    \"Sables d'Olonne\": '#668EDB'\n  },\n  'provinces':{\n    'Aunis': '#41BEA3',\n    'Saintonge': '#A7E6F9',\n    'Poitou': '#668EDB',\n    'Angoumois': '#514EEE'\n  },\n  'product': {\n    'sel': '#E0CB0E',\n    'eau-de-vie et vins divers': '#A07BEE',\n    'autres produits': '#72808D',\n    'produit colonial': '#FEA43B',\n      },\n  'partner': {\n    'Afrique': '#875E2E',\n    'Reste du monde (USA)': '#E0E3E6',\n    'Grande Bretagne': '#542AAD',\n    'Europe': '#A07BEE',\n    'Ports francs et petites îles': '#5439F9',\n    'Colonies': '#E5881A',\n    'Indéterminé supposé Europe': '#A07BEE'\n  },\n  'customs_office': {\n    'La Rochelle': '#41BEA3',\n    'Rochefort': '#349883',\n    'Saint-Martin-de-Ré': '#277262',\n    'Charente': '#5AD0F4',\n    'Aligre': '#67CBB6',\n    'Les Sables d\\'Olonne': '#668EDB',\n    'Marennes': '#A7E6F9',\n  }\n}\n\nexport default colorsPalettes;","import { csvParse } from 'd3-dsv';\nimport get from 'axios';\nimport iwanthue from 'iwanthue';\nimport {useRef, useEffect} from 'react';\nimport metadataFr from '../contents/fr/metadata'\nimport metadataEn from '../contents/en/metadata'\n// import Graph from 'graphology-types';\nimport palettes from '../colorPalettes';\n\nconst {generic} = palettes;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst DEFAULT_COLOR_SPACE = {\n  cmin: 25.59,\n  cmax: 55.59,\n  lmin: 60.94,\n  lmax: 90.94\n};\n\nconst SINGLE_COLOR_PALETTE = ['#999'];\n\nexport function buildPageTitle (title, lang = 'fr') {\n  return `${title} | ${metadata[lang].title} | PORTIC`;\n}\n\nexport function trimText(str, limit = 30) {\n  if (str.length > limit) {\n    const words = str.split(' ');\n    let output = [words[0]];\n    let i = 1;\n    while (output.join(' ') < limit - 3 && i < words.length) {\n      output.push(words[i]);\n      i++;\n    }\n    output = output.join(' ');\n    return [output, words.slice(i).join(' ')];\n  }\n  return [str, undefined];\n}\n\nexport function cartesian2Polar(x, y){\n  const distance = Math.sqrt(x*x + y*y)\n  const radians = Math.atan2(y,x) //This takes y first\n  return { distance:distance, radians:radians }\n}\n\n\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function generatePalette(name, count) {\n  if (count === 1 || !count) return SINGLE_COLOR_PALETTE;\n  else if (count === 2) {\n    return [generic.accent1, generic.accent2]\n  } else if (count === 3) {\n    return [generic.dark, generic.accent1, generic.accent2]\n  }\n\n  return iwanthue(count, {\n    colorSpace: DEFAULT_COLOR_SPACE,\n    seed: name,\n    clustering: 'force-vector'\n  });\n}\n\n\nconst _filterData = (data, { startYear, endYear, year, params, ...rest }) => {\n  console.group('filters');\n  console.time('filters time');\n  console.log('input', data);\n  /* dans data on a un dict de type : \n  [   {year: \"1789\", customs_region: \"La Rochelle\", partner_simplification: \"Iles\", export_import: ”Import\", product_revolutionempire: \"...\", ...},\n      {year: \"1782\", customs_region: \"Bordeaux\", ...},\n      {...},\n      columns: [\"year\", \"customs_region\", ...]\n\n  ]\n  */\n  let filteredData = data.filter(row => {\n    let rowYear = row.year ? +row.year.split(\".\")[0] : undefined;\n    if (startYear && endYear) {\n      return rowYear >= +startYear && rowYear <= +endYear;\n      // @todo : quand on aura rajouté startYear et endYear pour\n      // la récupération de portic il s'agira de déduire ce year des données\n    } else if (year && rowYear) {\n      return year === +rowYear;\n    } else return true;\n  })\n  // console.log('1', filteredData);\n\n  filteredData = filteredData.filter(row => {\n    // pour chaque filtre (sauf filtre timespan et filtrage des colomnes) :\n    let isValid = true;\n    // key --> 'year', filter_value --> 1789\n    // kwargs obtenu sous forme de dict : --> { year: 1789, customs_region: 'La Rochelle' }\n\n    // kwargs semble être indiçable mais pas sur qu'on doive pas le mettre dans un format spécial pas comme python\n    // sinon suggestion : function.apply(obj, [args])\n\n    // ligne originale : je ne sais pas pourquoi on ne veut prendre en compte les filtres que pour les colonnes qui ne sont pas à garder dans le résultats (colonne données dans l'argument 'params' sous forme de liste)\n    // for (let key,filter_value in [param for param in kwargs.items() if param[0] not in ['params']]): \n    // console.log('rest', rest);\n    Object.entries(rest)\n      .some(([key, inputFilterValue]) => {\n        const rowValue = row[key];\n        let filterValue = inputFilterValue;\n        // console.log('filter value 1', filterValue);\n        // si la valeur est une liste : on caste en string ses membres\n        if (Array.isArray(filterValue)) {\n          filterValue = filterValue.map(x => x + ''); // caster en string\n        }\n        // sinon c'est un tableau à une valeur qu'on caste en string\n        else {\n          filterValue = [filterValue + ''];\n        }\n        // console.log('filter value final', filterValue);\n        // à partir de là, filter_value est une liste de strings\n\n        // si la ligne a un attribut qui fait partie des valeurs acceptées par le filtre => on examine les autres filtres \n        if (filterValue.length > 0 && !(rowValue.includes(filterValue))) {\n          isValid = false;\n          return true;\n        }\n        return false;\n      })\n\n    return isValid;\n  })\n\n  // console.log('2', filteredData);\n\n\n  const transformedData = filteredData.map(row => {\n    let rowFormated = {};\n\n    // on ne garde que les colonnes qui nous intéressent dans le résultat => \n    // console.log(\"params : \", params);\n    // console.log(\"typeof(params) !== 'undefined' : \", (typeof params !== 'undefined'));\n    // console.log(\"row : \", row);\n    // on ne passe jamais ni dans le if ni dans le else, je ne sais pas pourquoi \n    // if (typeof params !== 'undefined') {\n\n    // if (params &&\n    // ci-dessous : tester si objet vide\n    if (!!params && Object.keys(params).length) {\n      // console.log(\"we are selecting only those columns : \", params);\n      for (let [column, value] of Object.entries(row)) {\n        if (params.includes(column)) {\n          rowFormated[column] = value;\n        }\n      }\n    }\n    // de base c'était else { ... } et on passait jamais dedans apparemment du coup là c'est bizarre\n    // else if (typeof params !== 'undefined') {\n    else {\n      // rowFormated = {...row}; // différencier rowFormated et row (nouvelle ref en unpackant et copiant key / params de row) => en JS differencier input d'output\n      // console.log(\"rowFormated = \", row);\n    }\n    // console.log(\"après le if / else\");\n    return rowFormated;\n  })\n  // console.log('3', transformedData);\n  console.timeEnd('filters time');\n  console.groupEnd('filters');\n  return transformedData;\n}\n\n\nexport const getToflitFlowsByCsv = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest // https://www.peterbe.com/plog/javascript-destructuring-like-python-kwargs-with-defaults ; \n  // \"standard\" JavaScript array : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters\n}) => {\n  // méthode de gestion avec callback\n  // let result;\n  // trucAsynchrone\n  // .then(data => {\n  //     callback(null, data);\n  // })\n  // .catch(error => {\n  //     callback(error);\n  // })\n\n  // méthode de gestion avec promesse\n  // return new Promise((resolve, reject) => {\n  //     trucAsynchrone\n  //     .then(data => {\n  //         // faire des trucs avec data\n  //         resolve(data);\n  //     })\n  //     .catch(error => {\n  //         // faire des choses avec l'erreur\n  //         reject(error);\n  //     })\n  // })\n\n  // méthode async/await\n  // const result = await trucAsynchrone();\n  // return result;\n\n  /*\n  Synopsis : récupère les flux toflit18\n  --- \n  Paramètres :\n  * startYear : <int> # année de début\n  * endYear : <int> # année de fin\n  * params : <arr> # propriétés à renvoyer\n  * [tous les noms de colonne des flux] : <arr/string> valeurs à filtrer dans les flux (peut être une ou plusieurs valeurs)\n  */\n\n  return new Promise((resolve, reject) => {\n\n    // let results = []; // ça sert à quelque chose ?? pour moi c'est pas utilisé, sinon je ne devrais pas avoir l'erreur \"t.map is not a function\" \n    // => voir https://www.pluralsight.com/guides/typeerror-handling-in-react.js-for-map-function\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n\n\n    // 1. Test de la validité des paramètres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    /* en l'état ça ne fonctionne pas */\n    const URL = `${process.env.PUBLIC_URL || 'localhost:3001'}/data/toflit18_flows_sprint.csv`;\n    // console.log(\"URL '${process.env.PUBLIC_URL}/data/toflit18_flows_sprint.csv' : \", URL)\n    get(URL) // get de axios\n      .then(({ data: csvString }) => {\n        // conversion en js (avec d3-dsv)\n        const newData = csvParse(csvString);\n        // faire des choses avec les résultats (filtres, ...)\n        const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest });\n        // console.log(\"finalData : \", finalData);\n        resolve(finalData);\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\nexport const getToflitFlowsByApi = ({\n  startYear = null,\n  endYear = null,\n  year = null,\n  params = null,\n  ...rest\n}) => {\n\n  return new Promise((resolve, reject) => {\n\n    let finalStartYear = startYear; // on ne modif pas params en JS\n    let finalEndYear = endYear;\n\n    // 1. Test de la validité des paramètres\n    if (startYear !== null && endYear === null) {\n      return reject(\"You must put an end year\");\n    } // pas sure pour les accolades\n    else if (endYear !== null && startYear === null) {\n      return reject(\"You must put a start year\");\n    }\n\n    if ((startYear !== null || endYear !== null) && year !== null) {\n      finalStartYear = null;\n      finalEndYear = null;\n    }\n\n    const URL = `http://data.portic.fr/api/flows/?date=${year}`;\n    console.log({ URL })\n    // équivalent à : const URL = 'http://data.portic.fr/api/flows/?date=' + year;\n    get(URL) // get de axios\n      // mixed content issue => comme l'API ne fournit pas d'accès HTTPS je me sentais un peu bloquée\n      .then(({ data: str }) => {\n        // conversion en js (avec d3-dsv)\n        // const newData = csvParse(csvString);\n        try {\n          const newData = JSON.parse(str);\n          // contraire : JSON.stringify()\n          // faire des choses avec les résultats (filtres, ...)\n          const finalData = _filterData(newData, { startYear: finalStartYear, endYear: finalEndYear, year, params, ...rest })\n          resolve(finalData);\n        } catch (e) {\n          reject(e);\n        }\n\n      })\n      .catch((err) => {\n        reject(err);\n      })\n\n  })\n\n}\n\n\n\n\n\nexport const getPorticPointcallsByApi = ({\n  filename,\n  spec\n}) => {\n\n}\n\n","\nimport {useContext, useEffect, useRef, useState} from 'react';\nimport cx from 'classnames';\nimport {v4 as genId} from 'uuid';\n\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nconst Caller = ({id: visualizationId, ...props}) => {\n  const ref = useRef(null);\n  const [id] = useState(genId());\n  const {\n    activeVisualization,\n    onBlockClick,\n    onRegisterVisualization,\n    onUnregisterVisualization,\n  } = useContext(VisualizationControlContext);\n\n  useEffect(() => {\n    // on wrappe dans un setTimeout pour avoir une ref non-nulle vers le composant\n    setTimeout(() => {\n      let payload = {...props};\n      payload = {\n        ...payload,\n        ref,\n        visualizationId,\n        id\n      }\n      onRegisterVisualization(payload)\n    })\n    return onUnregisterVisualization(id);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  const onClick = e => {\n    if (typeof onBlockClick === 'function') {\n      onBlockClick(id, ref);\n    }\n  }\n  return (\n    <div\n      ref={ref}\n      onClick={onClick} \n      className={cx(\"Caller\", {\n        'is-active': activeVisualization && id === activeVisualization.id, \n        'is-clearfix': !visualizationId,\n        'is-hidden': process.env.NODE_ENV !== 'development'\n      })}\n    >\n      {\n        visualizationId ?\n        <>caller pour la visualisation <code>{visualizationId}</code> </>\n        :\n        <>caller sans id (agit comme un clearfix)</>\n      }{\n        Object.keys(props).length ? \n          <span>avec les paramètres {JSON.stringify(props)}</span>\n        : null\n      }\n    </div>\n  );\n}\n\nexport default Caller;","import Caller from './Caller';\n\nexport default Caller;","var map = {\n\t\"./en/about.mdx\": [\n\t\t196\n\t],\n\t\"./en/footer.mdx\": [\n\t\t543,\n\t\t5\n\t],\n\t\"./en/introduction.mdx\": [\n\t\t186\n\t],\n\t\"./en/metadata\": [\n\t\t285,\n\t\t0\n\t],\n\t\"./en/metadata.js\": [\n\t\t285,\n\t\t0\n\t],\n\t\"./en/part-1.mdx\": [\n\t\t190\n\t],\n\t\"./en/part-2-1.mdx\": [\n\t\t544,\n\t\t6\n\t],\n\t\"./en/part-2-2.mdx\": [\n\t\t545,\n\t\t7\n\t],\n\t\"./en/part-2-3.mdx\": [\n\t\t546,\n\t\t8\n\t],\n\t\"./en/part-2-intro.mdx\": [\n\t\t192\n\t],\n\t\"./en/part-3.mdx\": [\n\t\t194\n\t],\n\t\"./en/test-scrolly.mdx\": [\n\t\t547,\n\t\t9\n\t],\n\t\"./en/tests.mdx\": [\n\t\t197\n\t],\n\t\"./fr/a-propos.mdx\": [\n\t\t195\n\t],\n\t\"./fr/footer.mdx\": [\n\t\t100\n\t],\n\t\"./fr/introduction.mdx\": [\n\t\t185\n\t],\n\t\"./fr/metadata\": [\n\t\t286,\n\t\t1\n\t],\n\t\"./fr/metadata.js\": [\n\t\t286,\n\t\t1\n\t],\n\t\"./fr/partie-1.mdx\": [\n\t\t189\n\t],\n\t\"./fr/partie-2.mdx\": [\n\t\t191\n\t],\n\t\"./fr/partie-3.mdx\": [\n\t\t193\n\t],\n\t\"./fr/test-scrolly.mdx\": [\n\t\t548,\n\t\t10\n\t],\n\t\"./fr/tests.mdx\": [\n\t\t198\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 533;\nmodule.exports = webpackAsyncContext;","\n\nconst Test = ({\n  datasets = {}\n}) => {\n  return(\n    <div className=\"Test\">\n      <div>Ceci est un appel pour une visualisation qui n'a pas encore été développée</div>\n      {\n        Object.keys(datasets).length ? \n        <div>\n          <h3>Datasets de la visualisation :</h3>\n          {\n            Object.entries(datasets)\n            .map(([datasetName, values]) => {\n              return (\n              <div key={datasetName}>\n                <h3>{datasetName}</h3>\n                <pre>\n                  <code>\n                    {\n                      JSON.stringify(values, null, 2)\n                    }\n                  </code>\n                </pre>\n              </div>\n              )\n            })\n          }\n        </div>\n        : null\n      }\n    </div>\n    )\n}\n\nexport default Test;","import { scalePow, scaleBand, scaleLinear } from \"d3-scale\";\nimport { range } from \"lodash\";\nimport {extent, max} from 'd3-array';\nimport { useMemo, useRef, useState, useEffect } from \"react\";\nimport {axisPropsFromTickScale} from 'react-d3-axis';\nimport cx from 'classnames';\n\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n\nconst prettifyValue = str => {\n  const inted = Math.round(+str) + '';\n  let finalStr = '';\n  let count = 0;\n  for (let i = inted.length - 1; i >= 0; i--) {\n    const char = inted[i];\n    count++;\n    \n    finalStr = char + finalStr;\n    if (count === 3) {\n      count = 0;\n      finalStr = ',' + finalStr;\n    }\n  }\n  if (finalStr[0] === ',') {\n    finalStr = finalStr.slice(1);\n  }\n\n  return finalStr;\n}\n\nconst LongitudinalTradeChart = ({\n  data: inputData,\n  // fields: if null, viz will not show the corresponding data\n  absoluteField,\n  shareField,\n  herfindhalField,\n\n  width,\n  height: wholeHeight,\n  axisLeftTitle,\n  axisRightTitle,\n\n  startYear,\n  endYear,\n  fillGaps,\n  barTooltipFn,\n  cityName,\n  highlightYears,\n  title,\n  colorScaleMessages,\n  annotations = [],\n  margins\n}) => {\n  const data = useMemo(() => inputData.filter(d => +d.year >= startYear & +d.year <= endYear), [startYear, endYear, inputData])\n  const headerRef = useRef(null);\n  const footerRef = useRef(null);\n  const [height, setHeight] = useState(wholeHeight);\n  useEffect(() => {\n    // handling ref updates to set the correct height\n    setTimeout(() => {\n      let newHeight = wholeHeight;\n      if (headerRef && headerRef.current) {\n        newHeight = wholeHeight - headerRef.current.offsetHeight;\n        if (footerRef && footerRef.current) {\n          newHeight -= footerRef.current.offsetHeight;;\n        }\n      }\n      setHeight(newHeight);\n      ReactTooltip.rebuild();\n    })\n    \n  }, [wholeHeight])\n  \n\n  const yearsExtent = extent(data.map((d) => +d.year));\n  const yearsEnumerated = range(...yearsExtent);\n\n  const xBand = scaleBand()\n    .domain([...yearsEnumerated, endYear, endYear + 1])\n    .range([margins.left, width - margins.right])\n    .padding(0.1);\n  const herfindhalColorScale = scalePow()\n    .domain(extent(data, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  // const herfindhalOpacityScale = herfindhalColorScale.copy()\n  // .range([1, 0.5])\n\n  const yearDomain = xBand.domain().map((y) => +y);\n  const yearTicks = yearDomain\n      .filter((y) => y % 5 === 0)\n  const yAbsoluteScale = scaleLinear()\n    .domain([0, max(data, (d) => +d[absoluteField])])\n    .nice()\n    .range([height - margins.bottom, margins.top]);\n  const yShareScale = scaleLinear()\n      .domain([0, max(data, (d) => +d[shareField])])\n      .nice()\n      .range([height - margins.bottom, margins.top]);\n\n  const {values: rightYAxisValues} = axisPropsFromTickScale(yAbsoluteScale, Math.round(height / 20));\n  const {values: leftYAxisValue} = axisPropsFromTickScale(yShareScale, Math.round(height / 20));\n  return (\n    <div className={cx(\"LongitudinalTradeChart\", {'has-highlights': highlightYears !== undefined})}>\n      <div className=\"chart-header\" ref={headerRef}>\n        <h3 style={{marginLeft: margins.left}}>{title}</h3>\n        <div className=\"axis-headers-container\">\n          <div style={{\n            background: axisLeftTitle && axisLeftTitle.length ? colorsPalettes.generic.accent2 : undefined,\n            marginLeft: margins.left,\n          }} className=\"axis-header axis-header-left\">\n            {axisLeftTitle}\n          </div>\n          {\n            colorScaleMessages ?\n            <div className=\"color-scale-container\">\n              <div className=\"color-scale-detail\">\n                <div \n                  className=\"bar\"\n                  style={{\n                    background: `linear-gradient(to right, ${herfindhalColorScale(herfindhalColorScale.domain()[0])}, ${herfindhalColorScale(herfindhalColorScale.domain()[1])})`\n                  }}\n                />\n                <div className=\"labels\">\n                  <span>{colorScaleMessages.maximum}</span>\n                  {/* <span>{colorScaleMessages.title}</span> */}\n                  <span>{colorScaleMessages.minimum}</span>\n                </div>\n              </div>\n            </div>\n            : null\n          }\n          <div style={{\n            background: axisRightTitle && axisRightTitle.length ? colorsPalettes.generic.accent1 : undefined,\n            marginRight: margins.right,\n          }} className=\"axis-header axis-header-right\">\n            {axisRightTitle}\n          </div>\n        </div>\n      </div>\n      <svg width={width} height={height}>\n        <g\n          className=\"axis axis-left\"\n        >\n          {\n            leftYAxisValue.map(value => {\n              return (\n                <g className=\"axis-group\">\n                  <line\n                    x1={margins.left * .8}\n                    x2={margins.left}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                  />\n                  <line\n                    x1={margins.left}\n                    x2={width - margins.right}\n                    y1={yShareScale(value)}\n                    y2={yShareScale(value)}\n                    stroke={colorsPalettes.generic.accent2}\n                    strokeDasharray={'2, 2'}\n                    opacity={.2}\n                  />\n                  <text\n                    x={margins.left * .7}\n                    y={yShareScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent2}\n                  >\n                    {Math.round(+value * 100) + '%'}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g\n          className=\"axis axis-right\"\n        >\n          {\n            rightYAxisValues.map(value => {\n              return (\n                <g className=\"axis-group\">\n                  <line\n                    x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n                    x2={xBand(yearTicks[yearTicks.length - 1])}\n                    y1={yAbsoluteScale(value)}\n                    y2={yAbsoluteScale(value)}\n                    stroke={colorsPalettes.generic.accent1}\n                    strokeDasharray={'4, 2'}\n                    opacity={.5}\n                  />\n                  <text\n                    x={width - margins.right + 2}\n                    y={yAbsoluteScale(value) + height / 100}\n                    fill={colorsPalettes.generic.accent1}\n                  >\n                    {value > 0 ? Math.round(value/1000000) + 'm livres t.' : 0}\n                  </text>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"axis axis-bottom\">\n          <line\n            y1={height - margins.bottom}\n            y2={height - margins.bottom}\n            x1={xBand(yearTicks[0]) + xBand.bandwidth() / 2}\n            x2={xBand(yearTicks[yearTicks.length - 1]) + xBand.bandwidth() / 2}\n            stroke={'lightgrey'}\n          />\n          {\n            yearTicks\n            .map(year => {\n              const x = xBand(year) + xBand.bandwidth() / 2;\n              const y = height - margins.bottom;\n              return (\n                <g\n                  key={year}\n                  className=\"axis-group\"\n                  transform={`translate(${x}, ${y})`}\n                >\n                  <line\n                    x1={0}\n                    x2={0}\n                    y1={0}\n                    y2={margins.bottom / 6}\n                    stroke=\"grey\"\n                  />\n                  <g \n                    transform={`translate(${(xBand.bandwidth() * .5)}, ${margins.bottom / 2})`}\n                  >\n                  <text fill=\"grey\">\n                    {year}\n                  </text>\n                  </g>\n                </g>\n              )\n            })\n          }\n        </g>\n        <g className=\"annotations-container\">\n          {\n            annotations.map((annotation, annotationIndex) => {\n              const {startYear, endYear, label} = annotation;\n              return (\n                <g className=\"annotation\" key={annotationIndex}>\n                  <rect\n                    x={xBand(startYear)}\n                    width={xBand(endYear) - xBand(startYear)}\n                    height={height - margins.top - margins.bottom}\n                    y={margins.top}\n                    fill=\"url(#diagonalHatch)\"\n                    opacity={.4}\n                  />\n                  <line\n                    x1={xBand(startYear)}\n                    x2={xBand(startYear)}\n                    y1={margins.top}\n                    y2={height - margins.bottom}\n                    stroke=\"grey\"\n                    opacity={.4}\n                    strokeDasharray={'4,2'}\n                  />\n                  <line\n                    x1={xBand(endYear)}\n                    x2={xBand(endYear)}\n                    y1={margins.top}\n                    y2={height - margins.bottom}\n                    stroke=\"grey\"\n                    opacity={.4}\n                    strokeDasharray={'4,2'}\n                  />\n                  <line \n                    x1={xBand(endYear) + 20} \n                    x2={xBand(endYear) + 10} \n                    y1={margins.top + 7.5}\n                    y2={margins.top + 7.5}\n                    stroke=\"grey\" \n                    marker-end=\"url(#arrowhead)\" \n                  />\n                  <text\n                    x={xBand(endYear) + 22}\n                    y={margins.top + 10}\n                    fontSize={'.5rem'}\n                    fill=\"grey\"\n                  >\n                    {label}\n                  </text>\n                  <defs>\n                    <marker id=\"arrowhead\" markerWidth=\"5\" markerHeight=\"5\" \n                    refX=\"0\" refY=\"2.5\" orient=\"auto\">\n                      <polygon stroke=\"grey\" fill=\"transparent\" points=\"0 0, 5 2.5, 0 5\" />\n                    </marker>\n                  </defs>\n                  <pattern id=\"diagonalHatch\" patternUnits=\"userSpaceOnUse\" width=\"4\" height=\"4\">\n                  <path d=\"M-1,1 l2,-2\n                          M0,4 l4,-4\n                          M3,5 l2,-2\" \n                        style={{stroke:'grey', opacity: .5, strokeWidth:1}} />\n                </pattern>\n\n                </g>\n              )\n            })\n          }\n        </g>\n\n        <g className=\"bars-container\">\n          {\n            data.map((d) => {\n              return (\n                <rect\n                  key={d.year}\n                  x={xBand(+d.year)}\n                  y={yShareScale(d[shareField])}\n                  width={xBand.bandwidth()}\n                  height={yShareScale(0) - yShareScale(d[shareField])}\n                  fill={herfindhalField && d[herfindhalField] ? herfindhalColorScale(+d[herfindhalField]) : colorsPalettes.generic.dark}\n                  // opacity={herfindhalField && d[herfindhalField]\n                  //         ? herfindhalOpacityScale(+d[herfindhalField])\n                  //         : 1}\n                  data-tip={barTooltipFn ? \n                    barTooltipFn(d.year, (d[shareField] * 100).toFixed(2), cityName, d[herfindhalField] && (+d[herfindhalField] || 0).toFixed(2)) \n                    .replace('[colorBox]', `<span style=\"display:inline-block;width: .8em;height:.8em;background:${herfindhalColorScale(+d[herfindhalField] || 0)}\"></span>`)\n                    : undefined}\n                  data-for={cityName}\n                  data-effect=\"solid\"\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place=\"left\"\n                  className={cx('graph-bar', {'is-highlighted': highlightYears && highlightYears.includes(+d.year)})}\n                />\n              )\n            })\n          }\n        </g>\n\n        <g\n          className=\"lines-container\"\n        >\n          {\n            data\n            .sort((a, b) => {\n              if (+a.year > +b.year) {\n                return 1;\n              }\n              return -1;\n            })\n            .filter((d, index) => {\n              const next = data[index + 1];\n              return index < data.length - 1\n              && (fillGaps ? true : +next.year === +d.year + 1)\n            })\n            .map((datum, index) => {\n              const next = data[index + 1];\n              const x1 = xBand(+datum.year) + xBand.bandwidth() / 2;\n              const x2 = xBand(+next.year)+ xBand.bandwidth() / 2;\n              const y1 = yAbsoluteScale(+datum[absoluteField]);\n              const y2 = yAbsoluteScale(+next[absoluteField]);\n              if (!+datum[absoluteField] || !+next[absoluteField]) {\n                return null;\n              }\n              const ratio = +next[absoluteField] > +datum[absoluteField] ? +next[absoluteField] / +datum[absoluteField] - 1 : -(1 - +next[absoluteField] / +datum[absoluteField]);\n              return (\n                 <line\n                   key={datum.year}\n                   {\n                     ...{\n                       x1,\n                       x2,\n                       y1,\n                       y2\n                     }\n                   }\n                   stroke={colorsPalettes.generic.accent1}\n                   title={`${datum.year}-${next.year}`}\n                   strokeWidth={2}\n                   data-tip={`${datum.year} → <strong>${prettifyValue(+datum[absoluteField])}</strong> livres tournois <br/>${next.year} → <strong>${prettifyValue(+next[absoluteField])}</strong> livres tournois<br/><i>(${ratio > 0 ? '+' : ''}${Math.round(ratio * 100)}%)</i>`}\n                    data-for={cityName}\n                    data-class=\"bar-tooltip\"\n                    data-html={true}\n                 />\n              )\n            })\n          }\n\n        </g>\n        \n      </svg>\n\n\n      <ReactTooltip id={cityName} />\n      \n    </div>\n  );\n};\nexport default LongitudinalTradeChart;\n","import {useRef, useState, useEffect, useMemo} from 'react';\nimport { sortBy, sum } from \"lodash\";\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport {extent} from 'd3-array';\nimport cx from 'classnames';\nimport ReactTooltip from 'react-tooltip';\n\nimport colorsPalettes from \"../../colorPalettes\";\n\n// TODO:\n// - click on products highlight same product on all years ?\n// - click on products make label bigger for small ones ?\n\nconst ProductsDistributionChart = ({\n  data: allData,\n  tradeData = [],\n  field,\n  partTreshold,\n  height: wholeHeight,\n  barWidth,\n  herfindhalField,\n  years,\n  width,\n  title,\n  margins,\n  productTooltipFn,\n  compareFrom\n}) => {\n  const titleRef = useRef(null);\n  const svgRef = useRef(null);\n  const yearsRef = useRef(new Array(years.length))\n\n  useEffect(() => {\n    setTimeout(() => {\n      ReactTooltip.rebuild();\n    })\n  }, [wholeHeight])\n\n  const [hoveredProduct, setHoveredProduct] = useState(undefined);\n  let height = wholeHeight;\n  const yearLabelHeight = height / 20 + 10;\n\n  if (titleRef && titleRef.current) {\n    height = wholeHeight - titleRef.current.getBoundingClientRect().height - yearLabelHeight;\n  }\n  const finalData= useMemo(() => {\n    if (compareFrom) {\n      const lastYear = years[years.length - 1];\n      const lastYearData =  allData.filter(datum => datum.year + '' === lastYear + '');\n      const lastYearTotalValue = sum(lastYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(lastYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * lastYearTotalValue;\n      });\n      const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: lastYearTotalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${lastYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n    return years.reduce((dict, year) => {\n\n        if (year === lastYear) {\n          return {\n            ...dict,\n            [year]: dataTillTreshold\n          }\n        }\n        const thisData = allData.filter(datum => datum.year + '' === year + '');\n        const thisTotalValue =  sum(thisData.map((d) => +d[field]));\n        const thisYearData = thisData.filter(d => topProducts.includes(d.product))\n        .sort((a, b) => {\n          if (+a[field] > +b[field]) {\n            return -1;\n          }\n          return 1;\n        })\n        thisYearData.push({\n          [field]: thisTotalValue - sum(thisYearData.map((d) => +d[field])),\n          product: `${thisData.length - thisYearData.length} autres types de produits`,\n        })\n        return {\n          ...dict,\n          [year]: thisYearData\n        }\n      });\n    }\n    return years.reduce((dict, year) => {\n      const thisYearData =  allData.filter(datum => datum.year + '' === year + '');\n      const totalValue = sum(thisYearData.map((d) => +d[field])); \n      let partAcc = 0;\n      // Sort by trade value and keep only the top products which totalizes partTreshold of share\n      const dataTillTreshold = sortBy(thisYearData, (d) => -d[field])\n      .filter((d) => {\n        partAcc += +d[field];\n        return partAcc <= partTreshold * totalValue;\n      });\n      // const topProducts = dataTillTreshold.map(d => d.product);\n      // group the long tail of low value (under the part Treshold) products as one aggregated misc\n      const aggregatedMiscProducts = {\n        [field]: totalValue - sum(dataTillTreshold.map((d) => +d[field])),\n        product: `${thisYearData.length - dataTillTreshold.length} autres types de produits`,\n      };\n      dataTillTreshold.push(aggregatedMiscProducts);\n      return {\n        ...dict,\n        [year]: dataTillTreshold\n      }\n    }, {})\n\n  }, [years, JSON.stringify(allData)])/* eslint react-hooks/exhaustive-deps : 0 */\n\n  const links = useMemo(() => {\n    const yearsToLink = years.filter((y, i) => i < years.length - 1)\n\n    return yearsToLink\n    .map((year, i) => {\n      const nextYear = years[i + 1];\n      const thisData = finalData[year + ''];\n      const nextData = finalData[nextYear + ''];\n      if (!nextData) {\n        return null;\n      }\n\n      const thisYearTotalValue = sum(thisData.map((d) => +d[field]));    \n      const thisYearScaleValue = (value) => {\n        const v = (value / thisYearTotalValue) * height;\n        return v;\n      };\n      const nextYearTotalValue = sum(nextData.map((d) => +d[field]));    \n      const nextYearScaleValue = (value) => {\n        const v = (value / nextYearTotalValue) * height;\n        return v;\n      };\n      let thisYearOffset = 0;\n      // const thisYearLabelScale = scaleLinear().domain(extent(thisData, datum => +datum[field])).range([height / 100, height / 15])\n\n      return thisData.reduce((res, datum, datumIndex) => {\n        let otherOffset = 0;\n        let otherHeight;\n        let thisHeight = thisYearScaleValue(datum[field]);\n        /* @todo if label adjust\n        let thisFontSize =  i === thisData.length - 1 ? 10 : thisYearLabelScale(+datum[field]);\n        if (isHighlighted && thisFontSize < 10) {\n          thisFontSize = 10;\n        }\n        */\n        thisYearOffset += thisHeight;\n        const hasNext = nextData.find(otherDatum => {\n          otherHeight = nextYearScaleValue(otherDatum[field]);\n          otherOffset += otherHeight;\n          if (otherDatum.product === datum.product) {\n            return true;\n          }\n          return false;\n        });\n        if (hasNext) {\n          return [\n            ...res,\n            {\n              product: datum.product,\n              y1: thisYearOffset/* + thisFontSize*/,\n              height1: thisHeight,\n              y2: otherOffset - otherHeight,\n              height2: otherHeight,\n            }\n          ]\n        } else {\n          return res;\n        }\n      }, [])\n    })\n      \n  }, [finalData, years, height]);\n  \n\n  const herfindhalColorScale = scalePow()\n    .domain(extent(tradeData, (d) => +d[herfindhalField]))\n    .range([colorsPalettes.generic.accent2, 'grey']);\n  const svgOffset = yearsRef.current && yearsRef.current.length && yearsRef.current[0] ? yearsRef.current[0].parentNode.offsetTop : undefined;\n  return (\n    <div className=\"ProductsDistributionChart\">\n      <h3 style={{marginLeft: margins.left}} ref={titleRef}>{title}</h3>\n      <div \n        className={cx(\"years-container\", {'has-highlights': hoveredProduct !== undefined})}\n        style={{\n          marginLeft: margins.left + 5,\n          marginRight: margins.right + width * .002,\n        }}\n      >\n      <svg ref={svgRef} className={cx(\"links-container\", {'has-highlights': hoveredProduct})} style={{top: svgOffset}} width={width} height={height}>\n        {\n          links.map((yearLinks, i) => {\n            const ref1 = yearsRef.current && yearsRef.current.length >= i && yearsRef.current[i] && yearsRef.current[i];\n            const ref2 = yearsRef.current && yearsRef.current.length >= i + 1 && yearsRef.current[i + 1] && yearsRef.current[i + 1];\n            const x1 = ref1 ? yearsRef.current[i].getBoundingClientRect().width : 0;\n            const x2 = ref2 && svgRef.current ? yearsRef.current[i + 1].getBoundingClientRect().x - svgRef.current.getBoundingClientRect().x : width;\n            return (\n            <g className=\"year-links\" key={i}>\n              {\n                yearLinks.map(({product, y1: initialY1, height1, y2: initialY2, height2}, index) => {\n                  const y1= initialY1 - height1 / 2;\n                  const y2= initialY2 + height2/2;\n                  const isHighlighted = hoveredProduct === product;\n                  return (\n                    <path\n                      d={`M ${x1} ${y1} C ${x1 + (x2 - x1) * .5} ${y1} ${x1 + (x2 - x1) * .5} ${y2} ${x2} ${y2}`}\n                      className={cx('link', {'is-highlighted': isHighlighted})}\n                    />\n                  );\n                })\n              }\n            </g>\n          )})\n        }\n      </svg>\n      {\n        years.map((year, yearIndex) => {\n          const data = allData.filter(datum => datum.year + '' === year + '');\n          const flows = tradeData.filter((d) => d.year === year + '');\n          const her = flows && +flows[0][herfindhalField];\n          const color = her\n          ? herfindhalColorScale(+her) // d3.rgb(200, 50, 0, herfindhalScale(+her))\n          : \"lightgrey\";\n          const totalValue = sum(data.map((d) => +d[field]));    \n          \n          const scaleValue = (value) => {\n            const v = (value / totalValue) * height;\n            return v;\n          };\n          const dataTillTreshold = finalData[year + ''];\n\n          const labelScale = scaleLinear().domain(extent(data, datum => +datum[field])).range([height / 100, height / 15])\n\n          return (\n            <div\n            key={year}\n            className=\"year-column\"\n          >\n            <h4 className=\"year-label\">\n              <span>{year}</span>\n            </h4>\n            <div \n            \n            className=\"year-items\">\n              <div className=\"dimensions-placeholder\"\n                ref={(element) => {yearsRef.current[yearIndex] = element}}\n                style={{\n                  width: `${barWidth}px`, height: 0,\n                  position: 'absolute',\n                  top: 0,\n                  left: yearIndex === years.length - 1 ? undefined : 0,\n                  right: yearIndex === years.length - 1 ? 0 : undefined,\n                }}\n              />\n            {dataTillTreshold &&\n              dataTillTreshold.map((d, i) => {\n                const isHighlighted = hoveredProduct === d.product;\n                let fontSize =  i === dataTillTreshold.length - 1 ? 10 : labelScale(+d[field]);\n                if (isHighlighted && fontSize < 10) {\n                  fontSize = 10;\n                }\n                return (\n                <div\n                  key={d.product}\n                  style={{\n                    height: `${scaleValue(d[field])}px`,\n                  }}\n                  className={cx(\"product-group\", {'is-highlighted': isHighlighted})}\n                  onClick={() => {\n                    if (hoveredProduct !== d.product && i !== dataTillTreshold.length - 1) {\n                      setHoveredProduct(d.product);\n                    } else {\n                      setHoveredProduct(undefined);\n                    }\n                  }}\n                  data-tip={productTooltipFn && i !== dataTillTreshold.length - 1 ? \n                    productTooltipFn(year, d.product, (d[field] / totalValue * 100).toFixed(2))\n                    : undefined}\n                  data-for={'product-tooltip'}\n                  data-html={true}\n                  data-class=\"bar-tooltip\"\n                  data-place={yearIndex === 0 ? 'right' : 'left'}\n                  data-effect=\"solid\"\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      width: `${barWidth}px`,\n                      maxWidth: `${barWidth}px`,\n                      minWidth: `${barWidth}px`,\n                      backgroundColor: color,\n                    }}\n                    className=\"bar\"\n                  ></div>\n                  <span\n                    className=\"label\"\n                    style={{\n                      fontSize\n                    }}\n                  >\n                    {d.product}\n                  </span>\n                </div>\n              )\n              })}\n              </div>\n          </div>\n          )\n        })\n      }\n      </div>\n      <ReactTooltip id={'product-tooltip'} />\n    </div>\n  );\n};\n\nexport default ProductsDistributionChart;","import DeclineComponent from './DeclineComponent';\n\nexport default DeclineComponent;","import cx from 'classnames';\nimport LongitudinalTradeChart from \"./LongitudinalTradeChart\";\nimport ProductsDistributionChart from './ProductsDistributionChart';\n\nimport './DeclineComponent.scss';\n\nconst DeclineComponent = (props) => {\n  const {\n    width, \n    height: containerHeight, \n    lang = 'fr',\n    startYear = 1720,\n    endYear = 1789,\n    productTradePartThreshold = 0.9,\n    rows,\n    datasets = {},\n    atlasMode\n  } = props;\n  const height = atlasMode ? 1200 : containerHeight;\n  const messages = {\n    franceOverviewTitle: {\n      fr: (start, end) => `Évolution de la valeur des exports du royaume de France de ${start} à ${end}`,\n      en: (start, end) => `Evolution of the value of exports from the kingdom of France from ${start} to ${end}`\n    },\n    tradeEvolutionTitle: {\n      fr: (cityName, start, end) => `Évolution du commerce de la direction des fermes de ${cityName} de ${start} à ${end}`,\n      en: (cityName, start, end) => `Evolution of the direction des fermes of ${cityName} trade from ${start} to ${end}`\n    },\n    top90PctTitle: {\n      fr: (cityName, start, end) => `Comparaison des parts des produits exportés par la direction des fermes de ${cityName} totalisant plus de 90% du commerce en ${start} et en ${end} (ports francs non pris en compte)`,\n      en: (cityName, start, end) => `Comparison of shares of the top 90% of exported products by the direction des fermes of ${cityName} in ${start} and in ${end} (ports francs non pris en compte)`,\n    },\n    partInPct: {\n      fr: () => 'part des exports fr.',\n      en: () => 'share of french exports'\n    },\n    absoluteValue: {\n      fr: () => 'valeur absolue des exports',\n      en: () => 'exports\\' absolute value'\n    },\n    herfindalLegendTitle: {\n      // fr: () => `Degré de diversité du commerce (inverse de l’indice de Herfindahl)`,\n      // en: () => `Degree of trade diversity (inverse of the Herfindahl index)`,\n      fr: () => `degré de diversité du commerce`,\n      en: () => `degree of trade diversity`,\n    },\n    herfindal0: {\n      fr: () => `commerce peu diversifié`,\n      en: () => `fewly diversified trade`,\n    },\n    herfindal1: {\n      fr: () => `commerce très diversifié`,\n      en: () => `very diversified trade`,\n    },\n    barTooltip: {\n      fr: (year, pct, city, herfindal) => `En <strong>${year}</strong>, ${pct}% des biens exportés depuis la France le sont à partir de <strong>${city}</strong>.<br/><br/>Concentration du commerce <i>(indice de Herfindahl-Hirschmann : somme du carré des parts du marché français par classe de produits exportés)</i> : <span>[colorBox] ${herfindal}</span>`,\n      en: (year, pct, city, herfindal) => `In <strong>${year}</strong>, ${pct}% of exported goods from France are exported <strong>${city}</strong>.<br/><br/>Trade concentration <i>(Herfindahl-Hirschmann index : sum of square french market' shares sorted by exported products classes)</i> : <span>[colorBox] ${herfindal}</span>`,\n    },\n    productTooltip: {\n      fr: (year, product, pct) => `En <strong>${year}</strong>, les produits de la classe \"${product}\" représentent <strong>${pct}%</strong> de la valeur des biens exportés par la direction des fermes de La Rochelle.`,\n      en: (year, product, pct) => `In <strong>${year}</strong>, products classed as \"${product}\" represent ${pct}% of goods exported by La Rochelle's direction des fermes.`,\n    },\n    sevenYearsWar: {\n      fr: () => 'guerre de sept ans',\n      en: () => 'seven years war'\n    }\n  }\n  const margins = { top: 10, right: 50, bottom: 30, left: 50 };\n\n  const totalRows = Object.entries(rows).reduce((sum, [id, count]) => sum + count, 0)\n  const renderRow = (row, rowFlex, rowIndex) => {\n    switch(row) {\n      case 'France':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"France\")}\n            absoluteField=\"Exports\"\n            title={messages.franceOverviewTitle[lang](startYear, endYear)}\n            axisLeftTitle={''}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              }\n            ]}\n            fillGaps\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'La Rochelle':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"La Rochelle\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('La Rochelle', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            margins={margins}\n            barTooltipFn={messages.barTooltip[lang]}\n            cityName=\"La Rochelle\"\n            highlightYears={rows.comparison > 0 ? [startYear, endYear] : undefined}\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              }\n            ]}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'Bordeaux':\n        if (!datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <LongitudinalTradeChart\n            width={width}\n            height={height/totalRows * rowFlex}\n            data={datasets['decline_longitudinal_data.csv'].filter((d) => d.region === \"Bordeaux\")}\n            absoluteField=\"Exports\"\n            shareField=\"Exports_share\"\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.tradeEvolutionTitle[lang]('Bordeaux', startYear, endYear)}\n            axisLeftTitle={messages.partInPct[lang]()}\n            axisRightTitle={messages.absoluteValue[lang]()}\n            barTooltipFn={ messages.barTooltip[lang]}\n            cityName=\"Bordeaux\"\n            annotations={[\n              {\n                type: 'span',\n                startYear: 1756,\n                endYear: 1763,\n                label: messages.sevenYearsWar[lang]()\n              }\n            ]}\n            margins={margins}\n            colorScaleMessages={{\n              title: messages.herfindalLegendTitle[lang](),\n              minimum: messages.herfindal0[lang](),\n              maximum: messages.herfindal1[lang](),\n            }}\n            {\n              ...{\n                startYear,\n                endYear\n              }\n            }\n          />\n        )\n      case 'comparison':\n        if (!datasets[`decline_LR_products.csv`] || !datasets['decline_longitudinal_data.csv']) {\n          return null;\n        }\n        return (\n          <ProductsDistributionChart\n            data={datasets[`decline_LR_products.csv`]}\n            tradeData={datasets['decline_longitudinal_data.csv']}\n            field=\"Exports\"\n            key={rowIndex}\n            partTreshold={productTradePartThreshold}\n            height={height/totalRows * rowFlex}\n            barWidth={width * 0.02}\n            years={[atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear]}\n            margins={margins}\n            herfindhalField=\"product_revolutionempire_exports_herfindahl\"\n            title={messages.top90PctTitle[lang]('La Rochelle', atlasMode ? 1750 : startYear, atlasMode ? 1789 : endYear)}\n            productTooltipFn={messages.productTooltip[lang]}\n            width={width}\n          />\n        )\n      default:\n        return <div>{row}</div>\n    }\n  }\n  return (\n    <div className=\"DeclineComponent\">\n      {\n        Object.entries(rows).map(([rowId, rowFlex], rowIndex) => {\n          return (\n            <div className={cx('row', {'is-visible': rows[rowId]})}>\n                {renderRow(rowId, rowFlex, rowIndex)}\n            </div>\n          )\n        })\n      }\n    </div>\n  )\n};\n\nexport default DeclineComponent;\n","import Decline from '../components/DeclineComponent';\n\nconst PrincipalVisualizationPart1 = ({width, height, step, ...props}) => {\n  if (props.atlasMode) {\n    return (\n      <Decline \n        startYear={1720} \n        endYear={1789} \n        rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 1}}  \n        {...{width, height, ...props}} \n      />\n    )\n  }\n  switch(step + '') {\n    case '1':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 2, 'La Rochelle': 3, 'Bordeaux': 3, 'comparison': 0}}  {...{width, height, ...props}} />\n    case '2':\n      return <Decline startYear={1720} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 1, 'comparison': 0}} {...{width, height, ...props}} />\n    case '3':\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 0, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 2}} {...{width, height, ...props}} />\n    case '4':\n    default:\n      return <Decline startYear={1750} endYear={1789} rows={{'France': 1, 'La Rochelle': 1, 'Bordeaux': 0, 'comparison': 1}} {...{width, height, ...props}} />\n    \n  }\n}\n\nexport default PrincipalVisualizationPart1;","import { useMemo, useState } from 'react';\nimport { scaleLinear } from 'd3-scale';\nimport {\n  schemeAccent as colorScheme1,\n  schemeDark2 as colorScheme2,\n  schemePaired as colorScheme3\n} from 'd3-scale-chromatic';\nimport cx from 'classnames';\n\nimport { prepareAlluvialData } from './utils';\n\nimport './CircularAlluvialComponent.scss';\nimport { min } from 'd3-array';\nimport { uniq } from 'lodash-es';\nimport { cartesian2Polar, trimText } from '../../helpers/misc';\n\nconst colorSchemes = [colorScheme1, colorScheme2, colorScheme3]\n\nconst CircularAlluvialComponent = ({\n  data: inputData = [],\n  sumBy,\n  steps,\n  width = 1200,\n  height = 800,\n  filters = [],\n  debug = false,\n  colorsPalettes,\n  centerHorizontalLabels = true,\n  displaceHorizontalLabels = true\n}) => {\n  // state is used for managing interactions through svg elements' classes\n  const [highlightedFlow, setHighlightedFlow] = useState(undefined);\n  const [highlightedFilter, setHighlightedFilter] = useState(undefined);\n  // rebuild data each time data or viz params are changed\n  const data = useMemo(() => {\n    const vizData = prepareAlluvialData(inputData, { sumBy, steps });\n    return vizData;\n  }, [inputData, sumBy, steps]);\n  const filtersTotal = useMemo(() => {\n    if (filters && filters.length) {\n      return inputData\n      .filter(flow => filters.find(({key, value}) => flow[key] === value))\n      .reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n    }\n    return inputData.reduce((sum, flow) => sum + (+flow[sumBy]), 0)\n  }, [inputData, sumBy, filters])\n\n  // build categorical color scales\n  const colorScales = useMemo(() => {\n    const modalitiesMap = data.reduce((cur, datum) => {\n      const ids = uniq(datum.nodes.map(node => node.id));\n      return {\n        ...cur,\n        [datum.field]: cur[datum.field] ? uniq([...cur[datum.field], ...ids]) : ids\n      }\n    }, {});\n    return Object.entries(modalitiesMap).reduce((cur, [field, values], fieldIndex) => {\n      let counter = 0;\n      return {\n        ...cur,\n        [field]: values.reduce((m, value) => {\n          counter++;\n          return { ...m, [value]: colorSchemes[fieldIndex][counter - 1] }\n        }, {})\n      }\n    }, {})\n  }, [data]);\n\n  // dimensions are aligned with the smallest dimension of the container (width or height)\n  const smallestDimension = useMemo(() => {\n    return min([width, height])\n  }, [width, height])\n\n  // bar size and height is relative to dimensions\n  let BAR_SIZE = smallestDimension * .3;\n  const BAR_WIDTH = smallestDimension / 50;\n  // margin for double bars\n  const HORIZONTAL_MARGIN = smallestDimension * .2;\n  const textScale = scaleLinear().range([smallestDimension / 120, smallestDimension / 70]).domain([0, 1])\n  const handleMouseOut = () => {\n    setHighlightedFlow(undefined);\n    setHighlightedFilter(undefined);\n  }\n  // these radiuses are used to align bars extremities on the three implicit circles they form\n  // (circle 1 : inner intersection of the 4 bars)\n  // (circle 2 : outer intersection of the external point of 4 bars)\n  // (circle 3 : outer intersection of the internal point of 4 bars)\n  const secondCircleRadius = cartesian2Polar(-smallestDimension / 2 + BAR_SIZE, -HORIZONTAL_MARGIN / 2).distance;\n  const thirdCircleRadius = cartesian2Polar(-smallestDimension / 2, -HORIZONTAL_MARGIN / 2 + BAR_WIDTH).distance;\n  const HORIZONTAL_DISPLACE = Math.abs(smallestDimension / 2 - thirdCircleRadius);\n  const VERTICAL_BAR_SIZE = smallestDimension / 2 - secondCircleRadius;\n\n  const stepScales = {\n    0: {\n      orientation: 'horizontal',\n      direction: 'top',\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5\n    },\n    1: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: 0,\n    },\n    2: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 - HORIZONTAL_MARGIN / 2,\n      displaceText: HORIZONTAL_MARGIN * .2 + 5,\n      direction: 'top',\n    },\n    3: {\n      orientation: 'horizontal',\n      displaceX: smallestDimension - BAR_SIZE - HORIZONTAL_DISPLACE,\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceText: -5,\n      direction: 'bottom',\n    },\n    4: {\n      orientation: 'vertical',\n      displaceX: smallestDimension / 2,\n      displaceY: smallestDimension - BAR_SIZE,\n    },\n    5: {\n      orientation: 'horizontal',\n      displaceY: smallestDimension / 2 + HORIZONTAL_MARGIN / 2,\n      displaceX: HORIZONTAL_DISPLACE,\n      displaceText: -5,\n      direction: 'bottom'\n    }\n  }\n  // const highlightedNode = highlightedFilter ? steps.find(s => s.field === highlightedFilter.key).find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNode = highlightedFilter ? data.find(s => s.field === highlightedFilter.key).nodes.find(node => node.id === highlightedFilter.value) : undefined;\n  const highlightedNodeTotal = highlightedNode ? highlightedNode.flows.reduce((sum, f) => sum + (+f[sumBy]), 0) : 0;\n  return (\n    <>\n      <div style={{ fontSize: '.6rem', alignSelf: 'flex-start' }}>Agrégation par le champ : {sumBy}</div>\n      <svg width={width} height={height} className={cx(\"CircularAlluvialComponent\", { 'has-filters': filters.length, 'has-highlight': highlightedFlow || highlightedFilter })}>\n        <g  transform={`translate(${width * .05}, ${height * .05})scale(.9)`}>\n        <g className=\"background-marks\" transform={`translate(${width / 2 - smallestDimension / 2}, 0)`} >\n          <line x1={0} x2={smallestDimension} y1={smallestDimension / 2} y2={smallestDimension / 2} />\n          {\n            debug ?\n              <>\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={smallestDimension * .5}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={thirdCircleRadius}\n                />\n                <circle\n                  cx={smallestDimension / 2}\n                  cy={smallestDimension / 2}\n                  r={secondCircleRadius}\n                />\n\n              </>\n              : null\n          }\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 - HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index <= 2) || (highlightedFlow && highlightedFlow.stepIndex <= 2) ? 800 : undefined\n            }}\n          >\n            EXPORTS\n          </text>\n          <text\n            x={smallestDimension / 2}\n            y={smallestDimension / 2 + HORIZONTAL_MARGIN * .8 + BAR_WIDTH}\n            style={{\n              fontWeight: (highlightedFilter && highlightedFilter.index > 2 ) || (highlightedFlow && highlightedFlow.stepIndex > 2) ? 800 : undefined\n            }}\n          >\n            IMPORTS\n          </text>\n        </g>\n        <g transform={`translate(${width / 2 - smallestDimension / 2}, 0)`} onMouseOut={handleMouseOut}>\n          {\n            data\n              .map((step, stepIndex) => {\n                const { orientation, direction, displaceX, displaceY: initialDisplaceY, displaceText } = stepScales[stepIndex];\n                let displaceY = initialDisplaceY;\n                let nodesSizeScale = scaleLinear().domain([0, 1]).range([0, orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - HORIZONTAL_DISPLACE]);\n                let displaceLabels = 0;\n                return (\n                  <g\n                    className={cx(\"step-container\", 'is-oriented-' + orientation)}\n                    key={stepIndex}\n                  >\n                    <rect\n                      x={displaceX}\n                      y={displaceY}\n                      width={orientation === 'vertical' ? BAR_WIDTH : BAR_SIZE}\n                      height={orientation === 'vertical' ? BAR_SIZE : BAR_WIDTH}\n                      fill=\"white\"\n                      className=\"step-bar-background\"\n                    />\n                    {\n                      /** for each node display links to next */\n\n                      step.nodes\n                        .map((node, nodeIndex) => {\n                          return (\n                            <g\n                              className={cx(\"links-group\")}\n                              key={nodeIndex}\n                            >\n                              {\n                                node.flows\n                                  .filter(f => f.nextPosition)\n                                  .map((flow, linkIndex) => {\n                                    const handleMouseOver = () => {\n                                      if (highlightedFilter) {\n                                        setHighlightedFilter(undefined);\n                                      }\n                                      setHighlightedFlow({...flow, stepIndex});\n                                    }\n                                    const nextStepScales = stepScales[stepIndex + 1];\n                                    let nextNodesSizeScale = scaleLinear().domain([0, 1]).range([0, nextStepScales.orientation === 'vertical' ? VERTICAL_BAR_SIZE : BAR_SIZE - BAR_WIDTH / 3]);\n\n                                    let x1 = displaceX + BAR_WIDTH;\n                                    let y1 = displaceY + nodesSizeScale(flow.displacePart);\n\n                                    let x2 = nextStepScales.displaceX //+ stepXScale(stepIndex + 1);\n                                    let y2 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart);\n\n                                    let x3 = nextStepScales.displaceX // + stepXScale(stepIndex + 1);\n                                    let y3 = nextStepScales.displaceY + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart);\n\n                                    let y4 = displaceY + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    let x4 = displaceX + BAR_WIDTH;\n\n                                    if (orientation === 'horizontal') {\n                                      x1 = displaceX + nodesSizeScale(flow.displacePart);;\n                                      y1 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      y4 = displaceY + (direction === 'bottom' ? BAR_WIDTH : 0);\n                                      x4 = displaceX + nodesSizeScale(flow.displacePart) + nodesSizeScale(flow.valuePart);\n                                    }\n                                    if (nextStepScales.orientation === 'horizontal') {\n                                      x2 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart) + nextNodesSizeScale(flow.valuePart)\n                                      y2 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n\n                                      x3 = nextStepScales.displaceX + nextNodesSizeScale(flow.nextPosition.displacePart);\n                                      y3 = nextStepScales.displaceY + (nextStepScales.direction === 'bottom' ? BAR_WIDTH : 0);\n                                    }\n                                    // @todo do this cleaner\n                                    if (stepIndex === 3) {\n                                      x2 += BAR_WIDTH;\n                                      x3 += BAR_WIDTH;\n                                      y2 += BAR_WIDTH;\n                                      y3 += BAR_WIDTH;\n                                    }\n                                    if (stepIndex === 4) {\n                                      x1 -= BAR_WIDTH;\n                                      x4 -= BAR_WIDTH;\n                                      y1 += BAR_WIDTH;\n                                      y4 += BAR_WIDTH;\n                                    }\n                                    // large arc control point 1\n                                    let controlPoint1AX = x1,\n                                      controlPoint1AY = y2,\n                                      // large arc control point 2\n                                      controlPoint1BX = x1,\n                                      controlPoint1BY = y2,\n                                      // little arc control point 1\n                                      controlPoint2AX = x4,\n                                      controlPoint2AY = y3,\n                                      // little arc control point 2\n                                      controlPoint2BX = x4,\n                                      controlPoint2BY = y3;\n                                    if (stepIndex === 1 || stepIndex === 4) {\n                                      // large arc control point 1\n                                      controlPoint1AX = x2;\n                                      controlPoint1AY = y1;\n                                      // large arc control point 2\n                                      controlPoint1BX = x2;\n                                      controlPoint1BY = y1;\n                                      // little arc control point 1\n                                      controlPoint2AX = x3;\n                                      controlPoint2AY = y4;\n                                      // little arc control point 2\n                                      controlPoint2BX = x3;\n                                      controlPoint2BY = y4;\n                                    }\n                                    if (stepIndex === 0) {\n                                      controlPoint1AY = y1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2BY = y4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y4 - y3);\n                                      controlPoint2AX = x3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x3 - x4);\n\n                                    } else if (stepIndex === 1) {\n                                      controlPoint1AX = x1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2AY = y3 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                      controlPoint2BX = x4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                    } else if (stepIndex === 3) {\n                                      controlPoint1AY = y1 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n                                      controlPoint1BX = x2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n\n                                      controlPoint2AX = x3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2BY = y4 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    } else if (stepIndex === 4) {\n                                      controlPoint1AX = x1 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x2 - x1);\n                                      controlPoint1BY = y2 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y2 - y1);\n\n                                      controlPoint2BX = x4 - (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(x4 - x3);\n                                      controlPoint2AY = y3 + (4 / 3) * (1 - Math.cos(45) / Math.sin(45)) * Math.abs(y3 - y4);\n                                    }\n                                    return (\n                                      <g\n                                        onMouseOver={handleMouseOver}\n                                        className={cx(\"flow-link\", {\n                                          'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n                                          'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                            (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        })}\n                                        key={linkIndex}\n                                      >\n                                        {/* <path \n                                    d={`\n                                    M ${x1} ${y1} \n                                    Q ${controlPoint1AX} ${controlPoint1AY}, ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    Q ${controlPoint2AX} ${controlPoint2AY}, ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                    title={'Valeur : ' + flow.valueAbs}\n                                    style={{fill: colorScales[step.field][node.id]}}\n                                  /> */}\n                                        <path\n                                          d={`\n                                    M ${x1} ${y1} \n                                    C ${controlPoint1AX},${controlPoint1AY} ${controlPoint1BX},${controlPoint1BY} ${x2} ${y2} \n                                    L ${x3} ${y3}\n                                    C ${controlPoint2AX},${controlPoint2AY} ${controlPoint2BX},${controlPoint2BY} ${x4} ${y4} \n                                    Z\n                                    `.trim().replace(/\\n/g, ' ')}\n                                          style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                        />\n                                        {\n                                          debug ?\n                                            <>\n                                              {/* control line for control point 1 for large arc */}\n                                              <line\n                                                stroke={'red'}\n                                                x1={x1}\n                                                y1={y1}\n                                                x2={controlPoint1AX}\n                                                y2={controlPoint1AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1AX}\n                                                cy={controlPoint1AY}\n                                                r={2}\n                                                fill=\"red\"\n                                              />\n                                              {/* control line for control point 2 for large arc */}\n                                              <line\n                                                stroke={'blue'}\n                                                x1={x2}\n                                                y1={y2}\n                                                x2={controlPoint1BX}\n                                                y2={controlPoint1BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint1BX}\n                                                cy={controlPoint1BY}\n                                                r={2}\n                                                fill=\"blue\"\n                                              />\n                                              {/* control line for control point 1 for small arc */}\n                                              <line\n                                                stroke={'green'}\n                                                x1={x3}\n                                                y1={y3}\n                                                x2={controlPoint2AX}\n                                                y2={controlPoint2AY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2AX}\n                                                cy={controlPoint2AY}\n                                                r={2}\n                                                fill=\"green\"\n                                              />\n                                              {/* control line for control point 2 for small arc */}\n                                              <line\n                                                stroke={'lightblue'}\n                                                x1={x4}\n                                                y1={y4}\n                                                x2={controlPoint2BX}\n                                                y2={controlPoint2BY}\n                                              />\n                                              <circle\n                                                cx={controlPoint2BX}\n                                                cy={controlPoint2BY}\n                                                r={2}\n                                                fill=\"lightblue\"\n                                              />\n                                            </>\n                                            : null\n                                        }\n                                      </g>\n                                    )\n                                  })\n                              }\n                            </g>\n                          )\n                        })\n                    }\n                    {\n                      step.nodes.map((node, nodeIndex) => {\n                        const nodeHeight = nodesSizeScale(node.valuePart);\n                        const initialY = nodesSizeScale(node.displacePart);\n                        const initialWidth = BAR_WIDTH;\n                        const initialHeight = nodeHeight - 2;\n\n                        let y = displaceY + initialY;\n                        let x = displaceX;\n                        let nodeWidth = initialWidth;\n                        let actualHeight = initialHeight;\n                        if (orientation === 'horizontal') {\n                          nodeWidth = initialHeight;\n                          actualHeight = initialWidth;\n                          x = displaceX + initialY;\n                          y = displaceY;\n                        }\n                        if (stepIndex === 4) {\n                          y += BAR_WIDTH;\n                        }\n                        const handleMouseOver = () => {\n                          if (highlightedFlow) {\n                            setHighlightedFlow(undefined);\n                          }\n                          setHighlightedFilter({ key: step.field, value: node.id, index: stepIndex })\n                        }\n                        const isHighlighted = highlightedFilter && node.id === highlightedFilter.value && stepIndex === highlightedFilter.index;\n                        let labelHighlightPart = 0;\n                        if (highlightedFilter) {\n                          labelHighlightPart = node.flows.filter(f => f[highlightedFilter.key] === highlightedFilter.value).reduce((sum, f) => sum + (+f[sumBy]), 0) / highlightedNodeTotal;\n                        } else if (filters && filters.length) {\n                          labelHighlightPart = node.flows\n                          .filter(flow => filters.find(({ key, value }) => flow[key] === value))\n                          .reduce((sum, f) => sum + (+f[sumBy]), 0) \n                          / filtersTotal;\n                        }\n                        if (labelHighlightPart > 1) {\n                          labelHighlightPart = 1;\n                        }\n                        const isFilteredIn = filters && filters.find(({ key, value }) => node.flows.find(flow => flow[key] === value))\n                        let textRotate = 0;\n                        if (stepIndex === 0 || stepIndex === 2) {\n                          textRotate = 30;\n                        } else if (stepIndex === 3 || stepIndex === 5) {\n                          textRotate = -30;\n                        }\n                        const initialLabelX = orientation === 'vertical' ? x + BAR_WIDTH * 2 : x + (centerHorizontalLabels ? nodeWidth / 2 : 0);\n                        let labelX = initialLabelX;\n                        if (orientation === 'horizontal') {\n                      \n                          const minTextWidth = 20;\n                          if (displaceHorizontalLabels && displaceLabels && labelX < displaceLabels + minTextWidth) {\n                            labelX = displaceLabels + minTextWidth;\n                          }\n                          displaceLabels = labelX;\n                          // console.groupEnd('test');\n                        }\n                        const labelY = orientation === 'vertical' ? y + actualHeight / 2 : y + displaceText;\n                        const [labelMain, labelSecondary] = trimText(node.id, 20);\n                        const nodeHasHighlights = (highlightedFlow && node.flows.find(flow => flow._id === highlightedFlow._id)) ||\n                        (highlightedFilter && step.id === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const nodeIsHighlighted = (highlightedFilter && step.field === highlightedFilter.key && node.id === highlightedFilter.value);\n                        const labelFontSize = (highlightedFilter || highlightedNode) ? labelHighlightPart > 0 ? textScale(labelHighlightPart) : textScale(node.valuePart) : textScale(1)\n                        return (\n                          <g\n                            className={cx(\"step-node-container\", {\n                              'has-highlights': nodeHasHighlights,\n                              'is-filtered-in': isFilteredIn,\n                              'is-highlighted': nodeIsHighlighted,\n                            })}\n                            key={node.id}\n                            onMouseOver={handleMouseOver}\n                          >\n                            <rect\n                              x={x}\n                              y={y}\n                              width={nodeWidth}\n                              height={actualHeight}\n                              className=\"node-level-node\"\n                            />\n                            <g\n                              transform={`\n                            translate(${labelX}, ${labelY})\n                            rotate(${textRotate})\n                          `}\n\n                              className={\n                                cx(\"node-level-label\", {\n                                  'is-filtered-in': isFilteredIn,\n                                  'is-highlighted': isHighlighted,\n                                  'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                })\n                              }\n                            >\n                              <text\n                                style={{\n                                  fontSize: labelFontSize,\n                                  \n                                }}\n                              >\n                                {isFilteredIn || isHighlighted ? labelMain + ' ' + (labelSecondary ? labelSecondary : '') : `${labelSecondary ? labelMain + '...' : labelMain}`}\n                              </text>\n                            </g>\n                            {\n                                displaceHorizontalLabels && initialLabelX !== labelX ?\n                                <line\n                                  x1={x + nodeHeight / 2}\n                                  y1={stepIndex === 0 || stepIndex === 2 ? y + BAR_WIDTH : y}\n                                  x2={labelX}\n                                  y2={labelY}\n                                  className={\n                                    cx(\"label-line\", {\n                                      'is-filtered-in': isFilteredIn,\n                                      'is-highlighted': isHighlighted,\n                                      'is-secondary-highlighted': !isHighlighted && labelHighlightPart > 0\n                                    })\n                                  }\n\n                                />\n                                : null\n                            }\n                            {\n                              node.flows.map((flow, flowIndex) => {\n                                let flowX = x;\n                                let flowY = displaceY + nodesSizeScale(flow.displacePart);\n                                if (stepIndex === 4) {\n                                  flowY += BAR_WIDTH;\n                                }\n                                let flowWidth = BAR_WIDTH;\n                                let flowHeight = nodesSizeScale(flow.valuePart);\n                                if (orientation === 'horizontal') {\n                                  flowWidth = nodesSizeScale(flow.valuePart);\n                                  flowHeight = BAR_WIDTH;\n                                  flowX = displaceX + nodesSizeScale(flow.displacePart);\n                                  flowY = displaceY;\n                                }\n                                return (\n                                  <rect\n                                    key={flowIndex}\n                                    x={flowX}\n                                    y={flowY}\n                                    width={flowWidth}\n                                    height={flowHeight}\n                                    className={\n                                      cx(\"flow-level-node\", {\n                                        'is-filtered-in': filters && filters.find(({ key, value }) => flow[key] === value),\n\n                                        'is-highlighted': (highlightedFlow && highlightedFlow._id === flow._id) ||\n                                          (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                        // || (highlightedFilter && flow[highlightedFilter.key] === highlightedFilter.value)\n                                      })\n                                    }\n                                    style={{ fill: colorsPalettes ? colorsPalettes[step.field][node.id] : colorScales[step.field][node.id] }}\n                                    title={node.id}\n                                  />\n                                )\n                              })\n                            }\n                          </g>\n                        )\n                      })\n                    }\n\n                  </g>\n                )\n              })\n          }\n        </g>\n        </g>\n      </svg>\n      {\n        highlightedFlow ?\n          <div style={{\n            position: 'absolute',\n            left: 0,\n            bottom: '1rem',\n            maxWidth: smallestDimension / 2,\n            fontSize: '.8rem'\n          }}>\n            Flux affiché : {highlightedFlow.flow_type} de {highlightedFlow.product} {highlightedFlow.flow_type === 'export' ? 'vers' : 'depuis'} {highlightedFlow.partner} (valeur : {highlightedFlow[sumBy]})\n          </div>\n          : null\n      }\n    </>\n  )\n}\n\nexport default CircularAlluvialComponent;","import groupBy from 'lodash/groupBy';\n\nexport const prepareAlluvialData = (inputData, spec) => {\n  const {sumBy, steps: stepsSpec} = spec;\n  // attribute an id to each flow\n  const data = inputData.map((d, index) => ({...d, _id: index}))\n  // compute nodes for each step\n  let steps = stepsSpec.map((step, stepIndex) => {\n    const {filters} = step;\n    let stepData = data;\n    if (filters && filters.length) {\n      // filter relevant flows\n      stepData = filters.reduce((current, {key, value}) => {\n        return current.filter(datum => {\n          return datum[key] === value;\n        })\n      }, stepData);\n    }\n    // count values for spec modalities\n    let groups = groupBy(stepData, d => d[step.field]);\n    groups = Object.entries(groups).map(([id, initialFlows]) => {\n      const flows = initialFlows.map(flow => {\n        let valueAbs;\n        // if a sumBy is define with sum with its value\n        if (sumBy) {\n          let actualValue = flow[sumBy];\n          actualValue = actualValue === '' ? 0 : actualValue;\n          valueAbs = +actualValue\n        } else valueAbs = 1;\n        return {\n          ...flow,\n          valueAbs\n        }\n      })\n      const valueAbs = flows.reduce((sum, flow) => {\n        return sum + flow.valueAbs\n      }, 0);\n      return {\n        id,\n        valueAbs,\n        flows\n      }\n    });\n    // compute relative part of each modality\n    const totalValue = groups.reduce((sum, g) => sum + g.valueAbs, 0);\n    groups = groups.map(g => ({\n      ...g,\n      valuePart: g.valueAbs / totalValue,\n      flows: g.flows.map(flow => ({\n        ...flow,\n        valuePart: flow.valueAbs / totalValue\n      }))\n      .sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }));\n    return {\n      ...step,\n      totalValue,\n      nodes: groups.sort((a, b) => {\n        // if (a.id > b.id) {\n        const sortAscending = stepIndex >= 2 && stepIndex <= 4 ? -1 : 1;\n        if (a.valuePart < b.valuePart) {\n          return sortAscending;\n        }\n        return -sortAscending;\n      })\n    }\n  })\n\n  // compute displacements for each step\n  steps = steps.map((step, index) => {\n    let displaceAbs = 0;\n    let displacePart = 0;\n    const newNodes = step.nodes.map(node => {\n      // computing flow-level displacement\n      let localDisplaceAbs = displaceAbs;\n      let localDisplacePart = displacePart;\n      const newNode = {\n        ...node,\n        displaceAbs,\n        displacePart,\n        flows: node.flows.map(flow => {\n          const newFlow = {\n            ...flow,\n            displaceAbs: localDisplaceAbs,\n            displacePart: localDisplacePart,\n            relativeDisplaceAbs: localDisplaceAbs - displaceAbs,\n            relativeDisplacePart: localDisplacePart - displacePart\n          }\n          localDisplaceAbs += flow.valueAbs;\n          localDisplacePart += flow.valuePart;\n          return newFlow;\n        })\n      };\n      displaceAbs += node.valueAbs;\n      displacePart += node.valuePart;\n      return newNode;\n    })\n    return {\n      ...step,\n      nodes: newNodes\n    }\n  })\n\n  // compute links\n  const stepsWithLinks = steps.map((step, index) => {\n    // for each step except last one\n    if (index < steps.length - 1) {\n      const nextStep = steps[index + 1];\n      const nextKey = nextStep.field;\n      const {nodes} = step;\n      // iterate over step's to add links\n      const newNodes = nodes.map((node, nodeIndex) => {\n        \n        const {flows} = node;\n        \n        const newFlows = flows.map((flow, flowIndex) => {\n          const nextVal = flow[nextKey];\n          const nextStepGroup = nextStep.nodes.find(({id}) => id === nextVal);\n          if (nextStepGroup) {\n            \n            const nextFlow = nextStepGroup.flows.find(flow2 => {\n              return (flow._id === flow2._id)\n            })\n            if (nextFlow) {\n              const {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              } = nextFlow;\n              const nextPosition = {\n                displaceAbs,\n                displacePart,\n                relativeDisplaceAbs,\n                relativeDisplacePart\n              }\n              return {\n                ...flow,\n                nextPosition\n              }\n            }\n          } else {\n          }\n          return flow;\n        })\n        return {\n          ...node,\n          flows: newFlows\n        }\n      });\n      return {\n        ...step,\n        nodes: newNodes\n      }\n    }\n    return step;\n  })\n\n  return stepsWithLinks;\n}","import PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\n\n\nexport default PrincipalVisualizationPart2;","import CircularAlluvialComponent from \"../../components/CircularAlluvialComponent/CircularAlluvialComponent\";\n\nimport colorsPalettes from '../../colorPalettes';\n\nimport './PrincipalVisualizationPart2.scss';\n\nconst PrincipalVisualizationPart2 = ({width, height: containerHeight, datasets, showOnlyToflit = false, atlasMode, ...props}) => {\n  const {step} = props;\n  let alluvialFilters = [];\n  let sumToflitBy = 'value';\n  const height = atlasMode ? 1200 : containerHeight;\n  switch(step) {\n    case 2:\n      alluvialFilters = [\n        {\n          key: 'product',\n          value: `produit colonial ('Café', 'Sucre', 'Indigo', 'Coton non transformé')`\n        },\n        {\n          key: 'partner',\n          value: `Afrique`\n        },\n        {\n          key: 'partner',\n          value: `Colonies`\n        }\n      ];\n      break;\n    case 3:\n      alluvialFilters = [\n        {\n          key: 'product',\n          value: `eau-de-vie et vins divers`\n        }\n      \n      ];\n      break;\n    case 4:\n      alluvialFilters = [{\n        key: 'product',\n        value: `sel`\n      }];\n      sumToflitBy = 'product_weight_kg'\n      break;\n    default:\n      break;\n  }\n  return (\n    <div className=\"PrincipalVisualizationPart2\">\n     <div>\n        <CircularAlluvialComponent\n          data={datasets['part_2_toflit_viz_data.csv']}\n          width={showOnlyToflit ? width : width / 2}\n          height={height}\n          sumBy={sumToflitBy}\n          filters={alluvialFilters}\n          colorsPalettes={colorsPalettes}\n          steps={[\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extérieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'export'}]\n            },\n            {\n              field: \"partner\",\n              labels: {\n                fr: 'partenaire du commerce extérieur',\n                en: 'external trade partner'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"product\",\n              labels: {\n                fr: 'type de produit',\n                en: 'product type'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n            {\n              field: \"customs_office\",\n              labels: {\n                fr: 'bureau des fermes',\n                en: 'customs office'\n              },\n              filters: [{key: 'flow_type', value: 'import'}]\n            },\n          ]}\n        />\n     </div>\n     <div className=\"radar-container\">\n       <img alt=\"radar-maquette\" src={`${process.env.PUBLIC_URL}/maquettes/part2-radar.jpg`} />\n     </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart2;","import PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\nexport default PrincipalVisualizationPart3;","\nimport cx from 'classnames';\n\nimport SigmaComponent from '../../components/SigmaComponent';\nimport GeoComponent from '../../components/GeoComponent/GeoComponent';\nimport TriangleComponent from '../../components/TriangleComponent/TriangleComponent';\n\nimport './PrincipalVisualizationPart3.scss';\n\n\nconst renderLabel = (datum, x, y) => { // fonction à adapter pour donner le double triangle + cercle qui va bien de la partie 3\n  // console.log(\"datum : \",datum)\n  return (\n    <g transform={`translate(${x},${y})`}>\n      <text>{datum.label}</text>\n    </g>);\n}\n\nconst renderStep3Object = (datum, x, y, { width }) => {\n\n    let sizeCoef = width * 0.05;\n    const totalTonnage = parseFloat(datum.else.cumulated_tonnage_in_region) + parseFloat(datum.else.cumulated_tonnage_out_region)\n    // console.log(\"tonnage total : \",totalTonnage)\n\n    if (datum.else.type_of_object === \"port\") {\n      // définition des coefficients de taille des triangles en 3 classes distinctes (pour l'instant la définition des classes est expérimentale)\n\n      // se gérerait bien avec un switch\n      if (totalTonnage<1000){\n        sizeCoef = width * 0.025\n      }\n      else {\n        if (totalTonnage>5000){\n          sizeCoef = width * 0.075\n        }\n      }\n    }\n\n    const leftTriangleHeight = parseFloat(datum.else.cumulated_tonnage_out_region) / totalTonnage * sizeCoef;\n    const rightTriangleHeight = parseFloat(datum.else.cumulated_tonnage_in_region) / totalTonnage * sizeCoef;\n\n    return (\n      <g className='double-triangle' transform={`translate(${x},${y})`}>\n\n        <path className='left-triangle' fill='rgb(39, 129, 141)'\n          d={`M ${0} ${0}\n              V ${leftTriangleHeight / 2}\n              L ${-Math.pow(5, 0.5) * leftTriangleHeight / 2} ${0}\n              L ${0} ${-leftTriangleHeight / 2}\n              Z\n              `}\n        />\n\n        <path className='right-triangle' fill='rgb(44, 74, 156)'\n          d={`M ${0} ${0}\n              V ${rightTriangleHeight / 2}\n              L ${Math.pow(5, 0.5) * rightTriangleHeight / 2} ${0}\n              L ${0} ${-rightTriangleHeight / 2}\n              Z\n              `}\n        />\n        <>\n        {\n          datum.else.type_of_object === \"customs_office\" ?\n          <>\n          <path \n            d={`M ${0} ${0} \n                C ${70} ${140}, ${110} ${140}, ${110} ${110}\n                `}  \n            stroke=\"black\" fill=\"transparent\"/>\n\n          <path \n            d={`M ${0} ${0} \n            C ${120} ${80}, ${180} ${80}, ${170} ${60}\n            `} \n            stroke=\"red\" fill=\"transparent\"/>\n          </>\n          : null\n        }\n        </>\n      </g>);\n  }\n\n\n\n\n\nconst PrincipalVisualizationPart3 = ({ step, width, height }) => {\n  console.log(process.env.NODE_ENV)\n  return (\n    <div className=\"PrincipalVisualizationPart3\" height={height}>\n      <div className={cx('step', { 'is-visible': step === 1 })}>\n        {process.env.NODE_ENV === 'development' ?\n        <>\n          <GeoComponent\n            backgroundFilename=\"cartoweb_france_1789_geojson.geojson\"\n            dataFilename=\"part_3_step1_viz_data.csv\"\n            height={height * 0.7} // @TODO à changer quand je combin erais en un seul SVG ou component custom\n            label=\"port\"\n            width={width} // j'aurais besoin de responsive\n            showLabels\n            centerOnRegion\n            rotationDegree={58}\n            renderObject={renderLabel}\n          // debug\n          />\n          <TriangleComponent\n            dataFilename=\"part_3_step1_viz_data.csv\"\n            totalWidth={width} // @TODO adapter la height\n            numberOfColumns={25}\n            rowHeight={height * 0.3}\n          />\n          </>\n          :\n          <img alt=\"step-3.1\" src={`${process.env.PUBLIC_URL}/maquettes/VIZ_3.1.svg`} />\n      }\n      </div>\n      <div className={cx('step', { 'is-visible': step === 2 })}>\n      {process.env.NODE_ENV === 'development' ?\n        <>\n        <SigmaComponent\n          data=\"toflit_aggregate_1789_only_out.gexf\"\n          nodeColor={`admiralty`}\n          nodeSize={`inside_degree`}\n          labelDensity={0.5}\n        />\n        <img alt=\"step-3.2\" src={`${process.env.PUBLIC_URL}/maquettes/comparaison_centralite-0.png`} />\n        <img alt=\"step-3.2\" src={`${process.env.PUBLIC_URL}/maquettes/comparaison_centralite-1.png`} />\n        </>\n        :\n        <>\n        <SigmaComponent\n          data=\"toflit_aggregate_1789_only_out.gexf\"\n          nodeColor={`admiralty`}\n          nodeSize={`inside_degree`}\n          labelDensity={0.5}\n        />\n          <img alt=\"step-3.2\" src={`${process.env.PUBLIC_URL}/maquettes/comparaison_centralite-0.png`} />\n          <img alt=\"step-3.2\" src={`${process.env.PUBLIC_URL}/maquettes/comparaison_centralite-1.png`} />\n        </>\n      \n      }\n      </div>\n      <div className={cx('step', { 'is-visible': step === 3 })} height={height}>\n      {process.env.NODE_ENV === 'development' ?\n        <>\n        <GeoComponent\n          backgroundFilename=\"cartoweb_france_1789_geojson.geojson\"\n          dataFilename=\"part_3_step3_viz_customs_offices_data.csv\"\n          width={width}\n          height={height * 0.99}\n          // markerColor=\"type_of_object\"\n          markerSize=\"type_of_object\"\n          label=\"name\"\n          showLabels\n          centerOnRegion\n          renderObject={renderStep3Object}\n        // debug=\"true\"\n        />\n        </>\n          :\n          <img alt=\"step-3.3\" src={`${process.env.PUBLIC_URL}/maquettes/VIZ_3.3.svg`} />\n      }\n      </div>\n    </div>\n  )\n}\n\nexport default PrincipalVisualizationPart3;","import {useContext, useMemo} from 'react';\n\nimport Test from './Test';\nimport PrincipalVisualizationPart1 from './PrincipalVisualizationPart1';\nimport PrincipalVisualizationPart2 from './PrincipalVisualizationPart2';\nimport PrincipalVisualizationPart3 from './PrincipalVisualizationPart3';\n\n\nimport {DatasetsContext} from '../helpers/contexts';\n\nimport visualizationsList from '../visualizationsList';\n\nconst VisualizationContainer = ({id, dimensions: inputDimensions, ...props}) => {\n  const dimensions = {\n    ...inputDimensions,\n    // height: inputDimensions.height - inputDimensions.top / 2\n  }\n  const datasets = useContext(DatasetsContext);\n  const relevantDatasets = useMemo(() => {\n    const viz = visualizationsList.find(v => v.id === id);\n    if (viz) {\n      const datasetsIds = viz.datasets && viz.datasets.split(',').map(d => d.trim());\n      if (datasetsIds.length && datasets) {\n        return datasetsIds.reduce((cur, id) => ({\n          ...cur,\n          [id]: datasets[id]\n        }), {})\n      }\n    }\n  }, [id, datasets]);\n  switch(id) {\n    case 'viz-principale-partie-1':\n      return <PrincipalVisualizationPart1 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-2':\n      return <PrincipalVisualizationPart2 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'viz-principale-partie-3':\n      return <PrincipalVisualizationPart3 {...props} datasets={relevantDatasets || {}} {...dimensions} />;\n    case 'test':\n    default:\n      return <Test {...props} datasets={relevantDatasets || {}} />;\n  }\n}\n\nexport default VisualizationContainer;","import {useState} from 'react';\nimport omit from 'lodash/omit';\nimport cx from 'classnames';\nimport Measure from 'react-measure'\n\nimport VisualizationContainer from '../../visualizations/index.js';\n\nconst VisualizationController = ({\n  activeVisualization,\n  atlasMode\n}) => {\n  const [dimensions, setDimensions] = useState({});\n  const visProps = activeVisualization && omit(activeVisualization, ['id', 'ref', 'visualizationId']);\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n          <div ref={measureRef} className={cx(\"VisualizationController\", {'is-empty': !activeVisualization})}>\n          {/* <h2>Visualization controller</h2> */}\n          {\n            activeVisualization ?\n            <>\n              <VisualizationContainer atlasMode={atlasMode} id={atlasMode ? activeVisualization.id : activeVisualization.visualizationId} {...visProps} dimensions={dimensions} />\n            </>\n            : <div>Pas de visualisation à afficher</div>\n          }\n        </div>\n      )}\n    </Measure>\n  );\n}\n\nexport default VisualizationController;","import VisualizationController from './VisualizationController';\n\nexport default VisualizationController;","import ScrollyPage from './ScrollyPage';\n\nexport default ScrollyPage;","import {useState, useReducer, useEffect, useRef} from 'react';\nimport {Helmet} from \"react-helmet\";\nimport {useScrollYPosition } from 'react-use-scroll-position';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport {VisualizationControlContext} from '../../helpers/contexts';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst CENTER_FRACTION = .6;\n\nconst ScrollyPage = ({\n  // Content,\n  ContentSync,\n  title,\n  lang,\n}) => {\n  const sectionRef = useRef(null);\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n      const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n      const y = scrollY + DISPLACE_Y;\n      const visualizationEntries = Object.entries(visualizations);\n      let found;\n      const sectionDims = sectionRef.current && sectionRef.current.getBoundingClientRect();\n      const sectionEnd = sectionDims.y + window.scrollY + sectionDims.height;\n      if (y > sectionEnd) {\n        if (activeVisualization) {\n          setActiveVisualization(undefined);\n        }\n        return;\n      }\n      // on parcourt la liste à l'envers pour récupérer\n      // la visualisation la plus haute de la page qui est\n      // au-dessus du milieu de l'écran\n      for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n        const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n        const { ref } = visualization;\n        if (ref.current) {\n          const { y: initialVisY } = ref.current.getBoundingClientRect();\n          let visY = initialVisY + window.scrollY;\n          // @todo refactor this, it is dirty\n          if (ref.current.parentNode.className === 'centered-part-contents') {\n            visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n          }\n          if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n            found = true;\n            setActiveVisualization(undefined);\n            break;\n          } else if (y > visY) {\n            found = true;\n            if (visualization.visualizationId) {\n              setActiveVisualization(visualization);\n            } else {\n              setActiveVisualization(undefined);\n            }\n            break;\n          }\n        }\n      }\n      if (scrollY === 0 && visualizationEntries.length) {\n        setActiveVisualization(visualizationEntries[0][1])\n      }\n      else if (!found && activeVisualization) {\n        setActiveVisualization(undefined);\n      }\n  }\n\n  /**\n   * Reset scroll when changing page\n   */\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [ContentSync])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    console.log('on block click', {id, ref})\n  }\n  return (\n    <VisualizationControlContext.Provider\n      value={{\n        activeVisualization,\n        onBlockClick,\n        onRegisterVisualization,\n        onUnregisterVisualization,\n      }}\n    >\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"ScrollyPage\">\n          <section ref={sectionRef}>\n            <ContentSync />\n          </section>\n          <aside>\n            <VisualizationController activeVisualization={activeVisualization} />\n          </aside>\n      </div>\n    </VisualizationControlContext.Provider>\n  )\n}\n\nexport default ScrollyPage;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport ScrollyPage from './pages/ScrollyPage';\n\n// import TestScrollyFr from '!babel-loader!mdx-loader!./contents/fr/test-scrolly.mdx';\n// import testScrollyEn from '!babel-loader!mdx-loader!./contents/en/test-scrolly.mdx';\n\nimport Part1Fr from '!babel-loader!mdx-loader!./contents/fr/partie-1.mdx';\nimport Part1En from '!babel-loader!mdx-loader!./contents/en/part-1.mdx';\n\n// import Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2-intro.mdx';\n// import Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\nimport Part2IntroFr from '!babel-loader!mdx-loader!./contents/fr/partie-2.mdx';\nimport Part2IntroEn from '!babel-loader!mdx-loader!./contents/en/part-2-intro.mdx';\n\n// import Part21Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-1.mdx';\n// import Part21En from '!babel-loader!mdx-loader!./contents/en/part-2-1.mdx';\n\n// import Part22Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-2.mdx';\n// import Part22En from '!babel-loader!mdx-loader!./contents/en/part-2-2.mdx';\n\n// import Part23Fr from '!babel-loader!mdx-loader!./contents/fr/partie-2-3.mdx';\n// import Part23En from '!babel-loader!mdx-loader!./contents/en/part-2-3.mdx';\n\nimport Part3Fr from '!babel-loader!mdx-loader!./contents/fr/partie-3.mdx';\nimport Part3En from '!babel-loader!mdx-loader!./contents/en/part-3.mdx';\n\nimport AboutFr from '!babel-loader!mdx-loader!./contents/fr/a-propos.mdx';\nimport AboutEn from '!babel-loader!mdx-loader!./contents/en/about.mdx';\n\nimport TestsFr from '!babel-loader!mdx-loader!./contents/fr/tests.mdx';\nimport TestsEn from '!babel-loader!mdx-loader!./contents/en/tests.mdx';\n\nconst summary = [\n  {\n    routes: {\n      fr: 'partie-1',\n      en: 'part-1'\n    },\n    titles: {\n      fr: 'Le déclin de la région de La Rochelle suite à la perte du Canada',\n      en: 'The decline of La Rochelle region after Canada\\'s loss'\n    },\n    shortTitles: {\n      fr: 'le déclin de la région de La Rochelle',\n      en: 'the decline of La Rochelle region'\n    },\n    contents: {\n      fr: 'fr/partie-1.mdx',\n      en: 'en/part-1.mdx'\n    },\n    contentsProcessed: {\n      fr: Part1Fr,\n      en: Part1En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'partie-2',\n      en: 'part-2'\n    },\n    titles: {\n      fr: 'Une forte spécialisation portuaire: le cas de la traite négrière, du commerce du sel et de l\\'eau-de-vie',\n      en: 'A strong portual specialization'\n    },\n    shortTitles: {\n      fr: 'une forte spécialisation portuaire',\n      en: 'a strong portual specialization'\n    },\n    contents: {\n      fr: 'fr/partie-2.mdx',\n      en: 'en/part-2.mdx'\n    },\n    contentsProcessed: {\n      fr: Part2IntroFr,\n      en: Part2IntroEn,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  // {\n  //   routes: {\n  //     fr: 'partie-2',\n  //     en: 'part-2'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2 - Une forte spécialisation portuaire: le cas de la traite négrière, du commerce du sel et de l\\'eau-de-vie',\n  //     en: 'Partie 2 - A strong portual specialization'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-intro.mdx',\n  //     en: 'en/part-2-intro.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part2IntroFr,\n  //     en: Part2IntroEn,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-1',\n  //     en: 'part-2-1'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.1 - La Rochelle et le commerce triangulaire',\n  //     en: 'Partie 2.1 - La Rochelle and triangular trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-1.mdx',\n  //     en: 'en/part-2-1.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part21Fr,\n  //     en: Part21En,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-2',\n  //     en: 'part-2-2'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.2 - Le commerce de l’eau-de-vie',\n  //     en: 'Partie 2.2 - Eau-de-vie trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-2.mdx',\n  //     en: 'en/part-2-2.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part22Fr,\n  //     en: Part22En,\n  //   },\n  // },\n  // {\n  //   routes: {\n  //     fr: 'partie-2-3',\n  //     en: 'part-2-3'\n  //   },\n  //   titles: {\n  //     fr: 'Partie 2.3 - Marennes et le commerce du sel',\n  //     en: 'Partie 2.3 - Marennes and salt trade'\n  //   },\n  //   contents: {\n  //     fr: 'fr/partie-2-3.mdx',\n  //     en: 'en/part-2-3.mdx'\n  //   },\n  //   contentsProcessed: {\n  //     fr: Part23Fr,\n  //     en: Part23En,\n  //   },\n  // },\n  {\n    routes: {\n      fr: 'partie-3',\n      en: 'part-3'\n    },\n    titles: {\n      fr: 'La Rochelle, port dominant mais pas structurant',\n      en: 'La Rochelle port, dominating but not structuring'\n    },\n    shortTitles: {\n      fr: 'un port dominant mais pas structurant',\n      en: 'a dominating but not structuring port'\n    },\n    contents: {\n      fr: 'fr/partie-3.mdx',\n      en: 'en/part-3.mdx'\n    },\n    contentsProcessed: {\n      fr: Part3Fr,\n      en: Part3En,\n    },\n    Component: ScrollyPage,\n    routeGroup: 'primary'\n  },\n  {\n    routes: {\n      fr: 'a-propos',\n      en: 'about'\n    },\n    titles: {\n      fr: 'À propos',\n      en: 'About'\n    },\n    shortTitles: {\n      fr: 'à propos',\n      en: 'about'\n    },\n    contents: {\n      fr: 'fr/a-propos.mdx',\n      en: 'en/about.mdx'\n    },\n    contentsProcessed: {\n      fr: AboutFr,\n      en: AboutEn,\n    },\n    routeGroup: 'secondary',\n  },\n  {\n    routes: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    titles: {\n      fr: 'Tests',\n      en: 'Tests'\n    },\n    shortTitles: {\n      fr: 'tests',\n      en: 'tests'\n    },\n    contents: {\n      fr: 'fr/tests.mdx',\n      en: 'fr/tests.mdx'\n    },\n    contentsProcessed: {\n      fr: TestsFr,\n      en: TestsEn,\n    },\n    routeGroup: 'secondary',\n    hide: process.env.NODE_ENV !== 'development'\n  }\n]\n\n\nexport default summary;","import React, { useState } from 'react';\n\nimport Measure from 'react-measure'\n\nimport BoatsIllustration from '../../components/BoatsIllustration';\n\n\nconst BoatsContainer = () => {\n  const [dimensions, setDimensions] = useState({});\n  return (\n    <Measure \n      bounds\n      onResize={contentRect => {\n        setDimensions(contentRect.bounds)\n      }}\n    >\n      {({ measureRef }) => (\n        <div ref={measureRef} className=\"boats-container\">\n          <BoatsIllustration {...{...dimensions}} />\n        </div>\n      )}\n    </Measure>\n  )\n}\n\nexport default BoatsContainer;","import { NavLink as Link } from 'react-router-dom';\n\n\nfunction HomeSummary({ lang, summary }) {\n  const messages = {\n    intro: {\n      fr: 'découvrir les 3 chapitres de l’étude de cas',\n      en: 'discover the 3 chapters of the case study'\n    },\n    atlas: {\n      fr: 'Accéder à l\\'atlas de toutes les visualisations',\n      en: 'Access all visualizations\\' atlas'\n    },\n    chapter: {\n      fr: 'Chapitre',\n      en: 'Chapter'\n    }\n  }\n  return (\n    <div className=\"HomeSummary\">\n      <div className=\"contents\">\n      <div className=\"intro\">\n        {messages.intro[lang]}\n      </div>\n      <ul className=\"chapters-links-container\">\n        {\n          summary\n            .filter(item => item.routeGroup === 'primary')\n            .map((item, itemIndex) => {\n              const title = item.titles[lang];\n              const route = `/${lang}/page/${item.routes[lang]}`;\n              return (\n                <li key={itemIndex}>\n                  <Link to={route}>\n                    <h4 className=\"pretitle\">{messages.chapter[lang]} {itemIndex + 1}</h4>\n                    <h3 className=\"title\">{title}</h3>\n                  </Link>\n                </li>\n              )\n            })\n        }\n      </ul>\n      <div className=\"atlas-link-container\">\n        <Link to={`/${lang}/atlas`}>\n          <h3 className=\"title\">{messages.atlas[lang]}</h3>\n        </Link>\n      </div>\n      </div>\n    </div>\n  )\n}\n\nexport default HomeSummary;","\nimport React, { useRef, useState, useReducer, useEffect } from 'react';\nimport { Helmet } from 'react-helmet';\n/* eslint-disable import/no-webpack-loader-syntax */\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport ContentsFr from '!babel-loader!mdx-loader!../../contents/fr/introduction.mdx'\nimport ContentsEn from '!babel-loader!mdx-loader!../../contents/en/introduction.mdx'\n\nimport { useScrollYPosition } from 'react-use-scroll-position';\n\nimport VisualizationController from '../../components/VisualizationController';\nimport { VisualizationControlContext } from '../../helpers/contexts';\nimport summary from '../../summary';\n\nimport BoatsContainer from './BoatsContainer';\nimport HomeSummary from './HomeSummary';\n\nconst CENTER_FRACTION = 0.5;\n// const CENTER_FRACTION = .6;\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nfunction Home({ match: {\n  params: { lang }\n} }) {\n  const introRef = useRef(null);\n  const title = metadata[lang].title\n  const titleHTML = metadata[lang].titleHTML;\n  const subtitle = metadata[lang].subtitle\n  const [activeVisualization, setActiveVisualization] = useState(undefined);\n  const [visualizations, setVisualizations] = useReducer(\n    (state, newState) => ({ ...state, ...newState }),\n    {}\n  )\n  const scrollY = useScrollYPosition();\n\n  const updateCurrentVisualization = () => {\n    // const bodyPos = document.body.getBoundingClientRect();\n    const DISPLACE_Y = window.innerHeight * CENTER_FRACTION;\n    const visualizationEntries = Object.entries(visualizations);\n    let found;\n    // on parcourt la liste à l'envers pour récupérer\n    // la visualisation la plus haute de la page qui est\n    // au-dessus du milieu de l'écran\n    for (let index = visualizationEntries.length - 1; index >= 0; index--) {\n      const y = index === 0 ? scrollY + window.innerHeight * .2 : scrollY + DISPLACE_Y;\n      const [_id, visualization] = visualizationEntries[index];/* eslint no-unused-vars : 0 */\n      const { ref } = visualization;\n      if (ref.current) {\n        const { y: initialVisY } = ref.current.getBoundingClientRect();\n        let visY = initialVisY + window.scrollY;\n        // @todo refactor this, it is dirty\n        if (ref.current.parentNode.className === 'centered-part-contents') {\n          visY += ref.current.parentNode.parentNode.getBoundingClientRect().y;\n        }\n        if (!visualization.visualizationId && scrollY + window.innerHeight * .8 > visY) {\n          found = true;\n          setActiveVisualization(undefined);\n          break;\n        } else if (y > visY) {\n          found = true;\n          if (visualization.visualizationId) {\n            setActiveVisualization(visualization);\n          } else {\n            setActiveVisualization(undefined);\n          }\n          break;\n        }\n      } else {\n        console.error('cant find ref for', visualizationEntries[index])\n      }\n    }\n    \n    if (!found && activeVisualization) {\n      setActiveVisualization(undefined);\n    }\n  }\n\n  /**\n   * Scroll to top on mount\n   */\n   useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [])\n  /**\n   * Scrollytelling management\n   */\n  useEffect(updateCurrentVisualization, [scrollY, visualizations]) /* eslint react-hooks/exhaustive-deps : 0 */\n\n  const onRegisterVisualization = (params) => {\n    const finalParams = {\n      ...params,\n      // data\n    }\n    setVisualizations({ ...visualizations, [params.id]: finalParams });\n  }\n  const onUnregisterVisualization = id => {\n    const newVis = Object.entries(visualizations).reduce((res, [thatId, payload]) => {\n      if (thatId === id) {\n        return res;\n      }\n      return {\n        ...res,\n        [thatId]: payload\n      }\n    }, {})\n    setVisualizations(newVis)\n  }\n  const onBlockClick = (id, ref) => {\n    console.log('on block click', { id, ref })\n  }\n  const onClickOnStart = () => {\n    if (introRef && introRef.current) {\n      const intro = introRef.current;\n      const top = intro.offsetTop - (window.innerHeight / 15);\n      window.scrollTo({\n        top,\n        behavior: 'smooth'\n      })\n    }\n    \n  }\n  return (\n    <div className=\"Home\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <div className=\"header\">\n        <div className=\"titles-container\">\n          <h1 dangerouslySetInnerHTML={{__html: titleHTML}}/>\n          <h2>{subtitle}</h2>\n          <button onClick={onClickOnStart} className=\"go-to-start\">\n          <span>⌄</span>\n          </button>\n        </div>\n        \n        <BoatsContainer />\n      </div>\n      <main ref={introRef} className=\"intro-container\">\n        <VisualizationControlContext.Provider\n          value={{\n            activeVisualization,\n            onBlockClick,\n            onRegisterVisualization,\n            onUnregisterVisualization,\n          }}\n        >\n          <div className=\"Contents\">\n            <section>\n              {lang === 'fr' ? <ContentsFr /> : <ContentsEn />}\n            </section>\n            <aside>\n              <VisualizationController activeVisualization={activeVisualization} />\n            </aside>\n          </div>\n        </VisualizationControlContext.Provider>\n        <HomeSummary lang={lang} summary={summary} />\n      </main>\n    </div>\n  )\n}\n\nexport default Home;","import Home from './Home';\nexport default Home;\n\n// import Carte from './Ports de la région Poitou, Aunis, Saintonge en 1789.svg'\n// export Carte;","import VisualizationController from '../../components/VisualizationController/VisualizationController.js';\n\n\nconst VisualizationFocus = ({ visualization, lang, history }) => {\n  const handleClose = () => {\n    history.push({\n      pathname: `/${lang}/atlas/`\n    })\n  }\n  const howDone = visualization[`comment_cest_fait_${lang}`];\n  const howRead = visualization[`comment_lire_${lang}`];\n  const messages = {\n    howDone: {\n      fr: 'Comment les données et la visualisations ont-elles été produites ?',\n      en: 'How were the data and visualization produced ?',\n    },\n    howRead: {\n      fr: 'Comment lire la visualisation ?',\n      en: 'How to read the visualization?'\n    }\n  }\n  return (\n    <div className=\"VisualizationFocus\">\n      <div onClick={handleClose} className=\"lightbox-background\" />\n      <div className=\"lightbox-contents\">\n        \n        <div className=\"visualization-details\">\n          <div className=\"details-header\">\n            <h2>{visualization[`titre_${lang}`]}</h2>\n            <button className=\"close-btn\" onClick={handleClose}>\n            ✕\n            </button>\n          </div>\n          <div className=\"details-contents\">\n            {\n              howDone && howDone.length ?\n              <section className=\"details-contents-section\">\n                <h3>{messages.howDone[lang]}</h3>\n                <p>\n                  {howDone}\n                </p>\n              </section>\n              : null\n            }\n            {\n              howRead && howRead.length ?\n              <section className=\"details-contents-section\">\n                <h3>{messages.howRead[lang]}</h3>\n                <p>\n                  {howRead}\n                </p>\n              </section>\n              : null\n            }\n          </div>\n        </div>\n        <div className=\"visualization-wrapper\">\n          <VisualizationController atlasMode activeVisualization={visualization} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default VisualizationFocus;","import React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {Helmet} from \"react-helmet\";\nimport cx from 'classnames';\n\n// charger le json de la liste des visualisations de l'atlas\nimport visualizations from '../../visualizationsList';\nimport VisualizationFocus from './VisualizationFocus';\n\nimport {buildPageTitle} from '../../helpers/misc';\n\n\nconst visualizationsMap = visualizations.reduce((res, visualization) => ({\n  ...res,\n  [visualization.id]: visualization\n}), {})\n\nfunction Atlas({\n  match: {\n    params: {\n      visualizationId,\n      lang\n    }\n  }\n}) {\n  const history = useHistory();\n  const shownVisualization = visualizationId && visualizationsMap[visualizationId];\n  return (\n    <div className=\"Atlas secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle('Atlas', lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <h1>Atlas</h1>\n        <ul className=\"visualizations-list\">\n          {\n            visualizations.map((visualization, visualizationIndex) => {\n              const handleClick = () => {\n                history.push({\n                  pathname: `/${lang}/atlas/${visualization.id}`\n                })\n              }\n              return (\n                <li\n                  className={cx('visualization-item', { 'is-active': shownVisualization && shownVisualization.id === visualization.id })}\n                  onClick={handleClick}\n                  key={visualizationIndex}\n                >\n                  <figure className=\"thumbnail-container\">\n                    {visualization.thumbnail ?\n                      <img\n                        src={`${process.env.PUBLIC_URL}/images/thumbnails/${visualization.thumbnail}}`}\n                        alt={visualization[`titre_${lang}`]}\n                      />\n                      : null\n                    }\n                  </figure>\n                  <h5 className=\"visualization-title\">\n                    {visualization[`titre_${lang}`]}\n                  </h5>\n                </li>\n              )\n            })\n          }\n        </ul>\n      </div>\n      {\n        shownVisualization ?\n          <VisualizationFocus history={history} visualization={shownVisualization} lang={lang} />\n          : null\n      }\n    </div>\n  );\n}\n\nexport default Atlas;","import Atlas from './Atlas';\n\nexport default Atlas;","import React, { useMemo, useState } from 'react';\nimport {useLocation} from 'react-router-dom';\nimport {NavLink as Link} from 'react-router-dom'; \nimport { useScrollYPosition } from 'react-use-scroll-position';\nimport cx from 'classnames';\n\nimport metadataFr from '../../contents/fr/metadata'\nimport metadataEn from '../../contents/en/metadata'\n\nimport {scaleLinear} from 'd3-scale';\n\nimport colorPalettes from '../../colorPalettes'\nimport { useDebounce } from '../../helpers/hooks';\n\nconst metadata = {\n  fr: metadataFr,\n  en: metadataEn\n}\n\nconst {\n  ui: {\n    colorText,\n    // colorAccent,\n    colorAccentBackground,\n    colorBackgroundBlue,\n    colorBackground\n  }\n} = colorPalettes;\n\nconst HeaderNav = ({\n  routes,\n  onLangChange,\n}) => {\n  const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n  const location = useLocation();\n  const pageType = useMemo(() => {\n    if (location.pathname.includes('/page/')) {\n      return 'page';\n    } else if (location.pathname === '/fr/' || location.pathname === '/en/') {\n      return 'home';\n    }\n    else return 'other-page';\n  }, [location])\n  const paramsLang = location && location.match && location.match.params && location.match.params.lang;\n  let lang = 'fr';\n  if (paramsLang) {\n    lang = paramsLang;\n  } else if (location.pathname.includes('/en/')) {\n    lang = 'en';\n  }\n  const liveScrollY = useScrollYPosition();\n\n  const scrollY = useDebounce(liveScrollY, 50)\n\n  const pageColorScale = scaleLinear().range([colorBackgroundBlue, colorBackground]).domain([0, 1])\n  const {fontColor, backgroundColor} = useMemo(() => {\n    // const wrapper = document.getElementById('wrapper');\n    // if (!wrapper) {\n    //   return {fontColor: undefined, backgroundColor: undefined}\n    // }\n    // const scrollHeight = wrapper.offsetHeight;\n    const screenHeight = window.innerHeight;\n    switch(pageType) {\n      case 'page':\n        if (scrollY < screenHeight) {\n          return {\n            fontColor: colorText,\n            backgroundColor: pageColorScale((scrollY / (screenHeight / 2))),\n          }\n        } else {\n          return {\n            backgroundColor: colorBackground\n          }\n        }\n      case 'home':\n        if (scrollY < screenHeight * .8) {\n          return {\n            fontColor: colorText,\n            backgroundColor: colorBackgroundBlue,\n          }\n        } else {\n          return {\n            fontColor: 'white',\n            backgroundColor: colorAccentBackground\n          }\n        }\n        \n      case 'other-page':\n      default:\n        return {\n          fontColor: undefined,\n          backgroundColor: undefined\n        }\n\n    }\n    \n  }, [scrollY, pageColorScale, pageType])\n\n  const title = metadata[lang].titleHTML\n\n  return (\n    <>\n      <nav\n        style={{\n          background: backgroundColor,\n          color: fontColor\n        }}\n        className=\"nav nav-large\"\n      >\n        <ul className=\"primary-nav-container\">\n          <li className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {\n                fontColor === 'white' ?\n                <img src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n                :\n                <img src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n              }\n            </Link>\n          </li>\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'primary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'secondary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n            <li className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n              <>\n              <li className=\"navitem-container lang-toggle\">\n                <button \n                  className={lang === 'fr' ? 'is-active': ''}\n                  onClick={() => onLangChange('fr')}\n                >fr</button>\n              </li>\n              <li className=\"navitem-container lang-toggle\">\n                <button\n                  className={lang === 'en' ? 'is-active': ''}\n                  onClick={() => onLangChange('en')}\n                >en</button>\n              </li>\n              </>\n              : null\n            }\n        </ul>\n      </nav>\n      <nav\n        style={{\n          // background: backgroundColor,\n          // color: fontColor\n        }}\n        className={cx(\"nav nav-drawer\", {'is-open': drawerIsOpen})}\n      >\n        <div className=\"drawer-background\" onClick={() => setDrawerIsOpen(!drawerIsOpen)} />\n        <div className=\"drawer-body\">\n        <ul className=\"primary-nav-container\">\n          <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n            <Link exact to={`/${lang}/`}>\n              {lang === 'fr' ? 'accueil' : 'home'}\n            </Link>\n          </li>\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'primary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n        </ul>\n        <ul className=\"secondary-nav-container\">\n          {\n              routes\n              .filter(({routeGroup = 'primary', hide}) => routeGroup === 'secondary' && !hide)\n              .map(({shortTitles, routes: inputRoute}, index) => {\n                const route = `/${lang}/page/${inputRoute[lang]}`\n                return (\n                  <li onClick={() => setDrawerIsOpen(false)} key={index} className=\"navitem-container\">\n                    <Link to={route}>\n                      {shortTitles[lang]}\n                    </Link>\n                  </li>\n                )\n                })\n            }\n            <li onClick={() => setDrawerIsOpen(false)} className=\"navitem-container\">\n              <Link to={`/${lang}/atlas`}>\n                {lang === 'fr' ? 'atlas des visualisations' : 'visualizations atlas'}\n              </Link>\n            </li>\n            {\n              // @todo delete this ternary when english contents are ready\n              process.env.NODE_ENV === 'development' ?\n              <li className=\"navitem-container lang-toggle\">\n                <ul className=\"lang-toggle-container\">\n                  <li>\n                    <button \n                      className={lang === 'fr' ? 'is-active': ''}\n                      onClick={() => onLangChange('fr')}\n                    >fr</button>\n                  </li>\n                  <li>\n                    <button\n                      className={lang === 'en' ? 'is-active': ''}\n                      onClick={() => onLangChange('en')}\n                    >en</button>\n                  </li>\n                </ul>\n                \n              </li>\n              :\n              null\n            }\n            \n            \n        </ul>\n        </div>\n        <div className=\"drawer-header\">\n          <button onClick={() => setDrawerIsOpen(!drawerIsOpen)} className={cx('drawer-button')}>\n            {\n              fontColor === 'white' || drawerIsOpen ?\n              <img style={{background: drawerIsOpen ? undefined: backgroundColor}} src={`${process.env.PUBLIC_URL}/rose_des_vents_white.svg`} alt=\"logo\" />\n              :\n              <img style={{background: drawerIsOpen ? undefined: backgroundColor}} src={`${process.env.PUBLIC_URL}/rose_des_vents.svg`} alt=\"logo\" />\n            }\n          </button>\n          <Link exact to={`/${lang}/`}>\n            <h1 style={{\n              color: drawerIsOpen ? undefined : fontColor,\n              background: drawerIsOpen ? undefined : backgroundColor,\n              }} dangerouslySetInnerHTML={{__html: title}} />\n          </Link>\n        </div>\n      </nav>\n    </>\n  )\n}\n\nexport default HeaderNav;","import HeaderNav from './HeaderNav';\n\nexport default HeaderNav;","const Loader = ({ percentsLoaded = 0 }) => {\n  return (\n    <div className=\"loader-container\">\n      <div className=\"loader\">\n        <div className=\"loading-bar\" style={{ width: percentsLoaded + '%' }} />\n      </div>\n    </div>\n  )\n}\n\nexport default Loader;","import PlainPage from './PlainPage';\n\nexport default PlainPage;","import {Suspense} from 'react';\nimport {Helmet} from \"react-helmet\";\n\nimport {buildPageTitle} from '../../helpers/misc';\n\nconst PlainPage = ({\n  Content,\n  contentsURL,\n  title,\n  lang = 'fr'\n}) => {\n  return (\n    <div className=\"PlainPage secondary-page\">\n      <Helmet>\n        <title>{buildPageTitle(title, lang)}</title>\n      </Helmet>\n      <div className=\"centered-contents\">\n        <Suspense fallback={<div>Chargement</div>}>\n          <Content />\n        </Suspense>\n      </div>\n  </div>\n  )\n}\n\nexport default PlainPage;","import Footer from './Footer';\n\nexport default Footer;","/* eslint import/no-webpack-loader-syntax : 0 */\nimport FooterFr from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\nimport FooterEn from '!babel-loader!mdx-loader!../../contents/fr/footer.mdx';\n\nconst Footer = ({lang}) => {\n  return (\n    <footer className=\"Footer\">\n      <div className=\"footer-contents\">\n      {lang === 'fr' ? <FooterFr /> : <FooterEn />}\n      </div>\n    </footer>\n  )\n}\n\nexport default Footer;","\n/* import external libraries */\nimport React, { useState, useEffect } from \"react\";\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useHistory,\n  useLocation,\n} from \"react-router-dom\";\n\nimport uniq from 'lodash/uniq';\nimport {csvParse, tsvParse} from 'd3-dsv';\n\n\nimport axios from 'axios';\nimport visualizationsList from './visualizationsList';\n\n/* import pages */\nimport Home from './pages/Home';\nimport Atlas from \"./pages/Atlas\";\n\n/* import components */\nimport HeaderNav from './components/HeaderNav';\nimport Loader from './components/Loader/Loader';\n\nimport PlainPage from './pages/PlainPage';\n\nimport {DatasetsContext} from './helpers/contexts';\n\n/* import other assets */\nimport './App.scss';\n\nimport routes from './summary'\nimport Footer from \"./components/Footer\";\n\nconst LANGUAGES = ['fr', 'en'];\n\nfunction App() {\n\n  const history = useHistory();\n  const location = useLocation();\n  const [datasets, setDatasets] = useState({})\n  const [loadingFraction, setLoadingFraction] = useState(0);\n\n  /**\n   * loading all datasets\n   */\n   useEffect(() => {\n    // loading all datasets from the atlas\n    // @todo do this on a page-to-page basis if datasets happens to be to big/numerous\n    const datasetsNames = uniq(visualizationsList.filter(d => d.datasets).reduce((res, d) => [...res, ...d.datasets.split(',').map(d => d.trim())], []));\n    datasetsNames.reduce((cur, datasetName, datasetIndex) => {\n      return cur.then((res) => new Promise((resolve, reject) => {\n\n        const url = datasetName ? `${process.env.PUBLIC_URL}/data/${datasetName}` : undefined;\n        if (url) {\n          axios.get(url, {\n            onDownloadProgress: progressEvent => {\n              const status = progressEvent.loaded / progressEvent.total;\n              const globalFraction = datasetIndex / datasetsNames.length;\n              setLoadingFraction(globalFraction + status / routes.length);\n            }\n          })\n            .then(({ data: inputData }) => {\n              setTimeout(() => {\n                let loadedData = inputData;\n                if (url.split('.').pop() === 'csv') {\n                  loadedData = csvParse(inputData);\n                } else if (url.split('.').pop() === 'tsv') {\n                  loadedData = tsvParse(inputData);\n                }\n                resolve({...res, [datasetName]: loadedData})\n              })\n            })\n            .catch(reject)\n        } else return resolve(res);\n\n      }))\n    }, Promise.resolve({}))\n    .then(newDatasets => {\n      setLoadingFraction(1);\n      setDatasets(newDatasets)\n    })\n    .catch(console.log)\n  }, [])\n\n  const onLangChange = (ln) => {\n    const otherLang = ln === 'fr' ? 'en' : 'fr';\n\n    const { pathname } = location;\n    if (pathname.includes('atlas')) {\n      const visualizationId = pathname.split('/atlas/').pop();\n      history.push(`/${ln}/atlas/${visualizationId || ''}`);\n    } else {\n      const pathOtherLang = history.location.pathname.split('/').pop();\n      const routeItem = routes.find(route => {\n        return route.routes[otherLang] === pathOtherLang;\n      });\n      if (routeItem) {\n        history.push(`/${ln}/page/${routeItem.routes[ln]}`);\n      } else {\n        history.push(`/${ln}/`);\n      }\n    }\n  }\n  const renderRoute = ({\n    Content,\n    ContentSync,\n    ThatComponent = PlainPage,\n    title,\n  }) => (\n    <>\n      <ThatComponent\n        {\n        ...{\n          Content,\n          ContentSync,\n          title\n        }\n        }\n      />\n    </>\n\n  );\n  return (\n    <DatasetsContext.Provider value={datasets}>\n      <div id=\"wrapper\">\n        <header>\n          <HeaderNav {...{ onLangChange, routes }} />\n        </header>\n        <main>\n          <Switch>\n            {\n              LANGUAGES.map(lang => {\n                return routes.map(({\n                  titles,\n                  routes: inputRoute,\n                  contents,\n                  Component: ThatComponent,\n                  contentsProcessed\n                }, index) => {\n                  const route = `/${lang}/page/${inputRoute[lang]}`\n                  const title = titles[lang];\n                  const Content = React.lazy(() => import(`!babel-loader!mdx-loader!./contents/${contents[lang]}`));\n                  const ContentSync = contentsProcessed[lang]\n                  return (\n                    <Route key={index} path={route} exact>\n                      {renderRoute({ Content, ThatComponent, title, ContentSync })}\n                    </Route>\n                  )\n                })\n              })\n            }\n            <Route path=\"/:lang/atlas/:visualizationId?\" component={Atlas} />\n            <Route path=\"/:lang\" exact component={Home} />\n            <Redirect to={`/fr/`} />\n          </Switch>\n          {\n            datasets ?\n            null :\n            <Loader percentsLoaded={loadingFraction * 100} />\n          }\n        </main>\n        <Footer\n          lang={'fr'}\n        />\n        \n        \n      </div>\n    </DatasetsContext.Provider>\n  );\n}\n\n\nexport default function Wrapper() {\n  return (\n    <Router>\n      <App />\n    </Router>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst rootElement = document.getElementById(\"root\");\nif (rootElement.hasChildNodes()) {\n  hydrate(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n} else {\n  render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>, rootElement);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","\nimport React from 'react';\n\nexport const VisualizationControlContext = React.createContext({\n\n})\n\nexport const DatasetsContext = React.createContext({\n\n})\n","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-échelles autour du port de La Rochelle au XVIIIème siècle\",\n  \"titleHTML\": \"Commerce multi-échelles autour du port de La Rochelle au <span>XVIII</span><sup>e</sup> siècle\",\n  \"subtitle\": \"Une étude de cas du programme de recherche interdisciplinaire PORTIC\"\n}","/* eslint import/no-anonymous-default-export : 0 */\nexport default {\n  \"title\": \"Commerce multi-échelles autour du port de La Rochelle au XVIIIème siècle\",\n  \"titleHTML\": \"Commerce multi-échelles autour du port de La Rochelle au XVIII<sup>e</sup> siècle\",\n  \"subtitle\": \"Une étude de cas du programme de recherche interdisciplinaire PORTIC\"\n}"],"sourceRoot":""}